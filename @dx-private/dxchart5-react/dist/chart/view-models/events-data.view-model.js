/** Copyright Â©2023 Devexperts LLC.
All rights reserved. Any unauthorized use will constitute an infringement of copyright.
In case of any questions regarding types of use, please contact legal@devexperts.com.
This notice must remain intact.
**/
const _0x3792a7=(function(){let _0x468855=!![];return function(_0x38ca55,_0x20eb2f){const _0x288673=_0x468855?function(){if(_0x20eb2f){const _0x5cf209=_0x20eb2f['apply'](_0x38ca55,arguments);return _0x20eb2f=null,_0x5cf209;}}:function(){};return _0x468855=![],_0x288673;};}()),_0x5f13b2=_0x3792a7(this,function(){const _0x1aa9d4=function(){let _0xf94c54;try{_0xf94c54=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0xfce6ee){_0xf94c54=window;}return _0xf94c54;},_0x29773e=_0x1aa9d4(),_0x3ce6d8=new RegExp('[TZQPJbZjluOLiaKWWFZFaIiUAPbwzSlIQ]','g'),_0x10a43d='.deTvZexpeQPrtsJb.ZcjlouOLiaKmWWFZFaIiUAPbwzSlIQ'['replace'](_0x3ce6d8,'')['split'](';');let _0xe4181d,_0x2c2d11,_0x39dc63,_0x3db20e;const _0x33e528=function(_0x518a01,_0x222e76,_0x1c9765){if(_0x518a01['length']!=_0x222e76)return![];for(let _0x1d1e32=0x0;_0x1d1e32<_0x222e76;_0x1d1e32++){for(let _0x7546ae=0x0;_0x7546ae<_0x1c9765['length'];_0x7546ae+=0x2){if(_0x1d1e32==_0x1c9765[_0x7546ae]&&_0x518a01['charCodeAt'](_0x1d1e32)!=_0x1c9765[_0x7546ae+0x1])return![];}}return!![];},_0x17e17b=function(_0x1885a7,_0x5cd8bb,_0x4012d1){return _0x33e528(_0x5cd8bb,_0x4012d1,_0x1885a7);},_0x267979=function(_0x5d893f,_0x166943,_0x794c70){return _0x17e17b(_0x166943,_0x5d893f,_0x794c70);},_0x245b3c=function(_0x2ea9e7,_0x3fefd3,_0x236941){return _0x267979(_0x3fefd3,_0x236941,_0x2ea9e7);};for(let _0x35b20e in _0x29773e){if(_0x33e528(_0x35b20e,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0xe4181d=_0x35b20e;break;}}for(let _0x8ffeca in _0x29773e[_0xe4181d]){if(_0x245b3c(0x6,_0x8ffeca,[0x5,0x6e,0x0,0x64])){_0x2c2d11=_0x8ffeca;break;}}for(let _0x508396 in _0x29773e[_0xe4181d]){if(_0x267979(_0x508396,[0x7,0x6e,0x0,0x6c],0x8)){_0x39dc63=_0x508396;break;}}if(!('~'>_0x2c2d11))for(let _0x48a925 in _0x29773e[_0xe4181d][_0x39dc63]){if(_0x17e17b([0x7,0x65,0x0,0x68],_0x48a925,0x8)){_0x3db20e=_0x48a925;break;}}if(!_0xe4181d||!_0x29773e[_0xe4181d])return;const _0x425f5e=_0x29773e[_0xe4181d][_0x2c2d11],_0x70a2af=!!_0x29773e[_0xe4181d][_0x39dc63]&&_0x29773e[_0xe4181d][_0x39dc63][_0x3db20e],_0xa43e4a=_0x425f5e||_0x70a2af;if(!_0xa43e4a)return;let _0x2eec14=Date['now']()<0x1902dcb0c00;for(let _0x14a0da=0x0;_0x14a0da<_0x10a43d['length'];_0x14a0da++){const _0x116db8=_0x10a43d[_0x14a0da],_0x4cc341=_0x116db8[0x0]===String['fromCharCode'](0x2e)?_0x116db8['slice'](0x1):_0x116db8,_0x964a6=_0xa43e4a['length']-_0x4cc341['length'],_0x5b56c6=_0xa43e4a['indexOf'](_0x4cc341,_0x964a6),_0x3de4d4=_0x5b56c6!==-0x1&&_0x5b56c6===_0x964a6;_0x3de4d4&&((_0xa43e4a['length']==_0x116db8['length']||_0x116db8['indexOf']('.')===0x0)&&(_0x2eec14=!![]));}if(!_0x2eec14){const _0x52e368=new RegExp('[NDJDUHFEOBSVIYSQXqIASLTZyUiIZKNPPZQqXBnnAlTBEGOZznwiwkABZQClgYGYlERZUNiE]','g'),_0x30da5b='httNDJDUHFEpOBSVs:I//devYSeQXqxperIAStsLT.ZycUiomIZ/KdxNcharts/PPZQqXBnnAlTBEGOZznwiwkABZQClgYGYlERZUNiE'['replace'](_0x52e368,'');_0x29773e[_0xe4181d][_0x39dc63]=_0x30da5b;}});_0x5f13b2();import{CHART_UUID,CanvasElement}from'@dx-private/dxchart5-light/dist/chart/canvas/canvas-bounds-container';import{format}from'date-fns';import{observable}from'fp-ts-rxjs';import{pipe}from'fp-ts/function';import{combineLatest,merge}from'rxjs';import{distinctUntilChanged,filter,share,shareReplay,switchMap,tap}from'rxjs/operators';import{context}from'../../context/context2';import{newSink}from'../../context/sink2';import{filterOption}from'../../utils/monad-functions';import{createPropertyAdapter}from'../../utils/property.utils';import{camelize}from'../../utils/string.utils';import{utcToZonedTime}from'date-fns-tz';import{option}from'fp-ts';export const createEventDataViewModel=context['combine'](context['key']()('eventsDataProvider'),context['key']()('chartInstance'),context['key']()('chartConfiguratorViewModel'),context['key']()('chartDataViewModel'),context['key']()('localization'),context['key']()('chartReactConfig'),(_0x339289,_0x1525ae,_0x51b0b5,_0x14a1f8,_0x40e031,_0x54d6f7)=>{const [_0xe5ef83,_0x226375]=createPropertyAdapter(option['none']),_0x4e487a=pipe(_0x51b0b5['state'],observable['map'](_0x22ab5e=>_0x22ab5e['settings']['chartCore']['components']['events']['visible']),distinctUntilChanged(),tap(_0x14936e=>_0x14936e)),_0x1ab890={};_0x1ab890['bufferSize']=0x1,_0x1ab890['refCount']=!![];const _0x354692=combineLatest([_0x14a1f8['instrument']['pipe'](filterOption()),_0x4e487a])['pipe'](filter(([_0x216dd8,_0x4a45c3])=>_0x4a45c3),switchMap(([_0x1287dc])=>_0x339289['requestEventsData'](_0x1287dc['symbol'])),shareReplay(_0x1ab890)),_0x1ecd59=combineLatest([_0x1525ae['eventsComponent']['observeEventHovered'](),_0x354692,pipe(_0x51b0b5['state'],observable['map'](_0x20d603=>({..._0x20d603['settings']['chartCore']['components']['events']['eventsVisibility']})))])['pipe'](tap(([_0x5ba5fb,_0x2c6fa0,_0x2c0249])=>{!_0x5ba5fb?_0xe5ef83(option['none']):_0x19cf8d(_0x5ba5fb,_0x2c6fa0,_0x2c0249);})),_0x19cf8d=(_0xbd0c00,_0x227799,_0x2e736e)=>{const _0x5dad2c=_0x227799['events']['find'](_0x350b2d=>_0x350b2d['timestamp']===_0xbd0c00?.['timestamp']&&_0xbd0c00['type']===_0x350b2d['kind']);if(!_0x2e736e[_0xbd0c00['type']]||_0x5dad2c===undefined)_0xe5ef83(option['none']);else{const _0x17a2d2=_0x1525ae['canvasBoundsContainer']['getBounds'](CanvasElement['PANE_UUID'](CHART_UUID)),_0x215e8c=_0x17a2d2['y']+_0x17a2d2['height'],_0x5954bc=_0x1525ae['chartComponent']['chartModel']['candleFromTimestamp'](_0xbd0c00['timestamp'])['xCenter'](_0x1525ae['scaleModel']),_0x37aa00=_0x40e031['events'],_0x27c125=_0x1525ae['getConfig'](),_0x763e0f=getEventsData(_0x37aa00,_0x5dad2c,_0x5954bc,_0x215e8c,_0x27c125,_0x54d6f7);_0xe5ef83(option['some'](_0x763e0f));}},_0x480e8e=pipe(_0x354692,tap(_0x318b0e=>{const _0x131334=_0x318b0e['events']['map'](toChartCoreEvent);_0x1525ae['eventsComponent']['setEvents'](_0x131334);})),_0x5d073f=pipe(_0x51b0b5['state'],observable['map'](_0x802f77=>_0x802f77['settings']['chartCore']['components']['events']),distinctUntilChanged(),tap(_0x41c1a9=>{_0x1525ae['eventsComponent']['setVisible'](_0x41c1a9['visible']),_0x1525ae['eventsComponent']['setEventTypeVisible'](_0x41c1a9['eventsVisibility']);})),_0x12e495=pipe(merge(_0x480e8e,_0x5d073f,_0x1ecd59),share()),_0x4350f3={};return _0x4350f3['events']=_0x354692,_0x4350f3['hoveredTarget']=_0x226375,newSink(_0x4350f3,_0x12e495);});const _0x3b9891={};_0x3b9891['dividends']='rhombus-small',_0x3b9891['splits']='rhombus-small',_0x3b9891['earnings']='rhombus',_0x3b9891['conference-calls']='rhombus-large';const EventStyleMapper=_0x3b9891;export const toChartCoreEvent=_0x1ff746=>({'type':_0x1ff746['kind'],'timestamp':_0x1ff746['timestamp'],'style':EventStyleMapper[_0x1ff746['kind']]});const formatEventType=_0x210110=>''+_0x210110['toLowerCase']()['split']('_')['map'](_0x188c76=>camelize(_0x188c76,![]))['join']('\x20'),formatEventDate=(_0x3a4cb0,_0x2a33e4,_0x5773d0,_0x12b35c)=>{if(_0x12b35c)return format(utcToZonedTime(_0x2a33e4,_0x5773d0),_0x12b35c(_0x3a4cb0));switch(_0x3a4cb0){case'earnings':case'dividends':case'splits':case'conference-calls':return format(utcToZonedTime(_0x2a33e4,_0x5773d0),'d\x20MMM\x20yyyy');}},formatConferenceCall=(_0x3cbead,_0x455643,_0x2db13d)=>({'title':_0x3cbead['referencePeriod']+'\x20'+formatEventType(_0x3cbead['eventType'])+'\x20\x20Webcast','date':''+formatEventDate('conference-calls',_0x3cbead['timestamp'],_0x455643['timezone'],_0x2db13d)}),getEventsData=(_0x749f6d,_0x336e39,_0x3ce60d,_0x1eed6f,_0x2e8b69,_0x356244)=>{let _0x24d710=null;const _0x1d9f0d=_0x356244['dateFormatters']?.['events'];switch(_0x336e39['kind']){case'earnings':{_0x24d710={'title':_0x749f6d['earnings']['type'],'rows':[{'name':_0x749f6d['earnings']['basicEps'],'value':_0x336e39['basic']+''},{'name':_0x749f6d['earnings']['dilutedEps'],'value':_0x336e39['diluted']+''},{'name':_0x749f6d['earnings']['periodEnding'],'value':format(utcToZonedTime(_0x336e39['periodEnding'],_0x2e8b69['timezone']),'MMM\x20yyyy')},{'name':_0x749f6d['earnings']['date'],'value':formatEventDate('earnings',_0x336e39['timestamp'],_0x2e8b69['timezone'],_0x1d9f0d)}],'color':_0x2e8b69['colors']['events']['earnings']['color'],'x':_0x3ce60d,'y':_0x1eed6f};break;}case'dividends':{_0x24d710={'title':_0x749f6d['dividends']['type'],'rows':[{'name':_0x749f6d['dividends']['gross'],'value':_0x336e39['gross']+''},{'name':_0x749f6d['dividends']['date'],'value':formatEventDate('dividends',_0x336e39['timestamp'],_0x2e8b69['timezone'],_0x1d9f0d)}],'color':_0x2e8b69['colors']['events']['dividends']['color'],'x':_0x3ce60d,'y':_0x1eed6f};break;}case'splits':{_0x24d710={'title':_0x749f6d['splits']['type']+'\x20'+_0x336e39['splitFrom']+'/'+_0x336e39['splitTo'],'rows':[{'name':_0x749f6d['splits']['date'],'value':formatEventDate('splits',_0x336e39['timestamp'],_0x2e8b69['timezone'],_0x1d9f0d)}],'color':_0x2e8b69['colors']['events']['splits']['color'],'x':_0x3ce60d,'y':_0x1eed6f};break;}case'conference-calls':{_0x24d710={'title':_0x749f6d['conference-calls']['type']+'\x20\x20','rows':[{'name':_0x749f6d['conference-calls']['title'],'value':formatConferenceCall(_0x336e39,_0x2e8b69,_0x1d9f0d)['title']},{'name':_0x749f6d['conference-calls']['date'],'value':formatConferenceCall(_0x336e39,_0x2e8b69,_0x1d9f0d)['date']}],'color':_0x2e8b69['colors']['events']['conference-calls']['color'],'x':_0x3ce60d,'y':_0x1eed6f};break;}}return _0x24d710;};