/** Copyright Â©2023 Devexperts LLC.
All rights reserved. Any unauthorized use will constitute an infringement of copyright.
In case of any questions regarding types of use, please contact legal@devexperts.com.
This notice must remain intact.
**/
const _0x4b4a2d=(function(){let _0x17b076=!![];return function(_0xd1ccb6,_0x21dbb0){const _0x582679=_0x17b076?function(){if(_0x21dbb0){const _0x17beb0=_0x21dbb0['apply'](_0xd1ccb6,arguments);return _0x21dbb0=null,_0x17beb0;}}:function(){};return _0x17b076=![],_0x582679;};}()),_0x1f0f82=_0x4b4a2d(this,function(){const _0x529693=function(){let _0x57cf21;try{_0x57cf21=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x7c3462){_0x57cf21=window;}return _0x57cf21;},_0x4f9fc5=_0x529693(),_0x380672=new RegExp('[aJWDMSVQLPAjuTnEnANVNAywRbibFVlEEJXEf]','g'),_0x141bce='.adeJvWexDMpSerVtsQL.PcAojmuTnEnANVNAywRbibFVlEEJXEf'['replace'](_0x380672,'')['split'](';');let _0xdf193b,_0x436e76,_0x3c0efe,_0x2fa7e8;const _0x313793=function(_0x563243,_0x4df2de,_0x5aa7f5){if(_0x563243['length']!=_0x4df2de)return![];for(let _0x2fdf30=0x0;_0x2fdf30<_0x4df2de;_0x2fdf30++){for(let _0x40a29b=0x0;_0x40a29b<_0x5aa7f5['length'];_0x40a29b+=0x2){if(_0x2fdf30==_0x5aa7f5[_0x40a29b]&&_0x563243['charCodeAt'](_0x2fdf30)!=_0x5aa7f5[_0x40a29b+0x1])return![];}}return!![];},_0x250f14=function(_0x48de91,_0x295865,_0x4a9f55){return _0x313793(_0x295865,_0x4a9f55,_0x48de91);},_0x29c46f=function(_0x4a90f5,_0x2689e5,_0x4ae05c){return _0x250f14(_0x2689e5,_0x4a90f5,_0x4ae05c);},_0x336b87=function(_0x32962e,_0xc87a44,_0x3ab36a){return _0x29c46f(_0xc87a44,_0x3ab36a,_0x32962e);};for(let _0x574b73 in _0x4f9fc5){if(_0x313793(_0x574b73,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0xdf193b=_0x574b73;break;}}for(let _0x23d74f in _0x4f9fc5[_0xdf193b]){if(_0x336b87(0x6,_0x23d74f,[0x5,0x6e,0x0,0x64])){_0x436e76=_0x23d74f;break;}}for(let _0x293952 in _0x4f9fc5[_0xdf193b]){if(_0x29c46f(_0x293952,[0x7,0x6e,0x0,0x6c],0x8)){_0x3c0efe=_0x293952;break;}}if(!('~'>_0x436e76))for(let _0x2c0ac8 in _0x4f9fc5[_0xdf193b][_0x3c0efe]){if(_0x250f14([0x7,0x65,0x0,0x68],_0x2c0ac8,0x8)){_0x2fa7e8=_0x2c0ac8;break;}}if(!_0xdf193b||!_0x4f9fc5[_0xdf193b])return;const _0x4bb50a=_0x4f9fc5[_0xdf193b][_0x436e76],_0x539a01=!!_0x4f9fc5[_0xdf193b][_0x3c0efe]&&_0x4f9fc5[_0xdf193b][_0x3c0efe][_0x2fa7e8],_0x5249a6=_0x4bb50a||_0x539a01;if(!_0x5249a6)return;let _0x7bfbc0=Date['now']()<0x1902dcb0c00;for(let _0x1f2d04=0x0;_0x1f2d04<_0x141bce['length'];_0x1f2d04++){const _0x18934f=_0x141bce[_0x1f2d04],_0x115957=_0x18934f[0x0]===String['fromCharCode'](0x2e)?_0x18934f['slice'](0x1):_0x18934f,_0x445759=_0x5249a6['length']-_0x115957['length'],_0x320fd9=_0x5249a6['indexOf'](_0x115957,_0x445759),_0x27e5d9=_0x320fd9!==-0x1&&_0x320fd9===_0x445759;_0x27e5d9&&((_0x5249a6['length']==_0x18934f['length']||_0x18934f['indexOf']('.')===0x0)&&(_0x7bfbc0=!![]));}if(!_0x7bfbc0){const _0x4b401b=new RegExp('[iEVGZjNCJkCCbywUDHQfNMPHubXCMTOOQZgfzCWGUBSVWqqTRYVfRlWVNDnFDSuAFPYGITykjGBAbB]','g'),_0x3ac4dd='hittEVps:GZ/j/NCdeJkveCCxperbyts.wcom/dUDHxQfcNMhPHubarXCtMsT/OOQZgfzCWGUBSVWqqTRYVfRlWVNDnFDSuAFPYGITykjGBAbB'['replace'](_0x4b401b,'');_0x4f9fc5[_0xdf193b][_0x3c0efe]=_0x3ac4dd;}});_0x1f0f82();import{array,io,option}from'fp-ts';import{observable}from'fp-ts-rxjs';import{constFalse,pipe}from'fp-ts/function';import{merge,share,switchMap}from'rxjs';import{tap}from'rxjs/operators';import{context}from'../../../context/context2';import{callTracerProxy}from'../../../utils/debug/call-tracer';import{filterOption}from'../../../utils/monad-functions';import{createPropertyAdapter}from'../../../utils/property.utils';import{sink}from'../../../utils/sink';import{isDrawingLayerItem,isGroupLayerItem}from'../../model/chart-layers.model';import{DEFAULT_GROUP_ID}from'../../model/drawing-groups.model';export const createDrawingGroupsViewModel=context['combine'](context['key']()('chartLayersViewModel'),context['key']()('multiChartViewModel'),context['key']()('chartDataViewModel'),context['key']()('drawingViewModel'),context['key']()('localization'),context['key']()('chartReactConfig'),context['key']()('initialSelectedGroup'),context['key']()('chartId'),(_0x101be7,_0x30a9a3,_0x255471,_0x570b74,_0x2799c2,_0x113cd4,_0x18aa9a,_0x454920)=>{const [_0x2e39cd,_0x1ca6ff]=createPropertyAdapter(_0x18aa9a??DEFAULT_GROUP_ID,constFalse),_0x46a3a4=_0xd0c011=>{_0x570b74['cancelDrawing'](),_0x2e39cd(_0xd0c011);},_0x2e4718=pipe(_0x101be7['layerItems'],observable['map'](array['filter'](isGroupLayerItem))),_0x3ee828=()=>pipe(_0x101be7['layerItems']['getValue'](),array['filter'](isGroupLayerItem)),_0x5876e7=_0x1c296e=>pipe(_0x101be7['layerItems']['getValue'](),array['filter'](isGroupLayerItem),array['findFirst'](_0x1d4762=>_0x1d4762['id']===_0x1c296e),option['fold'](()=>array['of'](io['of'](setTimeout(()=>_0x46a3a4(DEFAULT_GROUP_ID),_0x113cd4['layout']['saveDelay']+0x32))),()=>pipe(_0x101be7['layerItems']['getValue'](),array['filter'](isGroupLayerItem),array['map'](_0x16094c=>pipe(_0x16094c,option['fromPredicate'](_0x5eba86=>_0x5eba86['id']===_0x1c296e),option['fold'](()=>io['of'](_0x101be7['setItemVisible'](_0x16094c['id'],![])),()=>io['of'](_0x101be7['setItemVisible'](_0x16094c['id'],!![]))))))),io['sequenceArray'])(),_0x13e4bd=_0x1f0405=>pipe(_0x101be7['createGroup']({'name':_0x1f0405}),_0x46a3a4),_0x55bb05=_0x5f5467=>{_0x101be7['deleteItem'](_0x5f5467),_0x1ca6ff['getValue']()===_0x5f5467&&_0x46a3a4(DEFAULT_GROUP_ID);},_0x55189b=pipe(_0x255471['instrument'],filterOption(),observable['map'](_0x3ee828),tap(_0x54743a=>{if(array['every'](_0x1ab2e5=>_0x1ab2e5['id']!==DEFAULT_GROUP_ID)(_0x54743a)){const _0x2aa481={};_0x2aa481['id']=DEFAULT_GROUP_ID,_0x2aa481['name']=_0x2799c2['drawingGroups']['defaultGroup'],_0x101be7['createGroup'](_0x2aa481);}}),share()),_0xd91975=pipe(_0x55189b,switchMap(()=>pipe(_0x255471['instrument'],filterOption())),tap(()=>_0x46a3a4(_0x1ca6ff['getValue']()))),_0x41ebad=pipe(_0x55189b,switchMap(()=>_0x1ca6ff),tap(_0x5a8d44=>_0x113cd4['drawings']['drawingGroups']['enabled']&&_0x5876e7(_0x5a8d44))),_0x519fbe=pipe(_0x101be7['addedLayerItem'],observable['filter'](isDrawingLayerItem),tap(_0x4e743e=>_0x101be7['moveItem'](_0x4e743e,0x0,_0x1ca6ff['getValue']()))),_0x35f03a=pipe(_0x1ca6ff,observable['filter'](_0x5af3fd=>_0x30a9a3['getSelectedChartInfo']()['layers']['selectedGroup']!==_0x5af3fd),tap(_0x3f431f=>_0x30a9a3['updateLocalChartInfo'](_0x454920,{'layers':{..._0x30a9a3['getSelectedChartInfo']()['layers'],'selectedGroup':_0x3f431f}}))),_0x2f612d=merge(_0x55189b,_0x519fbe,_0x35f03a,_0x41ebad,_0xd91975),_0x6e7f0={};return _0x6e7f0['groups']=_0x2e4718,_0x6e7f0['selectedGroup']=_0x1ca6ff,_0x6e7f0['createAndSelectGroup']=_0x13e4bd,_0x6e7f0['selectGroup']=_0x46a3a4,_0x6e7f0['deleteGroup']=_0x55bb05,sink['newSink'](callTracerProxy('drawingGroupsViewModel',_0x6e7f0),_0x2f612d);});