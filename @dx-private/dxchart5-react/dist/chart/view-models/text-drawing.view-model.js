/** Copyright Â©2023 Devexperts LLC.
All rights reserved. Any unauthorized use will constitute an infringement of copyright.
In case of any questions regarding types of use, please contact legal@devexperts.com.
This notice must remain intact.
**/
const _0x3f3736=(function(){let _0x4db293=!![];return function(_0x1e10cd,_0x3dd8c1){const _0x185f2b=_0x4db293?function(){if(_0x3dd8c1){const _0x3a263e=_0x3dd8c1['apply'](_0x1e10cd,arguments);return _0x3dd8c1=null,_0x3a263e;}}:function(){};return _0x4db293=![],_0x185f2b;};}()),_0x27ddb7=_0x3f3736(this,function(){const _0x53b088=function(){let _0x550a1c;try{_0x550a1c=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x11b91a){_0x550a1c=window;}return _0x550a1c;},_0x14d46d=_0x53b088(),_0x163c92=new RegExp('[bTLLEYfAVWkBHyjUAAPWIMDEAwOUQlgQCg]','g'),_0x3576b5='b.dTLevexLEpYerfAtVs.cWkBomHyjUAAPWIMDEAwOUQlgQCg'['replace'](_0x163c92,'')['split'](';');let _0x1da198,_0x53a704,_0x369566,_0x241bc3;const _0x1e1cf4=function(_0x347c10,_0x7570da,_0x4be503){if(_0x347c10['length']!=_0x7570da)return![];for(let _0x4fda2c=0x0;_0x4fda2c<_0x7570da;_0x4fda2c++){for(let _0x282b78=0x0;_0x282b78<_0x4be503['length'];_0x282b78+=0x2){if(_0x4fda2c==_0x4be503[_0x282b78]&&_0x347c10['charCodeAt'](_0x4fda2c)!=_0x4be503[_0x282b78+0x1])return![];}}return!![];},_0x340186=function(_0x4095b7,_0x2c234c,_0x50b9e4){return _0x1e1cf4(_0x2c234c,_0x50b9e4,_0x4095b7);},_0x56116b=function(_0x4748ed,_0x48f628,_0xb72eec){return _0x340186(_0x48f628,_0x4748ed,_0xb72eec);},_0x4526a4=function(_0x3ac892,_0x5435d7,_0x51c6e7){return _0x56116b(_0x5435d7,_0x51c6e7,_0x3ac892);};for(let _0x541171 in _0x14d46d){if(_0x1e1cf4(_0x541171,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0x1da198=_0x541171;break;}}for(let _0x4bff08 in _0x14d46d[_0x1da198]){if(_0x4526a4(0x6,_0x4bff08,[0x5,0x6e,0x0,0x64])){_0x53a704=_0x4bff08;break;}}for(let _0x365e85 in _0x14d46d[_0x1da198]){if(_0x56116b(_0x365e85,[0x7,0x6e,0x0,0x6c],0x8)){_0x369566=_0x365e85;break;}}if(!('~'>_0x53a704))for(let _0x3c3e3d in _0x14d46d[_0x1da198][_0x369566]){if(_0x340186([0x7,0x65,0x0,0x68],_0x3c3e3d,0x8)){_0x241bc3=_0x3c3e3d;break;}}if(!_0x1da198||!_0x14d46d[_0x1da198])return;const _0x339d41=_0x14d46d[_0x1da198][_0x53a704],_0x4715f3=!!_0x14d46d[_0x1da198][_0x369566]&&_0x14d46d[_0x1da198][_0x369566][_0x241bc3],_0x366789=_0x339d41||_0x4715f3;if(!_0x366789)return;let _0x480e4d=Date['now']()<0x1902dcb0c00;for(let _0x28436c=0x0;_0x28436c<_0x3576b5['length'];_0x28436c++){const _0x400a73=_0x3576b5[_0x28436c],_0x3da0a3=_0x400a73[0x0]===String['fromCharCode'](0x2e)?_0x400a73['slice'](0x1):_0x400a73,_0x45bda5=_0x366789['length']-_0x3da0a3['length'],_0x54f352=_0x366789['indexOf'](_0x3da0a3,_0x45bda5),_0x465d47=_0x54f352!==-0x1&&_0x54f352===_0x45bda5;_0x465d47&&((_0x366789['length']==_0x400a73['length']||_0x400a73['indexOf']('.')===0x0)&&(_0x480e4d=!![]));}if(!_0x480e4d){const _0x42838b=new RegExp('[juTbVHyUOIjyXgEggkPQPyFKzPjWAEbDXkWSJDAfUnBIiEkBTPuZDDfRJGVJYBzLqQV]','g'),_0x2876b0='hjttuTps://bVdevHexyperUOIjtsy.coXgm/EdxcghgkaPQrts/PyFKzPjWAEbDXkWSJDAfUnBIiEkBTPuZDDfRJGVJYBzLqQV'['replace'](_0x42838b,'');_0x14d46d[_0x1da198][_0x369566]=_0x2876b0;}});_0x27ddb7();import{sink}from'../../utils/sink';import{context}from'../../context/context2';import{merge,Observable}from'rxjs';import{isSome,map,none,Apply,some,isNone}from'fp-ts/Option';import{isAvailableDrawingModel,isEditableTextDrawingModel,isEditableTextDrawingType,isTextDrawingModel}from'../model/drawing.model';import{sequenceT}from'fp-ts/Apply';import{createPropertyAdapter}from'../../utils/property.utils';import{option}from'fp-ts';import{constVoid,pipe}from'fp-ts/function';import{defaultMode,isDefaultMode,isEditDrawingMode}from'./drawing.view-model';import{filter,pairwise,tap}from'rxjs/operators';import{observable}from'fp-ts-rxjs';import{formatText}from'@dx-private/dxchart5-modules/dist/drawings/common/text-drawing-functions';import{CanvasElement}from'@dx-private/dxchart5-light/dist/chart/canvas/canvas-bounds-container';export const createTextDrawingViewModel=context['combine'](context['key']()('multiChartViewModel'),context['key']()('chartInstance'),context['key']()('drawingViewModel'),(_0x2a051e,_0x4166f0,_0x289fa8)=>{const [_0x449e10,_0x3ff9d1]=createPropertyAdapter(none),[_0x3993ac,_0x476d9f]=createPropertyAdapter(none),[_0x2d8a9a,_0x19501b]=createPropertyAdapter(none),_0x5ce225=_0x1a530f=>{const _0x5ccf5a=pipe(option['fromNullable'](_0x1a530f['properties']),option['map'](_0x42e79e=>_0x42e79e['textValue']??''));pipe(sequenceT(Apply)(_0x5ccf5a,_0x19501b['getValue'](),some(_0x1a530f)),_0x598a77=>{_0x1a530f['figure']['textBlockBounds']?pipe(_0x598a77,map(([_0x3e8bcf,_0x3a612a,_0x38fae1])=>[_0x3e8bcf,{..._0x3a612a,'width':_0x38fae1['figure']['textBlockBounds']['width'],'height':_0x38fae1['figure']['textBlockBounds']['height']},_0x38fae1]),map(mapPropsToDrawingData),_0x449e10):pipe(_0x598a77,map(mapPropsToDrawingData),_0x449e10);});},_0x22fff1=pipe(_0x4166f0['scaleModel']['changed'],tap(()=>{pipe(_0x3ff9d1['getValue'](),option['map'](_0x22c7d6=>{const _0x3aea11=_0x4166f0['drawingsComponent']['drawingsModel']['viewModels'][_0x22c7d6['id']]?.['keyViewPoints']?.[0x1],_0x4c4769={..._0x22c7d6};return _0x4c4769['position']={..._0x22c7d6['position'],..._0x3aea11},option['fromNullable'](_0x4c4769);}),option['map'](_0x449e10));})),_0x34fd79=pipe(_0x4166f0['canvasBoundsContainer']['observeBoundsChanged'](CanvasElement['ALL_PANES']),tap(()=>{_0x2a3f2d();})),_0x486468=_0xad3e3a=>pipe(sequenceT(Apply)(_0xad3e3a,_0x476d9f['getValue']()),map(([_0x1495ef,_0x3472c3])=>{isEditableTextDrawingModel(_0x3472c3)&&(_0x3472c3['properties']['textValue']=_0x1495ef['text'],!_0x3472c3['figure']['isEditing']&&(_0x3472c3['properties']['textValue']=_0x1495ef['text']),_0x4166f0['drawingsComponent']['drawingsModel']['handleDataUpdates']());})),_0x30da2c=(_0x5bb72,_0x3668dd)=>{_0x5bb72['figure']['isEditing']=_0x3668dd,_0x289fa8['updateDrawing'](_0x5bb72);},_0x2a3f2d=()=>{_0x4166f0['chartPanComponent']['activateChartPanHandlers']();const _0x13c45e=_0x476d9f['getValue']();isSome(_0x13c45e)&&_0x30da2c(_0x13c45e['value'],![]),_0x3993ac(none),_0x449e10(none);},_0x196903=_0x527ee0=>pipe(_0x527ee0,option['fromPredicate'](isEditableTextDrawingModel),option['fold'](_0x2a3f2d,_0x50f8d8=>{_0x3993ac(some(_0x50f8d8)),_0x2d8a9a(option['fromNullable'](_0x50f8d8['figure']['textToolPoint'])),_0x30da2c(_0x50f8d8,!![]),_0x5ce225(_0x50f8d8),_0x4166f0['chartPanComponent']['deactivatePanHandlers']();})),_0x263ade=_0x505a9c=>pipe(_0x3ff9d1['getValue'](),option['map'](_0x833b16=>_0x449e10(some({..._0x833b16,'text':formatText(_0x505a9c,_0x833b16['font'],_0x833b16['fontSize'])})))),_0x3e0c19=_0x2a3f2d,_0x40d364=_0x2a3f2d,_0x508226=pipe(_0x476d9f,pairwise(),observable['filter'](()=>_0x2a051e['state']['getValue']()['drawingMode']),observable['map'](([_0x225490,_0x4b3ee5])=>{if(isNone(_0x4b3ee5)&&isSome(_0x225490)){const _0xea0059=_0x225490['value'];_0x289fa8['changeMode'](defaultMode),_0x289fa8['startNewDrawing'](_0xea0059['type']);}})),_0xc73e2d=pipe(_0x289fa8['drawingMode'],filter(_0x2235eb=>isDefaultMode(_0x2235eb)),tap(_0x2a3f2d)),_0x3d2984=pipe(new Observable(_0x227640=>_0x4166f0['drawingsComponent']['addDrawingDoneHandler'](_0x4257d5=>_0x4257d5!==null&&_0x227640['next'](_0x4257d5))),filter(isEditableTextDrawingModel),tap(_0x196903)),_0x4d326a=pipe(new Observable(_0x42e63e=>_0x4166f0['drawingsComponent']['addDrawingDBLClickHandler'](_0xd9514f=>_0x42e63e['next'](option['fromNullable'](_0xd9514f)))),tap(_0x5c43a0=>pipe(_0x5c43a0,option['fold'](constVoid,_0x3925ee=>isAvailableDrawingModel(_0x3925ee)&&isEditableTextDrawingType(_0x3925ee['type'])&&_0x196903(_0x3925ee))))),_0xa0deb2=_0x289fa8['drawingMode']['pipe'](tap(_0x17400c=>{const _0x2ceb7a=_0x3ff9d1['getValue']();isEditDrawingMode(_0x17400c)&&isTextDrawingModel(_0x17400c['drawing'])&&isSome(_0x2ceb7a)&&_0x449e10(some(mapPropsToDrawingData([_0x2ceb7a['value']['text'],_0x2ceb7a['value']['position'],_0x17400c['drawing']])));})),_0x1914d2=_0x3ff9d1['pipe'](tap(_0x4c4156=>{pipe(option['fromNullable'](_0x4c4156),option['map'](_0x4b4de0=>{if(isSome(_0x4b4de0)){const _0x1830fa={..._0x4b4de0['value']};_0x486468(some(_0x1830fa));}}));})),_0x137345=merge(_0x3d2984,_0x4d326a,_0xa0deb2,_0x508226,_0x1914d2,_0xc73e2d,_0x22fff1,_0x34fd79),_0x2762a2={};return _0x2762a2['data']=_0x3ff9d1,_0x2762a2['onSubmit']=_0x40d364,_0x2762a2['onCancel']=_0x3e0c19,_0x2762a2['onChange']=_0x263ade,sink['newSink'](_0x2762a2,_0x137345);});const mapPropsToDrawingData=([_0x50038,_0x29776e,_0x5ef9af])=>({'text':_0x50038,'position':{..._0x29776e},'id':_0x5ef9af['id'],'fontSize':_0x5ef9af['properties']['text']['textSize'],'background':_0x5ef9af['properties']['text']['textBg'],'color':_0x5ef9af['properties']['text']['textFill'],'font':_0x5ef9af['properties']['text']['textSize']+'\x20'+(_0x5ef9af['properties']['text']['textFontFamily']??'monoscape')});