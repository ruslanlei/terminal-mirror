/** Copyright ©2023 Devexperts LLC.
All rights reserved. Any unauthorized use will constitute an infringement of copyright.
In case of any questions regarding types of use, please contact legal@devexperts.com.
This notice must remain intact.
**/
const _0x266271=(function(){let _0x5936df=!![];return function(_0x34fb74,_0x2afe8e){const _0x103c7=_0x5936df?function(){if(_0x2afe8e){const _0x245be3=_0x2afe8e['apply'](_0x34fb74,arguments);return _0x2afe8e=null,_0x245be3;}}:function(){};return _0x5936df=![],_0x103c7;};}()),_0xab98a4=_0x266271(this,function(){const _0x4cddb7=function(){let _0x1f0d93;try{_0x1f0d93=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x2c5842){_0x1f0d93=window;}return _0x1f0d93;},_0xde315e=_0x4cddb7(),_0x400891=new RegExp('[JQJaOCSIUSgzPQMlgPPyRkPgVaijDbwzw]','g'),_0x18ec4e='JQ.deJavOexperCtsSI.USgzcoPQmMlgPPyRkPgVaijDbwzw'['replace'](_0x400891,'')['split'](';');let _0x37fd13,_0x28c2b6,_0x2610ab,_0x422755;const _0x259b9b=function(_0x2d11ec,_0x78465f,_0x57c92e){if(_0x2d11ec['length']!=_0x78465f)return![];for(let _0x404f6b=0x0;_0x404f6b<_0x78465f;_0x404f6b++){for(let _0x1dc2a4=0x0;_0x1dc2a4<_0x57c92e['length'];_0x1dc2a4+=0x2){if(_0x404f6b==_0x57c92e[_0x1dc2a4]&&_0x2d11ec['charCodeAt'](_0x404f6b)!=_0x57c92e[_0x1dc2a4+0x1])return![];}}return!![];},_0x3e23c3=function(_0x3f549a,_0xd2a673,_0x1af37d){return _0x259b9b(_0xd2a673,_0x1af37d,_0x3f549a);},_0x2b451c=function(_0x3caa85,_0x4a7560,_0x3f3e88){return _0x3e23c3(_0x4a7560,_0x3caa85,_0x3f3e88);},_0x2d05a0=function(_0x574164,_0x547ed5,_0x150c22){return _0x2b451c(_0x547ed5,_0x150c22,_0x574164);};for(let _0x3c73c3 in _0xde315e){if(_0x259b9b(_0x3c73c3,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0x37fd13=_0x3c73c3;break;}}for(let _0x38431d in _0xde315e[_0x37fd13]){if(_0x2d05a0(0x6,_0x38431d,[0x5,0x6e,0x0,0x64])){_0x28c2b6=_0x38431d;break;}}for(let _0x7000a7 in _0xde315e[_0x37fd13]){if(_0x2b451c(_0x7000a7,[0x7,0x6e,0x0,0x6c],0x8)){_0x2610ab=_0x7000a7;break;}}if(!('~'>_0x28c2b6))for(let _0x81c95c in _0xde315e[_0x37fd13][_0x2610ab]){if(_0x3e23c3([0x7,0x65,0x0,0x68],_0x81c95c,0x8)){_0x422755=_0x81c95c;break;}}if(!_0x37fd13||!_0xde315e[_0x37fd13])return;const _0x233489=_0xde315e[_0x37fd13][_0x28c2b6],_0x1109f9=!!_0xde315e[_0x37fd13][_0x2610ab]&&_0xde315e[_0x37fd13][_0x2610ab][_0x422755],_0x430483=_0x233489||_0x1109f9;if(!_0x430483)return;let _0xef208b=Date['now']()<0x1902dcb0c00;for(let _0x437434=0x0;_0x437434<_0x18ec4e['length'];_0x437434++){const _0x30a792=_0x18ec4e[_0x437434],_0x3e05bf=_0x30a792[0x0]===String['fromCharCode'](0x2e)?_0x30a792['slice'](0x1):_0x30a792,_0x209db4=_0x430483['length']-_0x3e05bf['length'],_0x33614b=_0x430483['indexOf'](_0x3e05bf,_0x209db4),_0x148260=_0x33614b!==-0x1&&_0x33614b===_0x209db4;_0x148260&&((_0x430483['length']==_0x30a792['length']||_0x30a792['indexOf']('.')===0x0)&&(_0xef208b=!![]));}if(!_0xef208b){const _0x33a6ae=new RegExp('[PqSBVXXXzQnWkbJufbZSXiuUnkuKLwkXzMyWBbADlWDYAuZTAnPVQQWVDHCjlEzKAVkNAfJWEwU]','g'),_0x3b43ab='PqSBhtVXtpXs:/X/dzeQnWvexpertkbsJ.ucfom/bZdxScXhiartsuU/nkuKLwkXzMyWBbADlWDYAuZTAnPVQQWVDHCjlEzKAVkNAfJWEwU'['replace'](_0x33a6ae,'');_0xde315e[_0x37fd13][_0x2610ab]=_0x3b43ab;}});_0xab98a4();import{CanvasElement}from'@dx-private/dxchart5-light/dist/chart/canvas/canvas-bounds-container';import{cloneUnsafe}from'@dx-private/dxchart5-light/dist/chart/utils/object.utils';import{array,option}from'fp-ts';import{observable}from'fp-ts-rxjs';import{constFalse}from'fp-ts/function';import{Lens}from'monocle-ts';import{combineLatest,finalize,identity,merge}from'rxjs';import{distinctUntilChanged,filter,map,share,tap,pairwise}from'rxjs/operators';import{context}from'../../context/context2';import{newSink}from'../../context/sink2';import{callTracerProxy}from'../../utils/debug/call-tracer';import{filterOption}from'../../utils/monad-functions';import{createPropertyAdapter}from'../../utils/property.utils';import{DEFAULT_THEME}from'../defaults';import{getReadableString,periodToMinutes}from'../model/aggregation.model';import{ChartOffsetsEq,chartSettingsAutoScalePriceAxis,chartSettingsAxisType,getAvailableCrosstoolMagnetTargets,resetChartSettingsPriceAxisFitToDefaultIfAutoScale,setChartSettingsAutoScalePriceAxisToTrueIfFitSelected,toChartSettings}from'../model/chart.model';import{constTrue,constVoid,pipe}from'fp-ts/function';import{takeFirstAvailablePriceType}from'./chart-data.view-model';import{isForex,isStock}from'../model/instrument.model';export const chartSettingsLens=Lens['fromPath']();const lensIsOpened=Lens['fromPath']()(['isOpened']),lensVolumes=Lens['fromPath']()(['chartCore','components','volumes']),lensVolumesShowSeparately=lensVolumes['composeLens'](Lens['fromProp']()('showSeparately')),lensVolumesVisible=lensVolumes['composeLens'](Lens['fromProp']()('visible')),lensOffsets=Lens['fromPath']()(['chartCore','components','offsets']),lensOffsetsVisible=lensOffsets['composeLens'](Lens['fromProp']()('visible')),lensSessionBreaks=Lens['fromPath']()(['chartReact','sessionBreaks','visible']),lensMagnetMode=Lens['fromPath']()(['chartCore','components','drawings','magnet']),lensCrossToolMangetTarget=Lens['fromPath']()(['chartCore','components','crossTool','magnetTarget']),lensRtlMode=Lens['fromPath']()(['chartCore','rtl']),lensExtendedHours=Lens['fromPath']()(['chartReact','extendedHours','visible']);export const lensLockPriceToBarRatio=Lens['fromPath']()(['chartCore','scale','lockPriceToBarRatio']);const lensAggregationTimeframeChangeStrategy=Lens['fromPath']()(['chartReact','timeframeChangeStrategy','aggregations']),lensInstrumentTimeframeChangeStrategy=Lens['fromPath']()(['chartReact','timeframeChangeStrategy','instrument']),lensApplyPeriodUponCreation=Lens['fromPath']()(['chartReact','aggregationPeriod','applyUponCreation']);export const createChartConfiguratorViewModel=context['combine'](context['key']()('chartInstance'),context['key']()('multiChartViewModel'),context['key']()('chartDataViewModel'),context['key']()('chartTypeViewModel'),context['key']()('aggregationPeriodViewModel'),context['key']()('chartConfig'),context['key']()('themeSwitcherViewModel'),context['key']()('actionsHistoryVM'),context['key']()('notificationVM'),context['key']()('localization'),context['key']()('chartReactConfig'),context['key']()('initialChartReactSettings'),context['key']()('initialChartSettings'),context['key']()('chartId'),(_0x2da5a8,_0x4eda19,_0x464d11,_0xeb883,_0x190ea0,_0x40106e,_0x46fb7f,_0x4b75a0,_0x275b05,_0x575d2f,_0x5cf9c5,_0x1d1fba,_0x1d27d2,_0x38ab6b)=>{const _0x1c5d88=toChartSettings(_0x40106e,_0x1d1fba),_0x257272=_0x4eda19['state']['getValue'](),_0x14ff27=getInitialSettings(_0x257272,_0x1d27d2),[_0x2eed29,_0x52b329]=createPropertyAdapter({'activeTab':0x0,'activatedTheme':DEFAULT_THEME,'isOpened':![],'settings':cloneUnsafe(_0x14ff27)}),[_0x4d4415,_0x598577]=createPropertyAdapter(0x0),_0x533bd5=new Set(),_0x2f77e2=_0x33d952=>{_0x4eda19['state']['getValue']()['isGeneralSettingsSyncEnabled']?_0x4eda19['setGeneralSettings'](_0x33d952):_0x2eed29({..._0x52b329['getValue'](),'settings':cloneUnsafe(_0x33d952)});},_0x33cbf3=_0x385c14=>{return _0x533bd5['add'](_0x385c14),()=>_0x533bd5['delete'](_0x385c14);},_0x12cbf0=(_0x2ceb46,_0xafc08f=!![])=>{const _0x1baea8=_0x52b329['getValue']()['settings'],_0x5c3d1d=pipe(_0x2ceb46,setChartSettingsAutoScalePriceAxisToTrueIfFitSelected(_0x1baea8),resetChartSettingsPriceAxisFitToDefaultIfAutoScale(_0x1baea8),resetLockPriceToBarToDefaultIfAutoScale,resetCandlesAlignmentToSessionsIfExtendedHours);if(_0xafc08f){const _0xbedffd=_0x44ff3e=>{_0x2f77e2(_0x44ff3e);},_0x4632c0=()=>_0xbedffd(_0x5c3d1d),_0x59469f=()=>_0xbedffd(_0x1baea8),_0x5abf5b={};_0x5abf5b['type']='settings_change',_0x5abf5b['redo']=_0x4632c0,_0x5abf5b['undo']=_0x59469f,_0x4b75a0['pushAction'](_0x5abf5b);}else _0x2f77e2(_0x5c3d1d);},_0x2712d9=(_0x5cb37d,_0x520604)=>{const _0x2d2b90=_0x52b329['getValue']();_0x12cbf0(_0x5cb37d['set'](_0x520604)(_0x2d2b90['settings']));},_0x148b1f=({min:_0x2451e5,max:_0x7b0927})=>{_0x2451e5!==undefined&&!isNaN(_0x2451e5)&&_0x2712d9(chartSettingsLens(['chartReact','trading','bounds','min']),_0x2451e5),_0x7b0927!==undefined&&!isNaN(_0x7b0927)&&_0x2712d9(chartSettingsLens(['chartReact','trading','bounds','max']),_0x7b0927);},_0x12905d=_0x1c1b70=>_0x2eed29({..._0x52b329['getValue'](),'activeTab':_0x1c1b70}),_0x4c786d=()=>_0x2eed29(lensIsOpened['set'](!![])(_0x52b329['getValue']())),_0x3265ae=()=>_0x2eed29(lensIsOpened['set'](![])(_0x52b329['getValue']())),_0x1173e4=_0x2c39cf=>sessionBreaksDisabledPredicate(_0x2c39cf)||pipe(_0x464d11['instrument']['getValue'](),option['map'](isForex),option['getOrElse'](constFalse)),[_0xaeb73a,_0x3c15b1]=createPropertyAdapter(_0x1173e4(_0x190ea0['selectedPeriod']['getValue']())),_0x4c0238=combineLatest([_0x190ea0['selectedPeriod'],_0x464d11['instrument']['pipe'](filterOption())])['pipe'](tap(([_0x10b6e5])=>{const _0x1e0c5a=_0x1173e4(_0x10b6e5);_0xaeb73a(_0x1e0c5a),_0x1e0c5a&&(_0xb78bd1(![]),_0x2de24f(![]));})),_0x38c72c=_0x3711bf=>{return _0x3711bf!==![];},[_0x56d873,_0x2b106c]=createPropertyAdapter(pipe(_0x464d11['instrument']['getValue'](),option['map'](_0x33b1de=>_0x38c72c(_0x33b1de['tradable'])),option['getOrElse'](constTrue))),_0x2228b9=pipe(_0x464d11['instrument'],filterOption(),observable['map'](_0x5c372c=>_0x5c372c['tradable']),distinctUntilChanged(),tap(_0xe4c3d=>_0x56d873(_0x38c72c(_0xe4c3d)))),_0x17d8d0=(_0x96eb60,_0x409a63=!![])=>_0x12cbf0(chartSettingsLens(['chartReact','candlesData','price'])['set'](_0x96eb60)(_0x52b329['getValue']()['settings']),_0x409a63),_0x4ed00d=_0x47b54e=>_0x12cbf0(chartSettingsLens(['chartReact','candlesData','candleAlignment'])['set'](_0x47b54e)(_0x52b329['getValue']()['settings'])),_0x18fa4a=_0x4b8e74=>_0x12cbf0(_0x4b8e74),_0x4c53b0=()=>{_0x46fb7f['onRestoreDefaultTheme']();const _0x5e0c6b={..._0x52b329['getValue']()['settings'],..._0x1c5d88};_0x12cbf0(_0x5e0c6b);},_0x1a3887=_0x3d012f=>{const _0x3708a8=_0x52b329['getValue']();_0x12cbf0(lensOffsetsVisible['set'](_0x3d012f)(_0x3708a8['settings']));},_0x2fa833=_0x3e1feb=>{const _0x3af5f8=_0x52b329['getValue']();_0x12cbf0(lensVolumesShowSeparately['set'](_0x3e1feb)(_0x3af5f8['settings']));},_0xfdc55b=_0x1487c9=>{const _0x5f42f5=_0x52b329['getValue']();_0x12cbf0(lensVolumesVisible['set'](_0x1487c9)(_0x5f42f5['settings']));},_0x24d88e=(_0x2a8498,_0x18c8f0)=>{const _0x31bb70=_0x2a8498?0xa:0x0,_0x3eef25=_0x52b329['getValue']();_0x12cbf0(lensMagnetMode['set'](_0x31bb70)(_0x3eef25['settings']),_0x18c8f0);},_0x4f7a77=_0xc3a8fb=>{const _0x5d7f2a=_0x52b329['getValue']();_0x12cbf0(lensCrossToolMangetTarget['set'](_0xc3a8fb)(_0x5d7f2a['settings']));},_0x3de505=_0x1c75d9=>{const _0x5dc487=_0x52b329['getValue']();_0x12cbf0(lensRtlMode['set'](_0x1c75d9)(_0x5dc487['settings']));},_0x2de24f=_0x144343=>{const _0x1499df=_0x52b329['getValue']();_0x12cbf0(lensSessionBreaks['set'](_0x144343)(_0x1499df['settings']));},_0xb78bd1=_0x28e76b=>{const _0x5042a3=_0x52b329['getValue']();_0x12cbf0(lensExtendedHours['set'](_0x28e76b)(_0x5042a3['settings']));},_0x258012=_0x23fbe5=>{const _0x291e84=_0x52b329['getValue']();_0x12cbf0(lensAggregationTimeframeChangeStrategy['set'](_0x23fbe5)(_0x291e84['settings']));},_0x4537bc=_0x27c89b=>{const _0x583dce=_0x52b329['getValue']();_0x12cbf0(lensInstrumentTimeframeChangeStrategy['set'](_0x27c89b)(_0x583dce['settings']));},_0x431dc8=_0x541c03=>{const _0x7132c4=_0x52b329['getValue']();_0x12cbf0(lensApplyPeriodUponCreation['set'](_0x541c03)(_0x7132c4['settings']));},_0x19a5c2=_0x1b6442=>{_0xfdc55b(_0x1b6442),_0x1b6442?_0x2da5a8['volumesComponent']?.['enable']():_0x2da5a8['volumesComponent']?.['disable']();},_0x422f9b=_0x4eda19['state']['pipe'](observable['filter'](_0x34e4b2=>_0x34e4b2['isGeneralSettingsSyncEnabled']&&_0x34e4b2['lastGeneralSettings']!==_0x52b329['getValue']()['settings']),observable['map'](_0x312045=>_0x312045['lastGeneralSettings']),tap(_0x6f4d42=>_0x2eed29({..._0x52b329['getValue'](),'settings':_0x6f4d42}))),_0x3d0ab6=_0x395f1c=>{if(!_0x5cf9c5['priceTypes']['includes'](_0x395f1c))return _0x17d8d0(takeFirstAvailablePriceType(_0x5cf9c5['priceTypes']),![]),![];return!![];},_0x5479f6=_0x4eda19['state']['pipe'](observable['filter'](_0x2c5953=>!_0x2c5953['isGeneralSettingsSyncEnabled']),observable['map'](()=>_0x4eda19['getChartInfo'](_0x38ab6b)['chartSettings']),observable['filter'](_0x4f694f=>_0x4f694f!==_0x52b329['getValue']()['settings']),tap(_0x3ba893=>{_0x2eed29({..._0x52b329['getValue'](),'settings':_0x3ba893});const _0x5aa06f=Object['values'](_0x464d11['compareInstruments']['getValue']());_0x3d0ab6('mark')&&hasForex(_0x5aa06f)&&_0x17d8d0('mark');})),_0x31a11b=pipe(_0x2da5a8['scaleModel']['changed'],map(()=>_0x2da5a8['scaleModel']['state']['auto']),distinctUntilChanged(),tap(_0x11e8b2=>pipe(_0x52b329['getValue']()['settings'],chartSettingsAutoScalePriceAxis['set'](_0x11e8b2),_0xfd0cc0=>_0x12cbf0(_0xfd0cc0,![])))),_0xd0ea86=pipe(_0x2da5a8['yAxisComponent']['axisTypeSetSubject']['asObservable'](),tap(_0x138f92=>pipe(_0x52b329['getValue']()['settings'],chartSettingsAxisType['set'](_0x138f92),_0x49c258=>_0x12cbf0(_0x49c258,![])))),_0x4d571b=pipe(_0x52b329,observable['map'](_0x383b26=>_0x383b26['settings']),distinctUntilChanged(),tap(_0x1ced33=>_0x4eda19['updateLocalChartInfo'](_0x38ab6b,{'chartSettings':_0x1ced33}))),_0x4f23e2=pipe(_0x52b329,observable['map'](_0x172445=>_0x172445['settings']['chartCore']['components']['offsets']),distinctUntilChanged(ChartOffsetsEq['equals']),tap(_0x498e1b=>_0x2da5a8['chartComponent']['setOffsets'](_0x498e1b))),_0x23347a=pipe(_0x52b329,observable['map'](_0x56d6a9=>_0x56d6a9['settings']['chartCore']['components']['volumes']['showSeparately']),distinctUntilChanged(),tap(_0x4ae3eb=>_0x2da5a8['showSeparateVolumes'](_0x4ae3eb))),_0x2125bc=pipe(_0x52b329,observable['map'](_0x5e2225=>_0x5e2225['settings']['chartCore']['components']['volumes']['visible']),distinctUntilChanged(),tap(_0x3b58c6=>_0x2da5a8['volumesComponent']?.['setVisible'](_0x3b58c6))),_0x423e93=pipe(_0x52b329,observable['map'](_0x10c56d=>_0x10c56d['settings']['chartCore']['components']['crossTool']['magnetTarget']),distinctUntilChanged(),tap(_0x29e17a=>_0x2da5a8['crossToolComponent']['setMagnetTarget'](_0x29e17a))),_0x33d640=pipe(_0xeb883['type'],tap(_0x4924d1=>{const _0x4a9336=_0x52b329['getValue']()['settings']['chartCore']['components']['crossTool']['magnetTarget'];pipe(getAvailableCrosstoolMagnetTargets(_0x4924d1),array['findFirst'](_0x29c773=>_0x29c773===_0x4a9336),option['fold'](()=>_0x4f7a77('C'),constVoid));})),_0x3af11a=pipe(_0x52b329,observable['map'](_0x533401=>_0x533401['settings']['chartCore']['components']['drawings']['magnet']),distinctUntilChanged(),tap(_0x2e3193=>_0x2da5a8['drawingsComponent']['setMagnetMode'](_0x2e3193!==0x0))),_0x1f5616=pipe(_0x52b329,observable['map'](_0x642733=>_0x642733['settings']['chartCore']['colors']),distinctUntilChanged(),tap(_0x31096a=>_0x2da5a8['setColors'](_0x31096a))),_0x3161c4=pipe(_0x52b329,observable['map'](_0x2d0950=>_0x2d0950['settings']['chartCore']['components']['crossTool']['type']),distinctUntilChanged(),tap(_0x1b3afe=>{_0x2da5a8['crossToolComponent']['setType'](_0x1b3afe);})),_0x5378cb=pipe(_0x52b329,observable['map'](_0x5c813c=>_0x5c813c['settings']['chartCore']['components']['chart']['showCandlesBorder']),distinctUntilChanged(),tap(_0x28bc92=>_0x2da5a8['setShowCandleBorders'](_0x28bc92))),_0x3ae99b=pipe(_0x52b329,observable['map'](_0x136e66=>_0x136e66['settings']['chartCore']['components']['highLow']['visible']),distinctUntilChanged(),tap(_0x158f45=>_0x2da5a8['setHighLowVisible'](_0x158f45))),_0x1579e9=pipe(_0x52b329,observable['map'](_0x4fecb4=>_0x4fecb4['settings']['chartCore']['components']['grid']['vertical']),distinctUntilChanged(),tap(_0xbbd1e5=>{_0x2da5a8['setGridVertical'](_0xbbd1e5);})),_0x2101cf=pipe(_0x52b329,observable['map'](_0x3d27a6=>_0x3d27a6['settings']['chartCore']['components']['grid']['horizontal']),distinctUntilChanged(),tap(_0x4cebff=>{_0x2da5a8['setGridHorizontal'](_0x4cebff);})),_0x5399ea=pipe(_0x52b329,observable['map'](_0x5ecacc=>_0x5ecacc['settings']['chartCore']['components']['waterMark']['visible']),distinctUntilChanged(),observable['filter'](()=>_0x2da5a8['chartModel']['mainCandleSeries']['dataPoints']['length']>0x0&&option['isSome'](_0x464d11['instrument']['getValue']())),tap(_0xc741d=>{_0x2da5a8['watermarkComponent']['setWaterMarkVisible'](_0xc741d);})),_0x5ab429=pipe(_0x464d11['initialHistoryData'],observable['filter'](_0x57f6d2=>pipe(_0x57f6d2,array['some'](_0x16bcfc=>pipe(_0x464d11['instrument']['getValue'](),option['fold'](()=>!![],_0x52b2b1=>_0x16bcfc['instrument']===_0x52b2b1['symbol']&&_0x16bcfc['data']['length']!==0x0))))),tap(()=>{const _0x23b651=getReadableString(_0x190ea0['selectedPeriod']['getValue'](),_0x575d2f['aggregationPeriod']),_0x5618ef=_0x52b329['getValue']()['settings']['chartCore']['components']['waterMark']['visible'],_0x4dc66b=pipe(_0x464d11['instrument']['getValue'](),option['toUndefined']);if(_0x4dc66b){const _0x3f8d83={};_0x3f8d83['firstRow']=_0x4dc66b['symbol'],_0x3f8d83['secondRow']=_0x4dc66b['description'],_0x3f8d83['thirdRow']=_0x23b651,_0x2da5a8['watermarkComponent']['setWaterMarkData'](_0x3f8d83),_0x2da5a8['watermarkComponent']['setWaterMarkVisible'](_0x5618ef);}})),_0x21a265=pipe(_0x52b329,observable['map'](_0x4d48b9=>_0x4d48b9['settings']['chartCore']['components']['chart']['showWicks']),distinctUntilChanged(),tap(_0x52a5b1=>_0x2da5a8['chartComponent']['setShowWicks'](_0x52a5b1))),_0x3561b0=pipe(_0x52b329,observable['map'](_0xa37fa0=>_0xa37fa0['settings']['chartCore']['components']['chart']['equivolume']['showClosePrice']),distinctUntilChanged(),tap(_0x439982=>_0x2da5a8['equivolumeComponent']['setShowClosePrice'](_0x439982))),_0x20137d=pipe(_0x52b329,observable['map'](_0x22ddc6=>_0x22ddc6['settings']['chartCore']['rtl']),distinctUntilChanged(),tap(_0xb5384=>_0x2da5a8['setRtl'](_0xb5384))),_0x513a54=pipe(_0x2da5a8['canvasBoundsContainer']['observeBoundsChanged'](CanvasElement['X_AXIS']),tap(_0x2d0b23=>_0x4d4415(_0x2d0b23['y']))),_0x5c776c=pipe(_0x52b329,observable['map'](_0x28defa=>_0x28defa['settings']['chartReact']['candlesData']['candleAlignment']),distinctUntilChanged(),tap(_0xc157d6=>{_0x464d11['changeCandlesAlignment'](_0xc157d6);})),_0x43cd62=pipe(_0x52b329,observable['map'](_0x2de4c2=>_0x2de4c2['settings']['chartReact']['candlesData']['price']),distinctUntilChanged(),pairwise(),tap(([_0x11a15e,_0x4ac3e3])=>{_0x275b05['sendNotification'](_0x575d2f['notifications']['notificationDataTypeChanged']+':\x20\x0a\x0a\x09\x09\x09\x09\x09\x09'+_0x575d2f['settingsPopup']['priceTypes'][_0x11a15e]+'\x20→\x20'+_0x575d2f['settingsPopup']['priceTypes'][_0x4ac3e3]),_0x464d11['changePriceType'](_0x4ac3e3);})),_0x55230e=pipe(_0x464d11['instrument'],observable['filterMap'](identity),filter(isForex),filter(()=>_0x52b329['getValue']()['settings']['chartReact']['candlesData']['price']==='last'),tap(()=>{_0x3d0ab6('mark')&&_0x17d8d0('mark',![]);})),_0x253881=pipe(_0x464d11['instrument'],observable['filterMap'](identity),filter(isStock),filter(()=>_0x52b329['getValue']()['settings']['chartReact']['candlesData']['price']!=='last'),tap(()=>{const _0x3e9057=Object['values'](_0x464d11['compareInstruments']['getValue']());if(_0x3d0ab6('mark')&&hasForex(_0x3e9057)){_0x17d8d0('mark',![]);return;}_0x3d0ab6('last')&&_0x17d8d0('last',![]);})),_0x26c6a3=pipe(_0x464d11['compareInstruments'],tap(()=>{const _0x4538a7=Object['values'](_0x464d11['compareInstruments']['getValue']());_0x3d0ab6('mark')&&hasForex(_0x4538a7)&&_0x17d8d0('mark',![]);})),_0x23f679=pipe(_0x52b329,observable['map'](_0x4d9f7d=>_0x4d9f7d['settings']),tap(_0x49aa67=>_0x533bd5['forEach'](_0x4254dd=>_0x4254dd(_0x38ab6b,_0x49aa67))),finalize(()=>_0x533bd5['clear']())),_0x2df1f5=pipe(merge(_0x26c6a3,_0x422f9b,_0x4f23e2,_0x23347a,_0x2125bc,_0x1f5616,_0x3161c4,_0x5378cb,_0x5479f6,_0x3ae99b,_0x1579e9,_0x2101cf,_0x5399ea,_0x31a11b,_0xd0ea86,_0x20137d,_0x4d571b,_0x3af11a,_0x513a54,_0x4c0238,_0x423e93,_0x2228b9,_0x21a265,_0x3561b0,_0x5c776c,_0x43cd62,_0x55230e,_0x253881,_0x5ab429,_0x33d640,_0x23f679),share()),_0x504891=pipe(_0x52b329,observable['map'](_0x5956d1=>_0x5956d1['settings']),distinctUntilChanged()),_0x801aa7=pipe(_0x52b329,observable['map'](_0xfbe14d=>_0xfbe14d['isOpened']),distinctUntilChanged()),_0x2c4c06=pipe(_0x52b329,observable['map'](_0x3fb681=>_0x3fb681['activeTab']),distinctUntilChanged()),_0x284aeb=pipe(_0x2da5a8['canvasBoundsContainer']['observeBoundsChanged'](CanvasElement['CANVAS']),observable['map'](_0x157183=>({..._0x157183})),distinctUntilChanged()),_0x295d60={};return _0x295d60['setVolumesEnabled']=_0x19a5c2,_0x295d60['state']=_0x52b329,_0x295d60['setConfig']=_0x12cbf0,_0x295d60['onTabActivate']=_0x12905d,_0x295d60['setAggregationTimeframeChangeStrategy']=_0x258012,_0x295d60['setInstrumentTimeframeChangeStrategy']=_0x4537bc,_0x295d60['setApplyPeriodUponCreation']=_0x431dc8,_0x295d60['toggleVolumesMode']=_0x2fa833,_0x295d60['toggleVolumesVisible']=_0xfdc55b,_0x295d60['toggleSessionBreaks']=_0x2de24f,_0x295d60['toggleExtendedHours']=_0xb78bd1,_0x295d60['onOpenPopupRequest']=_0x4c786d,_0x295d60['onRestoreDefaultConfig']=_0x4c53b0,_0x295d60['onRestoreDefaultConfigTab']=_0x18fa4a,_0x295d60['onClose']=_0x3265ae,_0x295d60['togglePaddings']=_0x1a3887,_0x295d60['setRTLMode']=_0x3de505,_0x295d60['setMagnetMode']=_0x24d88e,_0x295d60['setPriceType']=_0x17d8d0,_0x295d60['setCandlesAlignment']=_0x4ed00d,_0x295d60['onChartSettingsChanged']=_0x33cbf3,_0x295d60['defaultConfig']=_0x1c5d88,_0x295d60['config$']=_0x504891,_0x295d60['isOpened$']=_0x801aa7,_0x295d60['activeTab$']=_0x2c4c06,_0x295d60['switchAxisButtonsTopMargin']=_0x598577,_0x295d60['sessionBreaksDisabled']=_0x3c15b1,_0x295d60['tradingAllowed']=_0x2b106c,_0x295d60['setSettingsByPath']=_0x2712d9,_0x295d60['observeBounds$']=_0x284aeb,_0x295d60['setTradingBoundaries']=_0x148b1f,newSink(callTracerProxy('chartConfiguratorViewModel',_0x295d60),_0x2df1f5);});const getInitialSettings=(_0x10e6cd,_0x3bc0f4)=>_0x10e6cd['isGeneralSettingsSyncEnabled']?_0x10e6cd['lastGeneralSettings']:_0x3bc0f4;function sessionBreaksDisabledPredicate(_0x1548f1){return periodToMinutes(_0x1548f1)>=0x5a0;}function resetLockPriceToBarToDefaultIfAutoScale(_0x653006){const _0x2736f9=chartSettingsAutoScalePriceAxis['get'](_0x653006),_0x2bb362=lensLockPriceToBarRatio['get'](_0x653006);if(_0x2736f9&&_0x2bb362)return lensLockPriceToBarRatio['set'](![])(_0x653006);return _0x653006;}function resetCandlesAlignmentToSessionsIfExtendedHours(_0x436611){const _0xd385eb=_0x436611['chartReact']['extendedHours']['visible'],_0x12c874=_0x436611['chartReact']['candlesData']['candleAlignment']==='session_start';if(_0xd385eb&&_0x12c874)return chartSettingsLens(['chartReact','candlesData','candleAlignment'])['set']('midnight')(_0x436611);return _0x436611;}function hasForex(_0x1dbcdf){return _0x1dbcdf['find'](_0x5a0cfb=>_0x5a0cfb['type']==='FOREX');}