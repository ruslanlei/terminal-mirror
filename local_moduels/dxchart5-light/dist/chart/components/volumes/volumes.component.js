/*
 * Copyright (C) 2002 - 2023 Devexperts LLC
 * This Source Code Form is subject to the terms of the Mozilla Public License, v. 2.0.
 * If a copy of the MPL was not distributed with this file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */
import{ChartBaseElement as u}from"../../chart-base-element";import{DrawerType as h}from"../../drawers/drawing-manager";import{SeparateVolumesComponent as p}from"./separate-volumes.component";import{resolveColorForBar as n,resolveColorForCandle as v,resolveColorForLine as V}from"./volume-color-resolvers.functions";import{VolumesDrawer as C}from"./volumes.drawer";import{VolumesModel as c}from"./volumes.model";export class VolumesComponent extends u{constructor(e,o,r,a,l,s,i){super(),this.canvasModel=e,this.canvasBoundsContainer=a,this.config=s,this.volumesColorByChartTypeMap={};const t=new c(o,r);this.addChildEntity(t),this.separateVolumes=new p(e,o,l,s,t,this.volumesColorByChartTypeMap,i),this.addChildEntity(this.separateVolumes);const m=new C(e,s,t,o.chartModel,r,this.volumesColorByChartTypeMap,()=>!s.components.volumes.showSeparately);l.addDrawer(m,h.VOLUMES),this.registerDefaultVolumeColorResolvers()}registerDefaultVolumeColorResolvers(){this.registerVolumeColorResolver("candle",v),this.registerVolumeColorResolver("line",V),this.registerVolumeColorResolver("bar",n)}setShowVolumesSeparatly(e){this.config.components.volumes.showSeparately!==e&&(this.config.components.volumes.showSeparately=e,e?this.separateVolumes.activateSeparateVolumes():this.separateVolumes.deactiveSeparateVolumes())}doDeactivate(){super.doDeactivate(),this.setVisible(!1)}registerVolumeColorResolver(e,o){this.volumesColorByChartTypeMap[e]=o}setVisible(e=!0){this.config.components.volumes.visible=e,this.config.components.volumes.showSeparately===!0&&(e?this.separateVolumes.activateSeparateVolumes():this.separateVolumes.deactiveSeparateVolumes()),this.canvasBoundsContainer.recalculatePanesHeightRatios(),this.canvasModel.fireDraw()}}
