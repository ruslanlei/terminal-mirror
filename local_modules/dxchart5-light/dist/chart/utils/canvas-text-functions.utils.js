/*
 * Copyright (C) 2002 - 2023 Devexperts LLC
 * This Source Code Form is subject to the terms of the Mozilla Public License, v. 2.0.
 * If a copy of the MPL was not distributed with this file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */
export function prepareTextForFill(t,e){let n="";e.textStyle&&(e.textStyle.italic&&(n+="italic "),e.textStyle.bold&&(n+="bold ")),t.font=n+(e.textSize||12)+" "+(e.textFontFamily||"monospace"),t.fillStyle=e.textFill||"#FFFFFF",e.rtl?t.textAlign="right":t.textAlign="start"}export function getTextLineHeight(t){const e=t.font.match(/(\d+.)?\d+(px|pt)/gi);let n="10px";return e&&e.length&&(e[0].includes("pt")?n=+e[0].slice(0,e[0].indexOf("pt"))*96/72+"px":n=e[0]),parseInt(n,10)*1.33}export function getTextBounds(t,e,n){t.save(),prepareTextForFill(t,n);const l=Math.ceil(Math.max.apply(Math,e.map(a=>t.measureText(a).width))),i=getTextLineHeight(t),u=i*e.length;return t.restore(),[l,u,i]}export function getTextLines(t){return(t||"").split(/\r\n|\r|\n/)}export function drawText(t,e,n,l,i){t.save();const[u,,a]=getTextBounds(t,e,i);e.forEach((r,d)=>{var s,h,o;const f=t.measureText(r).width,x=g(n,u,f,(s=i.textAlign)!==null&&s!==void 0?s:"left");i.textStyle&&i.textStyle.underline&&underlineText(t,r,x,l+a*d,(h=i.textFill)!==null&&h!==void 0?h:"",(o=i.textSize)!==null&&o!==void 0?o:""),t.fillText(r,x,l+a*d)}),t.restore()}function g(t,e,n,l){switch(l){case"left":return t;case"right":return t+e-n;default:return t}}export function underlineText(t,e,n,l,i,u){t.save();const a=t.measureText(e).width,r=n,d=n+a,s=l+2,h=s;let o=parseInt(u,10)/15;o<1&&(o=1),t.beginPath(),t.strokeStyle=i,t.lineWidth=o,t.moveTo(r,s),t.lineTo(d,h),t.stroke(),t.restore()}export function getFontSizeInPx(t){return`${t}px`}
