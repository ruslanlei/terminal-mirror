/*
 * Copyright (C) 2002 - 2023 Devexperts LLC
 * This Source Code Form is subject to the terms of the Mozilla Public License, v. 2.0.
 * If a copy of the MPL was not distributed with this file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */
import{merge as n}from"rxjs";import{distinctUntilChanged as v,map as L}from"rxjs/operators";import{CanvasElement as u}from"../../canvas/canvas-bounds-container";import{ChartBaseElement as w}from"../../model/chart-base-element";import{CompositeDrawer as f}from"../../drawers/composite.drawer";import{XAxisLabelsDrawer as C}from"./x-axis-labels.drawer";import{XAxisTimeLabelsGenerator as x}from"./x-axis-labels.generator";import{XAxisLabelsModel as D}from"./x-axis-labels.model";import{XAxisScaleHandler as S}from"./x-axis-scale.handler";import{XAxisTimeLabelsDrawer as X}from"./x-axis-time-labels.drawer";export class XAxisComponent extends w{constructor(s,e,r,o,i,t,h,d,m,l,b,c,A){super(),this.eventBus=s,this.config=e,this.canvasModel=r,this.chartComponent=o,this.scaleModel=i,this.chartResizeHandler=d,this.timeZoneModel=l;const p=new x(s,e,o.chartModel,i,l);this.xAxisLabelsGenerator=p,this.xAxisLabelsModel=new D(s,[]);const a=new f;m.addDrawer(a,"X_AXIS"),this.xAxisDrawer=new X(e,r,i,t,()=>this.xAxisLabelsGenerator.labels,()=>e.components.xAxis.visible),a.addDrawer(this.xAxisDrawer),this.xAxisLabelsDrawer=new C(A,e,r,t,this.xAxisLabelsModel),a.addDrawer(this.xAxisLabelsDrawer),this.xAxisScaleHandler=new S(i,h,t,b,this.chartComponent.chartModel),this.addChildEntity(this.xAxisScaleHandler),c.addCursorForCanvasEl(u.X_AXIS,e.components.xAxis.cursor)}doActivate(){super.doActivate(),this.addRxSubscription(n(this.chartComponent.chartModel.candlesSetSubject,this.chartComponent.chartModel.candlesUpdatedSubject.pipe(L(()=>{var s,e;return(e=(s=this.chartComponent.chartModel.mainCandleSeries.visualPoints[0])===null||s===void 0?void 0:s.candle)===null||e===void 0?void 0:e.timestamp}),v()),this.timeZoneModel.observeTimeZoneChanged()).subscribe(()=>this.xAxisLabelsGenerator.generateLabels())),this.addRxSubscription(n(this.scaleModel.xChanged,this.chartResizeHandler.canvasResized).subscribe(()=>this.xAxisLabelsGenerator.recalculateLabels()))}getDrawer(){return this.xAxisDrawer}registerXAxisLabelsProvider(s){this.xAxisLabelsModel.labelProviders.push(s)}setVisible(s){var e;!((e=this.config.components)===null||e===void 0)&&e.xAxis&&(this.config.components.xAxis.visible=s,this.eventBus.fireDraw())}setFormatsForLabelsConfig(s){this.xAxisLabelsGenerator instanceof x?this.xAxisLabelsGenerator.setFormatsForLabelsConfig(s):console.error("Format config for x-axis is not available")}isVisible(){var s,e;return(e=(s=this.config.components)===null||s===void 0?void 0:s.xAxis.visible)!==null&&e!==void 0?e:!1}}
