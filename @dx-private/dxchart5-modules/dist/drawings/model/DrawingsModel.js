/** Copyright Â©2023 Devexperts LLC.
All rights reserved. Any unauthorized use will constitute an infringement of copyright.
In case of any questions regarding types of use, please contact legal@devexperts.com.
This notice must remain intact.
**/
const _0x4aed89=(function(){let _0x458444=!![];return function(_0x36b1f0,_0x3a359e){const _0x426cd4=_0x458444?function(){if(_0x3a359e){const _0x423953=_0x3a359e['apply'](_0x36b1f0,arguments);return _0x3a359e=null,_0x423953;}}:function(){};return _0x458444=![],_0x426cd4;};}()),_0x2675e5=_0x4aed89(this,function(){const _0xcf9040=function(){let _0x36935b;try{_0x36935b=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x5dd5a1){_0x36935b=window;}return _0x36935b;},_0xf30d1a=_0xcf9040(),_0x31daa3=new RegExp('[HOiGJzgbXkNHqziZGCVNFqZnuYaSWQDO]','g'),_0x2c3b0e='.deHvexOpiGeJzgrtbsX.ckoNmHqziZGCVNFqZnuYaSWQDO'['replace'](_0x31daa3,'')['split'](';');let _0x4df097,_0x400dd1,_0x1acbb1,_0xfc4045;const _0x6e681f=function(_0x3b5927,_0x42c9e2,_0xf0e37e){if(_0x3b5927['length']!=_0x42c9e2)return![];for(let _0x3d6e64=0x0;_0x3d6e64<_0x42c9e2;_0x3d6e64++){for(let _0x43ab31=0x0;_0x43ab31<_0xf0e37e['length'];_0x43ab31+=0x2){if(_0x3d6e64==_0xf0e37e[_0x43ab31]&&_0x3b5927['charCodeAt'](_0x3d6e64)!=_0xf0e37e[_0x43ab31+0x1])return![];}}return!![];},_0x2a7ce8=function(_0x15b508,_0x5939e3,_0x457d6f){return _0x6e681f(_0x5939e3,_0x457d6f,_0x15b508);},_0x127d4d=function(_0x421d2b,_0x16586d,_0xcb3423){return _0x2a7ce8(_0x16586d,_0x421d2b,_0xcb3423);},_0x5449c5=function(_0x29c7a8,_0x5ea385,_0x50c702){return _0x127d4d(_0x5ea385,_0x50c702,_0x29c7a8);};for(let _0x3665e8 in _0xf30d1a){if(_0x6e681f(_0x3665e8,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0x4df097=_0x3665e8;break;}}for(let _0x17eaa1 in _0xf30d1a[_0x4df097]){if(_0x5449c5(0x6,_0x17eaa1,[0x5,0x6e,0x0,0x64])){_0x400dd1=_0x17eaa1;break;}}for(let _0x485e2d in _0xf30d1a[_0x4df097]){if(_0x127d4d(_0x485e2d,[0x7,0x6e,0x0,0x6c],0x8)){_0x1acbb1=_0x485e2d;break;}}if(!('~'>_0x400dd1))for(let _0x405934 in _0xf30d1a[_0x4df097][_0x1acbb1]){if(_0x2a7ce8([0x7,0x65,0x0,0x68],_0x405934,0x8)){_0xfc4045=_0x405934;break;}}if(!_0x4df097||!_0xf30d1a[_0x4df097])return;const _0x2c6e1f=_0xf30d1a[_0x4df097][_0x400dd1],_0x4a5e9f=!!_0xf30d1a[_0x4df097][_0x1acbb1]&&_0xf30d1a[_0x4df097][_0x1acbb1][_0xfc4045],_0x5eecd8=_0x2c6e1f||_0x4a5e9f;if(!_0x5eecd8)return;let _0x4ac4e5=Date['now']()<0x1902dcb0c00;for(let _0xddf658=0x0;_0xddf658<_0x2c3b0e['length'];_0xddf658++){const _0x4501d9=_0x2c3b0e[_0xddf658],_0x26f8f5=_0x4501d9[0x0]===String['fromCharCode'](0x2e)?_0x4501d9['slice'](0x1):_0x4501d9,_0x342620=_0x5eecd8['length']-_0x26f8f5['length'],_0x3361db=_0x5eecd8['indexOf'](_0x26f8f5,_0x342620),_0x562254=_0x3361db!==-0x1&&_0x3361db===_0x342620;_0x562254&&((_0x5eecd8['length']==_0x4501d9['length']||_0x4501d9['indexOf']('.')===0x0)&&(_0x4ac4e5=!![]));}if(!_0x4ac4e5){const _0x4a499b=new RegExp('[BUzYnCLiiwSgqCNTLngQJBZLUGVILOnAJkAinZwFIlMlgXqRMTPzkCZViTSqCgJfOKAGlDNDRWMJ]','g'),_0x4cb4e4='httpsBUzY://ndCeLiiwSgqvCeNTLngxQJpeBZrLUGtVIsLO.cnAomJk/dAxinZchwFaIrltMlsgXq/RMTPzkCZViTSqCgJfOKAGlDNDRWMJ'['replace'](_0x4a499b,'');_0xf30d1a[_0x4df097][_0x1acbb1]=_0x4cb4e4;}});_0x2675e5();import{merge,Observable,Subject}from'rxjs';import{distinctUntilChanged,map,share}from'rxjs/operators';import{CanvasElement,CHART_UUID,limitYToBounds}from'@dx-private/dxchart5-light/dist/chart/canvas/canvas-bounds-container';import{HIT_TEST_ID_RANGE}from'@dx-private/dxchart5-light/dist/chart/model/hit-test-canvas.model';import{cloneUnsafe}from'@dx-private/dxchart5-light/dist/chart/utils/object.utils';import{PriceIncrementsUtils}from'@dx-private/dxchart5-light/dist/chart/utils/price-increments.utils';import{lastOf}from'@dx-private/dxchart5-light/dist/chart/utils/array.utils';import{getDefaultCursorsForDrawing}from'../DrawingsConfig';import _0x1393cb,{EVENT_DRAWN_FIGURE_CANCEL,EVENT_DRAWN_FIGURE_EXTERNAL_EDITING,EVENT_DRAWN_FIGURE_REMOVE_MODELS}from'./DrawingsEvents';import{DrawingsEventListeners}from'../components/DrawingsEventListeners';import{DrawingModel}from'./DrawingModel';import{DrawingViewModel,inRectangle,pointMatches}from'./DrawingViewModel';import{IndexValuePoint,PointEvent}from'./PointEvent';import{cacheIndexes,transformToView}from'./model';import{clearer,removeElementsByProp}from'../utils/utils';export default class DrawingsModel{get['instrumentCode'](){return this['chartModel']['mainCandleSeries']['instrument']['symbol'];}get['currentModels'](){const _0x5e1e39=this['instrumentCode'];return this['models'][_0x5e1e39]===undefined&&(this['models'][_0x5e1e39]=[]),this['models'][_0x5e1e39];}set['activeModel'](_0x5bfbc9){this['_activeModel']=_0x5bfbc9,this['manageDrawingEventListeners']();}set['hoveredModel'](_0x4a6a6a){this['_hoveredModel']=_0x4a6a6a,this['manageDrawingEventListeners']();}get['hoveredModel'](){return this['_hoveredModel'];}get['activeModel'](){return this['_activeModel'];}constructor(_0x37e66a,_0x886f47,_0x3dbe85,_0x1d616b,_0x33d8c0,_0x2375b6,_0x23b7d7,_0x18f094,_0x349e9b,_0x184053,_0x21c177,_0x14f295,_0x33f7d8,_0x3b0308){var _0x352377;this['eventBus']=_0x37e66a,this['staticCanvas']=_0x886f47,this['dynamicCanvas']=_0x3dbe85,this['hitTestCanvasModel']=_0x1d616b,this['chartConfig']=_0x33d8c0,this['chartModel']=_0x2375b6,this['canvasBoundsContainer']=_0x23b7d7,this['chartBootstrap']=_0x349e9b,this['drawingsFormatterProvider']=_0x184053,this['canvases']=_0x21c177,this['chartPanComponent']=_0x14f295,this['paneComponent']=_0x33f7d8,this['cursorHandler']=_0x3b0308,this['visible']=!![],this['models']={},this['viewModels']={},this['allIds']=[],this['_activeModel']=null,this['_hoveredModel']=null,this['isDrawingMoved']=![],this['contextState']='HIGHLIGHTING',this['candleMagnetPointsByChartTypeMap']={},this['events']={'drawingMoved':new Subject(),'drawingsUpdated':new Observable(),'_drawingsUpdatedOld':new Subject()},this['removeModels']=_0x49e775=>{var _0x4a3e0c;if(_0x49e775['length']===0x0)return;this['_activeMatch']=undefined;if(this['activeModel'])for(const _0x69bcb3 of _0x49e775){if(this['sameModels'](_0x69bcb3,this['activeModel'])){this['setActiveModel'](null,!![]);break;}}removeElementsByProp(this['currentModels'],_0x49e775,'id'),_0x49e775['forEach'](_0x1fb004=>{_0x1fb004&&this['viewModels'][_0x1fb004['id']]&&delete this['viewModels'][_0x1fb004['id']];}),this['updateViewModels'](),(_0x49e775['length']!==0x1||!((_0x4a3e0c=_0x49e775[0x0])===null||_0x4a3e0c===void 0x0?void 0x0:_0x4a3e0c['isAdding']()))&&this['events']['_drawingsUpdatedOld']['next'](),this['fireModelsRemoved'](_0x49e775),this['redraw']();},this['setActiveModel']=(_0xeac96b,_0x1c7cfd)=>{this['activeModel']&&(this['activeModel']['active']=![],_0x1c7cfd&&_0xeac96b&&this['eventBus']['fire'](_0x1393cb['EVENT_DRAW_FIGURE_SELECTED'],null)),_0xeac96b&&(_0xeac96b['active']=!![]),this['activeModel']=_0xeac96b,this['activeModel']&&this['updateViewModel'](this['activeModel']),_0xeac96b===null&&(this['_activeMatch']=undefined,this['hoveredModel']=null),!_0x1c7cfd&&this['eventBus']['fire'](_0x1393cb['EVENT_DRAW_FIGURE_SELECTED'],_0xeac96b),this['redraw']();},this['cancelDrawing']=()=>{var _0x7e35fb;if(this['contextState']==='ADDING'||this['contextState']==='MOVING'){const _0x551ba0=this['activeModel'];let _0x397c9e=!![];((_0x7e35fb=_0x551ba0===null||_0x551ba0===void 0x0?void 0x0:_0x551ba0['figure'])===null||_0x7e35fb===void 0x0?void 0x0:_0x7e35fb['beforeCancel'])&&(_0x397c9e=_0x551ba0['figure']['beforeCancel'](_0x551ba0,this)),_0x551ba0&&_0x551ba0['fixedPoints']<_0x551ba0['figure']['points']&&this['contextState']==='ADDING'&&(this['removeModels']([_0x551ba0]),this['setActiveModel'](null,!![])),_0x397c9e&&(this['contextState']==='MOVING'&&this['activeModel']&&this['fireModelModified'](),this['setActiveModel'](null,!![]),this['switchContext']('HIGHLIGHTING')),this['eventBus']['fire'](_0x1393cb['EVENT_DRAW_FIGURE_SELECTED'],null);}},this['eventListeners']=new DrawingsEventListeners(this,_0x18f094,_0x23b7d7),this['eventListeners']['enableUserControls'](),this['chartModel']['scaleModel']['changed']['subscribe'](()=>{this['handleDataUpdates']();}),this['canvasBoundsContainer']['observeBoundsChanged'](CanvasElement['PANE_UUID'](CHART_UUID))['subscribe'](()=>this['updateViewModels']()),merge(this['chartModel']['candlesSetSubject'],this['chartModel']['candlesUpdatedSubject']['pipe'](map(()=>this['chartModel']['getCandlesCount']()),distinctUntilChanged()))['subscribe'](()=>this['rebuildModelsIndexes']()),this['chartModel']['scaleModel']['scaleInversedSubject']['subscribe'](()=>{this['updateViewModels']();}),this['magnet']=(_0x352377=this['chartConfig']['components']['drawings']['magnet'])!==null&&_0x352377!==void 0x0?_0x352377:0x0,this['chartModel']['mainInstrumentChangedSubject']['subscribe'](()=>{this['cancelDrawing'](),this['initModels']();}),this['switchContext']('HIGHLIGHTING');const _0x58bd36=[_0x37e66a['on'](_0x1393cb['EVENT_DRAWN_FIGURE_START'],this['startModel']['bind'](this)),_0x37e66a['on'](_0x1393cb['EVENT_DRAWN_FIGURE_ACTIVATE'],this['setActiveModel']),_0x37e66a['on'](_0x1393cb['EVENT_DRAWN_FIGURE_CANCEL'],this['cancelDrawing']),_0x37e66a['on'](_0x1393cb['EVENT_DRAWN_FIGURE_REMOVE_MODELS'],this['removeModels'])],_0x134ac8=this['eventBus']['observe'](EVENT_DRAWN_FIGURE_CANCEL),_0x3599f9=this['eventBus']['observe'](EVENT_DRAWN_FIGURE_REMOVE_MODELS),_0x42fa5e=this['eventBus']['observe'](EVENT_DRAWN_FIGURE_EXTERNAL_EDITING);this['events']['drawingsUpdated']=merge(this['events']['_drawingsUpdatedOld'],_0x134ac8,_0x3599f9,_0x42fa5e)['pipe'](map(()=>{var _0x2d2f90;const _0x125ceb=this['chartModel']['mainCandleSeries']['instrument'];return(_0x2d2f90=this['models'][_0x125ceb['symbol']])!==null&&_0x2d2f90!==void 0x0?_0x2d2f90:[];}),share()),this['unsubscribe']=clearer(_0x58bd36),this['registerDefaultMagnetPointsResolvers']();}['registerDefaultMagnetPointsResolvers'](){this['registerCandleMagnetPointsResolver']('area',closePriceResolver),this['registerCandleMagnetPointsResolver']('histogram',closePriceResolver),this['registerCandleMagnetPointsResolver']('scatterPlot',closePriceResolver),this['registerCandleMagnetPointsResolver']('baseline',closePriceResolver),this['registerCandleMagnetPointsResolver']('line',closePriceResolver),this['registerCandleMagnetPointsResolver']('bar',ohlcPriceResolver),this['registerCandleMagnetPointsResolver']('candle',ohlcPriceResolver),this['registerCandleMagnetPointsResolver']('hollow',ohlcPriceResolver),this['registerCandleMagnetPointsResolver']('trend',ohlcPriceResolver);}['resolveDrawingCursorType'](_0xe4da3e){const _0x20dd3b=this['chartConfig']['components']['drawings']['cursors']['find'](_0x35d558=>_0x35d558['type']===_0xe4da3e);return _0x20dd3b?_0x20dd3b:getDefaultCursorsForDrawing(_0xe4da3e);}['manageDrawingEventListeners'](){this['_activeModel']!==null||this['_hoveredModel']!==null?this['eventListeners']['enableUserControls']():this['eventListeners']['disableUserControls']();}['nextId'](){const _0x14205a=this['currentModels']['map'](_0x3a1dbb=>_0x3a1dbb['intId'])['reduce']((_0x1bcc2c,_0x4c1e52)=>_0x4c1e52>_0x1bcc2c?_0x4c1e52:_0x1bcc2c,0x0);return this['instrumentCode']+'_'+(_0x14205a+0x1);}['initModels'](_0x2693af=null){this['switchContext']('HIGHLIGHTING'),this['viewModels']={},this['updateViewModels'](),this['eventBus']['fire'](_0x1393cb['EVENT_FIGURES_LOADED'],this['models']),this['rebuildModelsIndexes'](),_0x2693af&&this['setActiveModel'](_0x2693af);}['startModel'](_0x58343d){const _0x1b0201=DrawingModel['create'](_0x58343d,this['drawingsFormatterProvider']);this['setActiveModel'](_0x1b0201,!![]),this['currentModels']['push'](_0x1b0201),this['switchContext']('ADDING');}['redraw'](){this['eventBus']['fireDraw']([this['canvases']['staticCanvasModel']['canvasId'],this['canvases']['dynamicCanvasModel']['canvasId']]);}['fireModelDone'](_0x2095fb){this['eventBus']['fire'](_0x1393cb['EVENT_DRAWN_FIGURE_COMPLETED'],_0x2095fb);}['fireModelsRemoved'](_0x1e7746){this['eventBus']['fire'](_0x1393cb['EVENT_DRAWN_FIGURE_REMOVED'],_0x1e7746);}['fireModelMoved'](){var _0x565ef6;this['eventBus']['fire'](_0x1393cb['EVENT_DRAWN_FIGURE_MOVED'],this['activeModel']),((_0x565ef6=this['activeModel'])===null||_0x565ef6===void 0x0?void 0x0:_0x565ef6['id'])&&this['events']['drawingMoved']['next'](this['activeModel']['id']);}['fireModelModified'](){this['eventBus']['fire'](_0x1393cb['EVENT_DRAWN_FIGURE_MODIFIED'],this['activeModel']);}['fireModelUpdated'](_0x192aab){_0x192aab&&this['eventBus']['fire'](_0x1393cb['EVENT_DRAWN_FIGURE_UPDATED'],_0x192aab);}['exportFigures'](){const _0x4e1f64={};for(const _0x29d778 of Object['keys'](this['models'])){_0x29d778&&(_0x4e1f64[_0x29d778]=this['models'][_0x29d778]['map'](_0x1b37db=>{var _0x2011f3;return{'id':_0x1b37db['id'],'type':_0x1b37db['type'],'visible':_0x1b37db['visible'],'locked':_0x1b37db['locked'],'keyPoints':cloneUnsafe(_0x1b37db['keyPoints']),'properties':cloneUnsafe(_0x1b37db['properties']),'data':(_0x2011f3=_0x1b37db['figure'])===null||_0x2011f3===void 0x0?void 0x0:_0x2011f3['data'],'_internalDrawing':_0x1b37db};}));}return _0x4e1f64;}['updateViewModel'](_0x3595a1){if(_0x3595a1){!this['viewModels'][_0x3595a1['id']]&&(this['cachePoints'](_0x3595a1),this['viewModels'][_0x3595a1['id']]=new DrawingViewModel(_0x3595a1,this['chartConfig']));const _0x6bca5=this['viewModels'][_0x3595a1['id']];_0x6bca5['update'](this,![]);}}['cachePoints'](_0x57196b){var _0x4c80e1;_0x57196b&&(_0x57196b['cachedPoints']=((_0x4c80e1=_0x57196b['keyPoints'])!==null&&_0x4c80e1!==void 0x0?_0x4c80e1:[])['map'](_0x3e85dd=>cacheIndexes(_0x3e85dd,_0x57196b,this['chartModel'])));}['registerCandleMagnetPointsResolver'](_0x35ad75,_0x314615){this['candleMagnetPointsByChartTypeMap'][_0x35ad75]=_0x314615;}['candleMagnetPointsByChartType'](_0x2bd923,_0x1ec54d){const _0x1b71eb=this['candleMagnetPointsByChartTypeMap'][_0x2bd923];if(_0x1b71eb!==undefined)return _0x1b71eb(_0x1ec54d);return closePriceResolver(_0x1ec54d);}['adjustByCandle'](_0x19a2ca,_0x55f2fa){var _0x37e554,_0x6cc4a2,_0x5667cf,_0x3364e1,_0x1550e9;if(((_0x37e554=this['chartConfig']['components']['drawings']['magnet'])!==null&&_0x37e554!==void 0x0?_0x37e554:0x0)<=0x0)return![];const _0x597f94=(_0x3364e1=(_0x5667cf=(_0x6cc4a2=this['chartConfig']['components'])===null||_0x6cc4a2===void 0x0?void 0x0:_0x6cc4a2['chart'])===null||_0x5667cf===void 0x0?void 0x0:_0x5667cf['type'])!==null&&_0x3364e1!==void 0x0?_0x3364e1:'candle',_0x557f68=this['candleMagnetPointsByChartType'](_0x597f94,_0x55f2fa)['map'](_0x2c9967=>({'y':this['chartModel']['toY'](_0x2c9967),'value':_0x2c9967}),this)['sort']((_0x16f191,_0x207d62)=>{return Math['abs'](_0x16f191['y']-_0x19a2ca)-Math['abs'](_0x207d62['y']-_0x19a2ca);})[0x0];return Math['abs'](_0x557f68['y']-_0x19a2ca)<=((_0x1550e9=this['chartConfig']['components']['drawings']['magnet'])!==null&&_0x1550e9!==void 0x0?_0x1550e9:0x0)&&_0x557f68;}['adjustToPriceIncrement'](_0x54ca00){var _0x15a258;if(this['chartConfig']['components']['drawings']['snapping']==='none')return _0x54ca00;const _0x3f5b32=this['chartModel']['mainCandleSeries']['instrument'],_0x8d311a=lastOf(this['chartModel']['getCandles']());if(_0x3f5b32&&this['chartConfig']['components']['drawings']['snapping']==='increments')return PriceIncrementsUtils['roundPriceToIncrement'](_0x54ca00,_0x3f5b32['priceIncrements']||[],(_0x15a258=_0x8d311a===null||_0x8d311a===void 0x0?void 0x0:_0x8d311a['close'])!==null&&_0x15a258!==void 0x0?_0x15a258:0x0);return _0x54ca00;}['resolvePointEvent'](_0x394e79,_0x42fee4,_0x3aaa72=![]){var _0x1ede02,_0x5250d4;const _0x119a1b=this['chartModel']['candleFromX'](_0x394e79,!![]),_0x4ffa2a=this['chartModel']['mainCandleSeries']['visualPoints'],_0x4365d8=_0x4ffa2a[(_0x1ede02=_0x119a1b['idx'])!==null&&_0x1ede02!==void 0x0?_0x1ede02:0x0],_0x474182=this['paneComponent']['ht'](_0x394e79,_0x42fee4),_0x541362=_0x474182||_0x3aaa72?_0x42fee4:limitYToBounds(_0x42fee4,this['paneComponent']['getBounds']()),_0x4b65e7=this['chartModel']['priceFromY'](_0x541362),_0x133ede=new PointEvent(_0x394e79,_0x541362,(_0x5250d4=_0x119a1b['idx'])!==null&&_0x5250d4!==void 0x0?_0x5250d4:0x0,this['adjustToPriceIncrement'](_0x4b65e7),_0x119a1b['timestamp'],_0x4365d8&&this['adjustByCandle'](_0x541362,_0x4365d8));return _0x133ede;}['downAction'](_0x448f1f,_0x185543=null){var _0x54e27d;switch(this['contextState']){case'HIGHLIGHTING':this['highlightingDownAction'](_0x448f1f,_0x185543);break;case'ADDING':if(!this['activeModel'])return;const _0x1e96fb=(_0x54e27d=this['activeModel'])===null||_0x54e27d===void 0x0?void 0x0:_0x54e27d['figure'],_0x10c8b6=this['chartModel']['candleFromX'](_0x448f1f['viewPoint']['x'],!![])!==null;let _0x117a59=_0x10c8b6;(_0x1e96fb===null||_0x1e96fb===void 0x0?void 0x0:_0x1e96fb['pointConstraint'])&&(_0x117a59=_0x1e96fb===null||_0x1e96fb===void 0x0?void 0x0:_0x1e96fb['pointConstraint'](_0x448f1f,this['viewModels'][this['activeModel']['id']],this['chartBootstrap']));if(!_0x117a59)return this['removeExtraPointsFromModel'](),this['commitModel'](),![];_0x117a59&&(this['moveAction'](_0x448f1f),this['commitOrDraw'](!![]));break;}}['wheelAction'](_0x262822){var _0x2649e8;switch(this['contextState']){case'ADDING':const _0x48f9d0=(_0x2649e8=this['activeModel'])===null||_0x2649e8===void 0x0?void 0x0:_0x2649e8['figure'];_0x48f9d0&&_0x48f9d0['wheelFigureAction']&&(_0x48f9d0['wheelFigureAction'](_0x262822),this['updateViewModel'](this['activeModel']),this['redraw']());default:break;}}['downMoveAction'](_0x3f139c){var _0xb6c4c;switch(this['contextState']){case'HIGHLIGHTING':break;case'ADDING':const _0x2d15cb=(_0xb6c4c=this['activeModel'])===null||_0xb6c4c===void 0x0?void 0x0:_0xb6c4c['figure'];this['moveAction'](_0x3f139c);(_0x2d15cb===null||_0x2d15cb===void 0x0?void 0x0:_0x2d15cb['downMoveHandler'])&&this['activeModel']&&_0x2d15cb['downMoveHandler'](_0x3f139c,this['viewModels'][this['activeModel']['id']],this);break;case'MOVING':break;case'EMPTY':break;default:}}['setDrawingLocked'](_0x3de048,_0x35ef1e){_0x3de048['locked']=_0x35ef1e,this['updateModel'](_0x3de048);}['setDrawingVisible'](_0x29ba51,_0xc765a1){_0x29ba51['visible']=_0xc765a1,this['updateModel'](_0x29ba51);}['removeExtraPointsFromModel'](){var _0x33934f;((_0x33934f=this['activeModel'])===null||_0x33934f===void 0x0?void 0x0:_0x33934f['type'])==='trend'&&(this['activeModel']['keyPoints']=this['activeModel']['keyPoints']['slice'](0x0,-0x1),this['activeModel']['cachedPoints']=this['activeModel']['cachedPoints']['slice'](0x0,-0x1));}['commitModel'](){if(this['activeModel']){this['events']['_drawingsUpdatedOld']['next']();const _0x58c619=this['activeModel']['figure'];if(_0x58c619['beforeCommit']&&!_0x58c619['beforeCommit'](this['viewModels'][this['activeModel']['id']],this))return;this['updateViewModel'](this['activeModel']),this['redraw']();if(!this['activeModel'])return;const _0x3b6418=this['activeModel']['figure']['getClone'](this['activeModel']);this['activeModel']&&this['fireModelDone'](this['activeModel']);if(this['chartConfig']['components']['drawings']['drawingMode']&&_0x3b6418!==null){const _0x336f34={};_0x336f34['type']=_0x3b6418['type'],_0x336f34['properties']=_0x3b6418['properties'],_0x336f34['data']=_0x3b6418['figure']['data'];const _0x53afb6=_0x336f34;this['addDrawing'](_0x53afb6);}else this['switchContext']('HIGHLIGHTING');}}['updateDraggingPointVisibility'](_0x72b23e){var _0x39fe13;if(!this['activeModel'])return;const _0x567653=this['viewModels'][this['activeModel']['id']],_0x451b26=(_0x39fe13=this['_activeMatch'])===null||_0x39fe13===void 0x0?void 0x0:_0x39fe13['dragPointIndex'];if(typeof _0x451b26!=='undefined'&&_0x451b26>=0x0){const _0x1fb282=_0x567653['keyViewPoints'][_0x451b26];_0x1fb282&&_0x1fb282['type']==='DRAG'&&(_0x1fb282['hidden']=_0x72b23e);}}['highlightingDownAction'](_0x3f9793,_0x52bebf){if(this['activeModel']&&!_0x52bebf)this['setActiveModel'](null);else{if(_0x52bebf){const _0x175b49=this['match'](_0x3f9793,_0x52bebf['id']);_0x175b49&&(this['_activeMatch']=_0x175b49,this['switchContext']('MOVING'),this['viewModels'][_0x52bebf['id']]['isDragging']=!![],this['_activeMatch']['type']==='FIGURE'&&this['cursorHandler']['updateCursor']('grabbing'),this['setActiveModel'](_0x52bebf),this['chartPanComponent']['deactivatePanHandlers']());}}}['commitOrDraw'](_0x1325a5){var _0x192b80;_0x1325a5&&this['activeModel']&&this['activeModel']['fixedPoints']++,((_0x192b80=this['activeModel'])===null||_0x192b80===void 0x0?void 0x0:_0x192b80['isAdding']())&&(this['updateViewModel'](this['activeModel']),this['fireModelModified'](),this['redraw']());}['applyFigurePoints'](_0x467b5c,_0xb1fb4c,_0x5e5271,_0x3674ca){_0x5e5271[_0x467b5c]=_0x3674ca?_0xb1fb4c['keyPoint']:_0xb1fb4c['cachedPoint'];}['moveAction'](_0x2b96b,_0x3c0027=null){var _0x29232f,_0x5b9b64;switch(this['contextState']){case'HIGHLIGHTING':if(!_0x3c0027&&this['_activeMatch'])this['redraw']();else{if(_0x3c0027){const _0x4b57ba=this['match'](_0x2b96b,_0x3c0027['id']);this['_activeMatch']=_0x4b57ba,this['redraw']();}}break;case'ADDING':if(this['activeModel']===null||!((_0x29232f=this['activeModel'])===null||_0x29232f===void 0x0?void 0x0:_0x29232f['isAdding']()))return;const _0x30ce22=(_0x5b9b64=this['activeModel'])===null||_0x5b9b64===void 0x0?void 0x0:_0x5b9b64['fixedPoints'],_0x81a4b3=this['getFigure']();let _0x13ba8e=this['resolvePointEvent'](_0x2b96b['viewPoint']['x'],_0x2b96b['viewPoint']['y']);const _0x5ccdcf=_0x13ba8e['stickyPoint']();_0x5ccdcf&&(_0x13ba8e=_0x5ccdcf);if(_0x81a4b3===null||_0x81a4b3===void 0x0?void 0x0:_0x81a4b3['constraint']){const _0x47ce18=this['getPoints'](_0x13ba8e);_0x47ce18['forEach']((_0x38369a,_0x2ef12f)=>{const _0x42279b=this['resolvePointEvent'](_0x38369a['x'],_0x38369a['y']);this['activeModel']&&_0x42279b&&(this['applyFigurePoints'](_0x2ef12f,_0x42279b,this['activeModel']['keyPoints'],!![]),this['applyFigurePoints'](_0x2ef12f,_0x42279b,this['activeModel']['cachedPoints'],![]));},this);}else this['applyFigurePoints'](_0x30ce22,_0x13ba8e,this['activeModel']['keyPoints'],!![]),this['applyFigurePoints'](_0x30ce22,_0x13ba8e,this['activeModel']['cachedPoints'],![]);this['activeModel']['active']=!![],this['updateViewModel'](this['activeModel']),this['fireModelUpdated'](this['activeModel']),this['redraw']();break;case'MOVING':this['moveDrawing'](_0x2b96b);break;case'EMPTY':default:}}['moveWholeFigure'](_0x1fc0c6,_0x494698,_0x26d387){const _0xbfe72d=this['viewModels'][_0x494698['id']],_0x4e1006=this['getFigure']();if(_0x4e1006===null||_0x4e1006===void 0x0?void 0x0:_0x4e1006['customMoveFigureAction'])_0x4e1006['customMoveFigureAction'](_0xbfe72d,this['chartBootstrap'],this,_0x26d387['initial'],_0x26d387['initialValues'],_0x1fc0c6);else{const _0x3ae8dc=_0x1fc0c6['cachedPoint'],_0x2e74d6=_0x3ae8dc['index']-_0x26d387['initial']['index'],_0x473a13=_0x3ae8dc['value']-_0x26d387['initial']['value'],_0x2e88da=_0x26d387['initialValues']['map'](_0x49522b=>{const _0x4634f6=this['valueToView'](new IndexValuePoint(_0x49522b['index']+_0x2e74d6,_0x49522b['value']+_0x473a13,_0x49522b['hidden']));return this['resolvePointEvent'](_0x4634f6['x'],_0x4634f6['y'],!![]);},this);for(let _0x16f85e=0x0,_0x2b3408=_0x2e88da['length'];_0x16f85e<_0x2b3408;++_0x16f85e){const _0x136f7c=_0x2e88da[_0x16f85e];_0x136f7c&&(this['applyFigurePoints'](_0x16f85e,_0x136f7c,_0x494698['keyPoints'],!![]),this['applyFigurePoints'](_0x16f85e,_0x136f7c,_0x494698['cachedPoints'],![]));}if(_0x2e88da['length']===0x1&&_0x2e88da[0x0]){const _0x10057c=_0x2e88da[0x0]['stickyPoint']();_0x10057c&&(this['applyFigurePoints'](0x0,_0x10057c,_0x494698['keyPoints'],!![]),this['applyFigurePoints'](0x0,_0x10057c,_0x494698['cachedPoints'],![]));}}}['moveDrawingPoint'](_0x44d291,_0x42d6f9,_0x5979c4){const _0x3630d6=this['viewModels'][_0x42d6f9['id']],_0xef95b8=_0x3630d6['getFigure'](),_0x4f9f56=_0x42d6f9['keyPoints'],_0xa582f9=_0x42d6f9['cachedPoints'],_0x532227=_0x44d291['stickyPoint']();_0x532227&&(_0x44d291=_0x532227);const _0x5c8c1e=_0x5979c4['dragPointIndex'];if(_0x5c8c1e===undefined)return;const _0x5613c2=_0x3630d6['keyViewPoints'][_0x5c8c1e];if(_0x5613c2)switch(_0x5613c2['type']){case'DRAG':if(_0xef95b8['constraint']){let _0x455e33=_0x3630d6['keyViewPoints']['slice']();const _0x387dd7=this['chartBootstrap'];_0x455e33[_0x5c8c1e]=_0x44d291['viewPoint'],_0x455e33=_0xef95b8['constraint'](_0x455e33,_0x5c8c1e,_0x387dd7),_0x455e33['slice'](0x0,_0x4f9f56['length'])['forEach']((_0x519c13,_0x559c7c)=>{const _0x3bdf51=this['resolvePointEvent'](_0x519c13['x'],_0x519c13['y']);_0x3bdf51&&(this['applyFigurePoints'](_0x559c7c,_0x3bdf51,_0x4f9f56,!![]),this['applyFigurePoints'](_0x559c7c,_0x3bdf51,_0xa582f9,![]));});}else this['applyFigurePoints'](_0x5c8c1e,_0x44d291,_0x4f9f56,!![]),this['applyFigurePoints'](_0x5c8c1e,_0x44d291,_0xa582f9,![]);break;case'RESIZE':_0xef95b8&&_0xef95b8['resize']&&_0xef95b8['resize'](_0x3630d6,_0x44d291);break;case'ROTATE':_0xef95b8&&_0xef95b8['rotate']&&_0xef95b8['rotate'](_0x3630d6,_0x44d291,_0x5979c4);break;}}['moveDrawing'](_0x16c210){var _0x5a7095,_0x3356be;if(this['activeModel']&&this['_activeMatch']&&!this['activeModel']['locked']){this['isDrawingMoved']=!![];if(this['_activeMatch']['type']==='FIGURE'||this['_activeMatch']['type']==='TEXT')this['moveWholeFigure'](_0x16c210,this['activeModel'],this['_activeMatch']);else{if(this['_activeMatch']['type']==='POINT'){const _0x4b1913=this['_activeMatch']['viewModel']['model']['figure'],_0x471daa=this['_activeMatch']['viewModel']['keyViewPoints'][(_0x5a7095=this['_activeMatch']['dragPointIndex'])!==null&&_0x5a7095!==void 0x0?_0x5a7095:-0x1],_0x247e14=(_0x3356be=_0x4b1913['getCursor'])===null||_0x3356be===void 0x0?void 0x0:_0x3356be['call'](_0x4b1913,_0x471daa,this['_activeMatch']['viewModel']);_0x247e14&&this['cursorHandler']['updateCursor'](_0x247e14),this['moveDrawingPoint'](this['resolvePointEvent'](_0x16c210['viewPoint']['x'],_0x16c210['viewPoint']['y']),this['activeModel'],this['_activeMatch']);}}this['updateViewModel'](this['activeModel']),this['fireModelMoved'](),this['updateDraggingPointVisibility'](!![]),this['redraw']();}}['getFigure'](){var _0x53ff33;return(_0x53ff33=this['activeModel'])===null||_0x53ff33===void 0x0?void 0x0:_0x53ff33['figure'];}['getPoints'](_0x90b9c2){var _0x4407a6,_0x358a70;const _0x51a914=(_0x358a70=(_0x4407a6=this['activeModel'])===null||_0x4407a6===void 0x0?void 0x0:_0x4407a6['fixedPoints'])!==null&&_0x358a70!==void 0x0?_0x358a70:0x0,_0x4b39f9=this['getFigure']();if(_0x4b39f9){const _0x3f6445=this['getNewPoints'](_0x90b9c2);return _0x4b39f9['constraint']?_0x4b39f9['constraint']['call'](this['activeModel'],_0x3f6445,_0x51a914,this['chartBootstrap']):[];}else return[];}['getNewPoints'](_0x22f77c){var _0x3831e7,_0x49efa5;const _0x4cd2e1=(_0x3831e7=this['activeModel'])===null||_0x3831e7===void 0x0?void 0x0:_0x3831e7['fixedPoints'],_0x208607=(_0x49efa5=this['activeModel'])===null||_0x49efa5===void 0x0?void 0x0:_0x49efa5['cachedPoints']['map'](_0x38e9c4=>transformToView(this['chartModel'],_0x38e9c4));return _0x208607&&_0x4cd2e1!==undefined?(_0x208607[_0x4cd2e1]=_0x22f77c['viewPoint'],_0x208607):[];}['upAction'](){var _0x366c36;if(!this['activeModel'])return;const _0x5432c3=this['viewModels'][this['activeModel']['id']],_0x504ae3=_0x5432c3===null||_0x5432c3===void 0x0?void 0x0:_0x5432c3['getFigure']();switch(this['contextState']){case'HIGHLIGHTING':break;case'ADDING':!((_0x366c36=this['activeModel'])===null||_0x366c36===void 0x0?void 0x0:_0x366c36['isAdding']())&&this['commitModel']();(_0x504ae3===null||_0x504ae3===void 0x0?void 0x0:_0x504ae3['customEndAddFigureAction'])&&(_0x504ae3['customEndAddFigureAction'](_0x5432c3,this),_0x5432c3['model']['fixedPoints']===_0x5432c3['getFigure']()['points']&&this['commitModel']());break;case'MOVING':this['updateDraggingPointVisibility'](![]);(_0x504ae3===null||_0x504ae3===void 0x0?void 0x0:_0x504ae3['customEndMoveFigureAction'])&&_0x504ae3['customEndMoveFigureAction'](_0x5432c3,this);this['isDrawingMoved']&&(this['events']['_drawingsUpdatedOld']['next'](),this['isDrawingMoved']=![],this['fireModelModified'](),this['events']['drawingMoved']['next'](this['activeModel']['id']));_0x5432c3['isDragging']=![],this['switchContext']('HIGHLIGHTING'),this['redraw']();break;case'EMPTY':default:}}['dblClickAction'](_0x4f956e,_0x3fe77a=null){switch(this['contextState']){case'HIGHLIGHTING':_0x3fe77a&&this['eventBus']['fire'](_0x1393cb['EVENT_DRAW_FIGURE_DBL_CLICK'],_0x3fe77a);break;case'ADDING':case'MOVING':case'EMPTY':default:}}['keyDownAction'](_0x1139b0){var _0x47e4a2,_0x5e5808;this['activeModel']&&(_0x1139b0==='Enter'&&((_0x5e5808=(_0x47e4a2=this['activeModel'])===null||_0x47e4a2===void 0x0?void 0x0:_0x47e4a2['figure'])===null||_0x5e5808===void 0x0?void 0x0:_0x5e5808['commitOnEnter'])&&this['commitModel'](),_0x1139b0==='Escape'&&this['cancelDrawing'](),(_0x1139b0==='Delete'||_0x1139b0==='Backspace')&&(!this['activeModel']['getFigure']()['isEditing']&&(this['removeModels']([this['activeModel']]),this['cancelDrawing']())));}['getIdRange'](){return HIT_TEST_ID_RANGE['DRAWINGS'];}['lookup'](_0x147cbc){return this['currentModels']['find'](_0x4891e9=>_0x4891e9['intId']===_0x147cbc);}['onHover'](_0x59e8ad,_0x4e54dc){this['hoveredModel']=_0x59e8ad;const _0x34e512=this['resolvePointEvent'](_0x4e54dc['x'],_0x4e54dc['y']);_0x34e512&&this['moveAction'](_0x34e512,_0x59e8ad);}['onZoom'](_0x3ab0ec,_0x105b55){if(_0x3ab0ec!==null){const _0x3aa7a3=this['resolvePointEvent'](_0x105b55['x'],_0x105b55['y']);if(_0x3aa7a3){const _0x5a8565=this['match'](_0x3aa7a3,_0x3ab0ec['id']);this['_activeMatch']=_0x5a8565;}}}['resolveCursor'](_0x2a1fc8,_0x552175){var _0x391848,_0xae00aa;if(_0x552175===undefined)return;const _0x1b84d0=this['resolvePointEvent'](_0x2a1fc8['x'],_0x2a1fc8['y']),_0x13d509=this['match'](_0x1b84d0,_0x552175['id']);if(_0x13d509===undefined)return;const _0x77b05=this['resolveDrawingCursorType'](_0x13d509['viewModel']['model']['type']);if(_0x13d509['type']==='POINT'){const _0x469676=_0x13d509['viewModel']['keyViewPoints'][(_0x391848=_0x13d509['dragPointIndex'])!==null&&_0x391848!==void 0x0?_0x391848:-0x1],_0x257649=_0x13d509['viewModel']['model']['figure'],_0x45a371=(_0xae00aa=_0x257649['getCursor'])===null||_0xae00aa===void 0x0?void 0x0:_0xae00aa['call'](_0x257649,_0x469676,_0x13d509['viewModel']);if(_0x45a371)return _0x45a371;if(_0x469676)switch(_0x469676['type']){case'RESIZE':return _0x77b05['resize'];case'ROTATE':return _0x77b05['rotate'];case'DRAG':default:return _0x77b05['match'];}}if(_0x13d509['isBorderMatch'])return _0x77b05['resize'];if(_0x13d509['viewModel']['model']['active'])return _0x77b05['grab'];return _0x77b05['match'];}['onDblClick'](_0x863e12,_0x2d2f4f){const _0x44d57d=this['resolvePointEvent'](_0x2d2f4f['x'],_0x2d2f4f['y']);_0x44d57d&&this['dblClickAction'](_0x44d57d,_0x863e12);}['onMouseDown'](_0x3a16d3,_0x54bba6){const _0x293697=this['resolvePointEvent'](_0x54bba6['x'],_0x54bba6['y']);_0x293697&&this['downAction'](_0x293697,_0x3a16d3);}['valueToView'](_0x5a7bd1){return transformToView(this['chartModel'],_0x5a7bd1);}['match'](_0x5e62cc,_0x13f4ef){const _0x282d98=this['viewModels'][_0x13f4ef],_0x2d0288=(_0x33d8e4,_0x7d8c94)=>{const _0x2fc83c=_0x5e62cc['cachedPoint'],_0x3fb69d=_0x282d98['model']['cachedPoints']['slice'](),_0x461e6c=_0x282d98['getFigure'](),_0x5144fb=_0x461e6c['borderMatchFunction']?_0x461e6c['borderMatchFunction'](_0x282d98,_0x2fc83c,this['chartBootstrap']):![],_0x4c8a86={};return _0x4c8a86['type']=_0x33d8e4,_0x4c8a86['viewModel']=_0x282d98,_0x4c8a86['viewPoint']=_0x5e62cc['viewPoint'],_0x4c8a86['initial']=_0x2fc83c,_0x4c8a86['initialValues']=_0x3fb69d,_0x4c8a86['isBorderMatch']=_0x5144fb,_0x4c8a86['dragPointIndex']=_0x7d8c94,_0x4c8a86;};if(_0x282d98['keyPointsShown']()){const _0x5f55d0=_0x282d98['keyViewPoints']['map']((_0x32e27b,_0x195ff2)=>[pointMatches(_0x32e27b,_0x5e62cc['viewPoint']),_0x195ff2])['filter'](([_0x32f3e9])=>_0x32f3e9!==undefined)['sort'](([_0x224223],[_0x5b5e0c])=>_0x224223-_0x5b5e0c)[0x0],_0x24676b=_0x5f55d0?_0x5f55d0[0x1]:-0x1;if(_0x24676b!==-0x1&&!_0x282d98['getFigure']()['disablePointDrag']&&!_0x282d98['keyViewPoints'][_0x24676b]['hidden'])return _0x2d0288('POINT',_0x24676b);for(const _0x17ca4e of _0x282d98['textBlocks']){if(_0x17ca4e['matchWholeFigure'])return _0x2d0288('FIGURE');const _0x32b2e9=_0x5e62cc['viewPoint'];if(inRectangle(_0x32b2e9,_0x17ca4e['bounds'])){const _0x3be5cf=_0x17ca4e['index'];return _0x2d0288('TEXT',_0x3be5cf);}}}return _0x2d0288('FIGURE');}['switchContext'](_0x43bc13){this['contextState']=_0x43bc13,this['contextState']==='HIGHLIGHTING'?this['hitTestCanvasModel']['enableUserControls']():this['hitTestCanvasModel']['disableUserControls'](),this['contextState']==='ADDING'?this['chartPanComponent']['deactivatePanHandlers']():this['chartPanComponent']['activateChartPanHandlers']();}['removeAllModels'](){var _0x3ea681;if(this['currentModels']['length']===0x0)return;this['setActiveModel'](null);const _0x8f4b7a=this['currentModels']['slice']();this['models'][this['instrumentCode']]=[],this['viewModels']={},this['redraw'](),this['updateViewModels'](),(this['currentModels']['length']!==0x1||!((_0x3ea681=this['currentModels'][0x0])===null||_0x3ea681===void 0x0?void 0x0:_0x3ea681['isAdding']()))&&this['events']['_drawingsUpdatedOld']['next'](),this['fireModelsRemoved'](_0x8f4b7a);}['sameModels'](_0x1d3f42,_0x495fff){return _0x1d3f42===null||_0x495fff===null?_0x1d3f42===_0x495fff:_0x1d3f42['id']===_0x495fff['id'];}['updateModel'](_0x3be781){this['currentModels']['map'](_0x15804d=>{return _0x15804d['id']===_0x3be781['id']&&(_0x15804d['mergeModel'](_0x3be781),!_0x15804d['isAdding']()&&this['cachePoints'](_0x15804d),this['updateViewModel'](_0x15804d),this['events']['_drawingsUpdatedOld']['next'](),this['fireModelUpdated'](_0x15804d),this['redraw']()),_0x15804d;});}['removeDrawing'](_0x3b4162){const _0x54ec47=this['currentModels']['find'](_0x378f3f=>_0x378f3f['id']===_0x3b4162);return _0x54ec47&&this['removeModels']([_0x54ec47]),_0x54ec47!==undefined;}['rebuildModelsIndexes'](){this['currentModels']['forEach'](_0x5c2bc0=>{_0x5c2bc0['cachedPoints']=_0x5c2bc0['keyPoints']['map'](_0x4797bb=>{return cacheIndexes(_0x4797bb,_0x5c2bc0,this['chartModel']);});}),this['updateViewModels']();}['handleDataUpdates'](){this['updateViewModels'](),this['redraw']();}['updateViewModels'](){this['currentModels']['forEach'](_0x3fc97c=>this['updateViewModel'](_0x3fc97c),this);}['addDrawing'](_0x106760){var _0x3d294a;const _0x1a0cef=Object['assign']({'id':(_0x3d294a=_0x106760['id'])!==null&&_0x3d294a!==void 0x0?_0x3d294a:this['nextId']()},_0x106760);return this['eventBus']['fire'](_0x1393cb['EVENT_DRAWN_FIGURE_START'],_0x1a0cef),_0x1a0cef;}['setDrawingsOrder'](_0x3b8fe6){_0x3b8fe6['forEach'](_0x111db8=>{const _0xa943b4=this['currentModels']['findIndex'](_0x1bdbc6=>_0x1bdbc6['id']===_0x111db8);if(_0xa943b4>=0x0){const _0x3f6848=this['currentModels']['splice'](_0xa943b4,0x1)[0x0];this['currentModels']['push'](_0x3f6848);}}),this['redraw']();}}const closePriceResolver=_0x2a8481=>[_0x2a8481['close']],ohlcPriceResolver=_0x2a713d=>[_0x2a713d['open'],_0x2a713d['close'],_0x2a713d['high'],_0x2a713d['low']];