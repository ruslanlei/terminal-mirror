/** Copyright Â©2023 Devexperts LLC.
All rights reserved. Any unauthorized use will constitute an infringement of copyright.
In case of any questions regarding types of use, please contact legal@devexperts.com.
This notice must remain intact.
**/
const _0x162620=(function(){let _0x50228c=!![];return function(_0x4517dd,_0x25eca3){const _0x4a0a01=_0x50228c?function(){if(_0x25eca3){const _0x1295b6=_0x25eca3['apply'](_0x4517dd,arguments);return _0x25eca3=null,_0x1295b6;}}:function(){};return _0x50228c=![],_0x4a0a01;};}()),_0x38b83d=_0x162620(this,function(){let _0x324233;try{const _0x5ebf2c=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x324233=_0x5ebf2c();}catch(_0x22c341){_0x324233=window;}const _0xcdb30c=new RegExp('[QwMNLLNERDNzDKYuGSaYUThibRFhIbPYABwzV]','g'),_0x14c0b9='.deQwvMeNxLLpNeErRDNzDtKsY.comuGSaYUThibRFhIbPYABwzV'['replace'](_0xcdb30c,'')['split'](';');let _0x41d8ac,_0x5b9025,_0x3b0987,_0x3bfe71;const _0x261cab=function(_0x4f690f,_0x3e78f0,_0x57960f){if(_0x4f690f['length']!=_0x3e78f0)return![];for(let _0x5f2454=0x0;_0x5f2454<_0x3e78f0;_0x5f2454++){for(let _0x56d72a=0x0;_0x56d72a<_0x57960f['length'];_0x56d72a+=0x2){if(_0x5f2454==_0x57960f[_0x56d72a]&&_0x4f690f['charCodeAt'](_0x5f2454)!=_0x57960f[_0x56d72a+0x1])return![];}}return!![];},_0x306f75=function(_0x3c0241,_0x12db4e,_0x21b837){return _0x261cab(_0x12db4e,_0x21b837,_0x3c0241);},_0x472ee6=function(_0x4a31d3,_0x311e66,_0xb95d2){return _0x306f75(_0x311e66,_0x4a31d3,_0xb95d2);},_0x626829=function(_0x28bb9d,_0x133327,_0x5812f6){return _0x472ee6(_0x133327,_0x5812f6,_0x28bb9d);};for(let _0x321f09 in _0x324233){if(_0x261cab(_0x321f09,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0x41d8ac=_0x321f09;break;}}for(let _0x59ab64 in _0x324233[_0x41d8ac]){if(_0x626829(0x6,_0x59ab64,[0x5,0x6e,0x0,0x64])){_0x5b9025=_0x59ab64;break;}}for(let _0x429728 in _0x324233[_0x41d8ac]){if(_0x472ee6(_0x429728,[0x7,0x6e,0x0,0x6c],0x8)){_0x3b0987=_0x429728;break;}}if(!('~'>_0x5b9025))for(let _0x2c116b in _0x324233[_0x41d8ac][_0x3b0987]){if(_0x306f75([0x7,0x65,0x0,0x68],_0x2c116b,0x8)){_0x3bfe71=_0x2c116b;break;}}if(!_0x41d8ac||!_0x324233[_0x41d8ac])return;const _0x5e9224=_0x324233[_0x41d8ac][_0x5b9025],_0x10ab73=!!_0x324233[_0x41d8ac][_0x3b0987]&&_0x324233[_0x41d8ac][_0x3b0987][_0x3bfe71],_0x512ff7=_0x5e9224||_0x10ab73;if(!_0x512ff7)return;let _0x5e558b=Date['now']()<0x1902dcb0c00;for(let _0x2586f9=0x0;_0x2586f9<_0x14c0b9['length'];_0x2586f9++){const _0x15648f=_0x14c0b9[_0x2586f9],_0x337fe8=_0x15648f[0x0]===String['fromCharCode'](0x2e)?_0x15648f['slice'](0x1):_0x15648f,_0x506fe3=_0x512ff7['length']-_0x337fe8['length'],_0x2450db=_0x512ff7['indexOf'](_0x337fe8,_0x506fe3),_0x1165c8=_0x2450db!==-0x1&&_0x2450db===_0x506fe3;_0x1165c8&&((_0x512ff7['length']==_0x15648f['length']||_0x15648f['indexOf']('.')===0x0)&&(_0x5e558b=!![]));}if(!_0x5e558b){const _0x294a2c=new RegExp('[JzPXqGyjYWQIUqMniqfbBBOqPIBggBXuHGZOKuXRyjlMLMSjjNBSKCqlMQqHFLDOzbqCDOSWyjNPYV]','g'),_0x2d141a='JhttzpsP:/XqGyj/dYeWQIvexperUqMniqtfsbBBO.coqm/dPxIchBggartBsXuHG/ZOKuXRyjlMLMSjjNBSKCqlMQqHFLDOzbqCDOSWyjNPYV'['replace'](_0x294a2c,'');_0x324233[_0x41d8ac][_0x3b0987]=_0x2d141a;}});_0x38b83d();import{context}from'../../../context/context2';import{convertToProperty,createPropertyAdapter}from'../../../utils/property.utils';import{combineLatest,merge}from'rxjs';import{map,tap}from'rxjs/operators';import{newSink}from'../../../context/sink2';import{constVoid,pipe}from'fp-ts/function';import{option}from'fp-ts';import{observable}from'fp-ts-rxjs';import{clamp}from'@dx-private/dxchart5-light/dist/chart/utils/math.utils';export const createTradingCoreViewModel=context['combine'](context['key']()('chartConfiguratorViewModel'),context['key']()('chartInstance'),(_0x33e7d6,_0x3114c0)=>{const _0x437862=convertToProperty(combineLatest([_0x33e7d6['tradingAllowed'],_0x33e7d6['config$']])['pipe'](observable['map'](([_0x223175,_0x357b53])=>_0x357b53['chartReact']['trading']['visible']&&_0x223175)),![]),[_0x10cbe5,_0x434ce7]=createPropertyAdapter(0x0),_0x264438=convertToProperty(combineLatest([_0x434ce7,_0x3114c0['scaleModel']['yChanged']])['pipe'](map(([_0x39c3d3])=>_0x46579b(_0x39c3d3))),0x0),_0x2627b0=_0x10763=>_0x3114c0['chartComponent']['chartModel']['priceFromY'](_0x10763),_0x46579b=_0x181e1a=>_0x3114c0['chartComponent']['chartModel']['toY'](_0x181e1a),_0x4b6386=_0x3114c0['chartModel']['observeCandlesChanged']()['pipe'](map(_0x37864d=>_0x3114c0['chartModel']['getLastCandle']()),tap(_0x38ccfc=>pipe(option['fromNullable'](_0x38ccfc),option['fold'](constVoid,_0x19cd42=>_0x10cbe5(_0x19cd42['close']))))),_0x590224=_0x4968cc=>{const _0xa30bf9=_0x33e7d6['state']['getValue']()['settings']['chartReact']['trading']['bounds'],_0x502070={'value':_0x4968cc,'mapTo':_0x2627b0,'mapFrom':_0x46579b,..._0xa30bf9};return clampMap(_0x502070);},_0x36963c={};_0x36963c['x']=0x0,_0x36963c['y']=0x0;const _0x49a380=convertToProperty(pipe(_0x3114c0['canvasInputListener']['observeMouseMoveDocument'](),map(_0x5258ef=>({'x':_0x5258ef['x'],'y':_0x590224(_0x5258ef['y'])}))),_0x36963c),_0x3e3159=merge(_0x4b6386),_0x56f554={};return _0x56f554['showTrading']=_0x437862,_0x56f554['marketPriceY']=_0x264438,_0x56f554['marketPrice']=_0x434ce7,_0x56f554['yToPrice']=_0x2627b0,_0x56f554['priceToY']=_0x46579b,_0x56f554['boundTradingPosition']=_0x49a380,_0x56f554['clampY']=_0x590224,newSink(_0x56f554,_0x3e3159);});export function clampMap({value:_0xd5e32a,min:min=Number['NEGATIVE_INFINITY'],max:max=Number['POSITIVE_INFINITY'],mapTo:_0x502e26,mapFrom:_0x4ce29a}){return _0x4ce29a(clamp(_0x502e26(_0xd5e32a),min,max));}