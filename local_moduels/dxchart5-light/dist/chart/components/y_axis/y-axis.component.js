/*
 * Copyright (C) 2002 - 2023 Devexperts LLC
 * This Source Code Form is subject to the terms of the Mozilla Public License, v. 2.0.
 * If a copy of the MPL was not distributed with this file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */
import{Subject as g}from"rxjs";import{CanvasElement as h,CHART_UUID as i}from"../../canvas/canvas-bounds-container";import{ChartBaseElement as w}from"../../chart-base-element";import{ClearCanvasDrawer as f}from"../../drawers/clear-canvas.drawer";import{CompositeDrawer as D}from"../../drawers/composite.drawer";import{DrawerType as b}from"../../drawers/drawing-manager";import{uuid as Y}from"../../utils";import{resolveColorForArea as S,resolveColorForBar as R,resolveColorForBaseLine as P,resolveColorForCandle as T,resolveColorForHistogram as B,resolveColorForLine as I,resolveColorForScatterPlot as _,resolveColorForTrendAndHollow as A,resolveDefaultColorForLabel as F}from"./label-color.functions";import{LastCandleLabelsProvider as E}from"./price_labels/last-candle-labels.provider";import{LabelsGroups as n}from"./price_labels/y-axis-labels.model";import{YAxisPriceLabelsDrawer as H}from"./price_labels/y-axis-price-labels.drawer";import{YAxisDrawer as U}from"./y-axis.drawer";import{YAxisModel as N}from"./y-axis.model";import{YAxisScaleHandler as X}from"./y-axis-scale.handler";export class YAxisComponent extends w{constructor(e,s,t,x,o,l,L,r,y,C,a,c){super(),this.eventBus=e,this.config=s,this.canvasModel=t,this.yAxisLabelsCanvasModel=x,this.chartModel=o,this.scaleModel=l,this.canvasBoundsContainer=r,this.axisTypeSetSubject=new g,this.labelsColorByChartTypeMap={},this.state=s.components.yAxis;const d=new D,p=new f(this.yAxisLabelsCanvasModel);d.addDrawer(p,b.YAXIS_CLEAR),this.registerDefaultLabelColorResolver(),y.addDrawer(d,b.Y_AXIS),this.yAxisScaleHandler=new X(e,this.state,C,l,L,r,r.getBoundsHitTest(h.PANE_UUID_Y_AXIS(i)),M=>l.autoScale(M)),this.addChildEntity(this.yAxisScaleHandler),this.yAxisModel=new N(a,a.paneComponents[i],e,this.config,r,t,o,l),this.addChildEntity(this.yAxisModel),a.paneComponents[i].yAxisLabelsGenerator=this.yAxisModel.yAxisLabelsGenerator;const v=new U(s,this.state,t,()=>this.yAxisModel.yAxisBaseLabelsModel.labels,()=>r.getBounds(h.Y_AXIS),()=>this.state.visible,o.pane.scaleModel.toY.bind(o.pane.scaleModel));d.addDrawer(v);const m=new H(()=>this.yAxisModel.yAxisLabelsModel.orderedLabels,this.yAxisLabelsCanvasModel,this.state,this.canvasBoundsContainer,this.config.colors.yAxis,this.yAxisModel.yAxisLabelsModel.customLabels);d.addDrawer(m);const u=new E(this.chartModel,this.config,this.chartModel.lastCandleLabelsByChartType,this.getLabelsColorResolver.bind(this));this.registerYAxisLabelsProvider(u,n.MAIN),a.paneComponents[i].getAxisType=()=>this.state.type,c.addCursorForCanvasEl(h.PANE_UUID_Y_AXIS(i),s.components.yAxis.cursor)}updateOrderedLabels(e=!1){this.yAxisModel.yAxisLabelsModel.updateLabels(e)}doActivate(){super.doActivate()}registerDefaultLabelColorResolver(){this.registerLabelColorResolver("candle",T),this.registerLabelColorResolver("bar",R),this.registerLabelColorResolver("line",I),this.registerLabelColorResolver("area",S),this.registerLabelColorResolver("scatterPlot",_),this.registerLabelColorResolver("histogram",B),this.registerLabelColorResolver("baseline",P),this.registerLabelColorResolver("trend",A),this.registerLabelColorResolver("hollow",A)}registerYAxisLabelsProvider(e,s=n.MAIN,t=Y()){return this.yAxisModel.yAxisLabelsModel.registerYAxisLabelsProvider(s,e,t),t}addSimpleYAxisLabel(e,s){this.yAxisModel.yAxisLabelsModel.customLabels[e]=s,this.canvasModel.fireDraw()}deleteSimpleYAxisLabel(e){delete this.yAxisModel.yAxisLabelsModel.customLabels[e],this.canvasModel.fireDraw()}unregisterYAxisLabelsProvider(e=n.MAIN,s){return this.yAxisModel.yAxisLabelsModel.unregisterYAxisLabelsProvider(e,s),s}registerYAxisWidthContributor(e){this.yAxisModel.registerYAxisWidthContributor(e)}setAxisType(e){e!==this.state.type&&(this.state.type=e,this.axisTypeSetSubject.next(e),this.scaleModel.autoScale(!0),this.yAxisModel.yAxisLabelsModel.updateLabels(!0))}setYAxisAlign(e){this.state.align=e,this.canvasBoundsContainer.recalculateBounds(),this.eventBus.fireDraw()}setVisible(e){this.state.visible=e,this.eventBus.fireDraw()}isVisible(){return this.state.visible}setLockPriceToBarRatio(e=!1){this.scaleModel.setLockPriceToBarRatio(e)}changeLabelMode(e,s){this.state.labels.settings[e].mode=s,this.yAxisModel.yAxisLabelsModel.updateLabels()}togglePriceScaleInverse(e){this.scaleModel.state.inverse=e,this.scaleModel.inverseY=e,this.scaleModel.scaleInversedSubject.next(e)}changeLabelsDescriptionVisibility(e){this.state.labels.descriptions=e,this.canvasModel.fireDraw()}registerLabelColorResolver(e,s){this.labelsColorByChartTypeMap[e]=s}getLabelsColorResolver(e){var s;return(s=this.labelsColorByChartTypeMap[e])!==null&&s!==void 0?s:F}}
