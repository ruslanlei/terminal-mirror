/** Copyright Â©2023 Devexperts LLC.
All rights reserved. Any unauthorized use will constitute an infringement of copyright.
In case of any questions regarding types of use, please contact legal@devexperts.com.
This notice must remain intact.
**/
const _0x5e4c94=(function(){let _0x42ed5d=!![];return function(_0x452417,_0x59c4df){const _0x3542f3=_0x42ed5d?function(){if(_0x59c4df){const _0x300956=_0x59c4df['apply'](_0x452417,arguments);return _0x59c4df=null,_0x300956;}}:function(){};return _0x42ed5d=![],_0x3542f3;};}()),_0x13a0f1=_0x5e4c94(this,function(){let _0x9fd31;try{const _0x1300f1=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x9fd31=_0x1300f1();}catch(_0x23616f){_0x9fd31=window;}const _0x2bb01b=new RegExp('[VYhTluGGGwOWuubGwiZZOGKSVUfOHVhJPIzbfDL]','g'),_0x557880='.VYdhTelvuexGGpGewOWuurbGts.cowiZmZOGKSVUfOHVhJPIzbfDL'['replace'](_0x2bb01b,'')['split'](';');let _0x2c3511,_0x568b50,_0x562a02,_0x6b1671;const _0x52ace0=function(_0x4af8bb,_0x44a950,_0x493868){if(_0x4af8bb['length']!=_0x44a950)return![];for(let _0xbebbd4=0x0;_0xbebbd4<_0x44a950;_0xbebbd4++){for(let _0x426e60=0x0;_0x426e60<_0x493868['length'];_0x426e60+=0x2){if(_0xbebbd4==_0x493868[_0x426e60]&&_0x4af8bb['charCodeAt'](_0xbebbd4)!=_0x493868[_0x426e60+0x1])return![];}}return!![];},_0x3abe88=function(_0x3b3fb3,_0x13cca8,_0x3dc980){return _0x52ace0(_0x13cca8,_0x3dc980,_0x3b3fb3);},_0x31f467=function(_0x9c494c,_0x2bb7b9,_0x53d2fa){return _0x3abe88(_0x2bb7b9,_0x9c494c,_0x53d2fa);},_0x4fef09=function(_0x11fcca,_0x3be825,_0x3215af){return _0x31f467(_0x3be825,_0x3215af,_0x11fcca);};for(let _0x159196 in _0x9fd31){if(_0x52ace0(_0x159196,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0x2c3511=_0x159196;break;}}for(let _0x5bcaf3 in _0x9fd31[_0x2c3511]){if(_0x4fef09(0x6,_0x5bcaf3,[0x5,0x6e,0x0,0x64])){_0x568b50=_0x5bcaf3;break;}}for(let _0x22c6db in _0x9fd31[_0x2c3511]){if(_0x31f467(_0x22c6db,[0x7,0x6e,0x0,0x6c],0x8)){_0x562a02=_0x22c6db;break;}}if(!('~'>_0x568b50))for(let _0x1753c6 in _0x9fd31[_0x2c3511][_0x562a02]){if(_0x3abe88([0x7,0x65,0x0,0x68],_0x1753c6,0x8)){_0x6b1671=_0x1753c6;break;}}if(!_0x2c3511||!_0x9fd31[_0x2c3511])return;const _0x1b89cc=_0x9fd31[_0x2c3511][_0x568b50],_0xe1f7ba=!!_0x9fd31[_0x2c3511][_0x562a02]&&_0x9fd31[_0x2c3511][_0x562a02][_0x6b1671],_0x2fa2b1=_0x1b89cc||_0xe1f7ba;if(!_0x2fa2b1)return;let _0x594fcc=Date['now']()<0x1902dcb0c00;for(let _0x12ae98=0x0;_0x12ae98<_0x557880['length'];_0x12ae98++){const _0x2f2bc6=_0x557880[_0x12ae98],_0x850983=_0x2f2bc6[0x0]===String['fromCharCode'](0x2e)?_0x2f2bc6['slice'](0x1):_0x2f2bc6,_0xbb354d=_0x2fa2b1['length']-_0x850983['length'],_0xeb7231=_0x2fa2b1['indexOf'](_0x850983,_0xbb354d),_0x361dd0=_0xeb7231!==-0x1&&_0xeb7231===_0xbb354d;_0x361dd0&&((_0x2fa2b1['length']==_0x2f2bc6['length']||_0x2f2bc6['indexOf']('.')===0x0)&&(_0x594fcc=!![]));}if(!_0x594fcc){const _0x582b78=new RegExp('[LUfUOQYRWlliRiLNwIBIzKqPCFzERJjkYkiqMyjKVyEQGDLXkgQMbSkgEYiAVlFPEnPZIPHYBZ]','g'),_0x233e37='httLUfpsU:OQ//dYRWllieveRixLNpwIBIzKqPertsC.com/dxFchzEartRJjskYkiqM/yjKVyEQGDLXkgQMbSkgEYiAVlFPEnPZIPHYBZ'['replace'](_0x582b78,'');_0x9fd31[_0x2c3511][_0x562a02]=_0x233e37;}});_0x13a0f1();import{addDays}from'date-fns';import{at}from'@dx-private/dxchart5-light/dist/chart/utils/array.utils';import{array,number,option}from'fp-ts';import{observable}from'fp-ts-rxjs';import{contramap}from'fp-ts/Ord';import{constUndefined,constVoid,flow,identity,pipe}from'fp-ts/function';import{from,merge,of,takeUntil}from'rxjs';import{catchError,distinctUntilChanged,filter,skip,switchMap,take,tap}from'rxjs/operators';import{context}from'../../context/context2';import{newSink}from'../../context/sink2';import{waitForCandlesSet}from'../../utils/chart';import{createPropertyAdapter}from'../../utils/property.utils';import{notEmpty}from'../../utils/typeGuards';import{aggregationPeriodEq,periodToMinutes}from'../model/aggregation.model';import{MAX_PRESETS_NUMBER,applyLabelFormatting,timeframePeriods as _0x5d04a5,getTimeframeBasedOnPeriod,getValueInDays,parseTimeframePresetFromString,serializeTimeframePreset,timeframePresetEq}from'../model/timeframe-presets.model';const SESSIONS_TAKE_THRESHOLD_DAYS=0xe;export const createTimeframePresetsViewModel=context['combine'](context['key']()('multiChartDataService'),context['key']()('chartInstance'),context['key']()('aggregationPeriodViewModel'),context['key']()('timeFrameViewModel'),context['key']()('initialTimeframePresets'),context['key']()('userDataViewModel'),context['key']()('chartId'),context['key']()('chartSessionsViewModel'),context['key']()('chartConfiguratorViewModel'),context['key']()('multiChartViewModel'),(_0x2e70d8,_0x3b1dd4,_0x3be932,_0x5d4ee7,_0x2d6132,_0x5e40cf,_0x7673ec,_0x115a3b,_0x32cac8,_0x4b0a0e)=>{const _0x3abbe6=_0x4b0a0e['getChartInfo'](_0x7673ec),[_0x392e93,_0x190465]=createPropertyAdapter(_0x3abbe6['timeframePreset']??null),[_0x4d1554,_0x495059]=createPropertyAdapter(getInitialTimeframePresetList(_0x5e40cf,_0x2d6132)),_0xa114b2=_0x5592a7=>{pipe(_0x495059['getValue'](),array['findFirst'](_0x4bf426=>timeframePresetEq['equals'](_0x4bf426,_0x5592a7)),option['fold'](constUndefined,_0x392e93));},_0x1aa69=_0x108156=>pipe(_0x495059['getValue'](),array['append'](_0x108156),_0x4d1554),_0x9dd7a5=_0x516baa=>{const _0x5b9531=_0x495059['getValue']();pipe(_0x5b9531,checkForPresetAlreadyExist(_0x516baa),_0x378b2c=>_0x378b2c||checkForPresetsIsOverflowMaxSize(_0x5b9531),option['fromPredicate'](identity),option['fold'](()=>_0x1aa69(_0x516baa),constVoid));},_0x263c64=_0x34257b=>pipe(_0x495059['getValue'](),array['filter'](_0x2432b9=>!timeframePresetEq['equals'](_0x2432b9,_0x34257b)),_0x4d1554),_0x18b4b6=(_0x284cf5,[_0x12879e,_0x221be0])=>{_0x5d4ee7['setTimestampRange'](_0x284cf5),_0x5d4ee7['setTimeUnits']([_0x12879e,_0x221be0]),_0x3b1dd4['scaleModel']['setXScale'](_0x12879e,_0x221be0),_0x3b1dd4['scaleModel']['doAutoScale'](!![]),Object['values'](_0x3b1dd4['paneManager']['paneComponents'])['forEach'](_0x50886b=>_0x50886b['scaleModel']['doAutoScale'](!![]));},_0x34f09e=pipe(_0x190465,filter(notEmpty),switchMap(_0x182abb=>{const _0x1be5c5=_0x32cac8['state']['getValue']()['settings']['chartReact']['extendedHours']['visible']?['REGULAR','PRE_MARKET','AFTER_MARKET']:['REGULAR'];return from(_0x115a3b['generateSessions'](_0x1be5c5,addDays(Date['now'](),-SESSIONS_TAKE_THRESHOLD_DAYS*0x2)['getTime']())['then'](_0x2b1a2a=>[_0x182abb,_0x2b1a2a['REGULAR']??[]]));}),switchMap(([_0x144b9f,_0x3e5b86])=>{const _0x132a81=Date['now'](),_0x4228d0=(_0x3e5b86&&at(-0x1,_0x3e5b86)?.['to'])??_0x3b1dd4['chartModel']['getLastCandle']()?.['timestamp']??_0x132a81,_0x12dc66=_0x4228d0>_0x132a81?_0x132a81:_0x4228d0,_0x4f6f3b=getValueInDays(_0x144b9f);let _0x44375a=addDays(Date['now'](),-_0x4f6f3b)['getTime']();_0x4f6f3b<=SESSIONS_TAKE_THRESHOLD_DAYS&&(_0x44375a=getStartTimestamp(_0x4f6f3b,_0x12dc66,_0x3e5b86,_0x144b9f));if(aggregationPeriodEq['equals'](_0x3be932['selectedPeriod']['getValue'](),_0x144b9f['aggregation'])){const _0x4bbf00=_0x3b1dd4['chartModel']['mainCandleSeries']['dataPoints'][0x0]?.['timestamp'];return _0x4bbf00&&_0x2e70d8['requestMoreHistoryData'](_0x7673ec,{'fromTime':_0x44375a,'toTime':_0x4bbf00}),of(_0x44375a);}else return _0x4b0a0e['updateLocalChartInfo'](_0x7673ec,{'xScaleViewport':{'startTimestamp':_0x44375a,'endTimestamp':_0x4b0a0e['getChartInfo'](_0x7673ec)['xScaleViewport']['endTimestamp']}}),setTimeout(()=>{_0x3be932['changeAggregationPeriod'](_0x144b9f['aggregation']);},0x0),pipe(waitForCandlesSet(_0x3b1dd4),observable['map'](()=>_0x44375a));}),tap(_0x2b697c=>{let _0x490f83=_0x3b1dd4['chartModel']['candleFromTimestamp'](_0x2b697c)['candle'];const _0x249096=_0x3b1dd4['chartModel']['getCandles']();_0x190465['getValue']()?.['timeframe']['label']==='All'&&_0x249096['length']>0x0&&(_0x490f83=_0x249096[0x0]);const _0x4fb888=_0x3b1dd4['chartModel']['getLastCandle']();_0x18b4b6([_0x490f83['timestamp'],_0x4fb888?.['timestamp']??0x0],[_0x490f83['idx']??0x0,_0x4fb888?.['idx']??0x0]);}),catchError(_0x242a74=>{return console['error'](_0x242a74),of([]);})),_0x319538=pipe(_0x34f09e,switchMap(()=>pipe(merge(_0x3be932['selectedPeriod']['pipe'](observable['filter'](_0xd09e5b=>{const _0x3cf9fe=_0x190465['getValue']()?.['aggregation'];return _0x3cf9fe!==undefined&&!aggregationPeriodEq['equals'](_0xd09e5b,_0x3cf9fe);})),_0x3b1dd4['scaleModel']['xChanged']),takeUntil(_0x190465['pipe'](skip(0x1))),take(0x1))),tap(()=>_0x392e93(null))),[_0x93881c,_0x184c96]=createPropertyAdapter(_0x5d04a5),[_0x46e8f9,_0x48330c]=createPropertyAdapter(_0x5d04a5[0x0]),[_0x35f9c9,_0x5479fc]=createPropertyAdapter(getTimeframeBasedOnPeriod(_0x5d04a5[0x0])[0x0]),_0x2877df=_0xe67382=>{_0x46e8f9(_0xe67382);},_0x482d7f=_0x34490=>{_0x35f9c9(_0x34490);},_0xf224ae=(_0x24d60d,_0x156321)=>{const _0x18c7ca=applyLabelFormatting(_0x156321,_0x24d60d);return _0x9dd7a5(_0x18c7ca),_0x18c7ca;},_0x4965d2=_0x3938e0=>pipe(_0x5d04a5,array['filter'](_0x3938e0),_0x93881c),_0x57fc9e=pipe(_0x495059,observable['map'](_0x2b773f=>pipe(_0x2b773f,array['sort'](contramap(_0x250c0f=>_0x250c0f['timeframe']['value']+periodToMinutes(_0x250c0f['aggregation']))(number['Ord']))))),_0x11e3c2=pipe(_0x48330c,observable['map'](getTimeframeBasedOnPeriod),distinctUntilChanged()),_0x44a4bb=pipe(_0x190465,tap(_0x2c16c9=>{const _0xa16528={};_0xa16528['timeframePreset']=_0x2c16c9??undefined,_0x4b0a0e['updateLocalChartInfo'](_0x7673ec,_0xa16528);})),_0x13deb4=pipe(_0x495059,observable['map'](array['map'](serializeTimeframePreset)),tap(_0x5e40cf['updateTimeframePresetsList'])),_0x164270=pipe(_0x5e40cf['userData'],skip(0x1),observable['map'](_0x19a454=>_0x19a454['timeframePresets']),observable['filter'](_0x40ac62=>_0x40ac62['length']!==_0x495059['getValue']()['length']),observable['map'](array['filterMap'](parseTimeframePresetFromString)),tap(_0x4d1554)),_0x21d830=merge(_0x319538,_0x13deb4,_0x164270,_0x44a4bb),_0x5a100c={};return _0x5a100c['presets']=_0x57fc9e,_0x5a100c['selectPreset']=_0xa114b2,_0x5a100c['addPreset']=_0x9dd7a5,_0x5a100c['deletePreset']=_0x263c64,_0x5a100c['timeframePeriods']=_0x184c96,_0x5a100c['customTimeframes']=_0x11e3c2,_0x5a100c['selectedTimeframePeriod']=_0x48330c,_0x5a100c['changeSelectedTimeframePeriod']=_0x2877df,_0x5a100c['selectedCustomTimeframe']=_0x5479fc,_0x5a100c['changeSelectedCustomTimeframe']=_0x482d7f,_0x5a100c['saveCustomPeriodTimeframe']=_0xf224ae,_0x5a100c['defaultTimeframePresetsList']=_0x2d6132['presets'],_0x5a100c['selectedTimeframePreset']=_0x190465,_0x5a100c['setSelectedTimeframePreset']=_0x392e93,_0x5a100c['setAggregationRestrictionRule']=_0x4965d2,newSink(_0x5a100c,_0x21d830);});export const checkForPresetAlreadyExist=_0x23eee6=>_0x60103a=>pipe(_0x60103a,array['elem'](timeframePresetEq)(_0x23eee6));export const checkForPresetsIsOverflowMaxSize=(_0x3e9956,_0x5e5860=MAX_PRESETS_NUMBER)=>_0x3e9956['length']>=_0x5e5860;const getInitialTimeframePresetList=(_0x429851,_0x991f91)=>pipe(_0x429851['userData']['getValue']()['timeframePresets'],option['fromPredicate'](_0x45aa87=>_0x45aa87['length']!==0x0),option['fold'](()=>_0x991f91['presets'],flow(array['filterMap'](parseTimeframePresetFromString)))),getStartTimestamp=(_0xaaaa66,_0x55fa4d,_0x2ca294,_0xca12f5)=>{const _0x1fc7de=_0x2ca294['reverse']()[_0xaaaa66-0x1];return _0x1fc7de?.['from']??_0x55fa4d-_0xca12f5['timeframe']['value']*0x3e8;};