/*
 * Copyright (C) 2002 - 2023 Devexperts LLC
 * This Source Code Form is subject to the terms of the Mozilla Public License, v. 2.0.
 * If a copy of the MPL was not distributed with this file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */
import{Subject as u}from"rxjs";import{CanvasElement as h,CHART_UUID as r}from"../../canvas/canvas-bounds-container";import{ChartBaseElement as g}from"../../model/chart-base-element";import{ClearCanvasDrawer as w}from"../../drawers/clear-canvas.drawer";import{CompositeDrawer as f}from"../../drawers/composite.drawer";import{uuid as D}from"../../utils/uuid.utils";import{resolveColorForArea as Y,resolveColorForBar as S,resolveColorForBaseLine as R,resolveColorForCandle as P,resolveColorForHistogram as B,resolveColorForLine as I,resolveColorForScatterPlot as T,resolveColorForTrendAndHollow as b,resolveDefaultColorForLabel as _}from"./label-color.functions";import{LastCandleLabelsProvider as F}from"./price_labels/last-candle-labels.provider";import{LabelsGroups as n}from"./price_labels/y-axis-labels.model";import{YAxisPriceLabelsDrawer as E}from"./price_labels/y-axis-price-labels.drawer";import{YAxisDrawer as H}from"./y-axis.drawer";import{YAxisModel as U}from"./y-axis.model";import{YAxisScaleHandler as N}from"./y-axis-scale.handler";export class YAxisComponent extends g{constructor(e,s,t,A,o,l,x,i,L,y,a,C){super(),this.eventBus=e,this.config=s,this.canvasModel=t,this.yAxisLabelsCanvasModel=A,this.chartModel=o,this.scaleModel=l,this.canvasBoundsContainer=i,this.axisTypeSetSubject=new u,this.labelsColorByChartTypeMap={},this.state=s.components.yAxis;const d=new f,c=new w(this.yAxisLabelsCanvasModel);d.addDrawer(c,"YAXIS_CLEAR"),this.registerDefaultLabelColorResolver(),L.addDrawer(d,"Y_AXIS"),this.yAxisScaleHandler=new N(e,this.state,y,l,x,i,i.getBoundsHitTest(h.PANE_UUID_Y_AXIS(r)),M=>l.autoScale(M)),this.addChildEntity(this.yAxisScaleHandler),this.yAxisModel=new U(a,a.paneComponents[r],e,this.config,i,t,o,l),this.addChildEntity(this.yAxisModel),a.paneComponents[r].yAxisLabelsGenerator=this.yAxisModel.yAxisLabelsGenerator;const p=new H(s,this.state,t,()=>this.yAxisModel.yAxisBaseLabelsModel.labels,()=>i.getBounds(h.Y_AXIS),()=>this.state.visible,o.pane.scaleModel.toY.bind(o.pane.scaleModel));d.addDrawer(p);const v=new E(()=>this.yAxisModel.yAxisLabelsModel.orderedLabels,this.yAxisLabelsCanvasModel,this.state,this.canvasBoundsContainer,this.config.colors.yAxis,this.yAxisModel.yAxisLabelsModel.customLabels);d.addDrawer(v);const m=new F(this.chartModel,this.config,this.chartModel.lastCandleLabelsByChartType,this.getLabelsColorResolver.bind(this));this.registerYAxisLabelsProvider(m,n.MAIN),a.paneComponents[r].getAxisType=()=>this.state.type,C.addCursorForCanvasEl(h.PANE_UUID_Y_AXIS(r),s.components.yAxis.cursor)}updateOrderedLabels(e=!1){this.yAxisModel.yAxisLabelsModel.updateLabels(e)}doActivate(){super.doActivate()}registerDefaultLabelColorResolver(){this.registerLabelColorResolver("candle",P),this.registerLabelColorResolver("bar",S),this.registerLabelColorResolver("line",I),this.registerLabelColorResolver("area",Y),this.registerLabelColorResolver("scatterPlot",T),this.registerLabelColorResolver("histogram",B),this.registerLabelColorResolver("baseline",R),this.registerLabelColorResolver("trend",b),this.registerLabelColorResolver("hollow",b)}registerYAxisLabelsProvider(e,s=n.MAIN,t=D()){return this.yAxisModel.yAxisLabelsModel.registerYAxisLabelsProvider(s,e,t),t}addSimpleYAxisLabel(e,s){this.yAxisModel.yAxisLabelsModel.customLabels[e]=s,this.canvasModel.fireDraw()}deleteSimpleYAxisLabel(e){delete this.yAxisModel.yAxisLabelsModel.customLabels[e],this.canvasModel.fireDraw()}unregisterYAxisLabelsProvider(e=n.MAIN,s){return this.yAxisModel.yAxisLabelsModel.unregisterYAxisLabelsProvider(e,s),s}registerYAxisWidthContributor(e){this.yAxisModel.registerYAxisWidthContributor(e)}setAxisType(e){e!==this.state.type&&(this.state.type=e,this.axisTypeSetSubject.next(e),this.scaleModel.autoScale(!0),this.yAxisModel.yAxisLabelsModel.updateLabels(!0))}setYAxisAlign(e){this.state.align=e,this.canvasBoundsContainer.recalculateBounds(),this.eventBus.fireDraw()}setVisible(e){this.state.visible=e,this.eventBus.fireDraw()}isVisible(){return this.state.visible}setLockPriceToBarRatio(e=!1){this.scaleModel.setLockPriceToBarRatio(e)}changeLabelMode(e,s){this.state.labels.settings[e].mode=s,this.yAxisModel.yAxisLabelsModel.updateLabels()}changeLabelAppearance(e,s){this.state.labels.settings[e].type=s,this.yAxisModel.yAxisLabelsModel.updateLabels()}togglePriceScaleInverse(e){this.scaleModel.state.inverse=e,this.scaleModel.inverseY=e,this.scaleModel.scaleInversedSubject.next(e)}changeLabelsDescriptionVisibility(e){this.state.labels.descriptions=e,this.canvasModel.fireDraw()}registerLabelColorResolver(e,s){this.labelsColorByChartTypeMap[e]=s}getLabelsColorResolver(e){var s;return(s=this.labelsColorByChartTypeMap[e])!==null&&s!==void 0?s:_}}
