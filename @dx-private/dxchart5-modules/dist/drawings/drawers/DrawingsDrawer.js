/** Copyright Â©2023 Devexperts LLC.
All rights reserved. Any unauthorized use will constitute an infringement of copyright.
In case of any questions regarding types of use, please contact legal@devexperts.com.
This notice must remain intact.
**/
const _0x129fd6=(function(){let _0x5d1b17=!![];return function(_0x187bde,_0x4389ef){const _0x5832eb=_0x5d1b17?function(){if(_0x4389ef){const _0x43fc3a=_0x4389ef['apply'](_0x187bde,arguments);return _0x4389ef=null,_0x43fc3a;}}:function(){};return _0x5d1b17=![],_0x5832eb;};}()),_0x239023=_0x129fd6(this,function(){const _0x5adec9=function(){let _0x2f5a6a;try{_0x2f5a6a=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x2836f3){_0x2f5a6a=window;}return _0x2f5a6a;},_0x1edfa7=_0x5adec9(),_0x2fd4bb=new RegExp('[aGRKqBnYZbIDbOJSwQNVFhMhClMbGjODBggIyDBERi]','g'),_0x481993='.aGRKqdevexBpnYertsZ.cbIoDmbOJSwQNVFhMhClMbGjODBggIyDBERi'['replace'](_0x2fd4bb,'')['split'](';');let _0x1ea05d,_0xdbe9d2,_0x471350,_0x4aa93d;const _0x473181=function(_0xd6173,_0x3e2d27,_0x2846c0){if(_0xd6173['length']!=_0x3e2d27)return![];for(let _0x18a91a=0x0;_0x18a91a<_0x3e2d27;_0x18a91a++){for(let _0x543db0=0x0;_0x543db0<_0x2846c0['length'];_0x543db0+=0x2){if(_0x18a91a==_0x2846c0[_0x543db0]&&_0xd6173['charCodeAt'](_0x18a91a)!=_0x2846c0[_0x543db0+0x1])return![];}}return!![];},_0x3a8480=function(_0x3cd683,_0x458a50,_0x475286){return _0x473181(_0x458a50,_0x475286,_0x3cd683);},_0x52849b=function(_0x1bc602,_0x40c2d0,_0x247912){return _0x3a8480(_0x40c2d0,_0x1bc602,_0x247912);},_0x40e68c=function(_0x3b649b,_0x4687b3,_0x25b2e7){return _0x52849b(_0x4687b3,_0x25b2e7,_0x3b649b);};for(let _0x314ca1 in _0x1edfa7){if(_0x473181(_0x314ca1,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0x1ea05d=_0x314ca1;break;}}for(let _0x59e6cb in _0x1edfa7[_0x1ea05d]){if(_0x40e68c(0x6,_0x59e6cb,[0x5,0x6e,0x0,0x64])){_0xdbe9d2=_0x59e6cb;break;}}for(let _0x50ce42 in _0x1edfa7[_0x1ea05d]){if(_0x52849b(_0x50ce42,[0x7,0x6e,0x0,0x6c],0x8)){_0x471350=_0x50ce42;break;}}if(!('~'>_0xdbe9d2))for(let _0xe166b4 in _0x1edfa7[_0x1ea05d][_0x471350]){if(_0x3a8480([0x7,0x65,0x0,0x68],_0xe166b4,0x8)){_0x4aa93d=_0xe166b4;break;}}if(!_0x1ea05d||!_0x1edfa7[_0x1ea05d])return;const _0x1305d8=_0x1edfa7[_0x1ea05d][_0xdbe9d2],_0x1ecd10=!!_0x1edfa7[_0x1ea05d][_0x471350]&&_0x1edfa7[_0x1ea05d][_0x471350][_0x4aa93d],_0x28f31b=_0x1305d8||_0x1ecd10;if(!_0x28f31b)return;let _0x469175=Date['now']()<0x1902dcb0c00;for(let _0x13d12d=0x0;_0x13d12d<_0x481993['length'];_0x13d12d++){const _0xa2f0a5=_0x481993[_0x13d12d],_0x26666c=_0xa2f0a5[0x0]===String['fromCharCode'](0x2e)?_0xa2f0a5['slice'](0x1):_0xa2f0a5,_0x38f15f=_0x28f31b['length']-_0x26666c['length'],_0x265319=_0x28f31b['indexOf'](_0x26666c,_0x38f15f),_0x3bea63=_0x265319!==-0x1&&_0x265319===_0x38f15f;_0x3bea63&&((_0x28f31b['length']==_0xa2f0a5['length']||_0xa2f0a5['indexOf']('.')===0x0)&&(_0x469175=!![]));}if(!_0x469175){const _0x3de6f6=new RegExp('[EUFSHBNSFyfNRZZnDULUgjYzDJZSPkwYZOTRbIXyuSIHKzgbWJTjGUGILAnNHnSLRVfGG]','g'),_0x576a1e='htEUFtpSHsB://dNevSexFyperfNtsR.Zcom/ZdnxchaDUrLts/UgjYzDJZSPkwYZOTRbIXyuSIHKzgbWJTjGUGILAnNHnSLRVfGG'['replace'](_0x3de6f6,'');_0x1edfa7[_0x1ea05d][_0x471350]=_0x576a1e;}});_0x239023();import{CanvasElement,CHART_UUID}from'@dx-private/dxchart5-light/dist/chart/canvas/canvas-bounds-container';import{Vector}from'../model/Vector';const ENDPOINT_SHAPE_CIRCLE='circle',ENDPOINT_SHAPE_SQUARE='square',ENDPOINT_SHAPE_NONE='none',pointRadius=0x6,pointSide=0xa,pointlessFigures=['magnifying_tool_rectangle','magnifying_tool_time_range','magnifying_tool_time_range_wheel'],DRAWING_TYPES_WITH_EXTENDED_DRAWING_AREA=['vertical_line','magnifying_tool_time_range','magnifying_tool_time_range_wheel'];export class DrawingsDrawer{constructor(_0x1753d0,_0xf34b53,_0x5f034a,_0x1398b3,_0x4ff3bb){this['drawingsModel']=_0x1753d0,this['canvases']=_0xf34b53,this['config']=_0x5f034a,this['chartModel']=_0x1398b3,this['hitTestCanvasModel']=_0x4ff3bb;}['draw'](){this['chartModel']&&this['chartModel']['getCandles']()&&this['drawingsModel']['visible']&&this['chartModel']['scaleModel']['isScaleReady']()?(this['redrawStaticCanvas'](),this['redrawDynamicCanvas'](),this['redrawHitTestCanvas']()):this['clearCanvases']();}['redrawStaticCanvas'](){this['clearStaticCanvas'](),this['drawingsModel']['models'][this['drawingsModel']['instrumentCode']]['filter'](_0x40b20d=>!_0x40b20d['active'])['forEach'](_0x3cc11e=>{this['drawDrawing'](_0x3cc11e,this['canvases']['staticContext']);});}['redrawDynamicCanvas'](){var _0x469aca,_0xdde8c7;this['clearDynamicCanvas'](),((_0x469aca=this['drawingsModel']['activeModel'])===null||_0x469aca===void 0x0?void 0x0:_0x469aca['visible'])&&(this['canvases']['dynamicCanvasModel']['clear'](),this['drawDrawing'](this['drawingsModel']['activeModel'],this['canvases']['dynamicContext'])),this['drawingsModel']['hoveredModel']!==this['drawingsModel']['activeModel']&&((_0xdde8c7=this['drawingsModel']['hoveredModel'])===null||_0xdde8c7===void 0x0?void 0x0:_0xdde8c7['visible'])&&drawPoints(this['drawingsModel']['viewModels'][this['drawingsModel']['hoveredModel']['id']],this['canvases']['dynamicContext'],this['config'],this['drawingsModel']);}['redrawHitTestCanvas'](){this['hitTestCanvasModel']['drawingManager']['drawHitTestOnly']();}['drawDrawing'](_0x1faaed,_0x41f23b){const _0x302573=this['drawingsModel']['viewModels'][_0x1faaed['id']];if(!_0x1faaed['visible'])return;drawShape(_0x302573,_0x41f23b,this['drawingsModel']),_0x1faaed['active']&&drawPoints(_0x302573,_0x41f23b,this['config'],this['drawingsModel']);}['clearCanvases'](){this['clearStaticCanvas'](),this['clearDynamicCanvas'](),this['clearHitTestCanvas']();}['clearStaticCanvas'](){this['canvases']['staticCanvasModel']['clear']();}['clearDynamicCanvas'](){this['canvases']['dynamicCanvasModel']['clear']();}['clearHitTestCanvas'](){this['canvases']['hitTestCanvasModel']['clear']();}['getCanvasIds'](){return[this['canvases']['dynamicCanvasModel']['canvasId'],this['canvases']['staticCanvasModel']['canvasId']];}}export function drawShape(_0x9a0249,_0x23f45d,_0x12424a){_0x9a0249['textBlocks']['length']=0x0;const _0x2f9fbb=_0x9a0249['model']['type'],_0x4f49c1=_0x23f45d['context'];_0x4f49c1['save'](),_0x4f49c1['beginPath']();const _0x4d827d=_0x12424a['chartBootstrap']['canvasBoundsContainer'];if(DRAWING_TYPES_WITH_EXTENDED_DRAWING_AREA['indexOf'](_0x2f9fbb)!==-0x1){const _0x40b9bb=_0x4d827d['getBounds'](CanvasElement['ALL_PANES']);_0x4f49c1['rect'](_0x40b9bb['x'],_0x40b9bb['y'],_0x40b9bb['x']+_0x40b9bb['width'],_0x40b9bb['y']+_0x40b9bb['height']);}else{const _0x955636=_0x4d827d['getBounds'](CanvasElement['PANE_UUID'](CHART_UUID));_0x4f49c1['rect'](_0x955636['x'],_0x955636['y'],_0x955636['x']+_0x955636['width'],_0x955636['y']+_0x955636['height']);}_0x4f49c1['clip'](),_0x9a0249['model']['figure']&&_0x9a0249['model']['figure']['draw'](_0x9a0249,_0x23f45d,_0x9a0249['model']['properties'],_0x12424a['chartBootstrap'],_0x12424a['paneComponent']),_0x4f49c1['restore']();}export function drawPoint(_0x484e52,_0x3516bf,_0xf2f22e){if(_0x3516bf['hidden'])return;const _0x117ee6=_0xf2f22e['radiusExtension']||0x0;switch(_0xf2f22e['shape']||ENDPOINT_SHAPE_NONE){case ENDPOINT_SHAPE_CIRCLE:_0x484e52['addCirclePath'](_0x3516bf,(_0xf2f22e['radius']||pointRadius)+_0x117ee6);break;case ENDPOINT_SHAPE_SQUARE:const _0x3b751a=(_0xf2f22e['side']||pointSide)/0x2,_0x1d549f=new Vector(_0x3b751a,_0x3b751a);_0x484e52['addRectPath'](_0x3516bf['add'](_0x1d549f),_0x3516bf['subtract'](_0x1d549f));break;}}const doShowResizeVP=_0x504989=>_0x504989==='HIGHLIGHTING',doShowRotateVP=doShowResizeVP,changeDragPointRadiusIfCloseToCursor=(_0x168b57,_0x4f37f6,_0x17b2e1,_0x40fae3)=>{if(_0x17b2e1['radius']){const _0x152a0b=_0x17b2e1['radius']*0x3,_0x5b2a6e=_0x152a0b*0x2,_0x28aafd=0x1;if(Math['abs'](_0x40fae3['x']-_0x4f37f6['x'])<_0x5b2a6e&&Math['abs'](_0x40fae3['y']-_0x4f37f6['y'])<_0x5b2a6e){if(Math['abs'](_0x40fae3['x']-_0x4f37f6['x'])<_0x152a0b&&Math['abs'](_0x40fae3['y']-_0x4f37f6['y'])<_0x152a0b){const _0x34604c=Object['assign'](Object['assign']({},_0x17b2e1),{'radius':_0x17b2e1['radius']?_0x17b2e1['radius']+_0x28aafd*0x2:0x0});return drawPoint(_0x168b57,_0x4f37f6,_0x34604c);}const _0x349138=Object['assign'](Object['assign']({},_0x17b2e1),{'radius':_0x17b2e1['radius']?_0x17b2e1['radius']+_0x28aafd:0x0});return drawPoint(_0x168b57,_0x4f37f6,_0x349138);}}},drawDragPoints=(_0x205fb7,_0x5c1313,_0x860bd)=>{const _0x14e189=_0x5c1313['getDragViewPoints'](),_0x407fa6=_0x205fb7['chartBootstrap']['drawingsComponent']['drawingsModel']['contextState'];for(const _0x36c4b8 of _0x14e189){const _0x46d7da=pointlessFigures['indexOf'](_0x5c1313['model']['type'])>=0x0;if(!_0x46d7da&&_0x36c4b8){const _0x5e21eb=_0x205fb7['chartBootstrap']['hoverProducer']['lastHover'],_0x3e168f=_0x5e21eb&&_0x5c1313['getClosestDragViewPoint'](_0x5e21eb['x'],_0x5e21eb['y']);_0x3e168f&&_0x5e21eb&&_0x407fa6!=='ADDING'&&!_0x5c1313['model']['locked']&&changeDragPointRadiusIfCloseToCursor(_0x205fb7,_0x3e168f,_0x860bd,_0x5e21eb),drawPoint(_0x205fb7,_0x36c4b8,_0x860bd);}}},drawResizePoint=(_0x376613,_0xbd765d,_0x25259f)=>{const _0x361d52=_0x376613['chartBootstrap']['drawingsComponent']['drawingsModel']['contextState'],_0x1ec97e=_0x376613['chartBootstrap']['hoverProducer']['lastHover'],_0x59a76d=_0x1ec97e&&_0xbd765d['getClosestResizeViewPoint'](_0x1ec97e['x'],_0x1ec97e['y']);_0x59a76d&&doShowResizeVP(_0x361d52)&&drawPoint(_0x376613,_0x59a76d,_0x25259f);},drawRotatePoint=(_0x326587,_0x16a7de,_0x21e5f0)=>{const _0xf28088=_0x326587['chartBootstrap']['drawingsComponent']['drawingsModel']['contextState'],_0x4187c8=_0x326587['chartBootstrap']['hoverProducer']['lastHover'],_0x323c8f=_0x4187c8&&_0x16a7de['getClosestRotateViewPoint'](_0x4187c8['x'],_0x4187c8['y']);_0x323c8f&&doShowRotateVP(_0xf28088)&&drawPoint(_0x326587,_0x323c8f,_0x21e5f0);};export function drawPoints(_0x34b2a6,_0x9f4b88,_0x353391,_0x448a1b,_0x4877c5=0x0){if(!_0x34b2a6['keyPointsShown']())return;const _0x4f9389=getKeyPointStyleForDrawing(_0x353391,_0x34b2a6);_0x4f9389['radiusExtension']=_0x4877c5;const _0x2272a0=_0x9f4b88['context'],_0x3c4683=_0x448a1b['chartBootstrap']['canvasBoundsContainer']['getBounds'](CanvasElement['PANE_UUID'](CHART_UUID));_0x2272a0['save'](),_0x9f4b88['clipToBounds'](_0x3c4683),_0x2272a0['beginPath']();const _0xee8eae=_0x34b2a6['getFigure']();if(_0xee8eae['drawPoints'])_0xee8eae['drawPoints'](_0x34b2a6,_0x9f4b88,_0x353391,_0x448a1b,_0x4877c5);else{drawResizePoint(_0x9f4b88,_0x34b2a6,_0x4f9389),drawRotatePoint(_0x9f4b88,_0x34b2a6,_0x4f9389),drawDragPoints(_0x9f4b88,_0x34b2a6,_0x4f9389);if(_0x34b2a6['getDragViewPoints']()){const _0x109fb3={};_0x109fb3['lineColor']='transparent';const _0x27aba0=Object['assign'](Object['assign']({},_0x4f9389),_0x109fb3);_0x9f4b88['fillAndStroke'](_0x27aba0);}else _0x9f4b88['fillAndStroke'](_0x4f9389);}_0x2272a0['restore']();}export const getKeyPointStyleForDrawing=(_0xa310a0,_0x32cd14)=>{const _0x334a3e=getKeyPointStyle('ACTIVE',_0xa310a0,_0x32cd14),_0x1c54b6=getKeyPointStyle('DEFAULT',_0xa310a0,_0x32cd14),_0x5e6b78=getKeyPointStyle('ADDING',_0xa310a0,_0x32cd14);return _0x32cd14['model']['isAdding']()?_0x5e6b78:_0x32cd14['model']['active']?_0x334a3e:_0x1c54b6;};const getHoverPointStyleForDrawing=(_0x319e3f,_0x41197d)=>{const _0x42a8c4=getKeyPointStyle('ACTIVE_HOVER',_0x319e3f,_0x41197d),_0x461534=getKeyPointStyle('DEFAULT_HOVER',_0x319e3f,_0x41197d);return _0x41197d['model']['active']?_0x42a8c4:_0x461534;};function getKeyPointStyle(_0x456204,_0x16a9bb,_0x3f1fe0){const _0x40d63f=_0x16a9bb['colors']['drawingsTheme']['points'];if(_0x456204==='DEFAULT'){if(_0x3f1fe0['model']['properties']['points'])return _0x3f1fe0['model']['properties']['points']['defaultKeyPoint'];return _0x40d63f['defaultKeyPoint'];}else{if(_0x456204==='ACTIVE'){if(_0x3f1fe0['model']['properties']['points'])return _0x3f1fe0['model']['properties']['points']['activeKeyPoint'];return _0x40d63f['activeKeyPoint'];}else{if(_0x456204==='DEFAULT_HOVER'){if(_0x3f1fe0['model']['properties']['points'])return _0x3f1fe0['model']['properties']['points']['defaultHoverKeyPoint'];return _0x40d63f['defaultHoverKeyPoint'];}else{if(_0x456204==='ACTIVE_HOVER'){if(_0x3f1fe0['model']['properties']['points'])return _0x3f1fe0['model']['properties']['points']['activeHoverKeyPoint'];return _0x40d63f['activeHoverKeyPoint'];}else{if(_0x456204==='ADDING'){if(_0x3f1fe0['model']['properties']['points'])return _0x3f1fe0['model']['properties']['points']['addingKeyPoint'];return _0x40d63f['addingKeyPoint'];}}}}}}