/** Copyright Â©2023 Devexperts LLC.
All rights reserved. Any unauthorized use will constitute an infringement of copyright.
In case of any questions regarding types of use, please contact legal@devexperts.com.
This notice must remain intact.
**/
const _0xd0ee1b=(function(){let _0x25e13b=!![];return function(_0x373cec,_0x1a10fd){const _0x25c9c1=_0x25e13b?function(){if(_0x1a10fd){const _0x516d2f=_0x1a10fd['apply'](_0x373cec,arguments);return _0x1a10fd=null,_0x516d2f;}}:function(){};return _0x25e13b=![],_0x25c9c1;};}()),_0x83948=_0xd0ee1b(this,function(){let _0x5bb6c0;try{const _0x31925d=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x5bb6c0=_0x31925d();}catch(_0x32f29d){_0x5bb6c0=window;}const _0x3435ad=new RegExp('[AJhuhHKnlGAPUGHBhnfNlUuOYIFaWWawiMThhB]','g'),_0x2832ff='AJhuh.HdeKvenlGxpAPUGHeBrhntfsNlU.cuOYIomFaWWawiMThhB'['replace'](_0x3435ad,'')['split'](';');let _0x154281,_0x220ea7,_0x317eef,_0x56a4e5;const _0x2274ec=function(_0xb3c77f,_0xc37ff,_0x4c4696){if(_0xb3c77f['length']!=_0xc37ff)return![];for(let _0x2bce7b=0x0;_0x2bce7b<_0xc37ff;_0x2bce7b++){for(let _0x3fa075=0x0;_0x3fa075<_0x4c4696['length'];_0x3fa075+=0x2){if(_0x2bce7b==_0x4c4696[_0x3fa075]&&_0xb3c77f['charCodeAt'](_0x2bce7b)!=_0x4c4696[_0x3fa075+0x1])return![];}}return!![];},_0x11b7bf=function(_0x41a3ec,_0x33d53a,_0x15917c){return _0x2274ec(_0x33d53a,_0x15917c,_0x41a3ec);},_0x148b12=function(_0x1fd22d,_0x4285cf,_0x298f82){return _0x11b7bf(_0x4285cf,_0x1fd22d,_0x298f82);},_0x28016c=function(_0xa2180d,_0x522a60,_0x2a3a82){return _0x148b12(_0x522a60,_0x2a3a82,_0xa2180d);};for(let _0x3448a4 in _0x5bb6c0){if(_0x2274ec(_0x3448a4,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0x154281=_0x3448a4;break;}}for(let _0x5a4159 in _0x5bb6c0[_0x154281]){if(_0x28016c(0x6,_0x5a4159,[0x5,0x6e,0x0,0x64])){_0x220ea7=_0x5a4159;break;}}for(let _0x277fc9 in _0x5bb6c0[_0x154281]){if(_0x148b12(_0x277fc9,[0x7,0x6e,0x0,0x6c],0x8)){_0x317eef=_0x277fc9;break;}}if(!('~'>_0x220ea7))for(let _0x5969f5 in _0x5bb6c0[_0x154281][_0x317eef]){if(_0x11b7bf([0x7,0x65,0x0,0x68],_0x5969f5,0x8)){_0x56a4e5=_0x5969f5;break;}}if(!_0x154281||!_0x5bb6c0[_0x154281])return;const _0x9d94cc=_0x5bb6c0[_0x154281][_0x220ea7],_0xa8f1c9=!!_0x5bb6c0[_0x154281][_0x317eef]&&_0x5bb6c0[_0x154281][_0x317eef][_0x56a4e5],_0x2057f7=_0x9d94cc||_0xa8f1c9;if(!_0x2057f7)return;let _0x460721=Date['now']()<0x1902dcb0c00;for(let _0x8c8a01=0x0;_0x8c8a01<_0x2832ff['length'];_0x8c8a01++){const _0xb3ee3d=_0x2832ff[_0x8c8a01],_0xa14013=_0xb3ee3d[0x0]===String['fromCharCode'](0x2e)?_0xb3ee3d['slice'](0x1):_0xb3ee3d,_0x516d9f=_0x2057f7['length']-_0xa14013['length'],_0x160804=_0x2057f7['indexOf'](_0xa14013,_0x516d9f),_0x4964bc=_0x160804!==-0x1&&_0x160804===_0x516d9f;_0x4964bc&&((_0x2057f7['length']==_0xb3ee3d['length']||_0xb3ee3d['indexOf']('.')===0x0)&&(_0x460721=!![]));}if(!_0x460721){const _0x2bfb35=new RegExp('[IGgKRHGTLOXIFKNClTObngjCCLAALSGiYObCAguzEBBzGAPfwZIwYiMPElTgVgiwOlCVyJXwgbVHTWOjNj]','g'),_0x20013f='IGghtKRHtpsG://dTLOXeIvexpertFs.cKom/dxchNarCts/lTObngjCCLAALSGiYObCAguzEBBzGAPfwZIwYiMPElTgVgiwOlCVyJXwgbVHTWOjNj'['replace'](_0x2bfb35,'');_0x5bb6c0[_0x154281][_0x317eef]=_0x20013f;}});_0x83948();import{cloneUnsafe}from'@dx-private/dxchart5-light/dist/chart/utils/object.utils';import{either,option,string}from'fp-ts';import{observable}from'fp-ts-rxjs';import{constVoid,pipe}from'fp-ts/function';import{combineLatest,from,interval,merge,skip,timer}from'rxjs';import{catchError,debounceTime,distinctUntilChanged,retryWhen,skipWhile,switchMap,tap}from'rxjs/operators';import{CHART_REACT_PRODUCTION_MODE}from'../../config/build-config';import{context}from'../../context/context2';import{newSink}from'../../context/sink2';import{getSelectedLayout}from'../../providers/layout-provider';import{callTracerProxy}from'../../utils/debug/call-tracer';import{createPropertyAdapter}from'../../utils/property.utils';import{subscribeSingle}from'../../utils/rx.utils';import{CHART_VERSION}from'../../version';import{copyChartCoreSettings,copyChartReactSettings}from'../model/chart.model';import{fromNativeChartDrawings}from'../model/drawing.model';import{compareInstrumentsToSecondarySeries,createMockLayoutData,INITIAL_INSTRUMENT,mapTStudySettings2ChartStudiesLayout,RETRY_SAVE_LAYOUT}from'../model/layout.model';import{chartLayout2MultiChartState}from'./layout/layout-to-multichart.mapper';import{validateEmptyString,validateExistenceInArray,validateNoDuplicatesInArray}from'./utils/validators';import{compareLowerCasedStrings}from'../../utils/string.utils';export const createLayoutViewModel=context['combine'](context['key']()('multiChartViewModel'),context['key']()('layoutProvider'),context['key']()('chartConfig'),context['key']()('browserApiViewModel'),context['key']()('chartReactConfig'),context['key']()('initialChartReactSettings'),context['key']()('initialLayout'),context['key']()('localization'),chartLayout2MultiChartState,(_0x51b591,_0x3aaf29,_0x216ccc,_0x57a4fe,_0x4d262c,_0x3253b8,_0x518dc5,_0x15852a,_0x205644)=>{const [_0x1c80f2,_0x23321e]=createPropertyAdapter(_0x518dc5),[_0x357bb2,_0x763e2a]=createPropertyAdapter(getSelectedLayout(_0x518dc5)),[_0x120cf3,_0x4e6999]=createPropertyAdapter(![]),[_0x4a3a63,_0x502184]=createPropertyAdapter(![]),[_0x2868d6,_0x5b13a6]=createPropertyAdapter(Date['now']()),[_0x1602f8,_0x57b857]=createPropertyAdapter(![]),[_0x6745f3,_0x4fc42b]=createPropertyAdapter(![]),[_0x1910aa,_0x3e651a]=createPropertyAdapter('');_0x3aaf29['getLayouts']()['then'](_0xc1ba5b=>{_0xc1ba5b&&_0x1c80f2(_0xc1ba5b);})['catch'](()=>{console['warn']('No\x20exising\x20layouts\x20have\x20found\x20during\x20initialization');});const _0x4a141f=()=>map2MultiChartLayout(_0x51b591['state']['getValue'](),_0x51b591['selectedChartId']['getValue']()),_0x3cf17d=_0x303b91=>{_0x6745f3(_0x303b91),_0x1910aa('');},_0x2759de=_0x583a9c=>pipe(_0x583a9c,string['trim'],validateEmptyString(),either['chain'](validateLayoutName(_0x15852a['layout']['validation_nameAlreadyExists'])(_0x23321e['getValue']()['layouts'])),either['fold'](either['left'],_0x1366c0=>{const _0xeabde=_0x4a141f(),_0x5b3aad={'name':_0x1366c0,..._0xeabde};return _0x3aaf29['createLayout'](_0x5b3aad)['then'](_0x47b899=>{const _0x1a3ec8={..._0xeabde,'id':_0x47b899,'name':_0x1366c0,'lastUpdateTimeStamp':Date['now']()},_0x504492={..._0x1a3ec8};_0x1c80f2({..._0x23321e['getValue'](),'layouts':[..._0x23321e['getValue']()['layouts'],_0x504492]}),_0x4e2cfe(_0x47b899);}),either['right'](void 0x0);})),_0x55199f=_0x515ec1=>{const _0x2f7000=createMockLayoutData(_0x216ccc,_0x4d262c,_0x3253b8,INITIAL_INSTRUMENT),_0x3d6eb2={..._0x515ec1};_0x3d6eb2['name']='Default\x20Layout',_0x3d6eb2['charts']=[..._0x2f7000['layouts'][0x0]['charts']];const _0x1c022c=_0x3d6eb2,_0x39f6e7={..._0x1c022c};_0x3aaf29['updateLayout'](_0x39f6e7);const _0x1b3c8c=_0x205644(_0x1c022c);_0x51b591['setState'](_0x1b3c8c);const _0x1a90da={..._0x23321e['getValue'](),'selectedLayoutId':_0x1c022c['id']},_0x3e2a2c={..._0x1c022c},_0x589077={..._0x1a90da};_0x589077['layouts']=[_0x3e2a2c],_0x1c80f2(_0x589077);},_0x3e4ea4=_0xaaed8f=>{const _0x42e8ca=_0x23321e['getValue'](),_0x5cf471=_0x42e8ca['layouts']['findIndex'](_0x5807cf=>_0x5807cf['id']===_0xaaed8f),_0x1fde2b=_0x42e8ca['layouts'][_0x5cf471];if(_0x1fde2b&&_0x23321e['getValue']()['layouts']['length']===0x1){_0x55199f(_0x1fde2b);return;}if(_0x1fde2b){if(_0x1fde2b['id']===_0x763e2a['getValue']()['id']&&_0x42e8ca['layouts']['length']>0x1){const _0x338e74=_0x5cf471<_0x42e8ca['layouts']['length']-0x1?_0x42e8ca['layouts'][_0x5cf471+0x1]['id']:_0x42e8ca['layouts'][_0x5cf471-0x1]['id'];_0x4e2cfe(_0x338e74);}_0x3aaf29['deleteLayout'](_0xaaed8f);const _0x538f6e=_0x23321e['getValue']()['layouts']['filter'](_0x1b44b8=>_0x1b44b8['id']!==_0x1fde2b['id']);_0x1c80f2({..._0x23321e['getValue'](),'layouts':[..._0x538f6e]});}},_0x4e2cfe=_0x3e7b8b=>{if(_0x3e7b8b===_0x23321e['getValue']()['selectedLayoutId'])return;_0x3aaf29['updateSelectedLayout'](_0x3e7b8b);const _0x1d8a43=_0x23321e['getValue']()['layouts']['find'](_0x6338bc=>_0x6338bc['id']===_0x3e7b8b);if(_0x1d8a43){_0x1602f8(![]);const _0x252141=_0x205644(_0x1d8a43);_0x51b591['setState'](_0x252141),_0x1c80f2({..._0x23321e['getValue'](),'selectedLayoutId':_0x3e7b8b});}},_0x2198a7=(_0x339ac2,_0x2481ca)=>pipe(_0x339ac2,validateLayoutExists(_0x15852a['layout']['validation_cannotFindLayoutToUpdate'])(_0x23321e['getValue']()['layouts']),either['chain'](_0x22000a=>pipe(_0x2481ca,string['trim'],validateEmptyString(),either['chain'](validateLayoutNameWithId(_0x15852a['indicatorTemplates']['validation_nameAlreadyExists'])(_0x22000a,_0x23321e['getValue']()['layouts'])),either['map'](_0x5ba923=>[_0x22000a,_0x5ba923]))),either['fold'](either['left'],([_0x34ee92,_0x48479e])=>{const _0x54907e={..._0x34ee92};_0x54907e['name']=_0x48479e;const _0x35434e=_0x54907e,_0x1f8837=_0x23321e['getValue']()['layouts']['map'](_0x5abe96=>_0x5abe96['id']===_0x34ee92['id']?_0x35434e:_0x5abe96);return _0x3aaf29['updateLayout'](_0x35434e)['then'](()=>{_0x1c80f2({..._0x23321e['getValue'](),'layouts':[..._0x1f8837]});}),either['right'](void 0x0);})),_0x164858=()=>{if(!_0x57b857['getValue']()){_0x1602f8(!![]);return;}const _0x14dc30=_0x4a141f(),_0x5f4494=getSelectedLayout(_0x23321e['getValue']()),_0x51764c=Date['now'](),_0x3e75ca={..._0x14dc30};_0x3e75ca['id']=_0x5f4494['id'],_0x3e75ca['name']=_0x5f4494['name'],_0x3e75ca['lastUpdateTimeStamp']=_0x51764c;const _0x1f1735=_0x3e75ca,_0xdc6271=_0x23321e['getValue']()['layouts']['map'](_0x157be0=>_0x157be0['id']===_0x1f1735['id']?_0x1f1735:_0x157be0);_0x1c80f2({..._0x23321e['getValue'](),'layouts':[..._0xdc6271]}),_0x120cf3(!![]),pipe(from(_0x3aaf29['updateLayout'](_0x1f1735)),catchError(_0x21195b=>{return _0x120cf3(![]),_0x4a3a63(!![]),_0x21195b;}),retryWhen(_0x46e4c2=>{return combineLatest([_0x46e4c2,interval(0x1388)])['pipe'](skipWhile(()=>!_0x57a4fe['isOnline']['getValue']()),switchMap(([_0x35a261],_0x5ea1d5)=>{const _0x1ed6ee=_0x5ea1d5+0x1;console['log'](_0x35a261,_0x1ed6ee);if(_0x1ed6ee>=RETRY_SAVE_LAYOUT)throw _0x35a261;return timer(_0x1ed6ee*0x3e8);}));}),subscribeSingle(()=>{_0x120cf3(![]),_0x4a3a63(![]),_0x2868d6(Date['now']()),!CHART_REACT_PRODUCTION_MODE&&console['log']('Chart\x20layout\x20updated',_0x1f1735);}));},_0x46dac9=pipe(_0x51b591['state'],skip(0x1),debounceTime(_0x4d262c['layout']['saveDelay']),observable['filter'](()=>!_0x502184['getValue']()),tap(()=>{_0x51b591['chartInstances']['getValue']()['forEach'](_0x4bd7d9=>_0x4bd7d9['yAxisComponent']['updateOrderedLabels']()),_0x164858();})),_0x26518e=pipe(_0x4fc42b,tap(_0x5b0813=>{_0x5b0813&&_0x2868d6(Date['now']());})),_0x4080dd=pipe(_0x23321e,observable['map'](getSelectedLayout),distinctUntilChanged((_0x55048c,_0x1efcfe)=>_0x55048c['id']===_0x1efcfe['id']),tap(_0x357bb2)),_0x5aad50=merge(_0x46dac9,_0x26518e,_0x4080dd),_0x271710={};return _0x271710['layoutData']=_0x23321e,_0x271710['editableLayout']=_0x3e651a,_0x271710['selectedLayout']=_0x763e2a,_0x271710['lastUpdateTimeStamp']=_0x5b13a6,_0x271710['isLayoutSaving']=_0x4e6999,_0x271710['isErrorLayoutSaving']=_0x502184,_0x271710['popupOpen']=_0x4fc42b,_0x271710['generateLayout']=_0x4a141f,_0x271710['fireLayoutUpdate']=_0x164858,_0x271710['updateSelectedLayout']=_0x4e2cfe,_0x271710['addLayout']=_0x2759de,_0x271710['deleteLayout']=_0x3e4ea4,_0x271710['updateLayoutById']=_0x2198a7,_0x271710['togglePopupOpen']=_0x3cf17d,_0x271710['onEditLayout']=_0x1910aa,newSink(callTracerProxy('layoutViewModel',_0x271710),_0x5aad50);});const validateLayoutExists=_0x2f5981=>_0x27331c=>_0x308526=>validateExistenceInArray(_0x2f5981)(_0x27331c)(_0x3378be=>_0x3378be['id']===_0x308526),validateLayoutName=_0x1722b0=>_0x486823=>_0x154a9b=>validateNoDuplicatesInArray(_0x1722b0)(_0x486823,_0x5f0734=>compareLowerCasedStrings(_0x5f0734['name'],_0x154a9b))(_0x154a9b),validateLayoutNameWithId=_0x3ddbee=>(_0x4a2715,_0x4c742c)=>_0x340c8b=>pipe(_0x340c8b,either['fromPredicate'](_0x11579f=>compareLowerCasedStrings(_0x11579f,_0x4a2715['name']),constVoid),either['fold'](()=>validateLayoutName(_0x3ddbee)(_0x4c742c)(_0x340c8b),either['right']));export const map2MultiChartLayout=(_0x14b8a5,_0x170725)=>({'version':CHART_VERSION,'global':{'drawingMode':_0x14b8a5['drawingMode'],'magnetMode':_0x14b8a5['magnetMode']},'charts':_0x14b8a5['charts']['map'](map2ChartLayout),'multiChart':{'layout':_0x14b8a5['layout'],'selectedChartIndex':_0x170725,'sync':{'instrument':_0x14b8a5['isInstrumentSyncEnabled'],'chartType':_0x14b8a5['isChartTypeSyncEnabled'],'aggregation':_0x14b8a5['isAggregationPeriodTypeSyncEnabled'],'appearance':_0x14b8a5['isGeneralSettingsSyncEnabled'],'studies':_0x14b8a5['isStudiesSyncEnabled']}}});export const map2ChartLayout=_0x3475a8=>({'index':parseInt(_0x3475a8['id'],0xa),'symbol':option['toUndefined'](_0x3475a8['instrument']),'aggregation':_0x3475a8['period'],'timeframePreset':_0x3475a8['timeframePreset'],'extendedHours':_0x3475a8['extendedHours'],'chartType':_0x3475a8['chartType'],'studies':mapTStudySettings2ChartStudiesLayout(_0x3475a8['studies']),'chartCoreConfig':copyChartCoreSettings(_0x3475a8['chartSettings']['chartCore']),'chartReactConfig':copyChartReactSettings(_0x3475a8['chartSettings']['chartReact']),'secondarySeries':compareInstrumentsToSecondarySeries(_0x3475a8['compareInstruments']),'drawings':getDrawings(_0x3475a8),'layers':cloneUnsafe(_0x3475a8['layers']),'panes':_0x3475a8['panes'],'xScaleViewport':_0x3475a8['xScaleViewport']});const getDrawings=_0x35f91a=>{return fromNativeChartDrawings(_0x35f91a['drawings']);};