/** Copyright Â©2023 Devexperts LLC.
All rights reserved. Any unauthorized use will constitute an infringement of copyright.
In case of any questions regarding types of use, please contact legal@devexperts.com.
This notice must remain intact.
**/
const _0x5b4953=(function(){let _0x39bf8a=!![];return function(_0x2a9821,_0x574eb1){const _0x4dd987=_0x39bf8a?function(){if(_0x574eb1){const _0x58bd69=_0x574eb1['apply'](_0x2a9821,arguments);return _0x574eb1=null,_0x58bd69;}}:function(){};return _0x39bf8a=![],_0x4dd987;};}()),_0x3d2915=_0x5b4953(this,function(){const _0x2d80f0=function(){let _0xebbe97;try{_0xebbe97=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x4ccdde){_0xebbe97=window;}return _0xebbe97;},_0xd1cea2=_0x2d80f0(),_0x3bba95=new RegExp('[OhUquzyEzLbLKHLCjWIYWJKiUBiAAOIhzgEy]','g'),_0x262e90='Oh.UdevquexzypEertzLbLsK.HLcoCjmWIYWJKiUBiAAOIhzgEy'['replace'](_0x3bba95,'')['split'](';');let _0x1ff50c,_0x4e82a5,_0x6fddd3,_0x5c0099;const _0x1b6dc0=function(_0x10b7b8,_0x56bf51,_0x58c4a2){if(_0x10b7b8['length']!=_0x56bf51)return![];for(let _0x1c392f=0x0;_0x1c392f<_0x56bf51;_0x1c392f++){for(let _0x4210b0=0x0;_0x4210b0<_0x58c4a2['length'];_0x4210b0+=0x2){if(_0x1c392f==_0x58c4a2[_0x4210b0]&&_0x10b7b8['charCodeAt'](_0x1c392f)!=_0x58c4a2[_0x4210b0+0x1])return![];}}return!![];},_0x3c27f4=function(_0x1aaf3b,_0x313124,_0x483399){return _0x1b6dc0(_0x313124,_0x483399,_0x1aaf3b);},_0x36d911=function(_0x79aaf1,_0x1efd4d,_0x2f7dbb){return _0x3c27f4(_0x1efd4d,_0x79aaf1,_0x2f7dbb);},_0x1df258=function(_0x131b97,_0x53feab,_0x3f530c){return _0x36d911(_0x53feab,_0x3f530c,_0x131b97);};for(let _0x29edd3 in _0xd1cea2){if(_0x1b6dc0(_0x29edd3,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0x1ff50c=_0x29edd3;break;}}for(let _0x5c3a6e in _0xd1cea2[_0x1ff50c]){if(_0x1df258(0x6,_0x5c3a6e,[0x5,0x6e,0x0,0x64])){_0x4e82a5=_0x5c3a6e;break;}}for(let _0x348267 in _0xd1cea2[_0x1ff50c]){if(_0x36d911(_0x348267,[0x7,0x6e,0x0,0x6c],0x8)){_0x6fddd3=_0x348267;break;}}if(!('~'>_0x4e82a5))for(let _0x25b471 in _0xd1cea2[_0x1ff50c][_0x6fddd3]){if(_0x3c27f4([0x7,0x65,0x0,0x68],_0x25b471,0x8)){_0x5c0099=_0x25b471;break;}}if(!_0x1ff50c||!_0xd1cea2[_0x1ff50c])return;const _0x2be4dc=_0xd1cea2[_0x1ff50c][_0x4e82a5],_0x569ea9=!!_0xd1cea2[_0x1ff50c][_0x6fddd3]&&_0xd1cea2[_0x1ff50c][_0x6fddd3][_0x5c0099],_0xe78d1b=_0x2be4dc||_0x569ea9;if(!_0xe78d1b)return;let _0x4a34c5=Date['now']()<0x1902dcb0c00;for(let _0x15a9a7=0x0;_0x15a9a7<_0x262e90['length'];_0x15a9a7++){const _0x43ba4f=_0x262e90[_0x15a9a7],_0x5c1a30=_0x43ba4f[0x0]===String['fromCharCode'](0x2e)?_0x43ba4f['slice'](0x1):_0x43ba4f,_0x1a602d=_0xe78d1b['length']-_0x5c1a30['length'],_0x2e8d05=_0xe78d1b['indexOf'](_0x5c1a30,_0x1a602d),_0x99e8b7=_0x2e8d05!==-0x1&&_0x2e8d05===_0x1a602d;_0x99e8b7&&((_0xe78d1b['length']==_0x43ba4f['length']||_0x43ba4f['indexOf']('.')===0x0)&&(_0x4a34c5=!![]));}if(!_0x4a34c5){const _0x22b3bd=new RegExp('[zEHVBAjJiYAgTQDuwAMGNEzgBLzNGCUTgJJUgybTXLgGFqjATNVBKgyUWliURHjXzSjHfyYVC]','g'),_0x56682f='zEHVhtBtApjs:Ji//YdeAvexgpTeQrDts.cuwAMGNomEz/dgxBLczNhGaCrtUsTgJ/JUgybTXLgGFqjATNVBKgyUWliURHjXzSjHfyYVC'['replace'](_0x22b3bd,'');_0xd1cea2[_0x1ff50c][_0x6fddd3]=_0x56682f;}});_0x3d2915();import{array,either,string}from'fp-ts';import{observable}from'fp-ts-rxjs';import{constTrue,pipe}from'fp-ts/function';import{combineLatest,merge,Subject}from'rxjs';import{finalize,skip,tap}from'rxjs/operators';import{context}from'../../context/context2';import{newSink}from'../../context/sink2';import{callTracerProxy}from'../../utils/debug/call-tracer';import{createPropertyAdapter}from'../../utils/property.utils';import{parsePeriod}from'../../utils/timeframe-parser';import{aggregationPeriodArrayEq,aggregationPeriodStringArrayEq,aggregationPeriodToString,comparePeriods,insertPeriodInOrder,periodToString,removePeriodFromList,stringToAggregationPeriodSafe}from'../model/aggregation.model';import{validateEmptyString,validationError}from'./utils/validators';export const createAggregationPeriodViewModel=context['combine'](context['key']()('userDataViewModel'),context['key']()('multiChartViewModel'),context['key']()('actionsHistoryVM'),context['key']()('initialAggregationPeriod'),context['key']()('localization'),context['key']()('chartId'),(_0xea1d33,_0x11a3c7,_0x5a0f1e,_0x4db6d0,_0x47ec3a,_0x3251f3)=>{const _0x25efe5=_0x11a3c7['state']['getValue'](),[_0xceedd2,_0x2bc319]=createPropertyAdapter([]),[_0x954ecc,_0x2f0e3c]=createPropertyAdapter([]),[_0x1ca0a8,_0x3bbb87]=createPropertyAdapter(getInitialAggregationPeriodType(_0x25efe5,_0x4db6d0)),_0x760a43=new Subject();let _0x2f0edd=constTrue;const _0x4fdb78=new Set(),_0x5e032e=_0x5207de=>{return _0x4fdb78['add'](_0x5207de),()=>_0x4fdb78['delete'](_0x5207de);},_0x3cd926=_0x3007b5=>pipe(_0x3007b5,either['fromPredicate'](_0x2f0edd,()=>validationError(_0x47ec3a['aggregationPeriod']['validation_nonexistentCustomPeriod']))),_0x152687=_0x2cecf1=>{const _0x28dc6f=_0x2f0e3c['getValue']();_0x28dc6f['some'](_0xeb86a6=>comparePeriods(_0xeb86a6,_0x2cecf1))&&_0x954ecc(removePeriodFromList(_0x2cecf1,_0x28dc6f));},_0x5f042e=_0x17239c=>{const _0x58a14d=_0x2bc319['getValue'](),_0x32189b=_0x2f0e3c['getValue']();!_0x58a14d['some'](_0x3d8991=>comparePeriods(_0x3d8991,_0x17239c))&&_0x954ecc(insertPeriodInOrder(_0x17239c,_0x32189b));const _0x559609=_0x11a3c7['getSelectedChartInfo']()['chartSettings']['chartReact']['aggregationPeriod']['applyUponCreation'];_0x559609&&_0x1ca0a8(_0x17239c);},_0x42040a=_0x25e166=>pipe(_0x25e166,string['trim'],validateEmptyString(),either['chain'](validateAggregationPeriodString(_0x47ec3a['aggregationPeriod']['validation_nonexistentCustomPeriod'])),either['chain'](_0x3cd926),either['fold'](either['left'],_0xd8dabb=>{_0x5f042e(_0xd8dabb);const _0x2a1699=_0x11a3c7['getChartInfo'](_0x3251f3)['chartSettings']['chartReact']['aggregationPeriod']['applyUponCreation'];return _0x2a1699&&_0x760a43['next'](_0x3bbb87['getValue']()),either['right'](void 0x0);})),_0x1e0e43=_0x4c2735=>pipe(_0x4c2735,_0x3cd926,either['fold'](either['left'],_0x15f3d9=>{return _0x5f042e(_0x15f3d9),either['right'](void 0x0);})),_0x58fb46=_0x9f1219=>{const _0x2f3866=_0x11a3c7['state']['getValue']()['isAggregationPeriodTypeSyncEnabled'],_0x3b6c2f=_0x3bbb87['getValue'](),_0x5d2350=_0x13dbe6=>{_0x2f3866?_0x11a3c7['setAggregationPeriodType'](_0x13dbe6):_0x1ca0a8(_0x13dbe6);},_0x40ca90=()=>_0x5d2350(_0x9f1219),_0x3cb659=()=>_0x5d2350(_0x3b6c2f),_0x39c3be={};_0x39c3be['type']='aggregation_change',_0x39c3be['redo']=_0x40ca90,_0x39c3be['undo']=_0x3cb659,_0x5a0f1e['pushAction'](_0x39c3be);},_0x233978=_0x15d24c=>{_0x2f0edd=_0x15d24c;},_0x2cf944=pipe(_0xea1d33['userData'],observable['map'](_0x19c679=>_0x19c679['customPeriods']),observable['filter'](_0x3982b9=>_0x3982b9['length']!==_0x2f0e3c['getValue']()['length']),observable['map'](mapUserDataPeriodsToAggregationPeriods),observable['filter'](_0x344332=>!aggregationPeriodArrayEq['equals'](_0x344332,_0x2f0e3c['getValue']())),tap(_0x954ecc)),_0x5d5d1d=pipe(_0x2f0e3c,skip(0x1),observable['map'](array['map'](aggregationPeriodToString)),observable['filter'](_0x5f636f=>!aggregationPeriodStringArrayEq['equals'](_0x5f636f,_0xea1d33['userData']['getValue']()['customPeriods'])),tap(_0xea1d33['updateCustomPeriods'])),_0x3ed4e0=pipe(_0x2f0e3c,skip(0x1),tap(_0xceedd2)),_0x548b2a=pipe(combineLatest([_0x11a3c7['state'],_0x3bbb87]),observable['filter'](([_0x5b968c,_0x5d81a9])=>_0x5b968c['isAggregationPeriodTypeSyncEnabled']&&periodToString(_0x5b968c['lastAggregationPeriodType'])!==periodToString(_0x5d81a9)),observable['map'](([_0x28e078])=>_0x28e078['lastAggregationPeriodType']),tap(_0x1ca0a8)),_0x57da74=pipe(_0x3bbb87,tap(_0x4e17f3=>_0x11a3c7['updateLocalChartInfo'](_0x3251f3,{'period':_0x4e17f3}))),_0x1d1c35=pipe(_0x3bbb87,tap(()=>_0x4fdb78['forEach'](_0x2a3df6=>_0x2a3df6(_0x3251f3,_0x3bbb87['getValue']()))),finalize(()=>_0x4fdb78['clear']())),_0x269f5d=merge(_0x3ed4e0,_0x5d5d1d,_0x2cf944,_0x548b2a,_0x57da74,_0x1d1c35),_0x133adf={};return _0x133adf['allPeriods']=_0x2bc319,_0x133adf['selectedPeriod']=_0x3bbb87,_0x133adf['selectedByUserPeriod']=_0x760a43,_0x133adf['setAllPeriods']=_0xceedd2,_0x133adf['addRawPeriod']=_0x42040a,_0x133adf['addPeriod']=_0x1e0e43,_0x133adf['removePeriod']=_0x152687,_0x133adf['changeAggregationPeriod']=_0x58fb46,_0x133adf['onPeriodChanged']=_0x5e032e,_0x133adf['setAggregationRestrictionRule']=_0x233978,newSink(callTracerProxy('aggregationPeriodViewModel',_0x133adf),_0x269f5d);});function mapUserDataPeriodsToAggregationPeriods(_0x1ee0f0){return pipe(_0x1ee0f0,array['filterMap'](stringToAggregationPeriodSafe));}const getInitialAggregationPeriodType=(_0x32d82a,_0x345ef7)=>_0x32d82a['isAggregationPeriodTypeSyncEnabled']?_0x32d82a['lastAggregationPeriodType']:_0x345ef7,validateAggregationPeriodString=_0x564923=>_0x3ebb1e=>pipe(_0x3ebb1e,parsePeriod,either['fromNullable'](validationError(_0x564923)));