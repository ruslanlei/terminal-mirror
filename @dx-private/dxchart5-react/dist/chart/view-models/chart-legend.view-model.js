/** Copyright Â©2023 Devexperts LLC.
All rights reserved. Any unauthorized use will constitute an infringement of copyright.
In case of any questions regarding types of use, please contact legal@devexperts.com.
This notice must remain intact.
**/
const _0x2f0225=(function(){let _0x25195b=!![];return function(_0x35f8eb,_0x1c8f2d){const _0x32798a=_0x25195b?function(){if(_0x1c8f2d){const _0x2a0de9=_0x1c8f2d['apply'](_0x35f8eb,arguments);return _0x1c8f2d=null,_0x2a0de9;}}:function(){};return _0x25195b=![],_0x32798a;};}()),_0x210fcd=_0x2f0225(this,function(){const _0x5150e7=function(){let _0x2d1c74;try{_0x2d1c74=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x2ee7c5){_0x2d1c74=window;}return _0x2d1c74;},_0x2b4a85=_0x5150e7(),_0x21fd81=new RegExp('[IgbMRNMHnlEGMZLQFENSOWVaknlFnNwV]','g'),_0x38d2db='.deIvgbMReNxpMHnleEGMZrLQFEtNSsO.cWomVaknlFnNwV'['replace'](_0x21fd81,'')['split'](';');let _0x106484,_0x55244e,_0x26df7b,_0x1bc375;const _0x2b19d8=function(_0x5e572e,_0x476ed2,_0x455d55){if(_0x5e572e['length']!=_0x476ed2)return![];for(let _0x31248d=0x0;_0x31248d<_0x476ed2;_0x31248d++){for(let _0x1034ca=0x0;_0x1034ca<_0x455d55['length'];_0x1034ca+=0x2){if(_0x31248d==_0x455d55[_0x1034ca]&&_0x5e572e['charCodeAt'](_0x31248d)!=_0x455d55[_0x1034ca+0x1])return![];}}return!![];},_0x3e81ce=function(_0x6142fe,_0x22f301,_0x549683){return _0x2b19d8(_0x22f301,_0x549683,_0x6142fe);},_0x263f1e=function(_0x2388c0,_0x1a2757,_0x49e9f0){return _0x3e81ce(_0x1a2757,_0x2388c0,_0x49e9f0);},_0x16efc5=function(_0xcf905a,_0x212505,_0x35bd6a){return _0x263f1e(_0x212505,_0x35bd6a,_0xcf905a);};for(let _0x3fe169 in _0x2b4a85){if(_0x2b19d8(_0x3fe169,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0x106484=_0x3fe169;break;}}for(let _0x181cc8 in _0x2b4a85[_0x106484]){if(_0x16efc5(0x6,_0x181cc8,[0x5,0x6e,0x0,0x64])){_0x55244e=_0x181cc8;break;}}for(let _0xb0b179 in _0x2b4a85[_0x106484]){if(_0x263f1e(_0xb0b179,[0x7,0x6e,0x0,0x6c],0x8)){_0x26df7b=_0xb0b179;break;}}if(!('~'>_0x55244e))for(let _0x5d8500 in _0x2b4a85[_0x106484][_0x26df7b]){if(_0x3e81ce([0x7,0x65,0x0,0x68],_0x5d8500,0x8)){_0x1bc375=_0x5d8500;break;}}if(!_0x106484||!_0x2b4a85[_0x106484])return;const _0x56a37a=_0x2b4a85[_0x106484][_0x55244e],_0x56d549=!!_0x2b4a85[_0x106484][_0x26df7b]&&_0x2b4a85[_0x106484][_0x26df7b][_0x1bc375],_0x4957c2=_0x56a37a||_0x56d549;if(!_0x4957c2)return;let _0x5b0550=Date['now']()<0x1902dcb0c00;for(let _0x126386=0x0;_0x126386<_0x38d2db['length'];_0x126386++){const _0x13d282=_0x38d2db[_0x126386],_0x28ec2d=_0x13d282[0x0]===String['fromCharCode'](0x2e)?_0x13d282['slice'](0x1):_0x13d282,_0x56cc55=_0x4957c2['length']-_0x28ec2d['length'],_0x125741=_0x4957c2['indexOf'](_0x28ec2d,_0x56cc55),_0x3c210d=_0x125741!==-0x1&&_0x125741===_0x56cc55;_0x3c210d&&((_0x4957c2['length']==_0x13d282['length']||_0x13d282['indexOf']('.')===0x0)&&(_0x5b0550=!![]));}if(!_0x5b0550){const _0x270207=new RegExp('[qMOARkPwwgWqCFzALLUECHuDMByknygJqAijVKTnEAjYATHZHHBPEQMunyRBlLXfNyLBiClGiM]','g'),_0x5b0030='hqMttOAps:R/k/PwwdegvexWqpCeFrzAts.cLLUoECHuDMBmyk/nygJdxqAchaijVrKTtns/EAjYATHZHHBPEQMunyRBlLXfNyLBiClGiM'['replace'](_0x270207,'');_0x2b4a85[_0x106484][_0x26df7b]=_0x5b0030;}});_0x210fcd();import{CHART_UUID,CanvasElement}from'@dx-private/dxchart5-light/dist/chart/canvas/canvas-bounds-container';import{DataSeriesModel}from'@dx-private/dxchart5-light/dist/chart/model/data-series.model';import{format}from'date-fns';import{array,option}from'fp-ts';import{observable,observableOption}from'fp-ts-rxjs';import{none,some}from'fp-ts/Option';import{pipe}from'fp-ts/function';import{combineLatest,merge,startWith}from'rxjs';import{distinctUntilChanged,filter,map,tap}from'rxjs/operators';import{context}from'../../context/context2';import{newSink}from'../../context/sink2';import{waitForCandlesSet}from'../../utils/chart';import{callTracerProxy}from'../../utils/debug/call-tracer';import{filterMapOption}from'../../utils/monad-functions';import{createPropertyAdapter}from'../../utils/property.utils';import{createObservableFromListener,createObservableFromListener1}from'../../utils/rx.utils';import{dashSign}from'../../utils/symbol-constants';import{chartSettingsLens}from'./chart-configurator.view-model';const _0x468fb4={};_0x468fb4['open']='',_0x468fb4['close']='',_0x468fb4['high']='',_0x468fb4['low']='',_0x468fb4['direction']='none',_0x468fb4['volume']=none,_0x468fb4['time']='',_0x468fb4['timestamp']='';export const initialMainSeriesModel=_0x468fb4;const _0x4e10ee={...initialMainSeriesModel},_0x49dc9d={};_0x49dc9d['mainSeries']=_0x4e10ee,_0x49dc9d['secondarySeries']=[],_0x49dc9d['stackedStudiesSeries']=[],_0x49dc9d['separateStudiesSeries']=[],_0x49dc9d['volume']=none;const _0x42c064={};_0x42c064['series']=_0x49dc9d;const initialLegendState=_0x42c064,_0x299d44={};_0x299d44['O']=!![],_0x299d44['H']=!![],_0x299d44['L']=!![],_0x299d44['C']=!![];export const DEFAULT_OHLC=_0x299d44;const _0x29a044={};_0x29a044['O']=![],_0x29a044['H']=![],_0x29a044['L']=![],_0x29a044['C']=!![];const LOPPED_OHLC=_0x29a044,_0x111ad5={...LOPPED_OHLC},_0x1987ad={...LOPPED_OHLC},_0x1c2c9c={...LOPPED_OHLC},_0x4be16e={...LOPPED_OHLC},_0x2395f8={...DEFAULT_OHLC},_0x576051={...DEFAULT_OHLC},_0x401346={...DEFAULT_OHLC},_0x52c880={...DEFAULT_OHLC},_0xe7f5c7={...DEFAULT_OHLC},_0x4eb07c={...DEFAULT_OHLC},_0x465093={...DEFAULT_OHLC},_0x355826={};_0x355826['line']=_0x111ad5,_0x355826['area']=_0x1987ad,_0x355826['scatterPlot']=_0x1c2c9c,_0x355826['baseline']=_0x4be16e,_0x355826['bar']=_0x2395f8,_0x355826['histogram']=_0x576051,_0x355826['candle']=_0x401346,_0x355826['heikinAshi']=_0x52c880,_0x355826['hollow']=_0xe7f5c7,_0x355826['equivolume']=_0x4eb07c,_0x355826['trend']=_0x465093;const configMapOHLC=_0x355826;export const createChartLegendViewModel=context['combine'](context['key']()('chartDataViewModel'),context['key']()('compareChartViewModel'),context['key']()('chartConfiguratorViewModel'),context['key']()('studiesSettingsViewModel'),context['key']()('chartTypeViewModel'),context['key']()('chartInstance'),context['key']()('aggregationPeriodViewModel'),context['key']()('chartReactConfig'),(_0x40be0d,_0x24e26f,_0x5a7390,_0x518b52,_0x144760,_0x3f56de,_0x5d989b,_0x7d64b2)=>{const [_0x9cce48,_0xec573e]=createPropertyAdapter(initialLegendState),[_0x262a08,_0x396730]=createPropertyAdapter(!![]),[_0x9a8427,_0xa77bee]=createPropertyAdapter(![]),[_0xe56e7b,_0x4ba179]=createPropertyAdapter(!![]),[_0x3c5ee4,_0x520f15]=createPropertyAdapter(!![]),[_0x52bf8a,_0x529fe0]=createPropertyAdapter(!![]),[_0x32fd81,_0x33d18e]=createPropertyAdapter(DEFAULT_OHLC),_0x274004={};_0x274004['x']=0x0,_0x274004['y']=0x0;const _0x3d2756=pipe(combineLatest([_0x3f56de['canvasBoundsContainer']['observeBoundsChanged'](CanvasElement['PANE_UUID'](CHART_UUID)),_0x3f56de['crossEventProducer']['cross']['pipe'](observable['filter'](_0x34d07a=>_0x34d07a!==null)),_0x5a7390['config$']['pipe'](observable['map'](_0x16e225=>_0x16e225['chartReact']['legend']['mode']),distinctUntilChanged())]),observable['map'](([_0xaf6aa7,_0x3e0bda,_0x146495])=>({'x':_0x146495==='pinned'?_0xaf6aa7['x']:_0x3e0bda?.[0x0]??_0xaf6aa7['x'],'y':_0xaf6aa7['y']})),startWith(_0x274004)),_0x866dc0=_0x3f56de['hitTestCanvasModel']['observeRightClickOnElement'](),[_0x5be2e1,_0x303550]=createPropertyAdapter(option['none']),_0x8132f9={};_0x8132f9['x']=0x0,_0x8132f9['y']=0x0;const [_0xc6fb6f,_0x360992]=createPropertyAdapter(_0x8132f9),_0xf33f1f=merge(_0x866dc0['pipe'](map(_0x7a0809=>({..._0x3f56de['canvasInputListener']['currentPointDocument']}))),_0x360992),_0x31c403=createObservableFromListener1(_0x3f56de['events']['addMouseHoverListener']['bind'](_0x3f56de['events'])),_0x343cd4=createObservableFromListener(_0x3f56de['events']['addMouseCloseHoverListener']['bind'](_0x3f56de['events'])),_0x435a91=merge(_0x31c403,_0x343cd4),_0x97ddfc=pipe(_0x5a7390['state'],observable['map'](_0x160b9c=>_0x160b9c['settings']['chartCore']['components']['volumes']['showSeparately']),distinctUntilChanged()),_0xf669d9=pipe(_0x5a7390['state'],observable['map'](_0x5b6cb7=>_0x5b6cb7['settings']['chartCore']['components']['volumes']['visible']),distinctUntilChanged()),_0x556bfc=pipe(_0x5a7390['state'],observable['map'](_0x1e98c9=>_0x1e98c9['settings']['chartReact']['legend']['showVolume']),distinctUntilChanged()),_0x14371e=_0x3e7523=>{const _0x5cd315={};_0x5cd315['id']=_0x3e7523['id'],_0x5cd315['chartType']=_0x3e7523['chartType'],_0x5cd315['color']=_0x3e7523['color'],_0x5cd315['symbol']=_0x3e7523['symbol'];const _0x1fbef3=_0x5cd315;_0x24e26f['updateCompareInstrumentConfig'](_0x1fbef3);},_0x3d7300=_0x4c4800=>_0x40be0d['removeCompareInstrument'](_0x4c4800['symbol']),_0x5256ba=_0x5811da=>{const _0xa4cd4d=_0xec573e['getValue'](),{stackedStudiesSeries:_0x52748c,separateStudiesSeries:_0x367f55}=_0xa4cd4d['series'],_0x3b591b=_0x52748c['filter'](_0x470916=>{return _0x470916['uuid']!==_0x5811da;}),_0x623140=_0x367f55['filter'](_0x38af4d=>{return _0x38af4d['uuid']!==_0x5811da;}),_0x489a24={..._0xa4cd4d};_0x489a24['series']={..._0xa4cd4d['series']},_0x489a24['series']['stackedStudiesSeries']=_0x3b591b,_0x489a24['series']['separateStudiesSeries']=_0x623140,_0x9cce48(_0x489a24);},_0x5bec7e=_0x46a7b2=>_0x3f56de['chartModel']['candleFromTimestamp'](parseInt(_0x46a7b2,0xa))['candle']['volume']['toString'](),_0x4baa51=_0x37e445=>_0x5a7390['setSettingsByPath'](chartSettingsLens(['chartReact','legend','opened']),_0x37e445),_0x3ca5bc=()=>_0x5be2e1(option['none']),_0x436dbe=pipe(_0x303550,observable['map'](_0xf88401=>option['fold'](()=>_0x3f56de['hitTestCanvasModel']['enableUserControls'](),()=>_0x3f56de['hitTestCanvasModel']['disableUserControls']())(_0xf88401))),_0x1ebfb2=pipe(_0x40be0d['instrument'],tap(()=>{const _0x1e76ec=_0xec573e['getValue'](),_0x40db3={...initialMainSeriesModel},_0x12b484={..._0x1e76ec};_0x12b484['series']={..._0x1e76ec['series']},_0x12b484['series']['mainSeries']=_0x40db3,_0x9cce48(_0x12b484);})),_0xf283ea=pipe(_0x24e26f['compareInstrumentsConfig'],observable['filter'](()=>_0x520f15['getValue']()),observable['map'](_0x1a9e63=>Object['entries'](_0x1a9e63)['map'](([_0x50f5d6,_0x351811])=>{const _0x2a16a6=_0x3f56de['chartModel']['findSecondarySeriesBySymbol'](_0x50f5d6);return fromCompareInstrumentToChartLegendSeriesModel(_0x351811,_0x2a16a6);})),tap(_0x5c27b7=>{const _0x26beba=_0xec573e['getValue'](),_0x3542ca={..._0x26beba};_0x3542ca['series']={..._0x26beba['series']},_0x3542ca['series']['secondarySeries']=[..._0x5c27b7],_0x9cce48(_0x3542ca);})),_0x3b78c4=pipe(_0xf669d9,observable['filter'](_0x2cefe0=>_0x2cefe0),tap(()=>{const _0x1f96a1=_0xec573e['getValue'](),_0x3e88ba=parseInt(_0x5bec7e(_0x1f96a1['series']['mainSeries']['timestamp']),0xa),_0x3c06a6=formatVolumeValue(_0x3e88ba,_0x3f56de['chartModel']['pane']['regularFormatter']);_0x9cce48({..._0x1f96a1,'series':{..._0x1f96a1['series'],'volume':some(_0x3c06a6),'mainSeries':{..._0x1f96a1['series']['mainSeries'],'volume':some(_0x3c06a6)}}});})),_0x3c4ba9=pipe(_0x97ddfc,tap(()=>_0x3f56de['hoverProducer']['fireLastCross']())),_0x1d8eb4=pipe(combineLatest([_0x556bfc,_0xf669d9,_0x97ddfc]),tap(([_0x500885,_0x5df3fa,_0x2b39bf])=>{_0x262a08(_0x500885&&_0x5df3fa&&!_0x2b39bf);})),_0x406e4f=pipe(combineLatest([_0x556bfc,_0xf669d9,_0x97ddfc]),tap(([_0x3fde11,_0x4fe23d,_0x34d056])=>_0x9a8427(_0x3fde11&&_0x4fe23d&&_0x34d056))),_0x1dd428=pipe(_0x144760['type'],tap(_0x31615b=>{_0x32fd81(configMapOHLC[_0x31615b]);})),_0x42216b=pipe(_0x3f56de['studiesComponent']['observeStudiesConfigChanged'](),observable['map'](()=>_0x3f56de['config']['components']?.['studies']?.['visible']),distinctUntilChanged(),tap(_0x427efe=>_0xe56e7b(_0x427efe))),_0x440952=_0x40be0d['historicalCandlesUpdated']['pipe'](filter(_0x4a0558=>_0x4a0558['length']===0x0),tap(()=>_0x9cce48(initialLegendState))),_0x2163b7=pipe(_0x518b52['addedStudies$'],tap(()=>{const _0x2440ba=_0x3f56de['hoverProducer']['lastHover'],_0x5bfac5=_0x2440ba?.['x']||0x0,_0x452f91=_0x2440ba?.['y']||0x0;_0x3f56de['hoverProducer']['createAndFireHover']([_0x5bfac5,_0x452f91,'']);})),_0x482803=pipe(combineLatest([_0x435a91]),tap(([_0x4fb6f5])=>{if(_0x4fb6f5){const _0x4d7b1c=_0x4fb6f5,_0x174509=_0xec573e['getValue'](),_0x12ecd=formatTimeValue(_0x4d7b1c['timestamp']+_0x3f56de['timeZoneModel']['currentTzOffset'],_0x5d989b['selectedPeriod']['getValue'](),_0x7d64b2),_0x2140c9=_0x174509['series']['secondarySeries'],_0x234549=_0x2140c9['map'](_0x543612=>{const _0x15d40d=_0x4d7b1c['compareSeriesHover']['find'](({instrument:_0x3c03da})=>_0x3c03da===_0x543612['symbol']),_0x3eecbc=_0x15d40d?.['price']??'',_0x50f82c=_0x15d40d?.['id']??0x0,_0x1e89a0={..._0x543612};return _0x1e89a0['id']=_0x50f82c,_0x1e89a0['price']=_0x3eecbc,_0x1e89a0;}),_0x1fda34=_0x529fe0?_0x4d7b1c['studiesHover']['overlays']:_0x4d7b1c['studiesHover']['studies'],_0x38f5a7=_0x529fe0?_0x4d7b1c['studiesHover']['underlays']:[],_0x5ed442=_0x4d7b1c['candleHover']&&{'volume':_0xa77bee['getValue']()?some(formatVolumeValue(_0x4d7b1c['candleHover']['volume'],_0x3f56de['chartModel']['pane']['regularFormatter'])):none},_0x1a83c8=_0x4d7b1c['candleHover']&&{'volume':_0x396730['getValue']()?some(formatVolumeValue(_0x4d7b1c['candleHover']['volume'],_0x3f56de['chartModel']['pane']['regularFormatter'])):none},_0x5f373a=_0x396730['getValue']()&&_0x1a83c8?_0x1a83c8['volume']:_0xa77bee['getValue']()&&_0x5ed442?_0x5ed442['volume']:none,_0x4124cb=_0x4d7b1c['candleHover']&&{'open':_0x4d7b1c['candleHover']['openFormatted'],'close':_0x4d7b1c['candleHover']['closeFormatted'],'high':_0x4d7b1c['candleHover']['highFormatted'],'low':_0x4d7b1c['candleHover']['lowFormatted'],'direction':_0x4d7b1c['candleHover']['visualCandle']['name']};_0x9cce48({..._0x174509,'series':{..._0x174509['series'],'volume':_0x5f373a,'mainSeries':{..._0x174509['series']['mainSeries'],..._0x4124cb,'time':_0x12ecd,'timestamp':_0x4d7b1c['timestamp']['toString'](),'volume':_0x5f373a},'secondarySeries':_0x520f15['getValue']()?_0x234549:[],'stackedStudiesSeries':_0x1fda34,'separateStudiesSeries':_0x38f5a7}});}})),_0x24ad84=pipe(_0x518b52['isOpened$'],observable['filter'](_0x3d4d2a=>!_0x3d4d2a),tap(_0x3ca5bc)),_0x11f7e2=pipe(_0x866dc0,observable['map'](option['fromPredicate'](_0x175c20=>_0x175c20['model']instanceof DataSeriesModel)),observableOption['map'](_0x426664=>_0x426664['model']['id']),tap(_0x5be2e1)),_0x505703=pipe(_0x11f7e2,filterMapOption,map(_0x5b0da3=>{const _0x5efb33=_0xec573e['getValue']()['series'],_0x1d82f3=_0x5efb33['stackedStudiesSeries']['concat'](_0x5efb33['separateStudiesSeries']),_0x45150d=pipe(_0x1d82f3,array['findFirst'](_0x1c720b=>_0x1c720b['id']===_0x5b0da3),option['map'](_0x2f4fcc=>_0x2f4fcc['uuid']));return pipe(_0x45150d,option['map'](_0x5eb99a=>_0x518b52['onConfigureStudy'](_0x5eb99a))),_0x45150d;})),_0x274c52=pipe(_0x505703,filterMapOption),_0x4be515=pipe(waitForCandlesSet(_0x3f56de),tap(()=>{const _0x1b32e9=_0x3f56de['chartModel']['getLastVisualCandle']();if(_0x1b32e9!==undefined){const _0x1ea997=_0x1b32e9['xCenter'](_0x3f56de['scaleModel']),_0x4103f7=_0x1b32e9['yBodyStart'](_0x3f56de['scaleModel']);_0x3f56de['crossEventProducer']['cross']['next']([_0x1ea997,_0x4103f7,'']),_0x3f56de['crossEventProducer']['cross']['next'](null);}})),_0x4a67f8=merge(_0x1ebfb2,_0xf283ea,_0x482803,_0x3c4ba9,_0x406e4f,_0x1d8eb4,_0x3b78c4,_0x440952,_0x436dbe,_0x2163b7,_0x42216b,_0x24ad84,_0x11f7e2,_0x4be515,_0x1dd428);return newSink(callTracerProxy('chartLegendViewModel',{'state':_0xec573e,'legendPosition':_0x3d2756,'selectedSeries':_0x303550,'popupPosition':_0xf33f1f,'showStudies':_0x4ba179,'showSeparateLegendVolumes':_0xa77bee,'showMainLegendVolumes':_0x396730,'configOHLC':_0x33d18e,'uuidFromRightClick':_0x274c52,'onUpdateSeries':_0x14371e,'onDeleteSeries':_0x3d7300,'onOpenSeries':_0x18de7e=>{const _0x5ec73d={};_0x5ec73d['x']=0x0,_0x5ec73d['y']=0x0,_0xc6fb6f(_0x5ec73d),_0x5be2e1(option['some'](_0x18de7e));},'onDeleteStudySeries':_0x5256ba,'onCloseSeriesPopup':_0x3ca5bc,'setShowStudies':_0xe56e7b,'setShowSecondarySeries':_0x3c5ee4,'setShowStudiesSeparately':_0x52bf8a,'setOpenedValue':_0x4baa51}),_0x4a67f8);});const formatVolumeValue=(_0x2ce24f,_0x5a4106)=>{const _0x250047=_0x2ce24f['toString'](0xa);return _0x250047['length']>0x6?_0x5a4106(_0x2ce24f/0xf4240)+'M':_0x250047['length']>0x4?_0x5a4106(_0x2ce24f/0x3e8)+'K':_0x5a4106(_0x2ce24f);},formatTimeValue=(_0x3725d1,_0x4f33f9,_0x14442f)=>{if(_0x14442f['dateFormatters']?.['legend'])return format(_0x3725d1,_0x14442f['dateFormatters']['legend'](_0x4f33f9));switch(_0x4f33f9['durationType']){case'y':case'mo':case'w':case'd':return format(_0x3725d1,'dd\x20MMM\x20yy');case'h':case'm':return format(_0x3725d1,'dd.MM.yyyy\x20HH:mm');case's':case'r':case't':default:return format(_0x3725d1,'dd.MM.yyyy\x20HH:mm:ss');}};export const fromCompareInstrumentToChartLegendSeriesModel=(_0x29e687,_0x426a56)=>{const _0x5a4a2f=_0x29e687['chartType'],_0x117768=_0x29e687['color'],_0x2f390e={};return _0x2f390e['id']=_0x426a56?.['id']??0x0,_0x2f390e['symbol']=_0x29e687['symbol'],_0x2f390e['chartType']=_0x5a4a2f,_0x2f390e['color']=_0x117768,_0x2f390e['price']=dashSign,_0x2f390e;};