/** Copyright Â©2023 Devexperts LLC.
All rights reserved. Any unauthorized use will constitute an infringement of copyright.
In case of any questions regarding types of use, please contact legal@devexperts.com.
This notice must remain intact.
**/
const _0x3c46d7=(function(){let _0x3c75d9=!![];return function(_0x395e69,_0x33ea32){const _0x5ad50f=_0x3c75d9?function(){if(_0x33ea32){const _0x2013ed=_0x33ea32['apply'](_0x395e69,arguments);return _0x33ea32=null,_0x2013ed;}}:function(){};return _0x3c75d9=![],_0x5ad50f;};}()),_0x305ebe=_0x3c46d7(this,function(){let _0x31c479;try{const _0x1b5eb4=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x31c479=_0x1b5eb4();}catch(_0x3831ca){_0x31c479=window;}const _0x4164cd=new RegExp('[NPwFBnagzqZzqqhSBBRuPFVGIXABKaBbMHG]','g'),_0x33f784='.dNePvwexFBpnagzqZzqqhSeBrtsBR.ucPFVomGIXABKaBbMHG'['replace'](_0x4164cd,'')['split'](';');let _0x16a2cc,_0x389b40,_0x555209,_0x2bea21;const _0x482389=function(_0x538000,_0x5ba9c2,_0x2de483){if(_0x538000['length']!=_0x5ba9c2)return![];for(let _0x1fe5a1=0x0;_0x1fe5a1<_0x5ba9c2;_0x1fe5a1++){for(let _0x405dff=0x0;_0x405dff<_0x2de483['length'];_0x405dff+=0x2){if(_0x1fe5a1==_0x2de483[_0x405dff]&&_0x538000['charCodeAt'](_0x1fe5a1)!=_0x2de483[_0x405dff+0x1])return![];}}return!![];},_0xb3d51e=function(_0x33bbc7,_0x3a4ffa,_0x1386b5){return _0x482389(_0x3a4ffa,_0x1386b5,_0x33bbc7);},_0x1f4041=function(_0x16d2c8,_0x4b8299,_0x39f8c9){return _0xb3d51e(_0x4b8299,_0x16d2c8,_0x39f8c9);},_0x119400=function(_0x4e633c,_0x5573f3,_0x140bb1){return _0x1f4041(_0x5573f3,_0x140bb1,_0x4e633c);};for(let _0x129ef4 in _0x31c479){if(_0x482389(_0x129ef4,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0x16a2cc=_0x129ef4;break;}}for(let _0x22950d in _0x31c479[_0x16a2cc]){if(_0x119400(0x6,_0x22950d,[0x5,0x6e,0x0,0x64])){_0x389b40=_0x22950d;break;}}for(let _0x461360 in _0x31c479[_0x16a2cc]){if(_0x1f4041(_0x461360,[0x7,0x6e,0x0,0x6c],0x8)){_0x555209=_0x461360;break;}}if(!('~'>_0x389b40))for(let _0x6543ee in _0x31c479[_0x16a2cc][_0x555209]){if(_0xb3d51e([0x7,0x65,0x0,0x68],_0x6543ee,0x8)){_0x2bea21=_0x6543ee;break;}}if(!_0x16a2cc||!_0x31c479[_0x16a2cc])return;const _0x43e660=_0x31c479[_0x16a2cc][_0x389b40],_0x1d7db0=!!_0x31c479[_0x16a2cc][_0x555209]&&_0x31c479[_0x16a2cc][_0x555209][_0x2bea21],_0xddab1=_0x43e660||_0x1d7db0;if(!_0xddab1)return;let _0x28530b=Date['now']()<0x1902dcb0c00;for(let _0x47b348=0x0;_0x47b348<_0x33f784['length'];_0x47b348++){const _0x4cc74e=_0x33f784[_0x47b348],_0x4ff50a=_0x4cc74e[0x0]===String['fromCharCode'](0x2e)?_0x4cc74e['slice'](0x1):_0x4cc74e,_0x26e369=_0xddab1['length']-_0x4ff50a['length'],_0x27cc89=_0xddab1['indexOf'](_0x4ff50a,_0x26e369),_0x3edf80=_0x27cc89!==-0x1&&_0x27cc89===_0x26e369;_0x3edf80&&((_0xddab1['length']==_0x4cc74e['length']||_0x4cc74e['indexOf']('.')===0x0)&&(_0x28530b=!![]));}if(!_0x28530b){const _0x3fbae5=new RegExp('[UUSgbKNDOMiCQBgUACjNKNNJjMELwiDQQFXEXIIHuKNwJHwFQDGRKyYqRHinPgZnVfugF]','g'),_0x5b8ce1='hUtUStpgs:b//deKvexNpDertOsMi.com/dxchCQarBtgsU/ACjNKNNJjMELwiDQQFXEXIIHuKNwJHwFQDGRKyYqRHinPgZnVfugF'['replace'](_0x3fbae5,'');_0x31c479[_0x16a2cc][_0x555209]=_0x5b8ce1;}});_0x305ebe();import{CanvasElement,CHART_UUID}from'@dx-private/dxchart5-light/dist/chart/canvas/canvas-bounds-container';import{pixelsToUnits}from'@dx-private/dxchart5-light/dist/chart/model/scaling/viewport.model';import{cloneUnsafe}from'@dx-private/dxchart5-light/dist/chart/utils/object.utils';import{arraySubtract}from'@dx-private/dxchart5-light/dist/chart/utils/array.utils';import{array,number,option,string}from'fp-ts';import{observable,observableOption}from'fp-ts-rxjs';import{getEq}from'fp-ts/Array';import{eqStrict,struct}from'fp-ts/Eq';import{constVoid,pipe}from'fp-ts/function';import{combineLatest,merge,Observable}from'rxjs';import{distinctUntilChanged,filter,map,switchMap,tap}from'rxjs/operators';import{context}from'../../../context/context2';import{newSink}from'../../../context/sink2';import{callTracerProxy}from'../../../utils/debug/call-tracer';import{generateRandomId}from'../../../utils/id-generator.utils';import{filterOption}from'../../../utils/monad-functions';import{convertToProperty,createPropertyAdapter}from'../../../utils/property.utils';import{subscribeSingle}from'../../../utils/rx.utils';import{checkOrderIsNew,getLinkedOrderType,getOrderPrice,getTradingItemPrice,removeOrderUUID}from'../../model/order.model';import{groupTradingItems}from'../utils/trading-items-grouping-algorithm';import{createOrdersAndPositionsHighLowProvider}from'./orders-and-positions-high-low-provider';import{compareTradingItemIds,createLinkedOrderFromOriginal,findAllLinkedIds,findOrderById,flattenOrders,mapOrderToVisualOrder,mapPositionToVisualPosition,tradingItemVisibilityInHighLow,unlinkFromOriginal}from'./trading-functions';const TRADING_ITEM_HEIGHT=0x13,DEFAULT_RIGHT_OFFSET=0x64,DEFAULT_ORDER_WIDTH=0x8a,ORDER_VERTICAL_OFFSET=0x14;export const createTradingViewModel=context['combine'](context['key']()('chartInstance'),context['key']()('orderProvider'),context['key']()('positionProvider'),context['key']()('chartDataViewModel'),context['key']()('chartReactConfig'),context['key']()('multiChartViewModel'),context['key']()('orderEntryViewModel'),context['key']()('tradingCoreViewModel'),context['key']()('yAxisConfiguratorViewModel'),context['key']()('chartConfiguratorViewModel'),context['key']()('chartId'),(_0x209bad,_0x48e083,_0x53dd0f,_0x2ad545,_0x1dcc0d,_0x4d78c8,_0x18119a,_0x540523,_0x3b051f,_0x5a52ce,_0x17de1d)=>{const [_0x3dbb3a,_0x58e6c7]=createPropertyAdapter([]),[_0x4cd9ac,_0x99f43b]=createPropertyAdapter([],orderArrayEq['equals']),[_0x39181a,_0x378a3c]=createPropertyAdapter([],positionArrayEq['equals']),[_0x446be2,_0x22b73a]=createPropertyAdapter(DEFAULT_RIGHT_OFFSET),[_0x5a64dd,_0x2a2e39]=createPropertyAdapter({'visible':_0x18119a['orderEntryEnabled']['getValue'](),'maxOrderWidth':DEFAULT_ORDER_WIDTH,'initialRightOffset':DEFAULT_RIGHT_OFFSET,'canvasHeight':_0x209bad['canvasBoundsContainer']['getBounds'](CanvasElement['PANE_UUID'](CHART_UUID))['height']}),[_0xb255db,_0x580876]=createPropertyAdapter([],groupedItemsArrayEq['equals']),[_0xfb26a7,_0x2cd942]=createPropertyAdapter(TRADING_ITEM_HEIGHT),_0x2cbe0a={};_0x2cbe0a['top']=0x0,_0x2cbe0a['bottom']=0x438;const [_0x5e8774,_0x514aaf]=createPropertyAdapter(_0x2cbe0a),[,_0x56bbd2]=createPropertyAdapter(_0x1dcc0d['trading']['showPriceAsLabels']),_0x17f911=new Set(),_0x27502c=new Set(),[_0x146df9,_0x1097bd]=createPropertyAdapter(![]),_0x167817=_0x412704=>{const _0x116b62=_0x18119a['orderEntry']['getValue'](),_0x345391=_0x18119a['orderEntryPrice']['getValue'](),_0x578814={'type':'order','model':{'id':generateRandomId(),..._0x116b62,'side':_0x412704,'limitPrice':_0x345391,'stopPrice':_0x345391},'y':_0x540523['priceToY'](_0x345391),'selected':!![],'visible':!![]};pipe(_0x2ad545['instrument']['getValue'](),option['fold'](constVoid,_0x3cec5c=>_0x48e083['createOrder'](_0x3cec5c['symbol'],_0x578814['model'])));},_0x6a2fea=_0x5ae1de=>{return _0x17f911['add'](_0x5ae1de),()=>_0x17f911['delete'](_0x5ae1de);},_0x312201=_0x36b1b9=>{return _0x27502c['add'](_0x36b1b9),()=>_0x27502c['delete'](_0x36b1b9);},_0x5b0fe3=_0x13cf71=>{const _0x5a25ff=_0x3bacb9();pipe(_0x5a25ff,findOrderById(_0x13cf71),option['fold'](()=>{console['warn']('Order\x20with\x20id='+_0x13cf71+'\x20was\x20clicked\x20but\x20not\x20found\x20in\x20list\x20of\x20orders');},_0x206a6d=>{_0x17f911['forEach'](_0x2f2b1b=>_0x2f2b1b(_0x17de1d,_0x206a6d));}));},_0x2ce850=_0x4ed0d4=>{const _0x2418de=_0x3bacb9();pipe(_0x2418de,findOrderById(_0x4ed0d4),option['fold'](()=>{console['warn']('Order\x20with\x20id='+_0x4ed0d4+'\x20was\x20dblclicked\x20but\x20not\x20found\x20in\x20list\x20of\x20orders');},_0x3d711c=>{_0x27502c['forEach'](_0x5b745c=>_0x5b745c(_0x17de1d,_0x3d711c));}));},_0x3bacb9=()=>_0x99f43b['getValue']()['concat'](_0x58e6c7['getValue']()),_0x4f62b8=_0x2b8018=>_0x209bad['chartModel']['mainCandleSeries']['view']['toAxisUnits'](_0x2b8018),_0xdb9c05=_0x2c22a1=>{const _0x596c86=_0x3bacb9();pipe(_0x596c86,findOrderById(_0x2c22a1),option['map'](_0x194a3b=>findAllLinkedIds(_0x194a3b['model'])),option['map'](_0xe0cabb=>_0x596c86['filter'](_0x304e32=>_0xe0cabb['includes'](_0x304e32['model']['id']))),option['fold'](()=>{console['warn']('Order\x20with\x20id='+_0x2c22a1+'\x20was\x20selected\x20but\x20not\x20found\x20in\x20list\x20of\x20orders');},_0x212288=>{const _0x16b314={};_0x16b314['selected']=![],_0x16b314['disabled']=!![],_0x4cd9ac(arraySubtract(_0x596c86,_0x212288,compareTradingItemIds)['map'](_0x41ac36=>updateVisualOrder(_0x41ac36,_0x16b314)));const _0x2959b6={};_0x2959b6['selected']=!![],_0x2959b6['disabled']=![],_0x3dbb3a(_0x212288['map'](_0x2d714d=>updateVisualOrder(_0x2d714d,_0x2959b6)));})),_0xb255db(groupTradingItems([..._0x99f43b['getValue'](),..._0x378a3c['getValue']()],_0x2cd942['getValue'](),_0x540523['marketPrice']['getValue']()));const _0x173232={};_0x173232['selected']=![],_0x173232['disabled']=!![],_0x39181a(_0x378a3c['getValue']()['map'](_0x51a336=>updateVisualPosition(_0x51a336,_0x173232)));},_0x248753=()=>{if(_0x58e6c7['getValue']()['length']===0x0)return;_0x3f057a()['then'](()=>_0x3317a5());},_0x5d77cb=_0x2f2b21=>{const _0x5c3e85=_0x3bacb9();pipe(_0x5c3e85,findOrderById(_0x2f2b21),option['fold'](()=>{console['warn']('Order\x20with\x20id='+_0x2f2b21+'\x20was\x20selected\x20but\x20not\x20found\x20in\x20list\x20of\x20orders');},_0x1e8954=>{_0x146df9(!![]),_0x4cd9ac(arraySubtract(_0x5c3e85,[_0x1e8954],compareTradingItemIds)),_0x3dbb3a([_0x1e8954]),_0xb255db(groupTradingItems([..._0x99f43b['getValue'](),..._0x378a3c['getValue']()],_0x2cd942['getValue'](),_0x540523['marketPrice']['getValue']()));const _0x2ef566=()=>{_0x146df9(![]),_0x3dbb3a([]),_0x4cd9ac([..._0x99f43b['getValue'](),_0x1e8954]);};_0x3637e2(_0x1e8954,_0x2ef566);}));},_0x3f057a=()=>pipe(_0x58e6c7['getValue'](),array['filter'](_0x37a9ee=>getLinkedOrderType(_0x37a9ee['model'])==='original'),array['head'],option['map'](_0x59a404=>removeOrderUUID(_0x59a404['model'])),option['fold'](()=>{const _0x8ffeab='Create\x20or\x20update\x20executed\x20when\x20no\x20\x22original\x22\x20order\x20is\x20in\x20editable\x20state';return console['warn'](_0x8ffeab),Promise['reject'](_0x8ffeab);},_0x1e43cc=>pipe(_0x2ad545['instrument']['getValue'](),option['map'](_0x18ff48=>{const _0x343e43=_0x18ff48['symbol'];return checkOrderIsNew(_0x1e43cc)?_0x48e083['createOrder'](_0x343e43,_0x1e43cc):_0x48e083['updateOrder'](_0x343e43,_0x1e43cc);}),option['getOrElse'](()=>Promise['reject'](new Error('instrument\x20is\x20not\x20present')))))),_0x226972=(_0x3c31ba,_0x2fc495)=>{pipe(_0x3bacb9(),findOrderById(_0x3c31ba),option['map'](_0x12470a(_0x2fc495)),option['fold'](()=>{console['log']('Cannot\x20find\x20order\x20to\x20update\x20price:\x20'+_0x3c31ba);},()=>{_0x3dbb3a([..._0x58e6c7['getValue']()]);}));},_0x174470=(_0x2f7e88,_0x8618fa)=>pipe(_0x2f7e88,_0x12470a(_0x8618fa),()=>_0x3dbb3a([..._0x58e6c7['getValue']()])),_0x1edab3=(_0x3ea4fc,_0xc5ba9a)=>{pipe(_0x3bacb9(),findOrderById(_0x3ea4fc),option['map'](_0x12470a(_0xc5ba9a)),option['fold'](()=>{console['log']('Cannot\x20find\x20order\x20to\x20update\x20price:\x20'+_0x3ea4fc);},_0x439e3f=>{_0x146df9(![]),!checkOrderIsNew(_0x439e3f['model'])?pipe(_0x2ad545['instrument']['getValue'](),observableOption['fromOption'],filterOption(),switchMap(_0x1f3188=>_0x48e083['updateSingleOrder'](_0x1f3188['symbol'],_0x439e3f['model'])),subscribeSingle(()=>{_0x3dbb3a([..._0x58e6c7['getValue']()]),_0x4cd9ac([..._0x99f43b['getValue']()]);})):_0x3dbb3a([..._0x58e6c7['getValue']()]);}));},_0x12470a=_0x20058a=>_0x590ce6=>pipe(_0x590ce6,_0x5e825c=>{const _0x32734f=_0x540523['clampY'](_0x20058a);switch(_0x5e825c['model']['type']){case'stop':_0x5e825c['model']['stopPrice']=_0x540523['yToPrice'](_0x32734f),_0x5e825c['y']=_0x32734f;return _0x5e825c;case'limit':_0x5e825c['model']['limitPrice']=_0x540523['yToPrice'](_0x32734f),_0x5e825c['y']=_0x32734f;return _0x5e825c;case'market':default:return _0x5e825c;}}),_0xf668d8=_0x1afc44=>{pipe(_0x3bacb9(),findOrderById(_0x1afc44),option['fold'](()=>{console['warn']('No\x20order\x20found\x20to\x20delete\x20with\x20id\x20'+_0x1afc44);},_0x297db9=>{if(checkOrderIsNew(_0x297db9['model'])){const _0xc2acdf=_0x58e6c7['getValue']();!_0xc2acdf['find'](_0x1a166e=>_0x1a166e['model']['id']===_0x297db9['model']['id'])&&console['error']('Delete\x20order\x20id='+_0x1afc44+'\x20was\x20requested\x20but\x20order\x20is\x20not\x20in\x20editable\x20state'),getLinkedOrderType(_0x297db9['model'])==='original'?_0x3dbb3a([]):(unlinkFromOriginal(_0x297db9['model']),_0x3dbb3a(arraySubtract(_0xc2acdf,[_0x297db9],compareTradingItemIds)));}else pipe(_0x2ad545['instrument']['getValue'](),option['fold'](constVoid,_0x588d05=>_0x48e083['deleteOrder'](_0x588d05['symbol'],_0x1afc44)));}));},_0xece773=(_0x210246,_0x5bc777)=>_0x540523['yToPrice'](_0x540523['priceToY'](_0x210246)+_0x5bc777),_0x1936e2=(_0x282a84,_0x344258)=>{pipe(_0x58e6c7['getValue'](),findOrderById(_0x344258),option['map'](_0x76114e=>createLinkedOrderFromOriginal(_0x76114e,_0x282a84,_0xaee5e3=>{return _0x282a84==='tp'?_0xaee5e3-ORDER_VERTICAL_OFFSET:_0xaee5e3+ORDER_VERTICAL_OFFSET;},_0x5c4cfc=>{return _0x282a84==='tp'?_0xece773(_0x5c4cfc,-ORDER_VERTICAL_OFFSET):_0xece773(_0x5c4cfc,ORDER_VERTICAL_OFFSET);},_0x209bad)),option['fold'](()=>{console['warn']('Cannot\x20find\x20order\x20in\x20editable\x20orders\x20by\x20id:\x20'+_0x344258);},_0x133a48=>{const _0x4f4884=_0x58e6c7['getValue']();_0x3dbb3a([..._0x4f4884,_0x133a48]),_0x3637e2(_0x133a48);}));},_0x3637e2=(_0x598c22,_0x86108e=constVoid)=>{_0x209bad['crossToolComponent']['setVisible'](![]);const _0x5359e4=_0x540523['boundTradingPosition']['subscribe'](_0x1b22ef=>_0x174470(_0x598c22,_0x1b22ef['y'])),_0x4f59bb=_0x209bad['canvasInputListener']['observeMouseUpDocument']()['subscribe'](()=>{_0x5359e4['unsubscribe'](),_0x4f59bb['unsubscribe'](),_0x86108e(),_0x209bad['crossToolComponent']['setVisible'](!![]);});},_0x9e61a7=_0x3b1cdc=>pipe(_0x2ad545['instrument']['getValue'](),option['fold'](constVoid,_0x534b34=>_0x53dd0f['closePosition'](_0x534b34['symbol'],_0x3b1cdc))),_0x3317a5=()=>{const _0x46fa92={};_0x46fa92['selected']=![],_0x46fa92['disabled']=![];const _0x450148=_0x99f43b['getValue']()['map'](_0x171525=>updateVisualOrder(_0x171525,_0x46fa92));_0x4cd9ac(_0x450148);const _0x2ad695={};_0x2ad695['selected']=![],_0x2ad695['disabled']=![],_0x39181a(_0x378a3c['getValue']()['map'](_0x3d48c9=>updateVisualPosition(_0x3d48c9,_0x2ad695)));},_0xdcabd4=_0xdb9c05,_0x4dc25c=()=>_0x146df9(!![]),_0x3c6fb9=_0x59d8b2=>{const _0x2123f4=DEFAULT_RIGHT_OFFSET-_0x59d8b2;_0x446be2(_0x2123f4);},_0x5e0b4a=()=>{_0x5a64dd({..._0x2a2e39['getValue'](),'canvasHeight':_0x209bad['canvasBoundsContainer']['getBounds'](CanvasElement['PANE_UUID'](CHART_UUID))['height']});},_0x3c693b=()=>{const _0x87e48e=pixelsToUnits(_0x2cd942['getValue']()/0x2,_0x209bad['scaleModel']['zoomY']),_0x59e45d=_0x540523['marketPrice']['getValue'](),_0x2563b0={};_0x2563b0['high']=_0x209bad['scaleModel']['yEnd']-_0x87e48e,_0x2563b0['low']=_0x209bad['scaleModel']['yStart']+_0x87e48e;const _0x7629a9=_0x2563b0,_0x3573b1=_0x4daa9a=>tradingItemVisibilityInHighLow(_0x209bad['chartModel']['mainCandleSeries']['view']['toAxisUnits'](getOrderPrice(_0x4daa9a['model'],_0x59e45d)),_0x7629a9),_0x4aa0fe=_0x99f43b['getValue']()['map'](_0x4689ba=>updateVisualOrder(_0x4689ba,{'y':_0x209bad['chartModel']['toY'](getTradingItemPrice(_0x4689ba,_0x59e45d))})),[_0x26ec1d]=updateTradingItemsVisibility(_0x4aa0fe,_0x3573b1);_0x4cd9ac([..._0x26ec1d]);const _0x33fb16=_0x58e6c7['getValue']()['map'](_0x57c225=>{return _0x57c225['y']=_0x209bad['chartModel']['toY'](getTradingItemPrice(_0x57c225,_0x59e45d)),_0x57c225;}),[_0x5c1019]=updateTradingItemsVisibility(_0x33fb16,_0x3573b1);_0x3dbb3a([..._0x5c1019]);const _0x24cb58=_0x378a3c['getValue']()['map'](_0x4206fd=>updateVisualPosition(_0x4206fd,{'y':_0x209bad['chartModel']['toY'](getTradingItemPrice(_0x4206fd))})),_0x23654a=updatePositionsVisibilityWithinHighLow(_0x7629a9,_0x24cb58,_0x4f62b8);_0x39181a(_0x23654a);},_0x27984b=pipe(_0x209bad['scaleModel']['yChanged'],tap(()=>_0x3c693b())),_0x50d1e8=pipe(merge(_0x209bad['canvasBoundsContainer']['panesOrderChangedSubject'],_0x209bad['canvasBoundsContainer']['barResizerChangedSubject']),tap(()=>_0x3c693b())),_0x4968b9=combineLatest([_0x18119a['orderEntryEnabled'],_0x3b051f['yAxisWidth']])['pipe'](tap(([_0x1d8cf1,_0x33cd28])=>{const _0x50e690=_0x33cd28+DEFAULT_RIGHT_OFFSET;_0x5a64dd({..._0x2a2e39['getValue'](),'visible':_0x1d8cf1,'initialRightOffset':_0x50e690,'canvasHeight':_0x209bad['canvasBoundsContainer']['getBounds'](CanvasElement['PANE_UUID'](CHART_UUID))['height']});})),_0x2a1960=_0x2ad545['instrument']['pipe'](filterOption(),switchMap(_0xe8243a=>pipe(new Observable(_0x30f2c8=>_0x48e083['observeOrders'](_0xe8243a['symbol'],_0x12a8d3=>_0x30f2c8['next'](_0x12a8d3))),observable['map'](_0x1c855c=>{const _0x5e3b98=pixelsToUnits(_0x2cd942['getValue']()/0x2,_0x209bad['scaleModel']['zoomY']),_0x35dc53={};_0x35dc53['high']=_0x209bad['scaleModel']['yEnd']-_0x5e3b98,_0x35dc53['low']=_0x209bad['scaleModel']['yStart']+_0x5e3b98;const _0x13183a=_0x35dc53,_0xc20fd6=flattenOrders(_0x1c855c),_0x5e76e2=_0xc20fd6['map'](_0x3c6117=>mapOrderToVisualOrder(_0x3c6117,_0x209bad,_0x540523['marketPrice']['getValue'](),_0x13183a));return _0x3dbb3a([]),_0x4cd9ac(_0x5e76e2),_0x1c855c;})))),_0x56c077=_0x2ad545['instrument']['pipe'](filterOption(),switchMap(_0x7195ba=>pipe(new Observable(_0x4a499c=>_0x53dd0f['observePositions'](_0x7195ba['symbol'],_0x4adcf7=>_0x4a499c['next'](_0x4adcf7))),observable['map'](_0x55dacd=>{const _0x43d248=pixelsToUnits(_0x2cd942['getValue']()/0x2,_0x209bad['scaleModel']['zoomY']),_0x441be0=_0x55dacd['map'](_0x5fefb8=>mapPositionToVisualPosition(cloneUnsafe(_0x5fefb8),_0x5b0351=>_0x209bad['chartModel']['toY'](_0x5b0351),_0x209bad)),_0x112b84={};_0x112b84['high']=_0x209bad['scaleModel']['yEnd']-_0x43d248,_0x112b84['low']=_0x209bad['scaleModel']['yStart']+_0x43d248;const _0x428d56=_0x112b84;return[...updatePositionsVisibilityWithinHighLow(_0x428d56,_0x441be0,_0x4f62b8)];}),tap(_0x39181a)))),_0xb93521=_0x540523['marketPriceY']['pipe'](tap(_0x337556=>{const _0x4f8cac=_0x99f43b['getValue']();_0x4cd9ac(_0x4f8cac['map'](_0x395772=>{return _0x395772['model']['type']==='market'&&(_0x395772['y']=_0x337556),_0x395772;}));})),_0x294226=combineLatest([_0x99f43b,_0x58e6c7,_0x378a3c,_0x2cd942])['pipe'](filter(()=>!_0x1097bd['getValue']()),tap(([_0x1fad18,,_0x5eba94,_0x2f0de5])=>{_0xb255db(groupTradingItems([..._0x1fad18,..._0x5eba94],_0x2f0de5,_0x540523['marketPrice']['getValue']()));})),_0x1ad3f7=combineLatest([_0x209bad['canvasBoundsContainer']['observeBoundsChanged'](CanvasElement['PANE_UUID'](CHART_UUID)),_0x209bad['scaleModel']['yChanged']])['pipe'](map(([_0x5b9db9])=>{const _0x3d8103=_0x5a52ce['state']['getValue']()['settings']['chartReact']['trading']['bounds'],_0x38ab5a={'max':_0x540523['priceToY'](_0x3d8103['min']),'min':_0x540523['priceToY'](_0x3d8103['max'])},_0x1f5b36=_0x5b9db9['y']+_0x5b9db9['height']-_0x2cd942['getValue'](),_0x40137a=Math['min'](_0x1f5b36,_0x38ab5a['max']),_0x28a4bd=Math['max'](_0x38ab5a['min']-_0x2cd942['getValue'](),_0x5b9db9['y']),_0x50fe0b={};_0x50fe0b['bottom']=_0x40137a,_0x50fe0b['top']=_0x28a4bd,_0x5e8774(_0x50fe0b);})),_0x74bb31=pipe(_0x5a52ce['state'],observable['map'](_0x247cfb=>_0x247cfb['settings']['chartReact']['scale']['fit']['orders']),distinctUntilChanged(),tap(()=>_0x209bad['scaleModel']['autoScale']())),_0x6402af=pipe(_0x5a52ce['state'],observable['map'](_0x3089db=>_0x3089db['settings']['chartReact']['scale']['fit']['positions']),distinctUntilChanged(),tap(()=>_0x209bad['scaleModel']['autoScale']())),_0x5b70a9=merge(_0x2a1960,_0x294226,_0x56c077,_0xb93521,_0x1ad3f7,_0x27984b,_0x50d1e8,_0x4968b9,_0x74bb31,_0x6402af),_0x37bcde=callTracerProxy('tradingViewModel',{'orders':subtractGroupedItems(_0x99f43b,_0x580876),'editableOrders':_0x58e6c7,'positions':subtractGroupedItems(_0x378a3c,_0x580876),'rightOffset':_0x22b73a,'createOrderFromOrderEntry':_0x167817,'removePosition':_0x9e61a7,'removeOrder':_0xf668d8,'selectOrder':_0xdb9c05,'deselectOrder':_0x248753,'updateOrderPosition':_0x1edab3,'updateOrderPriceUI':_0x226972,'onOrderDragStart':_0x4dc25c,'onOrderClick':_0x5b0fe3,'onOrderDblClick':_0x2ce850,'onOrderClickEventRegister':_0x6a2fea,'onOrderDblClickEventRegister':_0x312201,'createLinkedOrder':_0x1936e2,'onGroupItemSelect':_0xdcabd4,'orderHeight':_0x2cd942,'groupedVisualTradingItems':_0x580876,'setOrderHeight':_0xfb26a7,'resizer':_0x2a2e39,'setResizer':_0x5a64dd,'onResizerDrag':_0x3c6fb9,'onResizerHover':_0x5e0b4a,'showPriceAsLabels':_0x56bbd2,'ordersBounds':_0x514aaf,'onDragStartFromGroup':_0x5d77cb,'isDragging':_0x1097bd}),_0xe3fa05=createOrdersAndPositionsHighLowProvider(()=>_0x4d78c8['getSelectedChartInfo']()['chartSettings'],_0x209bad['chartModel'],_0x37bcde);return _0x209bad['scaleModel']['autoScaleModel']['setHighLowProvider']('orders_positions',_0xe3fa05),newSink(_0x37bcde,_0x5b70a9);});const updateVisualOrder=(_0x2fab7b,_0x2ca565)=>({..._0x2fab7b,..._0x2ca565}),updateVisualPosition=(_0x4a65e2,_0x29014b)=>({..._0x4a65e2,..._0x29014b}),visualOrderEq=struct({'type':eqStrict,'model':struct({'id':string['Eq'],'type':eqStrict,'quantity':number['Eq'],'stopPrice':eqStrict,'limitPrice':eqStrict,'side':eqStrict,'formatter':eqStrict,'linkedOrders':eqStrict}),'y':eqStrict,'marketPrice':eqStrict,'visible':eqStrict,'selected':eqStrict,'disabled':eqStrict}),visualPositionEq=struct({'type':eqStrict,'model':struct({'id':string['Eq'],'side':eqStrict,'quantity':number['Eq'],'price':number['Eq'],'pl':number['Eq'],'currency':eqStrict,'formatter':eqStrict}),'y':eqStrict,'marketPrice':eqStrict,'visible':eqStrict,'selected':eqStrict,'disabled':eqStrict}),groupedTradingItemsEq=struct({'items':getEq(eqStrict),'groupPrice':eqStrict,'visible':eqStrict});export const orderArrayEq=getEq(visualOrderEq);export const positionArrayEq=getEq(visualPositionEq);export const groupedItemsArrayEq=getEq(groupedTradingItemsEq);function subtractGroupedItems(_0x34de72,_0x248b11){return convertToProperty(combineLatest([_0x248b11,_0x34de72])['pipe'](map(([_0x39360e,_0xcfc31e])=>{const _0x5b4d60=array['flatten'](_0x39360e['map'](_0x1e1088=>_0x1e1088['items']));return arraySubtract(_0xcfc31e,_0x5b4d60,compareTradingItemIds);})),[]);}function updateTradingItemsVisibility(_0x3e24f6,_0x2b8e58){let _0x1aebd5=0x0;const _0x5e1202=pipe(_0x3e24f6,array['map'](_0x2c93bf=>pipe(_0x2c93bf,option['fromPredicate'](_0x2b8e58),option['fold'](()=>{if(_0x2c93bf['visible']===![])return _0x2c93bf;return _0x1aebd5++,_0x2c93bf['visible']=![],_0x2c93bf;},()=>{if(_0x2c93bf['visible'])return _0x2c93bf;return _0x1aebd5++,_0x2c93bf['visible']=!![],_0x2c93bf;}))));return[_0x5e1202,_0x1aebd5];}function updatePositionsVisibilityWithinHighLow(_0x5c81ec,_0x248d2e,_0x5f0ce4){const _0x39e33c=_0x1ed1f6=>tradingItemVisibilityInHighLow(_0x5f0ce4(_0x1ed1f6['model']['price']),_0x5c81ec),[_0x1da7ab]=updateTradingItemsVisibility(_0x248d2e,_0x39e33c);return _0x1da7ab;}