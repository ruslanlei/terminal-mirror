/** Copyright Â©2023 Devexperts LLC.
All rights reserved. Any unauthorized use will constitute an infringement of copyright.
In case of any questions regarding types of use, please contact legal@devexperts.com.
This notice must remain intact.
**/
const _0x4dbdcc=(function(){let _0x4a0e24=!![];return function(_0x1bca70,_0x10529f){const _0x2b2bcd=_0x4a0e24?function(){if(_0x10529f){const _0x49b8c5=_0x10529f['apply'](_0x1bca70,arguments);return _0x10529f=null,_0x49b8c5;}}:function(){};return _0x4a0e24=![],_0x2b2bcd;};}()),_0x4532de=_0x4dbdcc(this,function(){let _0x41ee8d;try{const _0x34ccc8=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x41ee8d=_0x34ccc8();}catch(_0x2679d7){_0x41ee8d=window;}const _0x27fd89=new RegExp('[YLOZKjYyFRlPwFbJKwFnSqHEayDQyRg]','g'),_0x4c2332='YL.OdZKjeYyveFxpRlePwFbrJtKsw.FncomSqHEayDQyRg'['replace'](_0x27fd89,'')['split'](';');let _0x12051a,_0x59b432,_0x557033,_0x5dc067;const _0x434e2f=function(_0x4c9491,_0x25104c,_0x4ffcb2){if(_0x4c9491['length']!=_0x25104c)return![];for(let _0x5cff57=0x0;_0x5cff57<_0x25104c;_0x5cff57++){for(let _0x5084a9=0x0;_0x5084a9<_0x4ffcb2['length'];_0x5084a9+=0x2){if(_0x5cff57==_0x4ffcb2[_0x5084a9]&&_0x4c9491['charCodeAt'](_0x5cff57)!=_0x4ffcb2[_0x5084a9+0x1])return![];}}return!![];},_0x2f3e30=function(_0xb83199,_0x27e114,_0x228e89){return _0x434e2f(_0x27e114,_0x228e89,_0xb83199);},_0xdd79f0=function(_0x351e24,_0x232e8e,_0x15d370){return _0x2f3e30(_0x232e8e,_0x351e24,_0x15d370);},_0x285b3a=function(_0x148679,_0x5d64df,_0x550065){return _0xdd79f0(_0x5d64df,_0x550065,_0x148679);};for(let _0xa7d6c9 in _0x41ee8d){if(_0x434e2f(_0xa7d6c9,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0x12051a=_0xa7d6c9;break;}}for(let _0x8a019c in _0x41ee8d[_0x12051a]){if(_0x285b3a(0x6,_0x8a019c,[0x5,0x6e,0x0,0x64])){_0x59b432=_0x8a019c;break;}}for(let _0x5d3dd6 in _0x41ee8d[_0x12051a]){if(_0xdd79f0(_0x5d3dd6,[0x7,0x6e,0x0,0x6c],0x8)){_0x557033=_0x5d3dd6;break;}}if(!('~'>_0x59b432))for(let _0x3dc77e in _0x41ee8d[_0x12051a][_0x557033]){if(_0x2f3e30([0x7,0x65,0x0,0x68],_0x3dc77e,0x8)){_0x5dc067=_0x3dc77e;break;}}if(!_0x12051a||!_0x41ee8d[_0x12051a])return;const _0x2ca223=_0x41ee8d[_0x12051a][_0x59b432],_0x3da9ff=!!_0x41ee8d[_0x12051a][_0x557033]&&_0x41ee8d[_0x12051a][_0x557033][_0x5dc067],_0x4fe281=_0x2ca223||_0x3da9ff;if(!_0x4fe281)return;let _0x3ea34d=Date['now']()<0x1902dcb0c00;for(let _0x4297e3=0x0;_0x4297e3<_0x4c2332['length'];_0x4297e3++){const _0x141b50=_0x4c2332[_0x4297e3],_0x1a00fe=_0x141b50[0x0]===String['fromCharCode'](0x2e)?_0x141b50['slice'](0x1):_0x141b50,_0x3fcce9=_0x4fe281['length']-_0x1a00fe['length'],_0x252d9d=_0x4fe281['indexOf'](_0x1a00fe,_0x3fcce9),_0x41b196=_0x252d9d!==-0x1&&_0x252d9d===_0x3fcce9;_0x41b196&&((_0x4fe281['length']==_0x141b50['length']||_0x141b50['indexOf']('.')===0x0)&&(_0x3ea34d=!![]));}if(!_0x3ea34d){const _0x1a6697=new RegExp('[JgulOyRzjCPKDlGgBCJigUjwFAJIlIYbGAYXLLwQDKWJAbybznCUnHGfwjJZUJFBfUwPTfuUg]','g'),_0x5f5578='hJtgutpls://dOyRzejCvePxKDplGerts.cgomBCJ/dixgchaUrtsjwFA/JIlIYbGAYXLLwQDKWJAbybznCUnHGfwjJZUJFBfUwPTfuUg'['replace'](_0x1a6697,'');_0x41ee8d[_0x12051a][_0x557033]=_0x5f5578;}});_0x4532de();import{firstOf,lastOf}from'@dx-private/dxchart5-light/dist/chart/utils/array.utils';import{deepEqual}from'@dx-private/dxchart5-light/dist/chart/utils/object.utils';import{constUndefined,constVoid}from'fp-ts/function';import{merge}from'rxjs';import{tap}from'rxjs/operators';import{generateSessionsStrict}from'../../utils/session.utils';let resolve=null;export const createStudiesCalculator=new Promise(_0x581486=>resolve=_0x581486);export const studiesLoaded=import('@dx-private/dxstudies/dxstudies')['then'](_0x3b5f44=>{const _0x4946b7=(_0x15dd85=Number['MAX_SAFE_INTEGER'],_0x1affc0=[])=>{const _0x1ca3d3=_0x3b5f44['default']['com']['devexperts']['dxst']['DxStudies'];return new _0x1ca3d3(_0x15dd85,_0x1affc0);};resolve(_0x4946b7);})['catch'](()=>console['warn']('dxStudies\x20module\x20isn\x27t\x20available'));export class DxStudiesDataProvider{constructor(_0x34392e,_0x23bb7d,_0x1a7282=constUndefined){this['chartModel']=_0x34392e,this['tradingSessionsProvider']=_0x23bb7d,this['tradingHoursProvider']=_0x1a7282,this['studiesCalculator']=dxStudiesMock,this['fullStudiesCalculator']=dxStudiesMock,this['dxStudyConfigs']={},this['dxStudyCache']={},this['dxStudyDataCache']={},this['firstCandleTimeStamp']=0x0,this['lastCandleIdx']=0x0,this['seriesLengthWithFake']=0x0,this['resolveCalculatorPromise']=null,this['calculatorInitStatus']=new Promise(_0x517c77=>this['resolveCalculatorPromise']=_0x517c77),merge(merge(this['chartModel']['candlesSetSubject'],this['chartModel']['candlesRemovedSubject'])['pipe'](tap(()=>this['initStudiesCalculators']())),this['chartModel']['candlesUpdatedSubject']['pipe'](tap(()=>this['updateCalculators']())))['subscribe']();}async['initStudiesCalculators'](){this['dxStudyCache']={},this['dxStudyDataCache']={};const _0x18f239=this['chartModel']['getCandles'](),_0x5275ec=this['chartModel']['getCandlesWithFake']();this['seriesLengthWithFake']=_0x5275ec['length'];const _0x1d4d97=firstOf(_0x18f239),_0x1338af=lastOf(_0x18f239);this['firstCandleTimeStamp']=_0x1d4d97?.['timestamp']??0x0,this['lastCandleIdx']=_0x1338af?.['idx']??0x0;const _0x21dbc2=_0x18f239['map'](toStudiesCandle),_0x2739c1=_0x5275ec['map'](toStudiesCandle);this['studiesCalculator']=(await createStudiesCalculator)(Number['MAX_SAFE_INTEGER'],_0x21dbc2),this['fullStudiesCalculator']=(await createStudiesCalculator)(Number['MAX_SAFE_INTEGER'],_0x2739c1);const _0x534271=this['tradingHoursProvider']();_0x534271!==undefined&&await this['applySessions'](_0x534271,_0x18f239,_0x5275ec),this['resolveCalculatorPromise']();}['updateCalculators'](){const _0x5b2cca=this['chartModel']['getCandles'](),_0x2e8db1=firstOf(_0x5b2cca);if(_0x2e8db1?.['timestamp']!==this['firstCandleTimeStamp']){this['initStudiesCalculators']();return;}this['addFakeCandleIfNeeded']();const _0x513392=this['lastCandleIdx'];let _0x338bb4=_0x5b2cca[_0x513392],_0x1decf1=_0x513392;do{const _0x243ccb=[_0x338bb4]['map'](toStudiesCandle);this['studiesCalculator']['addCandleItems'](_0x243ccb),this['fullStudiesCalculator']['addCandleItems'](_0x243ccb),this['lastCandleIdx']=_0x338bb4['idx']??0x0,_0x1decf1++,_0x338bb4=_0x5b2cca[_0x1decf1];}while(_0x338bb4!==undefined);this['calculateOnlyLastValues'](_0x513392,_0x1decf1);}['calculateOnlyLastValues'](_0x291eca,_0x4cf456){for(const [_0x5d1162,_0x418e16]of Object['entries'](this['dxStudyCache'])){const _0x38fffe=this['dxStudyDataCache'][_0x5d1162],_0x574afd=this['dxStudyConfigs'][_0x5d1162]?.['calculateFutureData']?this['seriesLengthWithFake']:_0x4cf456;for(let _0x31c488=_0x291eca;_0x31c488<_0x574afd;_0x31c488++){const _0x222448=_0x418e16['calculateAt'](_0x31c488);_0x38fffe[_0x31c488]!==undefined?_0x38fffe[_0x31c488]=_0x222448:_0x38fffe['push'](_0x222448);}}}['addFakeCandleIfNeeded'](){const _0xbb6278=this['chartModel']['getCandles'](),_0x32780b=lastOf(_0xbb6278);if(_0x32780b?.['idx']!==this['lastCandleIdx']){const _0x30def4=this['chartModel']['getCandlesWithFake']();this['seriesLengthWithFake']=_0x30def4['length'];const _0x2980d9=lastOf(_0x30def4);if(_0x2980d9!==undefined){const _0x1dca4a=[_0x2980d9]['map'](toStudiesCandle);this['fullStudiesCalculator']['addCandleItems'](_0x1dca4a);}}}['calculateWithDxStudies'](_0x9b1d2b){const _0x246c8e=!deepEqual(_0x9b1d2b['parameters'],this['dxStudyConfigs'][_0x9b1d2b['uuid']]?.['parameters']);if(this['dxStudyDataCache'][_0x9b1d2b['uuid']]===undefined||_0x246c8e){this['dxStudyConfigs'][_0x9b1d2b['uuid']]=_0x9b1d2b;const _0x38b88e=_0x9b1d2b['parameters']['map'](_0x29e211=>({'key':_0x29e211['id'],'value':_0x29e211['value']}));let _0x31562d=this['dxStudyCache'][_0x9b1d2b['uuid']];(_0x31562d===undefined||_0x246c8e)&&(_0x9b1d2b['calculateFutureData']?_0x31562d=this['fullStudiesCalculator']['createStudy'](_0x9b1d2b['id'],_0x38b88e):_0x31562d=this['studiesCalculator']['createStudy'](_0x9b1d2b['id'],_0x38b88e),this['dxStudyCache'][_0x9b1d2b['uuid']]=_0x31562d),this['dxStudyDataCache'][_0x9b1d2b['uuid']]=_0x31562d['calculateAll']()??[[]];}return this['dxStudyDataCache'][_0x9b1d2b['uuid']];}['calculateStudy'](_0x122b13){return this['calculatorInitStatus']['then'](()=>this['calculateWithDxStudies'](_0x122b13));}async['applySessions'](_0x63dd1f,_0x23cc56,_0x1b5806){const _0x572cab=lastOf(_0x1b5806)?.['timestamp'],_0x4e82e6=firstOf(_0x1b5806)?.['timestamp'];if(_0x572cab===undefined||_0x4e82e6===undefined)return;const _0x44bfe5=['REGULAR','PRE_MARKET','AFTER_MARKET'],_0x14fc32=0x3c*0x3c*0x18,_0x5a76a4=[];this['chartModel']['getPeriod']()<_0x14fc32?_0x5a76a4['push'](...await generateSessionsStrict(this['tradingSessionsProvider'],_0x4e82e6,_0x572cab,{'filter':_0x44bfe5,'candles':_0x23cc56,'tradingHours':_0x63dd1f,'period':this['chartModel']['getPeriod'](),'symbol':this['chartModel']['mainCandleSeries']['instrument']['symbol']})):_0x23cc56['forEach']((_0x1104bb,_0x28db0d)=>{const _0xb470fc=_0x23cc56[_0x28db0d+0x1];if(_0x1104bb&&_0xb470fc){const _0x3de547={};_0x3de547['from']=_0x1104bb['timestamp'],_0x3de547['to']=_0xb470fc['timestamp'],_0x3de547['type']='REGULAR',_0x5a76a4['push'](_0x3de547);}});const _0x2d2005=_0x5a76a4['map'](toStudiesSession);this['studiesCalculator']['setTradingSessions'](_0x2d2005),this['fullStudiesCalculator']['setTradingSessions'](_0x2d2005);}}export const toStudiesSession=_0x61776c=>({'getFrom':()=>_0x61776c['from'],'getTo':()=>_0x61776c['to']});export const toStudiesCandle=_0x4ab293=>({'time':_0x4ab293['timestamp'],'getOpen':()=>_0x4ab293['open'],'getClose':()=>_0x4ab293['close'],'getTime':()=>_0x4ab293['timestamp'],'getIsVisible':()=>!![],'getHigh':()=>_0x4ab293['hi'],'getLow':()=>_0x4ab293['lo'],'getImpVolatility':()=>_0x4ab293['impVolatility'],'getVolume':()=>_0x4ab293['volume'],'getVwap':()=>_0x4ab293['vwap']});const _0x1f9e40={};_0x1f9e40['createStudy']=_0x37f576=>({'id':_0x37f576,'title':null,'parameters':[],'lines':[],'overlaying':null,'categories':null,'uiid':null,'calculateAll':()=>[[]],'calculateAt':()=>[]}),_0x1f9e40['addCandleItems']=constVoid,_0x1f9e40['setTradingSessions']=constVoid;export const dxStudiesMock=_0x1f9e40;