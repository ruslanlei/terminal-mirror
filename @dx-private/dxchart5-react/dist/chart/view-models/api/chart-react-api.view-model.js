/** Copyright Â©2023 Devexperts LLC.
All rights reserved. Any unauthorized use will constitute an infringement of copyright.
In case of any questions regarding types of use, please contact legal@devexperts.com.
This notice must remain intact.
**/
const _0x26e48c=(function(){let _0x161b1c=!![];return function(_0x252ad3,_0x1f64a2){const _0xeb8aae=_0x161b1c?function(){if(_0x1f64a2){const _0x1e0870=_0x1f64a2['apply'](_0x252ad3,arguments);return _0x1f64a2=null,_0x1e0870;}}:function(){};return _0x161b1c=![],_0xeb8aae;};}()),_0x5c93cf=_0x26e48c(this,function(){let _0x561972;try{const _0x2b5f30=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x561972=_0x2b5f30();}catch(_0x195d36){_0x561972=window;}const _0x3f5c80=new RegExp('[WOKWKRiHwCDlJfXTTLKIYWLKHhLFWQANH]','g'),_0x1e4d0d='.dWOKevexWKpReriHtwCDls.cJomfXTTLKIYWLKHhLFWQANH'['replace'](_0x3f5c80,'')['split'](';');let _0x40bc75,_0x1f045e,_0x1e89c7,_0x221bb5;const _0x1ef2a9=function(_0x4453e6,_0x4faaaf,_0x23c2a5){if(_0x4453e6['length']!=_0x4faaaf)return![];for(let _0x160380=0x0;_0x160380<_0x4faaaf;_0x160380++){for(let _0x416c81=0x0;_0x416c81<_0x23c2a5['length'];_0x416c81+=0x2){if(_0x160380==_0x23c2a5[_0x416c81]&&_0x4453e6['charCodeAt'](_0x160380)!=_0x23c2a5[_0x416c81+0x1])return![];}}return!![];},_0xc5d538=function(_0x2a7378,_0x29a263,_0x3ec00f){return _0x1ef2a9(_0x29a263,_0x3ec00f,_0x2a7378);},_0x90c020=function(_0x44cc4d,_0x145f57,_0x16b113){return _0xc5d538(_0x145f57,_0x44cc4d,_0x16b113);},_0x41a11f=function(_0x42a2d5,_0x83cf8a,_0x3cc069){return _0x90c020(_0x83cf8a,_0x3cc069,_0x42a2d5);};for(let _0x24a01c in _0x561972){if(_0x1ef2a9(_0x24a01c,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0x40bc75=_0x24a01c;break;}}for(let _0x12e6ea in _0x561972[_0x40bc75]){if(_0x41a11f(0x6,_0x12e6ea,[0x5,0x6e,0x0,0x64])){_0x1f045e=_0x12e6ea;break;}}for(let _0xfdb2db in _0x561972[_0x40bc75]){if(_0x90c020(_0xfdb2db,[0x7,0x6e,0x0,0x6c],0x8)){_0x1e89c7=_0xfdb2db;break;}}if(!('~'>_0x1f045e))for(let _0x3bc708 in _0x561972[_0x40bc75][_0x1e89c7]){if(_0xc5d538([0x7,0x65,0x0,0x68],_0x3bc708,0x8)){_0x221bb5=_0x3bc708;break;}}if(!_0x40bc75||!_0x561972[_0x40bc75])return;const _0x3cf049=_0x561972[_0x40bc75][_0x1f045e],_0x1674c0=!!_0x561972[_0x40bc75][_0x1e89c7]&&_0x561972[_0x40bc75][_0x1e89c7][_0x221bb5],_0x3eb721=_0x3cf049||_0x1674c0;if(!_0x3eb721)return;let _0x128aab=Date['now']()<0x1902dcb0c00;for(let _0x1b9246=0x0;_0x1b9246<_0x1e4d0d['length'];_0x1b9246++){const _0x5f560e=_0x1e4d0d[_0x1b9246],_0x10d22e=_0x5f560e[0x0]===String['fromCharCode'](0x2e)?_0x5f560e['slice'](0x1):_0x5f560e,_0x1b3040=_0x3eb721['length']-_0x10d22e['length'],_0x17ffe5=_0x3eb721['indexOf'](_0x10d22e,_0x1b3040),_0x357f69=_0x17ffe5!==-0x1&&_0x17ffe5===_0x1b3040;_0x357f69&&((_0x3eb721['length']==_0x5f560e['length']||_0x5f560e['indexOf']('.')===0x0)&&(_0x128aab=!![]));}if(!_0x128aab){const _0x188e18=new RegExp('[zFDjWIOTUiLDyTbGuJZDzNHQHbOYORCCMjEMVRAfAZiyYuXuGCkFNYZGuiHggwTBXuyZXVq]','g'),_0x38f96b='hztFtpsD:/jW/devIOeTxpUieLrtDsy.TbGucoJmZ/dxcDzNhHQaHbOYrtOs/RCCMjEMVRAfAZiyYuXuGCkFNYZGuiHggwTBXuyZXVq'['replace'](_0x188e18,'');_0x561972[_0x40bc75][_0x1e89c7]=_0x38f96b;}});_0x5c93cf();import _0x172eec from'@dx-private/dxchart5-light/dist/chart/bootstrap';import{array,option,record}from'fp-ts';import{observable}from'fp-ts-rxjs';import{constVoid,identity,pipe}from'fp-ts/function';import{Lens}from'monocle-ts';import{merge}from'rxjs';import{switchMap,tap}from'rxjs/operators';import{DEFAULT_LOCALIZATION}from'../../../config/localization/localization';import{context}from'../../../context/context2';import{MIGRATIONS_LIST}from'../../../layout-migration/migrations-list';import{windowGlobal}from'../../../utils/debug/chart-window-global';import{createPropertyAdapter}from'../../../utils/property.utils';import{sink}from'../../../utils/sink';import{ChartDataExporter}from'../../containers/chart-export-data/ChartDataExporter';import{chartLayout2MultiChartState}from'../layout/layout-to-multichart.mapper';export const createChartReactApiVM=context['combine'](context['key']()('initialLoaderVM'),context['key']()('multiChartViewModel'),context['key']()('themeSwitcherViewModel'),context['key']()('actionsHistoryVM'),context['key']()('onApiCreated'),context['key']()('notificationVM'),context['key']()('snapshotSharingVM'),context['key']()('layoutViewModel'),context['key']()('layoutProvider'),chartLayout2MultiChartState,(_0x562b9d,_0x21f9aa,_0x52f1a0,_0x5d71e8,_0x1be175,_0x224e5a,_0x2a130c,_0x36019a,_0x45b7c9,_0x451b83)=>{const [_0x189fdd,_0x4c22fc]=createPropertyAdapter({}),[_0x2a13c9,_0x39a5b8]=createPropertyAdapter({}),_0x267647=_0x3b6fea=>pipe(parseInt(_0x3b6fea,0xa),_0x23c375=>isNaN(_0x23c375)?undefined:_0x3b6fea),_0x316978=_0x506548=>{const _0x288de8=_0x4c22fc['getValue']();return record['keys'](_0x288de8)['map'](_0x227a7c=>_0x506548(_0x288de8[_0x227a7c]));},_0x19e901=_0x199cc4=>(_0x3fe416,_0x18b50e='')=>pipe(option['fromNullableK'](_0x267647)(_0x18b50e),option['fold'](()=>{return _0x316978(_0x1c49e1=>_0x199cc4(_0x1c49e1)(_0x3fe416)),void 0x0;},_0x434e9b=>pipe(_0x4c22fc['getValue'](),record['lookup'](_0x434e9b),option['fold'](constVoid,_0x5474e4=>_0x199cc4(_0x5474e4)(_0x3fe416))))),_0x53ebce=_0x5882ff=>(_0xd81f8d,_0x333b04='')=>pipe(option['fromNullableK'](_0x267647)(_0x333b04),option['fold'](()=>{const _0x296438=_0x316978(_0x1e0ca3=>_0x5882ff(_0x1e0ca3)(_0xd81f8d));return()=>_0x296438['forEach'](_0x57a0bc=>_0x57a0bc());},_0x4ab5c4=>pipe(_0x4c22fc['getValue'](),record['lookup'](_0x4ab5c4),option['fold'](()=>constVoid,_0x1bc7bd=>_0x5882ff(_0x1bc7bd)(_0xd81f8d))))),_0x4d3443=_0x19e901(_0x4408bc=>_0x21f05b=>_0x4408bc['chartDataViewModel']['changeInstrument'](option['fromNullable'](_0x21f05b))),_0x138b57=_0x19e901(_0x3f0b7b=>_0x3f0b7b['aggregationPeriodViewModel']['changeAggregationPeriod']),_0xf1b944=_0x19e901(_0x14df0b=>_0x14df0b['chartTypeViewModel']['setType']),_0x38398e=_0x19e901(_0x453b82=>_0x456bfd=>_0x453b82['chartConfiguratorViewModel']['setConfig'](_0x456bfd,![])),_0x3fd103=_0x19e901(_0x1d972c=>_0x1d972c['studiesSettingsViewModel']['setStudies']),_0x32f42e=_0x19e901(_0x5a8a77=>_0x5a8a77['drawingViewModel']['setDrawings']),_0x2b0fd5=_0x19e901(_0xb28766=>_0xb28766['chartLayersViewModel']['setAllLayerItems']),_0x52615c=_0x19e901(_0x5bdcba=>_0x5bdcba['timezoneViewModel']['setTimezoneSafe']),_0x1d0441=_0x19e901(_0x2d697a=>_0x2d697a['drawingGroupsViewModel']['selectGroup']),_0x5185fc=_0x19e901(_0x4cb12d=>_0x4cb12d['studiesSettingsViewModel']['setStudiesByIds']),_0x4a2807=_0x19e901(_0x5c8dcc=>_0x5c8dcc['yAxisConfiguratorViewModel']['setYAxisAlign']),_0x3566a7=_0x19e901(_0x163765=>_0x163765['chartConfiguratorViewModel']['setAggregationTimeframeChangeStrategy']),_0x699549=_0x19e901(_0x46cbfb=>_0x46cbfb['chartConfiguratorViewModel']['setInstrumentTimeframeChangeStrategy']),_0xe6f5bb=_0x19e901(_0x49cdd1=>_0x49cdd1['chartConfiguratorViewModel']['setConfig']),_0xe2753a=_0x52f1a0['setTheme'],_0x41a683=_0x19e901(_0x5ece8e=>_0x59e945=>{_0x5ece8e['aggregationPeriodViewModel']['setAggregationRestrictionRule'](_0x59e945),_0x5ece8e['timeframePresetsViewModel']['setAggregationRestrictionRule'](_0x59e945);}),_0xcbf119=_0x19e901(_0x235076=>_0x235076['chartDataViewModel']['addCompareInstrumentFromApi']),_0x119698=_0x19e901(_0x1e352c=>_0x1e352c['chartDataViewModel']['removeCompareInstrument']),_0x376096=_0x19e901(_0x31d5b5=>_0x31d5b5['chartDataViewModel']['setCompareInstrumentsFromApi']),_0x25f5ab=_0x2b527b=>{const _0x2346b2=_0x39a5b8['getValue']();record['keys'](_0x2346b2)['forEach'](_0x395e47=>{const _0x56594b=_0x2346b2[_0x395e47];_0x56594b instanceof _0x172eec&&_0x2b527b(_0x395e47,_0x56594b);});},_0x2ff83b=_0x53ebce(_0x27a5fe=>_0x27a5fe['chartConfiguratorViewModel']['onChartSettingsChanged']),_0x2b5c98=_0x53ebce(_0x3a3e7b=>_0x3a3e7b['chartLayersViewModel']['onLayerItemsChanged']),_0x156b22=_0x53ebce(_0xfab8ee=>_0xfab8ee['aggregationPeriodViewModel']['onPeriodChanged']),_0x50c213=_0x53ebce(_0x4289b8=>_0x4289b8['tradingVM']['onOrderClickEventRegister']),_0x19d614=_0x53ebce(_0x233c44=>_0x233c44['tradingVM']['onOrderDblClickEventRegister']),_0xaaa49d=_0x2e3aef=>{const _0x4b01bc=_0x21f9aa['getChartInfo'](_0x2e3aef),_0x362bf7=_0x39a5b8['getValue'](),_0x5ed23a=_0x362bf7[_0x4b01bc['id']];return{..._0x4b01bc,'instrument':option['toUndefined'](_0x4b01bc['instrument']),'chartInstance':_0x5ed23a instanceof _0x172eec?_0x5ed23a:undefined};},_0x17d48c=_0x2dfa7c=>{const _0xa274c0=_0x4c22fc['getValue'](),_0x502c80=_0x39a5b8['getValue'](),_0x576780=_0xa274c0[_0x2dfa7c],_0x26c5df=_0x502c80[_0x2dfa7c],_0x4db6f8=_0x576780['aggregationPeriodViewModel']['selectedPeriod']['getValue'](),_0x2ac929=new ChartDataExporter(_0x26c5df['chartModel'],_0x26c5df['studiesComponent']['studiesModel'],''+_0x4db6f8['duration']+_0x4db6f8['durationType']);_0x2ac929['exportChartData']();},_0x13b3b5=()=>_0x21f9aa['selectedChartId']['getValue'](),_0x4aacdf=_0x19e901(_0x542df1=>_0x542df1['chartConfiguratorViewModel']['setVolumesEnabled']),_0x4d207f=_0x19e901(_0x48fb67=>_0x48fb67['chartConfiguratorViewModel']['toggleVolumesVisible']),_0xf9596d=_0x19e901(_0x3c05f2=>_0x2b2463=>_0x3c05f2['chartConfiguratorViewModel']['toggleVolumesVisible'](_0x2b2463==='separate')),_0x9df391=_0x19e901(_0xb2d11a=>_0xb2d11a['chartConfiguratorViewModel']['setPriceType']),_0x273936=_0x19e901(_0x4740a1=>_0x4740a1['chartConfiguratorViewModel']['setCandlesAlignment']),_0x44bf78=_0x19e901(_0x54fdbd=>_0x54fdbd['chartConfiguratorViewModel']['setApplyPeriodUponCreation']),_0x32a16c=_0x19e901(_0xfd1bc1=>_0x26f476=>_0xfd1bc1['chartSessionsViewModel']['changeNextCandleTimestampOffset'](_0x26f476)),_0x1706a7=_0x19e901(_0x473418=>_0x473418['chartConfiguratorViewModel']['setTradingBoundaries']),_0x4b465f=(_0x4c6c1c,_0x22ff8c)=>pipe(_0x562b9d['processUserLayout'](_0x4c6c1c),_0xbf1b8f=>{const _0x5d3b11=_0x22ff8c?.['multiChartSync']||![],_0x2962e9=_0x22ff8c?.['multiChartLayout']||![],_0x2e21a4=_0x22ff8c?.['instrument']||![],_0x52f756=_0x22ff8c?.['chartType']||![],_0x37bfb8=_0x22ff8c?.['aggregation']||![],_0x30f3aa=_0x22ff8c?.['appearance']||![],_0x59cd3=_0x22ff8c?.['studies']||![],_0x53fc8f=_0x22ff8c?.['drawings']||![],_0x43f080=_0x22ff8c?.['selectedDrawingGroup']||![];_0x5d3b11&&(_0x21f9aa['setInstrumentSync'](_0xbf1b8f['multiChart']['sync']['instrument']),_0x21f9aa['setChartTypeSync'](_0xbf1b8f['multiChart']['sync']['chartType']),_0x21f9aa['setAggregationPeriodTypeSync'](_0xbf1b8f['multiChart']['sync']['aggregation']),_0x21f9aa['setGeneralSettingsSync'](_0xbf1b8f['multiChart']['sync']['appearance']),_0x21f9aa['setStudiesSync'](_0xbf1b8f['multiChart']['sync']['studies']));_0x2962e9&&_0x21f9aa['setLayout'](_0xbf1b8f['multiChart']['layout']);const _0xfe2f60=_0x451b83(_0xbf1b8f);_0x2e21a4&&_0xbf1b8f['charts']['forEach'](_0x1d01d0=>{const _0x27931b=_0xfe2f60['charts'][_0x1d01d0['index']];option['isSome'](_0x27931b['instrument'])&&_0x4d3443(_0x27931b['instrument']['value'],_0x1d01d0['index']+'');}),_0x52f756&&_0xbf1b8f['charts']['forEach'](_0x5a5a88=>{const _0x1e8845=_0xfe2f60['charts'][_0x5a5a88['index']];_0xf1b944(_0x1e8845['chartType'],_0x5a5a88['index']+'');}),_0x37bfb8&&_0xbf1b8f['charts']['forEach'](_0x35adf2=>{const _0x170334=_0xfe2f60['charts'][_0x35adf2['index']];_0x138b57(_0x170334['period'],_0x35adf2['index']+'');}),_0x30f3aa&&_0xbf1b8f['charts']['forEach'](_0x6090b8=>{const _0x5bd2c3=_0xfe2f60['charts'][_0x6090b8['index']];_0x38398e(_0x5bd2c3['chartSettings'],_0x6090b8['index']+'');}),_0x59cd3&&_0xbf1b8f['charts']['forEach'](_0x52e577=>{const _0x497177=_0xfe2f60['charts'][_0x52e577['index']];_0x3fd103(_0x497177['studies'],_0x52e577['index']+'');}),_0x53fc8f&&_0xbf1b8f['charts']['forEach'](_0x3f332e=>{const _0x587bb0=_0xfe2f60['charts'][_0x3f332e['index']];_0x32f42e(_0x587bb0['drawings'],_0x3f332e['index']+''),_0x2b0fd5(_0x587bb0['layers']['layerItems'],_0x3f332e['index']+'');const _0x424658=_0xaaa49d(_0x3f332e['index']+'')['layers']['selectedGroup'];_0x424658&&_0x1d0441(_0x424658,_0x3f332e['index']+'');}),_0x43f080&&_0xbf1b8f['charts']['forEach'](_0x405502=>{const _0x320119=_0xfe2f60['charts'][_0x405502['index']];_0x320119['layers']['selectedGroup']&&_0x1d0441(_0x320119['layers']['selectedGroup'],_0x405502['index']+'');});}),_0x231fa0=_0x152cf9=>pipe(MIGRATIONS_LIST,array['chain'](_0x552e9a=>_0x552e9a['scripts']),array['findFirst'](_0x23845f=>_0x23845f['name']===_0x152cf9),option['map'](_0x4d71ba=>_0x4d71ba['migrateFn'](_0x36019a['selectedLayout']['getValue']())),option['map'](_0x3c76a2=>{_0x45b7c9['updateLayout']({..._0x36019a['selectedLayout']['getValue'](),..._0x3c76a2}),window['location']['reload']();})),_0x472a85=()=>console['log'](JSON['stringify'](_0x36019a['layoutData']['getValue']())),_0x5326ca={'setNextCandleTimeOffset':_0x32a16c,'sendNotification':_0x224e5a['sendNotification'],'onPeriodChanged':_0x156b22,'setVolumesEnabled':_0x4aacdf,'setVolumesVisible':_0x4d207f,'setApplyPeriodUponCreation':_0x44bf78,'setVolumesMode':_0xf9596d,'setPriceType':_0x9df391,'setCandlesAlignment':_0x273936,'setAggregationTimeframeChangeStrategy':_0x3566a7,'getChartInfo':_0xaaa49d,'getSelectedChartInfo':()=>_0xaaa49d(_0x13b3b5()),'getSelectedChartId':_0x13b3b5,'changeInstrument':_0x4d3443,'changePeriod':_0x138b57,'changeTheme':_0xe2753a,'setStudies':_0x3fd103,'setStudiesByIds':_0x5185fc,'undo':_0x5d71e8['undo'],'redo':_0x5d71e8['redo'],'setYAxisAlign':_0x4a2807,'onChartInstanceCreated':_0x25f5ab,'onThemeChanged':_0x52f1a0['onThemeChanged'],'onChartSelected':_0x21f9aa['onSelectedChartIdChanged'],'onOrderDblClick':_0x19d614,'onOrderClick':_0x50c213,'syncLayoutParts':_0x4b465f,'setInstrumentTimeframeChangeStrategy':_0x699549,'exportChartData':_0x17d48c,'setAggregationRestrictionRule':_0x41a683,'setChartSettings':_0xe6f5bb,'onChartSettingsChanged':_0x2ff83b,'setLayerItems':_0x2b0fd5,'setCurrentTimezone':_0x52615c,'onLayerItemsChanged':_0x2b5c98,'addCompareInstrument':_0xcbf119,'removeCompareInstrument':_0x119698,'setCompareInstruments':_0x376096,'setTradingBoundaries':_0x1706a7},_0x50a9bd={'internal':{'chartVMs':{},'snapshotSharingVM':_0x2a130c,'multiChartViewModel':_0x21f9aa,'destroy':()=>Object['values'](_0x39a5b8['getValue']())['forEach'](_0x607b77=>_0x607b77['destroy']()),'getLocalizationJSON':()=>JSON['parse'](JSON['stringify'](DEFAULT_LOCALIZATION)),'exportLayout':_0x472a85,'applyMigrationScript':_0x231fa0},'supported':_0x5326ca,..._0x5326ca},[_0x125c10,_0x34c839]=createPropertyAdapter(_0x50a9bd),_0xc20217={'api':_0x34c839,'addChartVMsAndInstance':(_0x3a2d01,_0x2a78cc,_0x4e27ba)=>{_0x189fdd({..._0x4c22fc['getValue'](),[_0x3a2d01]:_0x2a78cc}),_0x2a13c9({..._0x39a5b8['getValue'](),[_0x3a2d01]:_0x4e27ba});}},_0x4a243e=pipe(_0x562b9d['isLoaded'],observable['filter'](identity),switchMap(()=>{return _0x189fdd({}),_0x4c22fc;}),observable['filter'](_0xc97601=>record['size'](_0xc97601)===_0x21f9aa['state']['getValue']()['charts']['length']),tap(_0x5eb2c1=>{const _0x1f2973=Lens['fromPath']()(['internal','chartVMs']),_0x181e09=_0x1f2973['set'](_0x5eb2c1)(_0x34c839['getValue']());_0x125c10(_0x181e09),windowGlobal['chartReactAPI'](_0x50a9bd),_0x1be175(_0x181e09);})),_0x3d284d=merge(_0x4a243e);return sink['newSink'](_0xc20217,_0x3d284d);});