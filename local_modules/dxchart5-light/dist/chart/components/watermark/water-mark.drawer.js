/*
 * Copyright (C) 2002 - 2023 Devexperts LLC
 * This Source Code Form is subject to the terms of the Mozilla Public License, v. 2.0.
 * If a copy of the MPL was not distributed with this file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */
import{CanvasElement as B}from"../../canvas/canvas-bounds-container";export class WaterMarkDrawer{constructor(o,e,s,w,h){this.config=o,this.canvasBoundsContainer=e,this.canvasModel=s,this.waterMarkConfigProvider=w,this.watermarkDataProvider=h,this.getConfig=(d=0,r,l,g,x,t)=>{const i=this.canvasModel.ctx,n=this.canvasBoundsContainer.getBounds(B.CHART),{position:u,offsetY:m,offsetX:R}=this.config.components.waterMark;let a;switch(t?a=t:(i.font=setFont(this.config,l),a=i.measureText(r).width,n.width-10<a&&(i.font=reCountingSize(this.config,this.canvasBoundsContainer,l,a),a=i.measureText(r).width)),u){case"left-top":return{x:R,y:m+d,font:i.font,text:r,color:g};case"left-bottom":return{x:R,y:n.height-x-m+d,font:i.font,text:r,color:g};case"center":return{x:n.width/2-a/2,y:(n.height-x)/2+d,font:i.font,text:r,color:g}}}}draw(){var o,e,s,w,h,d,r;if(((o=this.config.components.waterMark)===null||o===void 0?void 0:o.visible)&&this.config.colors){const{firstRow:l,secondRow:g,thirdRow:x}=this.watermarkDataProvider(),t=this.waterMarkConfigProvider(),i=this.config.colors.waterMarkTheme,n=this.canvasModel.ctx;let u=0,m=0,R=0,a=0,v=0;if(n.save(),t.firstRowFontSize&&l){n.font=setFont(this.config,t.firstRowFontSize);const c=n.measureText(l);u=c.actualBoundingBoxAscent+c.actualBoundingBoxDescent}if(t.secondRowFontSize&&g){n.font=setFont(this.config,t.secondRowFontSize);const c=n.measureText(g);m=c.actualBoundingBoxAscent+c.actualBoundingBoxDescent,R=(e=t.firstRowBottomPadding)!==null&&e!==void 0?e:0}if(t.thirdRowFontSize&&x){n.font=setFont(this.config,t.thirdRowFontSize);const c=n.measureText(x);a=c.actualBoundingBoxAscent+c.actualBoundingBoxDescent,v=(s=t.secondRowBottomPadding)!==null&&s!==void 0?s:0}const p=(w=t.thirdRowBottomPadding)!==null&&w!==void 0?w:0,C=(h=t.logoHeight)!==null&&h!==void 0?h:0,M=u+m+R+a+v+p+C;if(l&&this.drawWaterMark(this.getConfig(u,l,t.firstRowFontSize,i.firstRowColor,M)),g&&this.drawWaterMark(this.getConfig(u+R+m,g,t.secondRowFontSize,i.secondRowColor,M)),x&&this.drawWaterMark(this.getConfig(u+R+m+v+a,x,t.thirdRowFontSize,i.thirdRowColor,M)),this.logoImage){const c=this.getConfig(u+R+m+v+a+p,"",t.thirdRowFontSize,i.thirdRowColor,M,t.logoWidth);this.canvasModel.ctx.drawImage(this.logoImage,c.x,c.y,(d=t.logoWidth)!==null&&d!==void 0?d:0,(r=t.logoHeight)!==null&&r!==void 0?r:0)}n.restore()}}getCanvasIds(){return[this.canvasModel.canvasId]}setLogoImage(o){this.logoImage=o}drawWaterMark(o){const e=o.text;if(!e||!e.length)return;const s=this.canvasModel.ctx;s.font=o.font,s.fillStyle=o.color;const w=o.x,h=o.y;s.fillText(e,w,h)}reset(){}}export const reCountingSize=(f,o,e,s)=>{const h=((r,l)=>o.getBounds(B.CHART).width/l*r)(e,s);let d;return f.components&&f.components.waterMark&&(d=f.components.waterMark.fontFamily),h+"px "+d},setFont=(f,o)=>{let e;return f.components&&f.components.waterMark&&(e=f.components.waterMark.fontFamily),o+"px "+e};
