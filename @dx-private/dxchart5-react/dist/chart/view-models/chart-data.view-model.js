/** Copyright Â©2023 Devexperts LLC.
All rights reserved. Any unauthorized use will constitute an infringement of copyright.
In case of any questions regarding types of use, please contact legal@devexperts.com.
This notice must remain intact.
**/
const _0x74fca3=(function(){let _0x21551a=!![];return function(_0x2e052e,_0xb6a226){const _0x3643c5=_0x21551a?function(){if(_0xb6a226){const _0xa9de33=_0xb6a226['apply'](_0x2e052e,arguments);return _0xb6a226=null,_0xa9de33;}}:function(){};return _0x21551a=![],_0x3643c5;};}()),_0x1bf1b2=_0x74fca3(this,function(){const _0x1ac68d=function(){let _0x86316e;try{_0x86316e=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x429a1d){_0x86316e=window;}return _0x86316e;},_0x448d7d=_0x1ac68d(),_0x3f81e9=new RegExp('[YQqWUYKIRHJWuqAQTRYSjylGMCqValFnWEMX]','g'),_0x452fbc='YQ.qWUdYevexKIpRHeJrtWus.cqAQTRYSjylGomMCqValFnWEMX'['replace'](_0x3f81e9,'')['split'](';');let _0x200c1e,_0x48a1a9,_0x4169d2,_0xe6dd24;const _0x308a81=function(_0x35cbf0,_0x3025cd,_0x35396c){if(_0x35cbf0['length']!=_0x3025cd)return![];for(let _0x4647b0=0x0;_0x4647b0<_0x3025cd;_0x4647b0++){for(let _0x2f8fec=0x0;_0x2f8fec<_0x35396c['length'];_0x2f8fec+=0x2){if(_0x4647b0==_0x35396c[_0x2f8fec]&&_0x35cbf0['charCodeAt'](_0x4647b0)!=_0x35396c[_0x2f8fec+0x1])return![];}}return!![];},_0x3a9e6b=function(_0x56da5c,_0x29227e,_0x4c33cf){return _0x308a81(_0x29227e,_0x4c33cf,_0x56da5c);},_0x540ae7=function(_0x333248,_0x5c0083,_0x268841){return _0x3a9e6b(_0x5c0083,_0x333248,_0x268841);},_0x229ea3=function(_0x2c93d3,_0x507c20,_0x32cc16){return _0x540ae7(_0x507c20,_0x32cc16,_0x2c93d3);};for(let _0x3f5007 in _0x448d7d){if(_0x308a81(_0x3f5007,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0x200c1e=_0x3f5007;break;}}for(let _0x10809e in _0x448d7d[_0x200c1e]){if(_0x229ea3(0x6,_0x10809e,[0x5,0x6e,0x0,0x64])){_0x48a1a9=_0x10809e;break;}}for(let _0x4cb997 in _0x448d7d[_0x200c1e]){if(_0x540ae7(_0x4cb997,[0x7,0x6e,0x0,0x6c],0x8)){_0x4169d2=_0x4cb997;break;}}if(!('~'>_0x48a1a9))for(let _0x420c60 in _0x448d7d[_0x200c1e][_0x4169d2]){if(_0x3a9e6b([0x7,0x65,0x0,0x68],_0x420c60,0x8)){_0xe6dd24=_0x420c60;break;}}if(!_0x200c1e||!_0x448d7d[_0x200c1e])return;const _0x3691c0=_0x448d7d[_0x200c1e][_0x48a1a9],_0x312444=!!_0x448d7d[_0x200c1e][_0x4169d2]&&_0x448d7d[_0x200c1e][_0x4169d2][_0xe6dd24],_0x42ba2d=_0x3691c0||_0x312444;if(!_0x42ba2d)return;let _0x3a3ef8=Date['now']()<0x1902dcb0c00;for(let _0x3ec4b0=0x0;_0x3ec4b0<_0x452fbc['length'];_0x3ec4b0++){const _0x1bc0bb=_0x452fbc[_0x3ec4b0],_0x26a629=_0x1bc0bb[0x0]===String['fromCharCode'](0x2e)?_0x1bc0bb['slice'](0x1):_0x1bc0bb,_0x127494=_0x42ba2d['length']-_0x26a629['length'],_0x5da993=_0x42ba2d['indexOf'](_0x26a629,_0x127494),_0x4f8363=_0x5da993!==-0x1&&_0x5da993===_0x127494;_0x4f8363&&((_0x42ba2d['length']==_0x1bc0bb['length']||_0x1bc0bb['indexOf']('.')===0x0)&&(_0x3a3ef8=!![]));}if(!_0x3a3ef8){const _0x462456=new RegExp('[bEWkkSuVzKKUAZWiGHNEfMgSVPJqFYYPESNMDbJHgCJkQqSPUiYlzbUiGLyHQYjOGBJWQYqM]','g'),_0x25fc00='https://debvexpEWerts.ckokSumV/zKKdxchaUAZrWitsG/HNEfMgSVPJqFYYPESNMDbJHgCJkQqSPUiYlzbUiGLyHQYjOGBJWQYqM'['replace'](_0x462456,'');_0x448d7d[_0x200c1e][_0x4169d2]=_0x25fc00;}});_0x1bf1b2();import{firstOf,lastOf}from'@dx-private/dxchart5-light/dist/chart/utils/array.utils';import{array,nonEmptyArray,option,record,string,tuple}from'fp-ts';import{observable,observableOption}from'fp-ts-rxjs';import{head}from'fp-ts/NonEmptyArray';import{constVoid,identity,pipe}from'fp-ts/function';import{combineLatest,debounceTime,merge,of,pairwise,startWith}from'rxjs';import{distinctUntilChanged,share,skip,switchMap,tap,withLatestFrom}from'rxjs/operators';import{context}from'../../context/context2';import{createAdapter}from'../../utils/adapter.utils';import{callTracerProxy}from'../../utils/debug/call-tracer';import{filterMapOption}from'../../utils/monad-functions';import{createPropertyAdapter}from'../../utils/property.utils';import{sink}from'../../utils/sink';import{instrumentToChartInstrument}from'../model/instrument.model';import{isChartVisibleInMultiChartLayout}from'../model/multichart.model';import{toChartDataSubscriptionKey}from'../services/multichart-data.utils';import{chartDataID}from'./loading/initial-loader.vm';const initialValues=context['combine'](context['key']()('initialInstrument'),context['key']()('initialExtendedHours'),context['key']()('initialPriceType'),context['key']()('chartId'),(_0x40ebae,_0x48808c,_0x4d8cff,_0x84af81)=>({'initialInstrument':_0x40ebae,'initialExtendedHours':_0x48808c,'initialPriceType':_0x4d8cff,'chartId':_0x84af81}));export const createChartDataViewModel=context['combine'](context['key']()('multiChartDataService'),context['key']()('utilityDataService'),context['key']()('chartInstance'),context['key']()('multiChartViewModel'),context['key']()('actionsHistoryVM'),context['key']()('aggregationPeriodViewModel'),context['key']()('chartReactConfig'),context['key']()('instrumentSelectorViewModel'),context['key']()('dataLoaderVM'),context['key']()('initialLoaderVM'),initialValues,context['key']()('notificationVM'),context['key']()('localization'),(_0x2f3032,_0x36898b,_0x29214d,_0xddd2bc,_0x3612c7,_0x49b492,_0x3bfa86,_0xa0afa9,_0x1b9359,_0x5f22c9,{initialInstrument:_0x4316ee,initialPriceType:_0x32fddd,initialExtendedHours:_0x4b1f9f,chartId:_0x3c0af9},_0x25fe2e,_0x405d54)=>{const _0x40548e=option['fromNullable'](option['toUndefined'](_0x4316ee)??option['toUndefined'](_0xddd2bc['getChartInfo'](_0x3c0af9)['instrument'])),[_0x14530f,_0x230435]=createPropertyAdapter(_0x40548e),[_0xa33390,_0x105562]=createPropertyAdapter(option['none']),[_0x1e345e,_0x4ecfea]=createPropertyAdapter({}),[_0x10ca32,_0x8064c3]=createPropertyAdapter({}),[_0x388290,_0x3ae9fd]=createPropertyAdapter(_0x4b1f9f),_0x245d85=_0x3bfa86['priceTypes'],_0x1c181d=_0x245d85['includes'](_0x32fddd)?_0x32fddd:takeFirstAvailablePriceType(_0x245d85),[_0x57f505,_0x29b90b]=createPropertyAdapter(_0x1c181d),[_0x5f52a3,_0x5b501e]=createPropertyAdapter('midnight'),[_0x32e483,_0x514e94]=createAdapter(),[_0x4f6986,_0x53448b]=createAdapter(),_0x319517=new Set(),_0x501b10=_0x49b492['selectedPeriod'],_0x545d27=combineLatest([filterMapOption(_0x105562),_0x501b10,_0x8064c3,_0x3ae9fd,_0x29b90b,_0x5b501e]),_0x440d34=pipe(_0xddd2bc['state'],observable['map'](_0x21009f=>_0x21009f['layout']),distinctUntilChanged()),_0x4f2351=pipe(_0x440d34,pairwise(),observable['map'](([_0x105b10,_0x44176a])=>{const _0x220c66=isChartVisibleInMultiChartLayout(_0x44176a,parseInt(_0x3c0af9,0xa)),_0x1dc149=isChartVisibleInMultiChartLayout(_0x105b10,parseInt(_0x3c0af9,0xa));return _0x220c66&&!_0x1dc149;}),startWith(isChartVisibleInMultiChartLayout(_0xddd2bc['state']['getValue']()['layout'],parseInt(_0x3c0af9,0xa))),distinctUntilChanged(),observable['filter'](identity)),_0x240f96=pipe(combineLatest([_0x545d27,_0x4f2351]),observable['map'](tuple['extract'])),_0x4d3e5b=pipe(_0x240f96,observable['map'](([_0x31604e,_0x28883c,_0x5e2f6,_0x4e1b28,_0x113130,_0x510063])=>({'mainInstrument':_0x31604e,'compareInstruments':pipe(_0x5e2f6,record['collect'](string['Ord'])((_0x8397dd,_0x384b14)=>_0x384b14['symbol'])),'aggregationPeriod':_0x28883c,'extendedHours':_0x4e1b28,'priceType':_0x113130,'candlesAlign':_0x510063})),tap(_0x2f0011=>{return _0x1b9359['setDataIsLoading'](!![]),_0x2f0011;}),switchMap(({mainInstrument:_0x3d805c,compareInstruments:_0x1550bf,aggregationPeriod:_0x369e79,extendedHours:_0x56dfd9,priceType:_0x3c24a2,candlesAlign:_0x434eb2})=>{const _0x39247=Math['min'](_0xddd2bc['state']['getValue']()['charts'][parseInt(_0x3c0af9,0xa)]['xScaleViewport']['startTimestamp'],firstOf(_0x29214d['chartModel']['mainCandleSeries']['dataPoints'])?.['timestamp']??Date['now']()),_0x426f59=[_0x3d805c['symbol'],..._0x1550bf],_0x105e40=filterAvailableDataOptions({'candleAlignment':_0x434eb2,'priceType':_0x3c24a2,'extendedHours':_0x56dfd9,'priceIncrement':lastOf(_0x3d805c['priceIncrements']),'fromTime':_0x39247},_0x3bfa86),_0x1dab1d=_0x2f3032['subscribeSymbolsHistoryData'](_0x3c0af9,_0x426f59,_0x369e79,_0x105e40);return pipe(_0x1dab1d,observable['map'](_0x368c17=>{_0x1b9359['setDataIsLoading'](![]);const _0x3abb09=[],_0x4ee13f=_0x368c17['map'](_0x48a358=>{if(!(_0x48a358['data']instanceof Error))return _0x48a358;_0x3abb09['push'](_0x48a358['instrument']);const _0x4a3d0e={};return _0x4a3d0e['data']=[],_0x4a3d0e['instrument']=_0x48a358['instrument'],_0x4a3d0e['type']='HISTORICAL',_0x4a3d0e;});return _0x3e6133(_0x3abb09),_0x4ee13f;}));}),share()),_0x3e6133=_0x509200=>{const _0x20710c=_0x509200['filter'](_0x94dcd3=>!_0x319517['has'](_0x94dcd3))['reduce']((_0x149c0e,_0x3619e6,_0x45c327)=>_0x45c327===0x0?''+_0x3619e6:_0x149c0e+',\x20'+_0x3619e6,'');if(_0x20710c){const _0x5c73fc={};_0x5c73fc['displayTime']=0x1388,_0x25fe2e['sendNotification'](_0x405d54['notifications']['notificationInstrumentNoData']+'\x20'+_0x20710c,_0x5c73fc);}_0x509200['forEach'](_0x5d2051=>_0x319517['add'](_0x5d2051));},_0xc86868=pipe(_0x4d3e5b,observable['filter'](_0x32ea48=>pipe(_0x32ea48,array['every'](_0x585d08=>_0x585d08['type']==='HISTORICAL')))),_0x1983f6=pipe(_0x4d3e5b,observable['filter'](_0x3f5b68=>pipe(_0x3f5b68,array['every'](_0x30d87a=>_0x30d87a['type']==='LAZY')))),_0x395f37=pipe(_0x240f96,switchMap(([_0xda2d46,_0x2128f1,_0x459cb1,_0x107e30,_0x1656d1,_0x5f3250])=>_0x2f3032['subscribeLastCandleUpdates']([_0xda2d46['symbol'],...pipe(record['toArray'](_0x459cb1),array['map'](tuple['snd']),array['map'](_0x2c0623=>_0x2c0623['symbol']))],_0x2128f1,filterAvailableDataOptions({'candleAlignment':_0x5f3250,'priceType':_0x1656d1,'extendedHours':_0x107e30,'priceIncrement':lastOf(_0xda2d46['priceIncrements'])},_0x3bfa86)))),_0xfd0e52=_0x3a87f5=>{const _0xb87638=_0x8064c3['getValue'](),_0x1e2e7d=record['has'](_0x3a87f5['symbol'],_0xb87638);if(_0x1e2e7d)return;const _0x4a7d17=_0x1ce448=>{_0x10ca32(_0x1ce448);},_0x5f0af2=pipe(_0xb87638,record['upsertAt'](_0x3a87f5['symbol'],_0x3a87f5)),_0x5b46ad=()=>_0x4a7d17(_0x5f0af2),_0xc0f66d=()=>_0x4a7d17(_0xb87638),_0x2bba8f={};_0x2bba8f['type']='compare_change',_0x2bba8f['redo']=_0x5b46ad,_0x2bba8f['undo']=_0xc0f66d,_0x3612c7['pushAction'](_0x2bba8f);},_0x497513=_0x166c76=>_0xfd0e52({'symbol':_0x166c76}),_0x5738e9=_0x4caec7=>{const _0x56177e={};_0x4caec7['forEach'](_0x5bf0ea=>Object['assign'](_0x56177e,{[_0x5bf0ea]:{'symbol':_0x5bf0ea}})),_0x10ca32(_0x56177e);},_0x3e740d=_0x41f5a4=>{const _0x433da4=_0x244e71=>{_0x10ca32(_0x244e71);},_0xcc597f=_0x8064c3['getValue'](),_0x1fd85e=pipe(_0xcc597f,record['deleteAt'](_0x41f5a4)),_0x1929bc=()=>_0x433da4(_0x1fd85e),_0x2c45a8=()=>_0x433da4(_0xcc597f),_0x25cba0={};_0x25cba0['type']='compare_change',_0x25cba0['redo']=_0x1929bc,_0x25cba0['undo']=_0x2c45a8,_0x3612c7['pushAction'](_0x25cba0);},_0x2eb4ff=_0x1ad26d=>{const _0x50f342=_0xddd2bc['state']['getValue']()['isInstrumentSyncEnabled'],_0x31b6eb=_0x230435['getValue'](),_0x1e73c2=_0x2f792e=>{_0x50f342?_0xddd2bc['setInstrument'](_0x2f792e):_0x14530f(_0x2f792e);},_0x5b8a4d=()=>_0x1e73c2(_0x1ad26d),_0x565e5d=()=>_0x1e73c2(_0x31b6eb),_0x2416f5={};_0x2416f5['type']='instrument_change',_0x2416f5['redo']=_0x5b8a4d,_0x2416f5['undo']=_0x565e5d,_0x3612c7['pushAction'](_0x2416f5);},_0x2634b8=pipe(_0xc86868,withLatestFrom(filterMapOption(_0x105562),_0x8064c3),tap(([_0x316b4a,_0x578702,_0x233d4b])=>pipe(_0x316b4a,array['foldLeft'](constVoid,(_0x57be33,_0x203b61)=>{_0x29214d['chartComponent']['setAllSeries']({'candles':_0x57be33['data']['map'](toCandles),'instrument':instrumentToChartInstrument(_0x578702)},pipe(_0x203b61,array['map'](_0x4a202b=>({'candles':_0x4a202b['data']['map'](toCandles),'instrument':_0x233d4b[_0x4a202b['instrument']]})))),_0x32e483(_0x57be33['data']);})))),_0x45aef5=pipe(_0x1983f6,withLatestFrom(filterMapOption(_0x105562),_0x8064c3),tap(([_0x45f323,_0x463eaf,_0xc9867])=>pipe(_0x45f323,option['fromPredicate'](array['isNonEmpty']),option['fold'](constVoid,_0xca3d77=>pipe(_0xca3d77,nonEmptyArray['matchLeft']((_0x2a91ee,_0x3700e7)=>{_0x29214d['chartComponent']['updateAllSeries']({'candles':_0x2a91ee['data']['map'](toCandles),'instrument':instrumentToChartInstrument(_0x463eaf)},pipe(_0x3700e7,array['map'](_0x477bfd=>({'candles':_0x477bfd['data']['map'](toCandles),'instrument':_0xc9867[_0x477bfd['instrument']]}))));})))))),_0x5b2921=pipe(_0x395f37,withLatestFrom(filterMapOption(_0x105562),_0x8064c3,_0x514e94),observable['filter'](([_0x30a1cc,_0x2f9b57,_0x53f30c,_0x3181cf])=>!array['isEmpty'](_0x3181cf)),observable['map'](([_0x14ae38,_0x394321,_0x1b95aa])=>({'data':_0x14ae38,'instruments':{[_0x394321['symbol']]:_0x394321,..._0x1b95aa}})),observable['filterMap'](({data:{candleData:_0x4e2c97,symbol:_0x441750},instruments:_0x3b995b})=>pipe(_0x3b995b,record['lookup'](_0x441750),option['map'](_0x15b9ff=>({'instrument':_0x15b9ff,'candleData':_0x4e2c97})))),tap(({candleData:_0x500ad4,instrument:_0x44df71})=>{_0x29214d['chartComponent']['updateCandles']([toCandles(_0x500ad4)],_0x44df71['symbol']),_0x4f6986(_0x500ad4);})),_0x5839a7=pipe(filterMapOption(_0x105562),observable['map'](_0x4234da=>_0x4234da['symbol']),distinctUntilChanged(),switchMap(_0x36898b['subscribeServiceData']),tap(_0x1e345e)),_0x4d6989=pipe(_0x29214d['scaleModel']['xChanged'],skip(0x1),observable['filter'](()=>_0x29214d['scaleModel']['xStart']<0x0),debounceTime(0x12c),tap(()=>{if(_0x29214d['scaleModel']['xStart']<0x0){const _0x2739b2=_0x29214d['chartModel']['mainCandleSeries']['dataPoints'][0x0]?.['timestamp'];_0x2739b2&&_0x2f3032['requestMoreHistoryData'](_0x3c0af9,{'toTime':_0x2739b2});}})),_0x3de5ff=pipe(combineLatest([_0x230435,_0x3ae9fd,_0x501b10]),tap(([_0x4637fb,_0x40feda])=>{const _0x1f72b7={};_0x1f72b7['instrument']=_0x4637fb,_0x1f72b7['extendedHours']=_0x40feda,_0xddd2bc['updateLocalChartInfo'](_0x3c0af9,_0x1f72b7);})),_0x1a77af=pipe(_0x230435,observable['filter'](_0x159192=>option['isSome'](_0x159192)),observableOption['chain'](_0x2e9491=>_0xa0afa9['getInstrument'](_0x2e9491)),observableOption['fold'](()=>{const _0x3b327d={};return _0x3b327d['firstRow']='This\x20instrument\x20is\x20not\x20available',_0x29214d['watermarkComponent']['setWaterMarkData'](_0x3b327d),_0x29214d['watermarkComponent']['setWaterMarkVisible'](!![]),pipe(_0x230435['getValue'](),option['fold'](()=>undefined,_0x2803cf=>{const _0x2b2dca=toChartDataSubscriptionKey(_0x2803cf,_0x501b10['getValue'](),{'candleAlignment':_0x5b501e['getValue'](),'priceType':_0x29b90b['getValue'](),'extendedHours':_0x3ae9fd['getValue']()});_0x5f22c9['updateLoadingState'](chartDataID(_0x2b2dca),'done');})),of(option['none']);},_0x1453a4=>{return _0xa33390(option['some'](_0x1453a4)),of(option['some'](_0x1453a4));})),_0x24ee59=pipe(combineLatest([_0xddd2bc['state'],_0x230435]),observable['filter'](([_0x5e3c62])=>_0x5e3c62['isInstrumentSyncEnabled']),observable['map'](([_0x5c03fb])=>_0x5c03fb['lastInstrument']),tap(_0x14530f)),_0x53e297=pipe(_0xc86868,observable['filter'](_0x2c4e5e=>pipe(_0x2c4e5e,array['some'](_0x56612d=>pipe(_0x105562['getValue'](),option['fold'](()=>![],_0x28b64e=>_0x56612d['instrument']===_0x28b64e['symbol']&&_0x56612d['data']['length']===0x0))))),tap(()=>{const _0x495044={};_0x495044['firstRow']='No\x20data\x20available',_0x29214d['watermarkComponent']['setWaterMarkData'](_0x495044),_0x29214d['watermarkComponent']['setWaterMarkVisible'](!![]);})),_0x233cf5=pipe(merge(_0x2634b8,_0x45aef5,_0x5b2921,_0x5839a7,_0x24ee59,_0x3de5ff,_0x4d6989,_0x1a77af,_0x53e297),share()),_0x333702={};return _0x333702['selectedInstrument']=_0x230435,_0x333702['instrument']=_0x105562,_0x333702['compareInstruments']=_0x8064c3,_0x333702['priceType']=_0x29b90b,_0x333702['candlesAlign']=_0x5b501e,_0x333702['extendedHours']=_0x3ae9fd,_0x333702['historicalCandlesUpdated']=_0x514e94,_0x333702['lastCandleUpdated']=_0x53448b,_0x333702['lazyHistoryData']=_0x1983f6,_0x333702['initialHistoryData']=_0xc86868,_0x333702['changeInstrument']=_0x2eb4ff,_0x333702['addCompareInstrument']=_0xfd0e52,_0x333702['removeCompareInstrument']=_0x3e740d,_0x333702['setCompareInstruments']=_0x10ca32,_0x333702['setExtendedHours']=_0x388290,_0x333702['changePriceType']=_0x57f505,_0x333702['changeCandlesAlignment']=_0x5f52a3,_0x333702['serviceData']=_0x4ecfea,_0x333702['addCompareInstrumentFromApi']=_0x497513,_0x333702['setCompareInstrumentsFromApi']=_0x5738e9,sink['newSink'](callTracerProxy('chartDataViewModel',_0x333702),_0x233cf5);});const toCandles=_0x48bb98=>({'hi':_0x48bb98['high'],'lo':_0x48bb98['low'],'open':_0x48bb98['open'],'close':_0x48bb98['close'],'timestamp':_0x48bb98['time'],'volume':_0x48bb98['volume'],'expansion':![],'idx':undefined,'impVolatility':_0x48bb98['impVolatility'],'vwap':_0x48bb98['vwap']}),filterAvailableDataOptions=(_0x19ebbb,_0x2dc8bb)=>({..._0x19ebbb,..._0x2dc8bb['chartDataOptionsSettings']['candlesAlignment']['enabled']&&{'candleAlignment':_0x19ebbb['candleAlignment']},..._0x2dc8bb['chartDataOptionsSettings']['priceType']['enabled']&&{'priceType':_0x19ebbb['priceType']},..._0x2dc8bb['chartDataOptionsSettings']['extendedHours']['enabled']&&{'extendedHours':_0x19ebbb['extendedHours']}});export const instrumentNameOption=_0x508af1=>pipe(_0x508af1,option['map'](_0x4e7852=>_0x4e7852['symbol']));export const takeFirstAvailablePriceType=_0x58a77a=>{return pipe(_0x58a77a,option['fromPredicate'](array['isNonEmpty']),option['fold'](()=>'last',head));};