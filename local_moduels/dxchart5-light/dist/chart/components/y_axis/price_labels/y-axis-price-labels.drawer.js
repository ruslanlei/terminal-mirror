/*
 * Copyright (C) 2002 - 2023 Devexperts LLC
 * This Source Code Form is subject to the terms of the Mozilla Public License, v. 2.0.
 * If a copy of the MPL was not distributed with this file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */
import{CanvasElement as h,CHART_UUID as v,limitYToBounds as u}from"../../../canvas/canvas-bounds-container";import{fillRect as A}from"../../../utils/canvas-drawing-functions.utils";import{drawLabel as b}from"./price-label.drawer";export class YAxisPriceLabelsDrawer{constructor(o,t,l,a,i,n){this.labelsProvider=o,this.yAxisLabelsCanvasModel=t,this.yAxisState=l,this.canvasBoundsContainer=a,this.yAxisColors=i,this.customLabels=n}draw(){const o=this.yAxisLabelsCanvasModel.ctx,t=this.canvasBoundsContainer.getBounds(h.PANE_UUID_Y_AXIS(v));this.drawHighlightedBackgroundBetweenLabels(t),this.labelsProvider().forEach(a=>{var i;const n=(i=a.bounds)!==null&&i!==void 0?i:t;a.labels.forEach(d=>b(o,n,d,this.canvasBoundsContainer,this.yAxisState,this.yAxisColors))}),Object.values(this.customLabels).forEach(a=>b(o,t,a,this.canvasBoundsContainer,this.yAxisState,this.yAxisColors))}drawHighlightedBackgroundBetweenLabels(o){const t=this.yAxisLabelsCanvasModel.ctx,l=[],i=this.labelsProvider().reduce((r,e)=>r.concat(e.labels),l),n={},d=i.reduce((r,e)=>{if(e.subGroupId){let s=r[e.subGroupId];s||(s=[],r[e.subGroupId]=s),s.push(e)}return r},n);Object.keys(d).forEach(r=>{var e;const s=d[r];if(s.length===2){const c=this.canvasBoundsContainer.getBounds(h.Y_AXIS);t.save(),t.fillStyle=(e=s[0].highlightColor)!==null&&e!==void 0?e:s[0].bgColor;const[x,y]=s[0].y>s[1].y?[s[1].y,s[0].y]:[s[0].y,s[1].y];A(t,{x:c.x,y:u(x,o)},{x:c.x+c.width-6,y:u(y,o)}),t.restore()}})}getCanvasIds(){return[this.yAxisLabelsCanvasModel.canvasId]}}
