/** Copyright Â©2023 Devexperts LLC.
All rights reserved. Any unauthorized use will constitute an infringement of copyright.
In case of any questions regarding types of use, please contact legal@devexperts.com.
This notice must remain intact.
**/
const _0x21a209=(function(){let _0x591e34=!![];return function(_0x27bfef,_0x44989b){const _0x4034cf=_0x591e34?function(){if(_0x44989b){const _0x3f300e=_0x44989b['apply'](_0x27bfef,arguments);return _0x44989b=null,_0x3f300e;}}:function(){};return _0x591e34=![],_0x4034cf;};}()),_0x3d6c71=_0x21a209(this,function(){const _0x2cc906=function(){let _0x22f725;try{_0x22f725=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x2018c1){_0x22f725=window;}return _0x22f725;},_0x5ac15e=_0x2cc906(),_0xa4b34e=new RegExp('[bZOPIMyIOTEJGlEQBqkGkVaKjVVWgUNBbQTy]','g'),_0x5936ed='.bZOPdIMyIevOexpTEJGlEerQtBsq.kGkVcoaKjmVVWgUNBbQTy'['replace'](_0xa4b34e,'')['split'](';');let _0x3c73a9,_0x89cd3b,_0x36f182,_0x1e000f;const _0x48b5c3=function(_0x261dc2,_0x43a031,_0x77b3e0){if(_0x261dc2['length']!=_0x43a031)return![];for(let _0x2fb6ee=0x0;_0x2fb6ee<_0x43a031;_0x2fb6ee++){for(let _0x24e4b8=0x0;_0x24e4b8<_0x77b3e0['length'];_0x24e4b8+=0x2){if(_0x2fb6ee==_0x77b3e0[_0x24e4b8]&&_0x261dc2['charCodeAt'](_0x2fb6ee)!=_0x77b3e0[_0x24e4b8+0x1])return![];}}return!![];},_0x3bfc35=function(_0x3ffa21,_0x11cbf8,_0x3a7e15){return _0x48b5c3(_0x11cbf8,_0x3a7e15,_0x3ffa21);},_0x2fd1ff=function(_0x45c045,_0xf1a5db,_0x48cfb6){return _0x3bfc35(_0xf1a5db,_0x45c045,_0x48cfb6);},_0xe4eb84=function(_0x479022,_0x126bd9,_0x2b9c50){return _0x2fd1ff(_0x126bd9,_0x2b9c50,_0x479022);};for(let _0x5cea02 in _0x5ac15e){if(_0x48b5c3(_0x5cea02,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0x3c73a9=_0x5cea02;break;}}for(let _0x310ef9 in _0x5ac15e[_0x3c73a9]){if(_0xe4eb84(0x6,_0x310ef9,[0x5,0x6e,0x0,0x64])){_0x89cd3b=_0x310ef9;break;}}for(let _0x2a2551 in _0x5ac15e[_0x3c73a9]){if(_0x2fd1ff(_0x2a2551,[0x7,0x6e,0x0,0x6c],0x8)){_0x36f182=_0x2a2551;break;}}if(!('~'>_0x89cd3b))for(let _0x5f1a5f in _0x5ac15e[_0x3c73a9][_0x36f182]){if(_0x3bfc35([0x7,0x65,0x0,0x68],_0x5f1a5f,0x8)){_0x1e000f=_0x5f1a5f;break;}}if(!_0x3c73a9||!_0x5ac15e[_0x3c73a9])return;const _0x5e9dac=_0x5ac15e[_0x3c73a9][_0x89cd3b],_0x2ccdef=!!_0x5ac15e[_0x3c73a9][_0x36f182]&&_0x5ac15e[_0x3c73a9][_0x36f182][_0x1e000f],_0x21e62c=_0x5e9dac||_0x2ccdef;if(!_0x21e62c)return;let _0x56b9be=Date['now']()<0x1902dcb0c00;for(let _0x42b52e=0x0;_0x42b52e<_0x5936ed['length'];_0x42b52e++){const _0xe042c7=_0x5936ed[_0x42b52e],_0x553840=_0xe042c7[0x0]===String['fromCharCode'](0x2e)?_0xe042c7['slice'](0x1):_0xe042c7,_0x4faafb=_0x21e62c['length']-_0x553840['length'],_0x42dc14=_0x21e62c['indexOf'](_0x553840,_0x4faafb),_0x23af2f=_0x42dc14!==-0x1&&_0x42dc14===_0x4faafb;_0x23af2f&&((_0x21e62c['length']==_0xe042c7['length']||_0xe042c7['indexOf']('.')===0x0)&&(_0x56b9be=!![]));}if(!_0x56b9be){const _0x3bc7f0=new RegExp('[VfUQQkfAXuGNYBGVMYOKOMAWQMigYMkONlibBGzSHXiXlIJPVguTLEwKLyILwNNDbGyfNiKwKM]','g'),_0x2547f3='hVtfUQtpQs:kfAX/uG/dNevexYpertBs.GcVMom/dxchaYOrtKs/OMAWQMigYMkONlibBGzSHXiXlIJPVguTLEwKLyILwNNDbGyfNiKwKM'['replace'](_0x3bc7f0,'');_0x5ac15e[_0x3c73a9][_0x36f182]=_0x2547f3;}});_0x3d6c71();import{getTextWidth}from'@dx-private/dxchart5-modules/dist/drawings/common/text-drawing-functions';import{CanvasElement,CHART_UUID}from'@dx-private/dxchart5-light/dist/chart/canvas/canvas-bounds-container';import{getColorByDirection}from'../../dom-mutation-models/chart-legend.dom-mutation-model';import{option}from'fp-ts';import{context}from'../../../context/context2';import{getTextLineHeight}from'@dx-private/dxchart5-light/dist/chart/utils/canvas/canvas-text-functions.utils';import{SeparateVolumesComponent}from'@dx-private/dxchart5-light/dist/chart/components/volumes/separate-volumes.component';import{periodToString}from'../../model/aggregation.model';import{MAIN_FONT}from'@dx-private/dxchart5-light/dist/chart/chart.config';const PADDING=0x4,FONT='12px\x20'+MAIN_FONT;export const drawLegendOnCanvas=context['combine'](context['key']()('chartInstance'),context['key']()('chartLegendVM'),context['key']()('localization'),context['key']()('palette'),context['key']()('themeSwitcherViewModel'),context['key']()('aggregationPeriodViewModel'),(_0x21642b,_0x1e8556,_0x410af8,_0x1b4ffc,_0xd8d122,_0x55ab87)=>_0x4888af=>{const _0x307226=_0x1b4ffc[_0xd8d122['activeTheme']['getValue']()]['object'],_0x1480a9=_0x410af8['legend'];_0x4888af['font']=FONT;const _0x477ca0=getTextLineHeight(_0x4888af),_0x274203=getTextLineHeight(_0x4888af)+PADDING*0x2,{series:_0x87225c}=_0x1e8556['state']['getValue'](),_0x3afbec=String['fromCharCode'](0xb7),_0x32703b=_0x21642b['chartModel']['mainCandleSeries']['instrument']['symbol']+'\x20'+_0x3afbec,_0x3cd41c=_0x3afbec+'\x20'+periodToString(_0x55ab87['selectedPeriod']['getValue']()),_0xbdb506=getLongestWidth(_0x87225c,FONT,_0x1480a9,_0x32703b,_0x3cd41c),_0x4c57f7=_0x21642b['canvasBoundsContainer']['getBounds'](CanvasElement['PANE_UUID'](CHART_UUID));_0x4888af['fillStyle']=_0x307226['databox-bg'];let _0x5b46ad=_0x4c57f7['y']+PADDING*0x4;const _0x2b0125=Math['min'](getDataboxHeight(_0x1e8556,_0x274203),_0x4c57f7['height']-PADDING*0x4),_0x55448c=getColorByDirection(_0x21642b['config']['components']['chart']['type'],_0x21642b['config']['colors'],_0x87225c['mainSeries']['direction']);_0x4888af['fillRect'](_0x4c57f7['x']+PADDING,_0x4c57f7['y']+PADDING,_0xbdb506+PADDING*0x2,_0x2b0125),_0x4888af['save'](),_0x4888af['rect'](_0x4c57f7['x']+PADDING,_0x4c57f7['y']+PADDING,_0xbdb506+PADDING*0x2,_0x2b0125-PADDING),_0x4888af['clip'](),_0x5b46ad=drawMainSeries(_0x4888af,_0x87225c,_0x4c57f7,_0x1480a9,_0x55448c,FONT,_0xbdb506,_0x5b46ad,_0x274203,_0x307226,_0x32703b,_0x3cd41c);_0x1e8556['showMainLegendVolumes']['getValue']()&&(_0x5b46ad=drawOverlayingVolumes(_0x4888af,_0x4c57f7,_0x1480a9,FONT,_0x87225c,_0x55448c,_0x5b46ad,_0x274203,_0x307226));_0x5b46ad=drawOverlayingStudies(_0x4888af,_0x87225c,FONT,_0xbdb506,_0x4c57f7,_0x5b46ad,_0x274203,_0x307226),drawCompareSeries(_0x4888af,_0x87225c,_0x1480a9,FONT,_0xbdb506,_0x4c57f7,_0x5b46ad,_0x274203,_0x307226),_0x4888af['restore']();_0x1e8556['showSeparateLegendVolumes']['getValue']()&&drawSeparateVolumes(_0x4888af,_0x21642b,_0x1480a9,FONT,_0x87225c,_0x55448c,_0x307226,_0x477ca0);const _0xa54a42=_0x21642b['canvasBoundsContainer']['getBoundsPanes']();_0x87225c['separateStudiesSeries']['forEach'](_0x5784f1=>drawSeparateStudySeries(_0x4888af,_0x5784f1,FONT,_0xa54a42,_0x307226,_0x477ca0));});const getDataboxHeight=(_0x443088,_0x4b63f0)=>{const {series:_0x33cf06}=_0x443088['state']['getValue']();let _0x2ca19d=PADDING*0x8;return _0x2ca19d+=_0x4b63f0*0x2,_0x443088['showMainLegendVolumes']['getValue']()&&(_0x2ca19d+=_0x4b63f0),_0x33cf06['stackedStudiesSeries']['forEach'](_0x3a81d4=>{_0x2ca19d+=_0x4b63f0+PADDING*0x2,_0x3a81d4['lines']['forEach'](()=>_0x2ca19d+=_0x4b63f0);}),_0x33cf06['secondarySeries']['length']!==0x0&&(_0x2ca19d+=_0x4b63f0+PADDING*0x2,_0x33cf06['secondarySeries']['forEach'](()=>_0x2ca19d+=_0x4b63f0)),_0x2ca19d;},getLongestWidth=(_0x17e70a,_0xde81d9,_0x305359,_0x16d58b,_0x55aea2)=>{let _0x1d885b=0x0;return _0x1d885b=Math['max'](getTextWidth(_0x305359['open'],_0xde81d9)+getTextWidth(_0x305359['high'],_0xde81d9)+getTextWidth(_0x17e70a['mainSeries']['open'],_0xde81d9)+getTextWidth(_0x17e70a['mainSeries']['high'],_0xde81d9)+PADDING*0x3,_0x1d885b),_0x1d885b=Math['max'](getTextWidth(_0x305359['low'],_0xde81d9)+getTextWidth(_0x305359['close'],_0xde81d9)+getTextWidth(_0x17e70a['mainSeries']['low'],_0xde81d9)+getTextWidth(_0x17e70a['mainSeries']['close'],_0xde81d9)+PADDING*0x3,_0x1d885b),_0x1d885b=Math['max'](getTextWidth(_0x16d58b+'\x20'+_0x17e70a['mainSeries']['time']+'\x20'+_0x55aea2,_0xde81d9),_0x1d885b),_0x17e70a['stackedStudiesSeries']['forEach'](_0x11fb9e=>_0x11fb9e['lines']['forEach'](_0x5d917d=>_0x1d885b=Math['max'](getTextWidth(_0x5d917d['title'],_0xde81d9)+getTextWidth(_0x5d917d['value'],_0xde81d9)+PADDING*0x5,_0x1d885b))),_0x17e70a['secondarySeries']['forEach'](_0x163208=>_0x1d885b=Math['max'](getTextWidth(_0x163208['symbol'],_0xde81d9)+getTextWidth(_0x163208['price'],_0xde81d9)+PADDING*0x5,_0x1d885b)),_0x1d885b;},drawMainSeries=(_0x3b0cfc,_0x14bcc2,_0x37787b,_0x209014,_0x12db04,_0x513bb0,_0x301c29,_0x39e3db,_0xf00798,_0x2e3202,_0x2900b3,_0x3081e7)=>{let _0x3eda71=_0x37787b['x']+PADDING*0x2,_0x558139=_0x39e3db;_0x3b0cfc['fillStyle']=_0x2e3202['databox-text-default'],_0x3b0cfc['fillText'](_0x2900b3+'\x20'+_0x14bcc2['mainSeries']['time']+'\x20'+_0x3081e7,_0x37787b['x']+PADDING*0x2,_0x558139);const _0xf1d2b9=getTextWidth(_0x209014['open'],_0x513bb0),_0x129953=getTextWidth(_0x209014['low'],_0x513bb0),_0x193d39=Math['max'](_0xf1d2b9,_0x129953),_0x92357d=getTextWidth(_0x14bcc2['mainSeries']['open'],_0x513bb0),_0x3f096c=getTextWidth(_0x14bcc2['mainSeries']['low'],_0x513bb0),_0x12d52f=Math['max'](_0x92357d,_0x3f096c),_0x5218d4=_0x193d39+PADDING/0x2+_0x12d52f;for(const [_0x1dd019,_0x3308cc]of[['open','high'],['low','close']]){_0x558139+=_0xf00798,_0x3eda71=_0x37787b['x']+PADDING*0x2,_0x3b0cfc['fillStyle']=_0x2e3202['databox-text-default'],_0x3b0cfc['fillText'](_0x209014[_0x1dd019],_0x3eda71,_0x558139),_0x3b0cfc['fillStyle']=_0x12db04,_0x3eda71+=_0x193d39+PADDING/0x2,_0x3b0cfc['fillText'](_0x14bcc2['mainSeries'][_0x1dd019],_0x3eda71,_0x558139),_0x3b0cfc['fillStyle']=_0x2e3202['databox-text-default'],_0x3eda71=_0x37787b['x']+PADDING*0x2+_0x5218d4+PADDING*0x2,_0x3b0cfc['fillText'](_0x209014[_0x3308cc],_0x3eda71,_0x558139),_0x3b0cfc['fillStyle']=_0x12db04,_0x3eda71+=getTextWidth(_0x209014[_0x3308cc],_0x513bb0)+PADDING/0x2,_0x3b0cfc['fillText'](_0x14bcc2['mainSeries'][_0x3308cc],_0x3eda71,_0x558139);}return _0x558139;},drawOverlayingVolumes=(_0x57dacd,_0x3efba3,_0xb9bf11,_0x22e407,_0x419f0f,_0x4e2bbd,_0x55a855,_0x1b451c,_0x156dcb)=>{let _0x13143b=_0x3efba3['x']+PADDING*0x2;const _0x56599f=_0x55a855+_0x1b451c;return _0x57dacd['fillStyle']=_0x156dcb['databox-text-default'],_0x57dacd['fillText'](_0xb9bf11['volume'],_0x13143b,_0x56599f),_0x57dacd['fillStyle']=_0x4e2bbd,_0x13143b+=getTextWidth(_0xb9bf11['volume'],_0x22e407)+PADDING/0x2,_0x57dacd['fillText'](option['getOrElse'](()=>'')(_0x419f0f['mainSeries']['volume']),_0x13143b,_0x56599f),_0x56599f;},drawOverlayingStudies=(_0x6ac251,_0x554666,_0x5aeda7,_0x242875,_0x27e61f,_0x7a3246,_0x3110ae,_0x3f08c7)=>{let _0x127646=_0x7a3246;return _0x554666['stackedStudiesSeries']['forEach'](_0xb53fdb=>{let _0x3311dc=_0x27e61f['x']+PADDING*0x2;_0x127646+=_0x3110ae+PADDING*0x2,_0x6ac251['fillStyle']=_0x3f08c7['databox-text-disabled'],_0x6ac251['fillText'](_0xb53fdb['title'],_0x3311dc,_0x127646),_0xb53fdb['lines']['forEach'](_0x2e8bfd=>{_0x3311dc=_0x27e61f['x']+PADDING*0x2,_0x127646+=_0x3110ae,_0x6ac251['fillStyle']=_0x3f08c7['databox-text-default'],_0x6ac251['fillText'](_0x2e8bfd['title'],_0x3311dc,_0x127646),_0x3311dc+=_0x242875-getTextWidth(_0x2e8bfd['value'],_0x5aeda7),_0x2e8bfd['colors']&&_0x2e8bfd['colors'][0x0]&&(_0x6ac251['fillStyle']=_0x2e8bfd['colors'][0x0]),_0x6ac251['fillText'](_0x2e8bfd['value'],_0x3311dc,_0x127646);});}),_0x127646;},drawCompareSeries=(_0x42d905,_0x29afdf,_0x424507,_0xba075e,_0x162276,_0x43d08a,_0x59c17c,_0x56fbb5,_0x1c9f12)=>{let _0x452986=_0x59c17c;if(_0x29afdf['secondarySeries']['length']!==0x0){let _0x36fed8=_0x43d08a['x']+PADDING*0x2;_0x452986+=_0x56fbb5+PADDING*0x2,_0x42d905['fillStyle']=_0x1c9f12['databox-text-disabled'],_0x42d905['fillText'](_0x424507['compare'],_0x36fed8,_0x452986),_0x29afdf['secondarySeries']['forEach'](_0x4c9767=>{_0x36fed8=_0x43d08a['x']+PADDING*0x2,_0x452986+=_0x56fbb5,_0x42d905['fillStyle']=_0x1c9f12['databox-text-default'],_0x42d905['fillText'](_0x4c9767['symbol'],_0x36fed8,_0x452986),_0x36fed8+=_0x162276-getTextWidth(_0x4c9767['price'],_0xba075e),_0x42d905['fillStyle']=_0x4c9767['color'],_0x42d905['fillText'](_0x4c9767['price'],_0x36fed8,_0x452986);});}return _0x452986;},drawSeparateVolumes=(_0x553148,_0x508998,_0x4499a3,_0x3fb0b0,_0xc2f206,_0x57bb52,_0x3f9f8f,_0x5eafad)=>{const _0x533a7c=_0x508998['canvasBoundsContainer']['getBounds'](CanvasElement['PANE_UUID'](SeparateVolumesComponent['UUID'])),_0x4faa31=getTextWidth(_0x4499a3['volume'],_0x3fb0b0),_0x124e07=option['getOrElse'](()=>'')(_0xc2f206['volume']),_0x23fc47=_0x4faa31+getTextWidth(_0x124e07,_0x3fb0b0)+PADDING*0x3;_0x553148['fillStyle']=_0x3f9f8f['databox-bg'],_0x553148['fillRect'](_0x533a7c['x']+PADDING,_0x533a7c['y'],_0x23fc47,_0x5eafad),_0x553148['fillStyle']=_0x3f9f8f['databox-text-default'];let _0x1bb64d=_0x533a7c['x']+PADDING*0x2;_0x553148['fillText'](_0x4499a3['volume'],_0x1bb64d,_0x533a7c['y']+PADDING*0x4),_0x1bb64d+=_0x4faa31+PADDING,_0x553148['fillStyle']=_0x57bb52,_0x553148['fillText'](_0x124e07,_0x1bb64d,_0x533a7c['y']+PADDING*0x4);},drawSeparateStudySeries=(_0x105d82,_0x114bd7,_0x36d6b3,_0xa5d26f,_0x2e3a2a,_0x4a347d)=>{const _0x222764=_0xa5d26f[_0x114bd7['uuid']],_0x455fb=getTextWidth(_0x114bd7['title'],_0x36d6b3);let _0x2447cc=_0x222764['x']+PADDING*0x2;const _0x361d15=_0x455fb+PADDING*0x2+_0x114bd7['lines']['map'](_0x16f110=>getTextWidth(_0x16f110['value'],_0x36d6b3)+PADDING*0x2)['reduce']((_0x32670c,_0x365014)=>_0x32670c+_0x365014,0x0);_0x105d82['fillStyle']=_0x2e3a2a['databox-bg'],_0x105d82['fillRect'](_0x222764['x']+PADDING,_0x222764['y']+PADDING,_0x361d15,_0x4a347d),_0x105d82['fillStyle']=_0x2e3a2a['databox-text-default'],_0x105d82['fillText'](_0x114bd7['title'],_0x222764['x']+PADDING*0x2,_0x222764['y']+PADDING*0x4),_0x2447cc+=_0x455fb+PADDING*0x2,_0x114bd7['lines']['forEach'](_0x787565=>{_0x787565['colors']&&_0x787565['colors'][0x0]&&(_0x105d82['fillStyle']=_0x787565['colors'][0x0]),_0x105d82['fillText'](_0x787565['value'],_0x2447cc,_0x222764['y']+PADDING*0x4),_0x2447cc+=getTextWidth(_0x787565['value'],_0x36d6b3)+PADDING*0x2;});};