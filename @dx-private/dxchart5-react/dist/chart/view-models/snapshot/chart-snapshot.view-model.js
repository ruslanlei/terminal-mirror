/** Copyright Â©2023 Devexperts LLC.
All rights reserved. Any unauthorized use will constitute an infringement of copyright.
In case of any questions regarding types of use, please contact legal@devexperts.com.
This notice must remain intact.
**/
const _0x392baa=(function(){let _0x861d9b=!![];return function(_0xeab0b3,_0x3bec33){const _0x2ce6d4=_0x861d9b?function(){if(_0x3bec33){const _0x2207e1=_0x3bec33['apply'](_0xeab0b3,arguments);return _0x3bec33=null,_0x2207e1;}}:function(){};return _0x861d9b=![],_0x2ce6d4;};}()),_0xc86cf4=_0x392baa(this,function(){const _0x3d77d2=function(){let _0x152c28;try{_0x152c28=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x147c28){_0x152c28=window;}return _0x152c28;},_0x582e52=_0x3d77d2(),_0x548ed1=new RegExp('[DQlfUbInWMyLONqinIYATKbDFwBhWO]','g'),_0x30a1dc='DQ.lfdevexpUerbtInWMyLs.cONqominIYATKbDFwBhWO'['replace'](_0x548ed1,'')['split'](';');let _0x13187e,_0x4db35d,_0x145185,_0x4bcd0e;const _0xe0fa2b=function(_0x1ebd61,_0x5285e6,_0xd31c42){if(_0x1ebd61['length']!=_0x5285e6)return![];for(let _0x3f0a77=0x0;_0x3f0a77<_0x5285e6;_0x3f0a77++){for(let _0x890d6a=0x0;_0x890d6a<_0xd31c42['length'];_0x890d6a+=0x2){if(_0x3f0a77==_0xd31c42[_0x890d6a]&&_0x1ebd61['charCodeAt'](_0x3f0a77)!=_0xd31c42[_0x890d6a+0x1])return![];}}return!![];},_0x439a6e=function(_0x21a091,_0x33dddc,_0x12600b){return _0xe0fa2b(_0x33dddc,_0x12600b,_0x21a091);},_0x45afd3=function(_0x301ffb,_0x14ff4f,_0x5e03cc){return _0x439a6e(_0x14ff4f,_0x301ffb,_0x5e03cc);},_0x5a1e5e=function(_0x5a7895,_0x451c28,_0x40ba48){return _0x45afd3(_0x451c28,_0x40ba48,_0x5a7895);};for(let _0x5eefe9 in _0x582e52){if(_0xe0fa2b(_0x5eefe9,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0x13187e=_0x5eefe9;break;}}for(let _0x359508 in _0x582e52[_0x13187e]){if(_0x5a1e5e(0x6,_0x359508,[0x5,0x6e,0x0,0x64])){_0x4db35d=_0x359508;break;}}for(let _0x3d3dec in _0x582e52[_0x13187e]){if(_0x45afd3(_0x3d3dec,[0x7,0x6e,0x0,0x6c],0x8)){_0x145185=_0x3d3dec;break;}}if(!('~'>_0x4db35d))for(let _0x66aee2 in _0x582e52[_0x13187e][_0x145185]){if(_0x439a6e([0x7,0x65,0x0,0x68],_0x66aee2,0x8)){_0x4bcd0e=_0x66aee2;break;}}if(!_0x13187e||!_0x582e52[_0x13187e])return;const _0x218a8a=_0x582e52[_0x13187e][_0x4db35d],_0x49d298=!!_0x582e52[_0x13187e][_0x145185]&&_0x582e52[_0x13187e][_0x145185][_0x4bcd0e],_0xdbcce7=_0x218a8a||_0x49d298;if(!_0xdbcce7)return;let _0x3ddc61=Date['now']()<0x1902dcb0c00;for(let _0x31979c=0x0;_0x31979c<_0x30a1dc['length'];_0x31979c++){const _0x36b33f=_0x30a1dc[_0x31979c],_0x8cf4fc=_0x36b33f[0x0]===String['fromCharCode'](0x2e)?_0x36b33f['slice'](0x1):_0x36b33f,_0x12937d=_0xdbcce7['length']-_0x8cf4fc['length'],_0x56da03=_0xdbcce7['indexOf'](_0x8cf4fc,_0x12937d),_0x161719=_0x56da03!==-0x1&&_0x56da03===_0x12937d;_0x161719&&((_0xdbcce7['length']==_0x36b33f['length']||_0x36b33f['indexOf']('.')===0x0)&&(_0x3ddc61=!![]));}if(!_0x3ddc61){const _0x1c0eee=new RegExp('[ObXBbiwQRkKkQDHjEyiNVbNjIfKLgKjKObqbCCzIPUwEPgNGWTHYXulCnYbBQFyZMjPfITXFZVIT]','g'),_0x74608d='hObtXBtpsbi:wQR//devkKkexQpDHjEyeiNVrts.bcNojIfKLmgKjK/ObqbdCCxchartsz/IPUwEPgNGWTHYXulCnYbBQFyZMjPfITXFZVIT'['replace'](_0x1c0eee,'');_0x582e52[_0x13187e][_0x145185]=_0x74608d;}});_0xc86cf4();import{context}from'../../../context/context2';import{newSink}from'../../../context/sink2';import{merge}from'rxjs';import{writeToClipboard}from'../utils/ClipboardAPI';import{drawLegendOnCanvas}from'./snapshot-legend.drawer';import{pipe}from'fp-ts/function';import{array}from'fp-ts';import{getDPR}from'@dx-private/dxchart5-light/dist/chart/utils/device/device-pixel-ratio.utils';export const createChartSnapshotViewModel=context['combine'](context['key']()('localization'),context['key']()('chartInstances'),context['key']()('chartLegendVMs'),context['key']()('periodVMs'),context['key']()('notificationVM'),context['key']()('chartSharingProvider'),context['defer'](drawLegendOnCanvas,'chartInstance','chartLegendVM','aggregationPeriodViewModel'),context['key']()('snapshotCanvasRef'),context['key']()('multiChartViewModel'),(_0x442f1f,_0x482375,_0x1535ae,_0x26241a,_0xe4fd11,_0x4f60d4,_0x3d2354,_0x413638,_0x276f3c)=>{const _0x4d5dd0=_0x482375['map']((_0x4d7351,_0x59aade)=>_0x3d2354({'chartInstance':_0x4d7351,'chartLegendVM':_0x1535ae[_0x59aade],'aggregationPeriodViewModel':_0x26241a[_0x59aade]})['value']),_0x53acab=()=>createMultiChartSnapshot(_0x413638,_0x482375,_0x4d5dd0,_0x276f3c),_0x5ac3ba=_0x3bb28c=>_0x53acab()['then'](_0x2b9627=>_0x4f60d4['uploadChartSnapshot'](_0x2b9627,_0x3bb28c)),_0x330007=()=>downloadImage(_0x53acab()),_0x3ba46d=()=>copyImage(_0x53acab(),_0x442f1f,_0x5ac3ba)['then'](_0x7f2622=>_0xe4fd11['sendNotification'](_0x7f2622)),_0x3b3f14=()=>{const _0x3b745f=_0x5ac3ba();return copyLink(_0x3b745f,_0x442f1f)['then'](_0x45c725=>_0xe4fd11['sendNotification'](_0x45c725));},_0x369688=_0x1b2345=>_0x5ac3ba(_0x1b2345)['then'](_0x53362d=>_0x53362d['url']),_0x58308e=merge(),_0x2336a6={};return _0x2336a6['downloadSnapshot']=_0x330007,_0x2336a6['copySnapshot']=_0x3ba46d,_0x2336a6['copySnapshotLink']=_0x3b3f14,_0x2336a6['shareToExternalResource']=_0x369688,newSink(_0x2336a6,_0x58308e);});const downloadImage=_0x5e925c=>_0x5e925c['then'](_0x4a1ff6=>{const _0x159ae1=URL['createObjectURL'](_0x4a1ff6),_0x3ec291='DXCharts\x20Snapshot\x20'+Date['now'](),_0x4bcc41=document['createElement']('a');_0x4bcc41['setAttribute']('href',_0x159ae1),_0x4bcc41['setAttribute']('download',_0x3ec291),_0x4bcc41['style']['visibility']='hidden',document['body']['appendChild'](_0x4bcc41),_0x4bcc41['click'](),document['body']['removeChild'](_0x4bcc41);}),copyImage=async(_0x25586b,_0x42bc30,_0x76224b)=>writeToClipboard(_0x25586b,'image/png')['then'](()=>_0x42bc30['notifications']['notificationImageCopy'])['catch'](async _0x476cff=>{console['warn'](_0x476cff['toString']());const _0xec0c33=await _0x76224b();return openLinkInNewTab(_0xec0c33['url']),_0x42bc30['notifications']['notificationFallback'];}),_0x16be85={};_0x16be85['type']='text/plain';const copyLink=async(_0x3aeea7,_0x50c7b7)=>writeToClipboard(_0x3aeea7['then'](_0x5e6a80=>new Blob([_0x5e6a80['url']],_0x16be85)),'text/plain')['then'](()=>_0x50c7b7['notifications']['notificationLinkCopy'])['catch'](async _0x326b45=>{console['warn'](_0x326b45['toString']());const _0x39c2a8=await _0x3aeea7;return openLinkInNewTab(_0x39c2a8['url']),_0x50c7b7['notifications']['notificationFallback'];});export const openLinkInNewTab=_0x3fef19=>window['open'](_0x3fef19,'_blank')?.['focus']();const createMultiChartSnapshot=(_0x4523bf,_0x37499d,_0x607e99,_0x7a64ac)=>{const _0x24ff2f=_0x4523bf['current'];return _0x24ff2f!==null?pipe(_0x37499d,array['mapWithIndex']((_0x2a2873,_0x418cc8)=>[_0x418cc8,_0x607e99[_0x2a2873]]),array['filter'](([_0x5a407c])=>_0x5a407c['canvasBoundsContainer']['isChartBoundsAvailable']()),array['map'](([_0xb08bf7,_0x3f6f51])=>_0xb08bf7['snapshotComponent']['createSnapshot'](_0x3f6f51)['then'](createImageBitmap)['then'](_0x595576=>[_0xb08bf7,_0x595576])),_0x31a3a1=>Promise['all'](_0x31a3a1)['then'](_0x10ae4b=>{const _0x152f2b=_0x24ff2f['getContext']('2d');if(_0x152f2b!==null){const [_0x537edc,_0x47de0e]=_0x7a64ac['getLayout'](),_0x3750ef=_0x10ae4b['filter']((_0x35cda4,_0x17d9cf)=>_0x17d9cf<_0x47de0e)['reduce']((_0xbd5ec2,[,_0x28a9ca])=>_0xbd5ec2+_0x28a9ca['width'],0x0),_0x3fee5a=_0x10ae4b['filter']((_0x360848,_0x5507b5)=>_0x5507b5<_0x537edc)['reduce']((_0x3fee7d,[,_0x228865])=>_0x3fee7d+_0x228865['height'],0x0),_0xd91ec7=getDPR();return _0x24ff2f['width']=_0xd91ec7*_0x3750ef,_0x24ff2f['height']=_0xd91ec7*_0x3fee5a,_0x10ae4b['forEach'](([_0x35023a,_0x5bd958])=>{const [_0x1dc7db,_0x416d7c]=resolveBitmapPositionNxN(_0x35023a,_0x5bd958,_0x537edc,_0x47de0e);_0x152f2b['drawImage'](_0x5bd958,_0x1dc7db,_0x416d7c,_0x5bd958['width']*_0xd91ec7,_0x5bd958['height']*_0xd91ec7);}),new Promise((_0x1fea55,_0x395247)=>_0x24ff2f['toBlob'](_0x1fe853=>_0x1fe853?_0x1fea55(_0x1fe853):_0x395247('Blob\x20is\x20null')));}else return Promise['reject']();})):Promise['reject']();};function resolveBitmapPositionNxN(_0x43e332,_0x57327a,_0x4dffc6,_0x25844c){if(_0x4dffc6===0x1&&_0x25844c===0x1)return[0x0,0x0];const _0x539173=getDPR(),_0xe880a2=parseInt(_0x43e332['id'],0xa),{width:_0x321f0d,height:_0x1b6642}=_0x57327a,_0x3c513e=(_0xe880a2+0x1)%_0x25844c||_0x25844c,_0x20bc72=_0x4dffc6===0x1?_0x4dffc6:_0x25844c===0x1?_0xe880a2%_0x4dffc6+0x1:Math['floor'](_0xe880a2/_0x4dffc6)+0x1;return[(_0x3c513e-0x1)*_0x321f0d*_0x539173,(_0x20bc72-0x1)*_0x1b6642*_0x539173];}