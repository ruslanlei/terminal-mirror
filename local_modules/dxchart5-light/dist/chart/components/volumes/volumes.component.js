/*
 * Copyright (C) 2002 - 2023 Devexperts LLC
 * This Source Code Form is subject to the terms of the Mozilla Public License, v. 2.0.
 * If a copy of the MPL was not distributed with this file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */
import{ChartBaseElement as u}from"../../chart-base-element";import{SeparateVolumesComponent as h}from"./separate-volumes.component";import{resolveColorForBar as p,resolveColorForCandle as n,resolveColorForLine as v}from"./volume-color-resolvers.functions";import{VolumesDrawer as V}from"./volumes.drawer";import{VolumesModel as C}from"./volumes.model";export class VolumesComponent extends u{constructor(e,o,r,a,l,s,i){super(),this.canvasModel=e,this.canvasBoundsContainer=a,this.config=s,this.volumesColorByChartTypeMap={};const t=new C(o,r);this.addChildEntity(t),this.separateVolumes=new h(e,o,l,s,t,this.volumesColorByChartTypeMap,i),this.addChildEntity(this.separateVolumes);const m=new V(e,s,t,o.chartModel,r,this.volumesColorByChartTypeMap,()=>!s.components.volumes.showSeparately);l.addDrawer(m,"VOLUMES"),this.registerDefaultVolumeColorResolvers()}registerDefaultVolumeColorResolvers(){this.registerVolumeColorResolver("candle",n),this.registerVolumeColorResolver("line",v),this.registerVolumeColorResolver("bar",p)}setShowVolumesSeparatly(e){this.config.components.volumes.showSeparately!==e&&(this.config.components.volumes.showSeparately=e,e?this.separateVolumes.activateSeparateVolumes():this.separateVolumes.deactiveSeparateVolumes())}doDeactivate(){super.doDeactivate(),this.setVisible(!1)}registerVolumeColorResolver(e,o){this.volumesColorByChartTypeMap[e]=o}setVisible(e=!0){this.config.components.volumes.visible=e,this.config.components.volumes.showSeparately===!0&&(e?this.separateVolumes.activateSeparateVolumes():this.separateVolumes.deactiveSeparateVolumes()),this.canvasBoundsContainer.recalculatePanesHeightRatios(),this.canvasModel.fireDraw()}}
