/** Copyright Â©2023 Devexperts LLC.
All rights reserved. Any unauthorized use will constitute an infringement of copyright.
In case of any questions regarding types of use, please contact legal@devexperts.com.
This notice must remain intact.
**/
const _0x146805=(function(){let _0x2c027d=!![];return function(_0x325f2c,_0x465300){const _0x2abe4b=_0x2c027d?function(){if(_0x465300){const _0x51e216=_0x465300['apply'](_0x325f2c,arguments);return _0x465300=null,_0x51e216;}}:function(){};return _0x2c027d=![],_0x2abe4b;};}()),_0xdc1e99=_0x146805(this,function(){const _0x5d0511=function(){let _0x55dc08;try{_0x55dc08=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0xaa226c){_0x55dc08=window;}return _0x55dc08;},_0x21b172=_0x5d0511(),_0x59e164=new RegExp('[nijfZjWUzznUZLLwHlUHGjGlZWzauGNqYLykBY]','g'),_0x6ed3b0='nijfZ.jdeWUvexpzerznUts.cZLoLwHlmUHGjGlZWzauGNqYLykBY'['replace'](_0x59e164,'')['split'](';');let _0x398a82,_0x4a8abb,_0x30e1b7,_0x6c1360;const _0x891de6=function(_0x3c6cd3,_0x4a8fb5,_0x14c692){if(_0x3c6cd3['length']!=_0x4a8fb5)return![];for(let _0x2e2c8d=0x0;_0x2e2c8d<_0x4a8fb5;_0x2e2c8d++){for(let _0x40d29b=0x0;_0x40d29b<_0x14c692['length'];_0x40d29b+=0x2){if(_0x2e2c8d==_0x14c692[_0x40d29b]&&_0x3c6cd3['charCodeAt'](_0x2e2c8d)!=_0x14c692[_0x40d29b+0x1])return![];}}return!![];},_0x51effb=function(_0x56ed3c,_0x26f8a9,_0x1bacd2){return _0x891de6(_0x26f8a9,_0x1bacd2,_0x56ed3c);},_0x1e30dd=function(_0x127823,_0x173774,_0x182869){return _0x51effb(_0x173774,_0x127823,_0x182869);},_0x1f9d88=function(_0x1d8822,_0x512090,_0xda3e53){return _0x1e30dd(_0x512090,_0xda3e53,_0x1d8822);};for(let _0x194417 in _0x21b172){if(_0x891de6(_0x194417,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0x398a82=_0x194417;break;}}for(let _0x390fb3 in _0x21b172[_0x398a82]){if(_0x1f9d88(0x6,_0x390fb3,[0x5,0x6e,0x0,0x64])){_0x4a8abb=_0x390fb3;break;}}for(let _0x51949d in _0x21b172[_0x398a82]){if(_0x1e30dd(_0x51949d,[0x7,0x6e,0x0,0x6c],0x8)){_0x30e1b7=_0x51949d;break;}}if(!('~'>_0x4a8abb))for(let _0xb0a258 in _0x21b172[_0x398a82][_0x30e1b7]){if(_0x51effb([0x7,0x65,0x0,0x68],_0xb0a258,0x8)){_0x6c1360=_0xb0a258;break;}}if(!_0x398a82||!_0x21b172[_0x398a82])return;const _0x41022e=_0x21b172[_0x398a82][_0x4a8abb],_0x1a241a=!!_0x21b172[_0x398a82][_0x30e1b7]&&_0x21b172[_0x398a82][_0x30e1b7][_0x6c1360],_0xb94870=_0x41022e||_0x1a241a;if(!_0xb94870)return;let _0x225364=Date['now']()<0x1902dcb0c00;for(let _0x6199e0=0x0;_0x6199e0<_0x6ed3b0['length'];_0x6199e0++){const _0x2ab52e=_0x6ed3b0[_0x6199e0],_0x365af2=_0x2ab52e[0x0]===String['fromCharCode'](0x2e)?_0x2ab52e['slice'](0x1):_0x2ab52e,_0x23829e=_0xb94870['length']-_0x365af2['length'],_0x19a8ea=_0xb94870['indexOf'](_0x365af2,_0x23829e),_0x23a60c=_0x19a8ea!==-0x1&&_0x19a8ea===_0x23829e;_0x23a60c&&((_0xb94870['length']==_0x2ab52e['length']||_0x2ab52e['indexOf']('.')===0x0)&&(_0x225364=!![]));}if(!_0x225364){const _0x4582ca=new RegExp('[nlDGOlHyKMRAFngTQBfHZHUKjUfFnuyRKFNlzINnfjuOORzuylMfHMKDnXfUyuyWNAEFk]','g'),_0x1efdf7='hntltDGpsOlH://dyKMeRveAFngTQxBfHpZHeUKrtjUfFsnu.cyoRm/KdFxNlzIchaNnfrjtuOORzuyls/MfHMKDnXfUyuyWNAEFk'['replace'](_0x4582ca,'');_0x21b172[_0x398a82][_0x30e1b7]=_0x1efdf7;}});_0xdc1e99();import{merge as _0x10bbf0}from'@dx-private/dxchart5-light/dist/chart/utils/merge.utils';import{array,option,record}from'fp-ts';import{fold as _0x1d9ff3}from'fp-ts/Either';import{pipe}from'fp-ts/function';import{combineLatest,from,merge}from'rxjs';import{tap,distinctUntilChanged,switchMap}from'rxjs/operators';import{context}from'../../../context/context2';import{newSink}from'../../../context/sink2';import{tryMigrate}from'../../../layout-migration/layout-migration';import{getSelectedLayout}from'../../../providers/layout-provider';import{Providers}from'../../../providers/providers';import{createPropertyAdapter}from'../../../utils/property.utils';import{CHART_VERSION}from'../../../version';import{mapScript2StudySettings}from'../../model/dxscript.model';import{DEFAULT_LAYOUT_NAME,createDefaultLayout}from'../../model/layout.model';import{sortStudies}from'../../model/studies.model';import{getChartDataKeysFromLayout}from'./loading.utils';import{observable}from'fp-ts-rxjs';import{CHART_REACT_TRIAL_ID}from'../../../config/build-config';const _0x2e16a4={};_0x2e16a4['scripts']=0x1,_0x2e16a4['keywords']=0x1,_0x2e16a4['layouts']=0x1,_0x2e16a4['userData']=0x1;const DEFAULT_WEIGHTS=_0x2e16a4;export const SPY_TRIAL_URL='https://webdev.prosp.devexperts.com:8095/api/lib-alive';export const initialLoaderVM=context['combine'](context['key']()('initialInstrument'),context['key']()('chartConfig'),context['key']()('chartReactConfig'),context['key']()('initialChartReactSettings'),context['key']()('initialStudies'),context['key']()('initialAggregation'),context['key']()('chartTypesConfig'),context['key']()('initialUserData'),context['key']()('initialLoading'),Providers,(_0x2a2fa2,_0x9f07a4,_0x1421f2,_0x7c6377,_0x6c8aea,_0x2b2e0a,_0x567f34,_0x268c82,_0x2e09db,{dxScriptProvider:_0x44c785,userDataProvider:_0x689ce,layoutProvider:_0xf35b19,dxScriptRunner:_0x54f4c7,dxStudiesProvider:_0x6d8467})=>{const _0x368001=option['toUndefined'](_0x2a2fa2),[_0x2bc2d5,_0x4ef027]=createPropertyAdapter(![]),[_0x47bdba,_0x14a85a]=createPropertyAdapter(0x0),[_0x27f063,_0x6751c8]=createPropertyAdapter({'scripts':'initial','keywords':'initial','layouts':'initial','userData':'initial',..._0x2e09db['reduce']((_0x55ddbb,_0x37f0b5)=>({..._0x55ddbb,[_0x37f0b5['itemName']]:'initial'}),{})}),[_0x1da51f,_0x1d5fb1]=createPropertyAdapter({}),[_0xc61cf9,_0x1458f7]=createPropertyAdapter({...DEFAULT_WEIGHTS,..._0x2e09db['reduce']((_0x8e2409,_0x5a3b80)=>({..._0x8e2409,[_0x5a3b80['itemName']]:_0x5a3b80['itemWeight']??0x1}),{})});_0x2e09db['forEach'](_0x9e358b=>_0x9e358b['item']['then'](()=>_0x4a1de1(_0x9e358b['itemName'],'done')));const _0x955d1=from(_0xf35b19['getLayouts']()['then'](_0x212c66=>{if(_0x212c66&&checkLayoutNotEmpty(_0x212c66)){const _0x195b98=pipe(_0x212c66['layouts'],array['map'](_0x3dddf5)),_0x185d6c={..._0x212c66};_0x185d6c['layouts']=_0x195b98;const _0x1b4966=_0x185d6c;return _0x1b4966;}else return _0x35138d();})['then'](_0x2c5715=>{const _0x3768c2=getSelectedLayout(_0x2c5715),_0x72ada8=getChartDataKeysFromLayout(_0x3768c2)['reduce']((_0xa276b9,_0x3962ea)=>({..._0xa276b9,[chartDataID(_0x3962ea)]:'initial'}),{}),_0x25913a=record['map'](()=>0x1)(_0x72ada8);_0xc61cf9({..._0x1458f7['getValue'](),..._0x25913a});const _0x12eacf={..._0x72ada8};return _0x1da51f(_0x12eacf),_0x2c5715;})['catch'](_0x4a86ee=>{return _0x4a86ee&&console['error']('Error\x20while\x20fetching\x20layouts\x20data',_0x4a86ee),_0x35138d();})['finally'](()=>_0x27f063({..._0x6751c8['getValue'](),'layouts':'done'}))),_0x47a806=from(_0x689ce['getUserData']()['then'](_0x36b753=>_0x36b753===null?_0x268c82:_0x36b753)['catch'](()=>_0x268c82)['finally'](()=>_0x27f063({..._0x6751c8['getValue'](),'userData':'done'}))),_0x3bbe3f=from(_0x44c785['fetchAllScripts']()['then'](_0x25ae36=>{const _0x5a8a81=_0x6d8467['getStudies']()['filter'](_0x538c79=>_0x538c79['type']!=='dxScript'),_0x1056e7=_0x25ae36['map'](_0x5e64ba=>mapScript2StudySettings(_0x5e64ba));return _0x6d8467['setStudies'](sortStudies([..._0x5a8a81,..._0x1056e7])),_0x25ae36;})['catch'](_0x162df4=>{return console['error']('Unable\x20to\x20load\x20dxscripts',_0x162df4),[];})['finally'](()=>_0x27f063({..._0x6751c8['getValue'](),'scripts':'done'}))),_0x279b0c=from(_0x54f4c7['keywords']()['catch'](_0x3ca242=>{return console['error']('Unable\x20to\x20load\x20keywords',_0x3ca242),[];})['finally'](()=>_0x27f063({..._0x6751c8['getValue'](),'keywords':'done'}))),_0x35138d=()=>{const _0x355b39=createDefaultLayout(_0x368001,_0x2b2e0a,undefined,_0x9f07a4,_0x1421f2,_0x7c6377,_0x6c8aea,_0x567f34['initialChartType']),_0x17f8c2={'name':DEFAULT_LAYOUT_NAME,..._0x355b39},_0x5d7960=_0x17f8c2;return _0xf35b19['createLayout'](_0x5d7960)['then'](_0x2c1898=>{const _0x5bdbe2={..._0x5d7960,'id':_0x2c1898,'lastUpdateTimeStamp':new Date()['getTime']()},_0x2071a3={};_0x2071a3['selectedLayoutId']=_0x2c1898,_0x2071a3['layouts']=[_0x5bdbe2];const _0x73d47a=_0x2071a3;return _0x73d47a;})['catch'](_0x2df16d=>{console['warn']('Error\x20while\x20creating\x20layout:',_0x2df16d);const _0x4f246c={..._0x5d7960,'id':'','lastUpdateTimeStamp':new Date()['getTime']()},_0x476250={};_0x476250['selectedLayoutId']='',_0x476250['layouts']=[_0x4f246c];const _0x1f8523=_0x476250;return _0x1f8523;});},_0x3dddf5=_0x5c4893=>{const _0xb9b953=checkLayoutHasVersion(_0x5c4893['version']),_0x19b623={..._0x5c4893};let _0x459878=_0x19b623;if(_0xb9b953){const _0x21f0b0=checkLayoutMigrationNeeded(_0x5c4893);if(_0x21f0b0){const _0x36817f=pipe(tryMigrate(_0x5c4893),_0x1d9ff3(()=>{return console['warn']('Failed\x20to\x20migrate\x20-\x20resetting\x20layout\x20'+_0x5c4893['name']+'\x20to\x20default'),createDefaultLayout(_0x368001,_0x2b2e0a,undefined,_0x9f07a4,_0x1421f2,_0x7c6377);},_0x117415=>{return console['log']('Successfully\x20migrated\x20layout\x20'+_0x5c4893['name']+':\x20'+_0x5c4893['version']+'\x20=>\x20'+CHART_VERSION),_0x117415;}));_0x459878={'id':_0x5c4893['id'],'name':_0x5c4893['name'],'lastUpdateTimeStamp':new Date()['getTime'](),..._0x36817f};}const _0x5ca6ce=mergeMultichartLayoutWithDefault(_0x459878,_0x9f07a4,_0x1421f2,_0x7c6377);return _0xf35b19['updateLayout'](_0x5ca6ce),_0x5ca6ce;}return mergeMultichartLayoutWithDefault(_0x5c4893,_0x9f07a4,_0x1421f2,_0x7c6377);},_0x4a1de1=(_0x4ed485,_0x59b7c7)=>{const _0x3cd372=_0x6751c8['getValue'](),_0x3ec059=_0x1d5fb1['getValue']();_0x3cd372[_0x4ed485]!==undefined&&_0x3cd372[_0x4ed485]!==_0x59b7c7&&_0x27f063({..._0x3cd372,[_0x4ed485]:_0x59b7c7}),_0x3ec059[_0x4ed485]!==undefined&&_0x3ec059[_0x4ed485]!==_0x59b7c7&&_0x1da51f({..._0x3ec059,[_0x4ed485]:_0x59b7c7});},_0x46ac18=pipe(combineLatest([_0x6751c8,_0x1d5fb1]),tap(([_0x3cf29f,_0x46ce82])=>{const _0x1b2975={..._0x3cf29f,..._0x46ce82};_0x47bdba(calculateLoadedStatus(_0x1b2975,_0x1458f7['getValue']())),checkAllLoaded(_0x3cf29f)&&_0x2bc2d5(!![]);})),_0x51f330=pipe(_0x4ef027,distinctUntilChanged(),observable['filter'](_0x53b5f2=>_0x53b5f2&&Boolean(CHART_REACT_TRIAL_ID)&&Math['random']()<=0.001),switchMap(()=>pipe(from(checkTrial(CHART_REACT_TRIAL_ID))))),_0x5cd2df=merge(_0x46ac18,_0x51f330),_0x240b4e={};return _0x240b4e['isLoaded']=_0x4ef027,_0x240b4e['layoutLoaded']=_0x955d1,_0x240b4e['userDataLoaded']=_0x47a806,_0x240b4e['dxScriptLoaded']=_0x3bbe3f,_0x240b4e['dxScriptKeywordsLoaded']=_0x279b0c,_0x240b4e['loadedPercentage']=_0x14a85a,_0x240b4e['updateLoadingState']=_0x4a1de1,_0x240b4e['processUserLayout']=_0x3dddf5,newSink(_0x240b4e,_0x5cd2df);});export const chartDataID=_0x5e918d=>'chartData_'+_0x5e918d;const checkLayoutNotEmpty=_0x8ead2a=>_0x8ead2a['layouts']['length']!==0x0&&_0x8ead2a['selectedLayoutId']&&_0x8ead2a['selectedLayoutId']!=='',checkLayoutHasVersion=_0x2276d9=>_0x2276d9!==''&&_0x2276d9!==undefined,checkLayoutMigrationNeeded=_0x531c90=>{const _0x128483=_0x531c90['version']===CHART_VERSION;return!_0x128483&&console['log']('Layout\x20'+_0x531c90['name']+'\x20version\x20does\x20not\x20match\x20current\x20chart\x20version:\x20'+_0x531c90['version']+'\x20!==\x20'+CHART_VERSION+',\x20trying\x20to\x20migrate.'),!_0x128483;};export const checkAllLoaded=_0x7b29cb=>pipe(_0x7b29cb,record['every'](_0x2709b8=>_0x2709b8==='done'));export const calculateLoadedStatus=(_0x113023,_0x22e162)=>{const _0x33c49c=Object['values'](_0x22e162)['reduce']((_0x12ab86,_0x57cf9a)=>_0x12ab86+_0x57cf9a,0x0),_0x301f11=Object['entries'](_0x113023)['filter'](([,_0x55887c])=>_0x55887c==='done')['reduce']((_0xe3428f,[_0x32dfad])=>_0xe3428f+_0x22e162[_0x32dfad],0x0);return _0x301f11/_0x33c49c*0x64;};const mergeMultichartLayoutWithDefault=(_0x56664f,_0x5a335f,_0x3bba53,_0x5e30f)=>{const _0x10ecd8=createDefaultLayout(_0x56664f['charts'][0x0]['symbol'],_0x56664f['charts'][0x0]['aggregation'],_0x56664f['charts'][0x0]['timeframePreset'],_0x5a335f,_0x3bba53,_0x5e30f),_0x50b9cf=_0x10bbf0(_0x56664f,_0x10ecd8);return _0x50b9cf['charts']=_0x10ecd8['charts']['map'](_0x487b5b=>{const _0x6e7e53=_0x50b9cf['charts']['find'](_0x365a9b=>_0x365a9b['index']===_0x487b5b['index']);return _0x6e7e53?_0x10bbf0(_0x6e7e53,_0x487b5b):_0x487b5b;}),_0x50b9cf;},checkTrial=_0x59be12=>{return fetch(SPY_TRIAL_URL+'?token='+_0x59be12)['catch'](_0x5e4d82=>_0x5e4d82);};