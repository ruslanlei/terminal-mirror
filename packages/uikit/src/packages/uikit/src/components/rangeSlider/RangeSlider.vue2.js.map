{"version":3,"file":"RangeSlider.vue2.js","sources":["../../../../../components/rangeSlider/RangeSlider.vue"],"sourcesContent":["<template>\n  <div\n    ref=\"slider\"\n    :class=\"$style.rangeSlider\"\n    @mousedown.prevent=\"onMouseDown\"\n  >\n    <div :class=\"$style.track\" />\n    <div\n      :style=\"computedProgressStyles\"\n      :class=\"[$style.progress, !isDragging && $style.animated]\"\n    />\n    <div\n      :style=\"computedDraggingPointStyles\"\n      :class=\"[$style.pointer, !isDragging && $style.animated]\"\n    />\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport {\n  ref,\n  computed,\n  onMounted,\n  onBeforeUnmount, watch,\n} from 'vue';\nimport {\n  add,\n  divide, divideRight, multiply, roundNumber, subtract, subtractRight,\n} from '@terminal/common/utils/number';\nimport { compose } from '@terminal/common/utils/fp';\nimport { useEnvironmentObserver } from '@/hooks/useEnvironmentObserver';\nimport { useLocalValue } from '@/hooks/useLocalValue';\nimport { awaitFrame } from '@/utils/window';\nimport { getRect } from '@/utils/dom';\nimport { RangeSliderEmits, RangeSliderProps } from './index';\n\nconst props = withDefaults(\n  defineProps<RangeSliderProps>(),\n  {\n    min: 0,\n    max: 100,\n  },\n);\n\nconst emit = defineEmits<RangeSliderEmits>();\n\n// slider\nconst slider = ref();\nconst sliderSizing = ref({\n  beginningLeft: 0,\n  endLeft: 0,\n  width: 0,\n});\n\nconst computedStepSize = computed(() => compose(\n  divide(sliderSizing.value.width),\n  subtractRight,\n)(props.min, props.max));\n\nconst calculateSliderSizing = () => {\n  const {\n    left,\n    width,\n  } = getRect(slider.value);\n\n  sliderSizing.value.beginningLeft = left;\n  sliderSizing.value.endLeft = left + width;\n  sliderSizing.value.width = width;\n};\n\n// calculate value\nconst localValue = useLocalValue<number>(props, emit, 'modelValue');\nconst calculateValueByPosition = (pointerLeft: number) => {\n  localValue.value = compose(\n    roundNumber,\n    add(props.min),\n    divideRight(computedStepSize.value),\n  )(pointerLeft);\n};\n\n// dragging point\nconst activePointLeft = ref(0);\nconst computedDraggingPointStyles = computed(() => ({\n  transform: `translateX(${activePointLeft.value}px)`,\n}));\nconst calculatePositionByValue = () => {\n  activePointLeft.value = multiply(subtract(localValue.value, props.min), computedStepSize.value);\n};\nconst isDragging = ref(false);\nconst onMouseMove = (event: MouseEvent) => {\n  // calculate left relative to container\n  const pointLeft = subtract(event.clientX, sliderSizing.value.beginningLeft);\n  let normalizedPointLeft = pointLeft;\n  if (pointLeft < 0) {\n    normalizedPointLeft = 0;\n  }\n  const distanceToEndOfSlider = subtract(sliderSizing.value.endLeft, event.clientX);\n  if (distanceToEndOfSlider <= 0) {\n    normalizedPointLeft = subtract(sliderSizing.value.endLeft, sliderSizing.value.beginningLeft);\n  }\n\n  activePointLeft.value = normalizedPointLeft;\n\n  calculateValueByPosition(activePointLeft.value);\n};\nwatch(localValue, () => {\n  if (!isDragging.value) {\n    calculatePositionByValue();\n  }\n});\nconst onMouseUp = () => {\n  isDragging.value = false;\n  calculatePositionByValue();\n  window.removeEventListener('mousemove', onMouseMove);\n  window.removeEventListener('mouseup', onMouseUp);\n};\nconst onMouseDown = async (event: MouseEvent) => {\n  calculateSliderSizing();\n  await awaitFrame();\n  isDragging.value = true;\n  onMouseMove(event);\n  window.addEventListener('mousemove', onMouseMove);\n  window.addEventListener('mouseup', onMouseUp);\n};\nonMounted(calculatePositionByValue);\n\n// progress\nconst computedProgressStyles = computed(() => ({\n  width: `${activePointLeft.value}px`,\n}));\n\n// common\nconst {\n  setListeners,\n  removeListeners,\n} = useEnvironmentObserver(slider, () => {\n  calculateSliderSizing();\n  if (!isDragging.value) {\n    calculatePositionByValue();\n  }\n});\nonMounted(() => {\n  calculateSliderSizing();\n  setListeners();\n});\nonBeforeUnmount(removeListeners);\n</script>\n\n<style lang=\"scss\" module>\n@import \"src/assets/styles/utils\";\n\n.rangeSlider {\n  height: 14px;\n  width: 100%;\n  position: relative;\n  display: flex;\n  align-items: center;\n  cursor: pointer;\n}\n\n.track {\n  height: 6px;\n  background-color: rgb(var(--color-background-1));\n  width: 100%;\n  border-radius: 10px;\n}\n\n.progress {\n  height: 6px;\n  background: mainGradient(180deg);\n  position: absolute;\n  left: 0;\n  border-radius: 10px;\n  &.animated {\n    transition: width 200ms;\n  }\n}\n\n.pointer {\n  width: 1px;\n  height: 14px;\n  background-color: red;\n  position: absolute;\n  left: 0;\n  cursor: pointer;\n  &::before {\n    content: '';\n    display: block;\n    position: absolute;\n    width: 14px;\n    height: 14px;\n    background-color: rgb(var(--color-accent-1));\n    border-radius: 50%;\n    transform: translateX(-50%);\n  }\n  &.animated {\n    transition: transform 200ms;\n  }\n}\n</style>\n"],"names":["slider","ref","sliderSizing","computedStepSize","computed","compose","divide","subtractRight","props","calculateSliderSizing","left","width","getRect","localValue","useLocalValue","emit","calculateValueByPosition","pointerLeft","roundNumber","add","divideRight","activePointLeft","computedDraggingPointStyles","calculatePositionByValue","multiply","subtract","isDragging","onMouseMove","event","pointLeft","normalizedPointLeft","watch","onMouseUp","onMouseDown","awaitFrame","onMounted","computedProgressStyles","setListeners","removeListeners","useEnvironmentObserver","onBeforeUnmount"],"mappings":";;;;;;;;;;;;;;;;iBA+CMA,IAASC,KACTC,IAAeD,EAAI;AAAA,MACvB,eAAe;AAAA,MACf,SAAS;AAAA,MACT,OAAO;AAAA,IAAA,CACR,GAEKE,IAAmBC,EAAS,MAAMC;AAAA,MACtCC,EAAOJ,EAAa,MAAM,KAAK;AAAA,MAC/BK;AAAA,IACA,EAAAC,EAAM,KAAKA,EAAM,GAAG,CAAC,GAEjBC,IAAwB,MAAM;AAC5B,YAAA;AAAA,QACJ,MAAAC;AAAA,QACA,OAAAC;AAAA,MAAA,IACEC,EAAQZ,EAAO,KAAK;AAExB,MAAAE,EAAa,MAAM,gBAAgBQ,GACtBR,EAAA,MAAM,UAAUQ,IAAOC,GACpCT,EAAa,MAAM,QAAQS;AAAA,IAAA,GAIvBE,IAAaC,EAAsBN,GAAOO,GAAM,YAAY,GAC5DC,IAA2B,CAACC,MAAwB;AACxD,MAAAJ,EAAW,QAAQR;AAAA,QACjBa;AAAA,QACAC,EAAIX,EAAM,GAAG;AAAA,QACbY,EAAYjB,EAAiB,KAAK;AAAA,QAClCc,CAAW;AAAA,IAAA,GAITI,IAAkBpB,EAAI,CAAC,GACvBqB,IAA8BlB,EAAS,OAAO;AAAA,MAClD,WAAW,cAAciB,EAAgB;AAAA,IACzC,EAAA,GACIE,IAA2B,MAAM;AACrB,MAAAF,EAAA,QAAQG,EAASC,EAASZ,EAAW,OAAOL,EAAM,GAAG,GAAGL,EAAiB,KAAK;AAAA,IAAA,GAE1FuB,IAAazB,EAAI,EAAK,GACtB0B,IAAc,CAACC,MAAsB;AAEzC,YAAMC,IAAYJ,EAASG,EAAM,SAAS1B,EAAa,MAAM,aAAa;AAC1E,UAAI4B,IAAsBD;AAC1B,MAAIA,IAAY,MACQC,IAAA,IAEML,EAASvB,EAAa,MAAM,SAAS0B,EAAM,OAAO,KACnD,MAC3BE,IAAsBL,EAASvB,EAAa,MAAM,SAASA,EAAa,MAAM,aAAa,IAG7FmB,EAAgB,QAAQS,GAExBd,EAAyBK,EAAgB,KAAK;AAAA,IAAA;AAEhD,IAAAU,EAAMlB,GAAY,MAAM;AAClB,MAACa,EAAW,SACWH;IAC3B,CACD;AACD,UAAMS,IAAY,MAAM;AACtB,MAAAN,EAAW,QAAQ,IACMH,KAClB,OAAA,oBAAoB,aAAaI,CAAW,GAC5C,OAAA,oBAAoB,WAAWK,CAAS;AAAA,IAAA,GAE3CC,IAAc,OAAOL,MAAsB;AACzB,MAAAnB,KACtB,MAAMyB,EAAW,GACjBR,EAAW,QAAQ,IACnBC,EAAYC,CAAK,GACV,OAAA,iBAAiB,aAAaD,CAAW,GACzC,OAAA,iBAAiB,WAAWK,CAAS;AAAA,IAAA;AAE9C,IAAAG,EAAUZ,CAAwB;AAG5B,UAAAa,IAAyBhC,EAAS,OAAO;AAAA,MAC7C,OAAO,GAAGiB,EAAgB;AAAA,IAC1B,EAAA,GAGI;AAAA,MACJ,cAAAgB;AAAA,MACA,iBAAAC;AAAA,IAAA,IACEC,EAAuBvC,GAAQ,MAAM;AACjB,MAAAS,KACjBiB,EAAW,SACWH;IAC3B,CACD;AACD,WAAAY,EAAU,MAAM;AACQ,MAAA1B,KACT4B;IAAA,CACd,GACDG,EAAgBF,CAAe;;;;;;;;;;;;;;;;;;;;"}