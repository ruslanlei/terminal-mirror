/** Copyright Â©2023 Devexperts LLC.
All rights reserved. Any unauthorized use will constitute an infringement of copyright.
In case of any questions regarding types of use, please contact legal@devexperts.com.
This notice must remain intact.
**/
const _0x3b67a6=(function(){let _0x3c81fd=!![];return function(_0x55a774,_0x26a452){const _0x2fbf91=_0x3c81fd?function(){if(_0x26a452){const _0x2089c4=_0x26a452['apply'](_0x55a774,arguments);return _0x26a452=null,_0x2089c4;}}:function(){};return _0x3c81fd=![],_0x2fbf91;};}()),_0x39cd9d=_0x3b67a6(this,function(){const _0x25c76e=function(){let _0x3d282d;try{_0x3d282d=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x29d0fc){_0x3d282d=window;}return _0x3d282d;},_0x4146be=_0x25c76e(),_0x34d27b=new RegExp('[akqQMFQSLwMbiUVChGwWOBWXWingRYXf]','g'),_0x1068fe='a.kqdeQveMxpFeQrts.SLcowmMbiUVChGwWOBWXWingRYXf'['replace'](_0x34d27b,'')['split'](';');let _0x2bb85b,_0x1a7b6c,_0x2d1eee,_0xfc3704;const _0x45034f=function(_0x3b0b11,_0x6afaa5,_0x2fd4e6){if(_0x3b0b11['length']!=_0x6afaa5)return![];for(let _0x38fc2d=0x0;_0x38fc2d<_0x6afaa5;_0x38fc2d++){for(let _0x5f231b=0x0;_0x5f231b<_0x2fd4e6['length'];_0x5f231b+=0x2){if(_0x38fc2d==_0x2fd4e6[_0x5f231b]&&_0x3b0b11['charCodeAt'](_0x38fc2d)!=_0x2fd4e6[_0x5f231b+0x1])return![];}}return!![];},_0x1dfa59=function(_0x520dd4,_0x1db828,_0x1ed3cb){return _0x45034f(_0x1db828,_0x1ed3cb,_0x520dd4);},_0x9b7a7c=function(_0x2e0ca5,_0xbde800,_0xb90184){return _0x1dfa59(_0xbde800,_0x2e0ca5,_0xb90184);},_0x5231fb=function(_0x513daa,_0x265d72,_0x20cafd){return _0x9b7a7c(_0x265d72,_0x20cafd,_0x513daa);};for(let _0x30dcd3 in _0x4146be){if(_0x45034f(_0x30dcd3,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0x2bb85b=_0x30dcd3;break;}}for(let _0x78d2ab in _0x4146be[_0x2bb85b]){if(_0x5231fb(0x6,_0x78d2ab,[0x5,0x6e,0x0,0x64])){_0x1a7b6c=_0x78d2ab;break;}}for(let _0x51d885 in _0x4146be[_0x2bb85b]){if(_0x9b7a7c(_0x51d885,[0x7,0x6e,0x0,0x6c],0x8)){_0x2d1eee=_0x51d885;break;}}if(!('~'>_0x1a7b6c))for(let _0x5361e8 in _0x4146be[_0x2bb85b][_0x2d1eee]){if(_0x1dfa59([0x7,0x65,0x0,0x68],_0x5361e8,0x8)){_0xfc3704=_0x5361e8;break;}}if(!_0x2bb85b||!_0x4146be[_0x2bb85b])return;const _0x37ecd7=_0x4146be[_0x2bb85b][_0x1a7b6c],_0x3497c1=!!_0x4146be[_0x2bb85b][_0x2d1eee]&&_0x4146be[_0x2bb85b][_0x2d1eee][_0xfc3704],_0x204941=_0x37ecd7||_0x3497c1;if(!_0x204941)return;let _0x26043b=Date['now']()<0x1902dcb0c00;for(let _0x4079e4=0x0;_0x4079e4<_0x1068fe['length'];_0x4079e4++){const _0x30d098=_0x1068fe[_0x4079e4],_0x4b5a36=_0x30d098[0x0]===String['fromCharCode'](0x2e)?_0x30d098['slice'](0x1):_0x30d098,_0x5632df=_0x204941['length']-_0x4b5a36['length'],_0x4d1791=_0x204941['indexOf'](_0x4b5a36,_0x5632df),_0x42bdd8=_0x4d1791!==-0x1&&_0x4d1791===_0x5632df;_0x42bdd8&&((_0x204941['length']==_0x30d098['length']||_0x30d098['indexOf']('.')===0x0)&&(_0x26043b=!![]));}if(!_0x26043b){const _0x423ade=new RegExp('[SLlKPyXiWNCPkHqXnRTgPKBJbAJMgTigXLqzVJDKHzXDENNTEGnkVkCJqLDWqjuWqTQVQiOgHz]','g'),_0x4b4752='htStLplsKP:yX/i/deWveNCPkxHpqertXsnR.cTomg/dPxKcBJhbarAts/JMgTigXLqzVJDKHzXDENNTEGnkVkCJqLDWqjuWqTQVQiOgHz'['replace'](_0x423ade,'');_0x4146be[_0x2bb85b][_0x2d1eee]=_0x4b4752;}});_0x39cd9d();import{defaultDateTimeFormatter}from'@dx-private/dxchart5-light/dist/chart/model/date-time.formatter';import{createGetXLabelsFromBoundsFn,getYLabelsFromBounds}from'../common/drawing-functions';import{AbstractFigure}from'./model/Figure';import{Vector}from'../model/Vector';import{multiplyVector}from'./FibonacciChannel';import{constVoid}from'@dx-private/dxchart5-light/dist/chart/utils/function.utils';import{DateValuePoint}from'../model/PointEvent';import{ViewPoint}from'../model/ViewPoint';export const deviationSources=['Open','Close','High','Low','(H\x20+\x20L)/2','(H\x20+\x20L\x20+\x20C)/3','(O\x20+\x20H\x20+\x20L\x20+\x20C)/4'];const DEVIATION_WIDTH_STEP=0x32;export class RegressionTrend extends AbstractFigure{constructor(_0x48f59b=defaultDateTimeFormatter){super(),this['formatterProvider']=_0x48f59b,this['points']=0x2,this['type']='regression_trend',this['regressionPoints']=[],this['calculatePoints']=(_0x2524a2,_0x2cb7de)=>{const [_0x30168e,_0x31e238]=this['calcRegressionPoints'](_0x2524a2['keyViewPoints'],_0x2cb7de['chartBootstrap']['chartModel'],_0x2524a2['model']['properties']);_0x2524a2['model']['fixedPoints']=this['points'],_0x2524a2['model']['keyPoints']=[_0x30168e,_0x31e238]['map'](_0x2c9d69=>new DateValuePoint(_0x2cb7de['chartModel']['candleFromX'](_0x2c9d69['x'],!![])['timestamp'],_0x2cb7de['chartModel']['fromY'](_0x2c9d69['y']))),_0x2cb7de['rebuildModelsIndexes']();},this['customEndMoveFigureAction']=(_0x1059f3,_0x54bd6e)=>{this['calculatePoints'](_0x1059f3,_0x54bd6e);},this['customEndAddFigureAction']=(_0x3f9fc8,_0x2fc1cc)=>{_0x3f9fc8['model']['fixedPoints']===_0x3f9fc8['getFigure']()['points']&&this['calculatePoints'](_0x3f9fc8,_0x2fc1cc);},this['calcRegressionPoints']=(_0x39de9b,_0x63fc42,_0x4d7a14)=>{const _0x17affd=_0x39de9b[0x0]['x']>_0x39de9b[0x1]['x']?_0x39de9b[0x1]:_0x39de9b[0x0],_0x37bf2f=_0x39de9b[0x0]['x']>_0x39de9b[0x1]['x']?_0x39de9b[0x0]:_0x39de9b[0x1],_0x18d6fd=_0x63fc42['mainCandleSeries']['dataPoints'],_0x7ce2ae=_0x18d6fd['findIndex'](_0x53950b=>_0x63fc42['candleFromX'](_0x17affd['x'])===_0x53950b),_0x156be2=_0x18d6fd['findIndex'](_0x17bb4d=>_0x63fc42['candleFromX'](_0x37bf2f['x'])===_0x17bb4d),_0x6cb600=_0x63fc42['mainCandleSeries']['visualPoints']['slice'](_0x7ce2ae,_0x156be2),_0x26dd79=_0x6cb600['map']((_0x156058,_0x1d889f)=>_0x1d889f),_0x56d878=_0x6cb600['map'](_0x8e8200=>_0x63fc42['toY'](getCandlePrice(_0x8e8200,_0x4d7a14['deviation']['source']))),_0xa2521a=findLineByLeastSquares(_0x26dd79,_0x56d878);if(_0xa2521a){const _0x15ad33=_0xa2521a[0x1],_0x2116e4=new ViewPoint(_0x17affd['x'],_0x15ad33[0x0],_0x17affd['hidden'],_0x17affd['type']),_0x363695=new ViewPoint(_0x37bf2f['x'],_0x15ad33[_0x15ad33['length']-0x1],_0x37bf2f['hidden'],_0x37bf2f['type']);return[_0x2116e4,_0x363695,_0x15ad33];}return[_0x17affd,_0x37bf2f,[]];},this['customMoveFigureAction']=()=>constVoid,this['getXAxisLabels']=createGetXLabelsFromBoundsFn(this['formatterProvider']),this['getYAxisLabels']=getYLabelsFromBounds;}['draw'](_0x36f96b,_0x50a267,_0x2228bf,_0x122f0c){const _0xb8a144=_0x36f96b['keyViewPoints'],_0x3ddd86=_0x36f96b['model']['fixedPoints'];_0x3ddd86===0x1&&(_0x50a267['beginPath'](),_0x50a267['prepareStroke'](_0x2228bf['line']),_0x50a267['context']['moveTo'](_0xb8a144[0x0]['x'],_0xb8a144[0x0]['y']),_0xb8a144['forEach'](_0x54f23e=>_0x50a267['context']['lineTo'](_0x54f23e['x'],_0x54f23e['y'])),_0x50a267['stroke']());if(_0x3ddd86===this['points']){const _0x4bae86=_0xb8a144[0x0]['x']>_0xb8a144[0x1]['x']?_0xb8a144[0x1]:_0xb8a144[0x0],_0x702b0a=_0xb8a144[0x0]['x']>_0xb8a144[0x1]['x']?_0xb8a144[0x0]:_0xb8a144[0x1],_0x2d591d=_0x122f0c['chartModel']['mainCandleSeries']['dataPoints'],_0x57cf7=_0x2d591d['findIndex'](_0x2044b2=>_0x122f0c['chartModel']['candleFromX'](_0x4bae86['x'])===_0x2044b2),_0x211da4=_0x2d591d['findIndex'](_0x93e002=>_0x122f0c['chartModel']['candleFromX'](_0x702b0a['x'])===_0x93e002),_0x58bbd3=_0x122f0c['chartModel']['mainCandleSeries']['visualPoints']['slice'](_0x57cf7,_0x211da4),_0x1c18d8=_0x36f96b['isDragging']&&_0xb8a144['find'](_0x1d990f=>_0x1d990f['hidden']);if(_0x1c18d8||_0x58bbd3['length']<=0x1)this['drawTrendLine'](_0x50a267,_0xb8a144,_0x2228bf);else{const [_0x358d48,_0x56549e,_0x18a56f]=this['calcRegressionPoints'](_0xb8a144,_0x122f0c['chartModel'],_0x2228bf);for(const _0x3b0066 of _0x2228bf['sections']){const _0x4e6380=calculateSectionPoints(_0x3b0066,_0x358d48,_0x56549e,_0x2228bf,_0x2d591d['slice'](_0x57cf7,_0x211da4),_0x122f0c['chartModel'],_0x18a56f);if(_0x3b0066['visible']){const _0x58372f=new Vector(_0x358d48['x'],_0x4e6380['first']),_0x2c765b=new Vector(_0x56549e['x'],_0x4e6380['second']),_0x18c9b2={};_0x18c9b2['lineColor']=_0x3b0066['line']['lineColor'],_0x18c9b2['lineWidth']=_0x3b0066['line']['lineWidth'],_0x18c9b2['lineDash']=_0x3b0066['line']['lineDash'],drawSectionLine(_0x50a267,_0x18c9b2,_0x58372f,_0x2c765b),fillSection(_0x50a267,_0x3b0066,_0x358d48,_0x56549e,_0x2c765b,_0x58372f);if(_0x2228bf['extendLines']){const _0x4284fd=multiplyVector(_0x58372f,_0x2c765b,0x64),_0x5aa11d={};_0x5aa11d['lineColor']=_0x3b0066['line']['lineColor'],_0x5aa11d['lineWidth']=_0x3b0066['line']['lineWidth'],_0x5aa11d['lineDash']=_0x3b0066['line']['lineDash'],drawSectionLine(_0x50a267,_0x5aa11d,_0x2c765b,_0x4284fd);const _0x50210d=_0x3b0066['deviationCoef']*DEVIATION_WIDTH_STEP,_0x4c0992=_0x4e6380['deviation']?new Vector(_0x358d48['x'],_0x4e6380['first']-_0x4e6380['deviation']):new Vector(_0x358d48['x'],_0x4e6380['first']+_0x50210d),_0x2b2aac=_0x4e6380['deviation']?new Vector(_0x56549e['x'],_0x4e6380['second']-_0x4e6380['deviation']):new Vector(_0x56549e['x'],_0x4e6380['second']+_0x50210d),_0x4ecead=multiplyVector(_0x4c0992,_0x2b2aac,0x64);_0x3b0066['type']!=='base'&&fillSection(_0x50a267,_0x3b0066,_0x2c765b,_0x4284fd,_0x4ecead,_0x2b2aac);}}if(_0x2228bf['pearsonR']&&_0x3b0066['type']==='down'){const _0x3c68c9=_0x58bbd3['map']((_0x36251a,_0x52dd8f)=>({'index':_0x52dd8f,'price':getCandlePrice(_0x36251a,_0x2228bf['deviation']['source'])})),_0x447d6b=regressionEquation(_0x3c68c9);if(_0x447d6b){const _0x2f6581=_0x3c68c9['map'](_0x2aa95f=>_0x2aa95f['index']),_0xf4bed5=_0x3c68c9['map'](_0x237f1b=>_0x237f1b['price']),_0x96a4a2=String(pearsonR(_0x2f6581,_0xf4bed5,_0x447d6b));_0x50a267['fillStyle']=_0x2228bf['line']['lineColor'];const _0x2851b3=0xf,_0x2a77a7=_0x4e6380['deviation']&&_0x3b0066['type']==='down'?-_0x4e6380['deviation']-_0x2851b3:_0x3b0066['deviationCoef']*DEVIATION_WIDTH_STEP-_0x2851b3;_0x50a267['context']['fillText'](_0x96a4a2,_0x358d48['x']-_0x50a267['context']['measureText'](_0x96a4a2)['width']/0x2,_0x3b0066['visible']?_0x358d48['y']-_0x2a77a7:_0x358d48['y']+_0x2851b3);}}}}}}['drawTrendLine'](_0x32e2c8,_0x3b81d1,_0x5d32df){_0x32e2c8['beginPath'](),_0x32e2c8['prepareStroke'](_0x5d32df['line']),_0x32e2c8['context']['moveTo'](_0x3b81d1[0x0]['x'],_0x3b81d1[0x0]['y']),_0x32e2c8['context']['lineTo'](_0x3b81d1[0x1]['x'],_0x3b81d1[0x1]['y']),_0x32e2c8['stroke']();}}export const calculateSectionPoints=(_0x3ce000,_0x10037a,_0x3cd82a,_0x22d3e2,_0x28934e,_0x4d6dbb,_0x4aca07)=>{if(_0x3ce000['type']==='up'&&!_0x22d3e2['deviation']['useUpperDeviation']){const _0x5369e7=Math['max'](..._0x28934e['map']((_0xe5b4d,_0x3cfb1e)=>_0x4aca07[_0x3cfb1e]-_0x4d6dbb['toY'](_0xe5b4d['hi']))),_0x3967ed={};return _0x3967ed['first']=_0x10037a['y']-_0x5369e7,_0x3967ed['second']=_0x3cd82a['y']-_0x5369e7,_0x3967ed['deviation']=-_0x5369e7,_0x3967ed;}if(_0x3ce000['type']==='down'&&!_0x22d3e2['deviation']['useLowerDeviation']){const _0x5eb093=Math['max'](..._0x28934e['map']((_0x2f4a6a,_0x4a8f30)=>_0x4d6dbb['toY'](_0x2f4a6a['lo'])-_0x4aca07[_0x4a8f30])),_0x1f3312={};return _0x1f3312['first']=_0x10037a['y']+_0x5eb093,_0x1f3312['second']=_0x3cd82a['y']+_0x5eb093,_0x1f3312['deviation']=_0x5eb093,_0x1f3312;}const _0x169a87=_0x3ce000['deviationCoef']*DEVIATION_WIDTH_STEP,_0xe45d81={};return _0xe45d81['first']=_0x10037a['y']-_0x169a87,_0xe45d81['second']=_0x3cd82a['y']-_0x169a87,_0xe45d81;};export const getCandlePrice=(_0x58d601,_0x5952a4)=>{const _0x964c15=_0x58d601['candle'],{hi:_0x187426,lo:_0x14652b,open:_0x501c6e,close:_0x1b210b}=_0x964c15;switch(_0x5952a4){case'(H\x20+\x20L\x20+\x20C)/3':return(_0x187426+_0x14652b+_0x1b210b)/0x3;case'(H\x20+\x20L)/2':return(_0x187426+_0x14652b)/0x2;case'(O\x20+\x20H\x20+\x20L\x20+\x20C)/4':return(_0x501c6e+_0x187426+_0x14652b+_0x1b210b)/0x4;case'High':return _0x187426;case'Low':return _0x14652b;case'Open':return _0x501c6e;case'Close':return _0x1b210b;}};export const drawSectionLine=(_0x43b328,_0x17d14c,_0x4ed2d7,_0x5670ce)=>{_0x43b328['beginPath'](),_0x43b328['prepareStroke'](_0x17d14c),_0x43b328['addSegmentPath'](_0x4ed2d7,_0x5670ce),_0x43b328['stroke'](),_0x43b328['closePath']();};export const fillSection=(_0x4d4821,_0x43d273,_0x15bef3,_0x1b8341,_0x70af1c,_0x21bc30)=>{_0x4d4821['beginPath'](),_0x4d4821['prepareFill'](_0x43d273['line']),_0x4d4821['addPolygonPath']([_0x15bef3,_0x1b8341,_0x70af1c,_0x21bc30]),_0x4d4821['fillWithoutHT'](),_0x4d4821['closePath']();};const findLineByLeastSquares=(_0x176e78,_0x558414)=>{let _0x5a0b83=0x0,_0x531e2d=0x0,_0xa70bea=0x0,_0x401f2a=0x0,_0x4277b7=0x0,_0x2e294a=0x0,_0x27deac=0x0;const _0x1a247a=_0x176e78['length'];if(_0x1a247a!==_0x558414['length'])return undefined;if(_0x1a247a===0x0)return[[],[]];for(let _0x38a13d=0x0;_0x38a13d<_0x1a247a;_0x38a13d++){_0x2e294a=_0x176e78[_0x38a13d],_0x27deac=_0x558414[_0x38a13d],_0x5a0b83+=_0x2e294a,_0x531e2d+=_0x27deac,_0xa70bea+=_0x2e294a*_0x2e294a,_0x401f2a+=_0x2e294a*_0x27deac,_0x4277b7++;}const _0x28ed3c=(_0x4277b7*_0x401f2a-_0x5a0b83*_0x531e2d)/(_0x4277b7*_0xa70bea-_0x5a0b83*_0x5a0b83),_0x67b373=_0x531e2d/_0x4277b7-_0x28ed3c*_0x5a0b83/_0x4277b7,_0x5ee358=[],_0x4a0488=[];for(let _0x43edef=0x0;_0x43edef<_0x1a247a;_0x43edef++){_0x2e294a=_0x176e78[_0x43edef],_0x27deac=_0x2e294a*_0x28ed3c+_0x67b373,_0x5ee358['push'](_0x2e294a),_0x4a0488['push'](_0x27deac);}return[_0x5ee358,_0x4a0488];},pearsonR=(_0x32f2b3,_0x20d211,_0x22f75c)=>{if(_0x32f2b3['length']&&_0x20d211['length']&&_0x22f75c){let _0x85e33a=0x0,_0x1df552=0x0;const _0x42d065=_0x20d211['reduce']((_0x51199a,_0x4f6673)=>_0x51199a+_0x4f6673)/_0x20d211['length'];for(let _0x4bee1c=0x0;_0x4bee1c<_0x32f2b3['length'];_0x4bee1c++){_0x85e33a+=Math['pow'](_0x20d211[_0x4bee1c]-yPrediction(_0x32f2b3[_0x4bee1c],_0x22f75c),0x2),_0x1df552+=Math['pow'](_0x20d211[_0x4bee1c]-_0x42d065,0x2);}return 0x1-_0x85e33a/_0x1df552;}},yPrediction=(_0x313fce,_0x43532c)=>{return _0x43532c['a']+_0x43532c['b']*_0x313fce;},regressionEquation=_0x1c52bd=>{if(_0x1c52bd){let _0x4b36e2=0x0,_0x18f8d4=0x0,_0x24c230=0x0,_0x1f11ba=0x0,_0x3240f2=0x0,_0xf3b1f7=0x0,_0x25e957=0x0;for(const _0x4fef22 of _0x1c52bd){_0x4fef22['price']!==null&&(_0x4b36e2++,_0x18f8d4+=_0x4fef22['index'],_0x24c230+=_0x4fef22['price'],_0x1f11ba+=_0x4fef22['index']*_0x4fef22['price'],_0x3240f2+=Math['pow'](_0x4fef22['index'],0x2));}_0xf3b1f7=_0x24c230/_0x4b36e2,_0x25e957=_0x18f8d4/_0x4b36e2;const _0x3cd910=(_0x4b36e2*_0x1f11ba-_0x18f8d4*_0x24c230)/(_0x4b36e2*_0x3240f2-_0x18f8d4*_0x18f8d4),_0x26b071=_0xf3b1f7-_0x3cd910*_0x25e957,_0x152f63={};return _0x152f63['a']=_0x26b071,_0x152f63['b']=_0x3cd910,_0x152f63;}};