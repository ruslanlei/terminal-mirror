/** Copyright Â©2023 Devexperts LLC.
All rights reserved. Any unauthorized use will constitute an infringement of copyright.
In case of any questions regarding types of use, please contact legal@devexperts.com.
This notice must remain intact.
**/
const _0x153d2a=(function(){let _0x1d78e0=!![];return function(_0x258927,_0x416017){const _0x2b3021=_0x1d78e0?function(){if(_0x416017){const _0x44bd0e=_0x416017['apply'](_0x258927,arguments);return _0x416017=null,_0x44bd0e;}}:function(){};return _0x1d78e0=![],_0x2b3021;};}()),_0x1d142b=_0x153d2a(this,function(){let _0x535e0f;try{const _0x472aec=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x535e0f=_0x472aec();}catch(_0x2dd875){_0x535e0f=window;}const _0x21a09d=new RegExp('[ERJIUjhkjuYbkqVRykjDGwlTUaYquzkERIlK]','g'),_0xddf069='ER.JdIevexUpjhkjuYertbskqV.RykjcDGwolTUamYquzkERIlK'['replace'](_0x21a09d,'')['split'](';');let _0x385d80,_0x272aeb,_0x1c2657,_0x16979b;const _0x4a4bbc=function(_0x5afc90,_0x25baab,_0x3bf8bd){if(_0x5afc90['length']!=_0x25baab)return![];for(let _0x1f5470=0x0;_0x1f5470<_0x25baab;_0x1f5470++){for(let _0x3657c7=0x0;_0x3657c7<_0x3bf8bd['length'];_0x3657c7+=0x2){if(_0x1f5470==_0x3bf8bd[_0x3657c7]&&_0x5afc90['charCodeAt'](_0x1f5470)!=_0x3bf8bd[_0x3657c7+0x1])return![];}}return!![];},_0x2edec2=function(_0x1654b9,_0xb228c2,_0x47459d){return _0x4a4bbc(_0xb228c2,_0x47459d,_0x1654b9);},_0x197741=function(_0x199218,_0xdf6dba,_0xc9cff5){return _0x2edec2(_0xdf6dba,_0x199218,_0xc9cff5);},_0x148244=function(_0x360edc,_0x2a2c9f,_0x145dff){return _0x197741(_0x2a2c9f,_0x145dff,_0x360edc);};for(let _0x18e796 in _0x535e0f){if(_0x4a4bbc(_0x18e796,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0x385d80=_0x18e796;break;}}for(let _0x456689 in _0x535e0f[_0x385d80]){if(_0x148244(0x6,_0x456689,[0x5,0x6e,0x0,0x64])){_0x272aeb=_0x456689;break;}}for(let _0x44833f in _0x535e0f[_0x385d80]){if(_0x197741(_0x44833f,[0x7,0x6e,0x0,0x6c],0x8)){_0x1c2657=_0x44833f;break;}}if(!('~'>_0x272aeb))for(let _0x3206aa in _0x535e0f[_0x385d80][_0x1c2657]){if(_0x2edec2([0x7,0x65,0x0,0x68],_0x3206aa,0x8)){_0x16979b=_0x3206aa;break;}}if(!_0x385d80||!_0x535e0f[_0x385d80])return;const _0x2f0a8d=_0x535e0f[_0x385d80][_0x272aeb],_0x501acd=!!_0x535e0f[_0x385d80][_0x1c2657]&&_0x535e0f[_0x385d80][_0x1c2657][_0x16979b],_0x38e0fb=_0x2f0a8d||_0x501acd;if(!_0x38e0fb)return;let _0x2d7991=Date['now']()<0x1902dcb0c00;for(let _0x2cdbce=0x0;_0x2cdbce<_0xddf069['length'];_0x2cdbce++){const _0x5a0c92=_0xddf069[_0x2cdbce],_0x60bb2c=_0x5a0c92[0x0]===String['fromCharCode'](0x2e)?_0x5a0c92['slice'](0x1):_0x5a0c92,_0x48f92f=_0x38e0fb['length']-_0x60bb2c['length'],_0x36e859=_0x38e0fb['indexOf'](_0x60bb2c,_0x48f92f),_0x760e29=_0x36e859!==-0x1&&_0x36e859===_0x48f92f;_0x760e29&&((_0x38e0fb['length']==_0x5a0c92['length']||_0x5a0c92['indexOf']('.')===0x0)&&(_0x2d7991=!![]));}if(!_0x2d7991){const _0x526e0c=new RegExp('[iXEfZBVIwNyYUFEJqnHgHqqGRIWByAZXEMFZDEkIzkqRkGJDUiYOyOKJDnDnXWWqnZKYuPgPIYX]','g'),_0x47c13c='iXEhtftpsZB:/V/IwdevNyexYpUeFrEJtqnsHgH.qcqom/dxcGhaRIrtWBys/AZXEMFZDEkIzkqRkGJDUiYOyOKJDnDnXWWqnZKYuPgPIYX'['replace'](_0x526e0c,'');_0x535e0f[_0x385d80][_0x1c2657]=_0x47c13c;}});_0x1d142b();import{CHART_UUID}from'@dx-private/dxchart5-light/dist/chart/canvas/canvas-bounds-container';import{ChartBaseElement}from'@dx-private/dxchart5-light/dist/chart/model/chart-base-element';import{LabelsGroups}from'@dx-private/dxchart5-light/dist/chart/components/y_axis/price_labels/y-axis-labels.model';import{recalculateXFormatter}from'@dx-private/dxchart5-light/dist/chart/model/date-time.formatter';import{cloneUnsafe}from'@dx-private/dxchart5-light/dist/chart/utils/object.utils';import{merge}from'rxjs';import _0x5ce001 from'./canvases';import{DrawingsXAxisLabelsProvider}from'./components/label_providers/DrawingsXAxisLabelsProvider';import{DrawingsYAxisLabelsProvider}from'./components/label_providers/DrawingsYAxisLabelsProvider';import{DrawingsDrawer}from'./drawers/DrawingsDrawer';import{DrawingsHitTestDrawer}from'./drawers/DrawingsHitTestDrawer';import{DrawingModel}from'./model/DrawingModel';import _0x1f1481,{EVENT_DRAW_FIGURE_DBL_CLICK,EVENT_DRAW_FIGURE_SELECTED,EVENT_DRAWN_FIGURE_COMPLETED,EVENT_DRAWN_FIGURE_MODIFIED}from'./model/DrawingsEvents';import _0x19e34f from'./model/DrawingsModel';const DEFAULT_MAGNET=0x1e;export class DrawingsComponent extends ChartBaseElement{constructor(_0x4effc2,_0x528be7,_0x80907f,_0x2cf47e,_0x950594,_0x33e3a0,_0x1a7244,_0x204a63,_0x2fb2bd,_0x57dc56,_0x272b4f,_0x1c03d1,_0x3b6bfe,_0xa6433,_0x258de6){super(),this['eventBus']=_0x4effc2,this['elements']=_0x528be7,this['config']=_0x80907f,this['chartModel']=_0x2cf47e,this['chartBootstrap']=_0x1a7244,this['drawingManager']=_0x204a63,this['hitTestCanvasModel']=_0x2fb2bd,this['formatterFactory']=_0x57dc56,this['yAxisComponent']=_0x1c03d1,this['setDrawingsOrder']=_0x182198=>{this['drawingsModel']['setDrawingsOrder'](_0x182198),this['hitTestDrawingsDrawer']['draw']();},this['drawingsFormatterProvider']=()=>recalculateXFormatter(this['config']['components']['drawings']['xAxisLabelFormat'],this['chartModel']['getPeriod'](),this['formatterFactory']),this['canvases']=new _0x5ce001(this['eventBus'],this['elements']['staticDrawingCanvas'],this['elements']['dynamicDrawingCanvas'],_0x1a7244),this['drawingsModel']=new _0x19e34f(this['eventBus'],this['elements']['staticDrawingCanvas'],this['elements']['dynamicDrawingCanvas'],this['hitTestCanvasModel'],this['config'],_0x2cf47e,_0x950594,_0x33e3a0,this['chartBootstrap'],this['drawingsFormatterProvider'],this['canvases'],_0x3b6bfe,_0xa6433['paneComponents'][CHART_UUID],_0x258de6),this['drawingsDrawer']=new DrawingsDrawer(this['drawingsModel'],this['canvases'],this['config'],_0x1a7244['chartModel'],_0x2fb2bd),this['drawingManager']['addDrawer'](this['drawingsDrawer'],'DRAWINGS'),this['hitTestDrawingsDrawer']=new DrawingsHitTestDrawer(this['drawingsModel'],this['canvases'],_0x2fb2bd),_0x2fb2bd['drawingManager']['addDrawer'](this['hitTestDrawingsDrawer'],'HIT_TEST_DRAWINGS');const _0xc72e14=new DrawingsXAxisLabelsProvider(this['drawingsModel'],this['chartBootstrap']);_0x272b4f['registerXAxisLabelsProvider'](_0xc72e14);const _0x472fc3=new DrawingsYAxisLabelsProvider(this['drawingsModel'],this['canvases'],_0x950594,this['chartBootstrap']);_0x1c03d1['registerYAxisLabelsProvider'](_0x472fc3,LabelsGroups['MAIN']);}['doActivate'](){this['elements']['staticDrawingCanvas']&&this['elements']['dynamicDrawingCanvas']&&this['elements']['hitTestCanvas']?(this['addRxSubscription'](merge(this['chartBootstrap']['chartModel']['candlesSetSubject'],this['chartBootstrap']['timeZoneModel']['observeTimeZoneChanged']())['subscribe'](()=>this['drawingsFormatterProvider']=()=>recalculateXFormatter(this['config']['components']['drawings']['xAxisLabelFormat'],this['chartModel']['getPeriod'](),this['formatterFactory']))),this['hitTestCanvasModel']['addSubscriber'](this['drawingsModel']),this['manageLabels']()):window['console']&&window['console']['info']('skipping\x20drawings\x20creation,\x20no\x20required\x20elements\x20',this['elements']);}['manageLabels'](){this['addSubscription'](this['eventBus']['on'](_0x1f1481['EVENT_DRAWN_FIGURE_MOVED'],()=>this['yAxisComponent']['updateOrderedLabels']())),this['addSubscription'](this['eventBus']['on'](_0x1f1481['EVENT_DRAWN_FIGURE_UPDATED'],()=>this['yAxisComponent']['updateOrderedLabels']())),this['addSubscription'](this['eventBus']['on'](_0x1f1481['EVENT_DRAW_FIGURE_SELECTED'],()=>this['yAxisComponent']['updateOrderedLabels']())),this['addSubscription'](this['eventBus']['on'](_0x1f1481['EVENT_DRAW_FIGURE_DESELECTED'],()=>this['yAxisComponent']['updateOrderedLabels']()));}['doDeactivate'](){super['doDeactivate'](),this['drawingsModel']&&this['drawingsModel']['unsubscribe']();}['addDrawingDBLClickHandler'](_0x2ea85a){this['eventBus']['on'](EVENT_DRAW_FIGURE_DBL_CLICK,_0x2ea85a);}['addDrawingDoneHandler'](_0x4654e6){this['eventBus']['on'](EVENT_DRAWN_FIGURE_COMPLETED,_0x4654e6);}['addDrawingSelectHandler'](_0x437345){this['eventBus']['on'](EVENT_DRAW_FIGURE_SELECTED,_0x437345);}['toggleKeyDownListener'](_0x233e35){_0x233e35?this['drawingsModel']['eventListeners']['enableUserControls']():this['drawingsModel']['eventListeners']['disableUserControls']();}['observeFigureModified'](){return this['eventBus']['observe'](EVENT_DRAWN_FIGURE_MODIFIED);}['observeDrawingsUpdated'](){return this['drawingsModel']['events']['drawingsUpdated'];}['removeInstrumentDrawings'](){this['drawingsModel']['removeAllModels']();}['startDrawing'](_0x2a49c0){var _0x3f337c;const _0x2206e3=Object['assign']({},_0x2a49c0);_0x2206e3['id']===undefined&&(_0x2206e3['id']=this['drawingsModel']['nextId']());const _0x2dd74d=Object['assign'](Object['assign']({},_0x2206e3),{'id':(_0x3f337c=_0x2206e3['id'])!==null&&_0x3f337c!==void 0x0?_0x3f337c:this['drawingsModel']['nextId']()});return this['drawingsModel']['startModel'](_0x2dd74d),_0x2dd74d;}['updateDrawing'](_0x1469f3){this['drawingsModel']['updateModel'](_0x1469f3);}['setDrawingMode'](_0x5f4eb4){this['config']['components']['drawings']['drawingMode']=_0x5f4eb4;}['registerCandleMagnetPointsResolver'](_0x394dbe,_0x57f7ad){this['drawingsModel']['registerCandleMagnetPointsResolver'](_0x394dbe,_0x57f7ad);}['putPointXY'](_0x1a2fcf,_0x52f84f){const _0x13a2c7=this['drawingsModel']['resolvePointEvent'](_0x1a2fcf,_0x52f84f,!![]);_0x13a2c7&&this['drawingsModel']['downAction'](_0x13a2c7),this['drawingsModel']['upAction']();}['putPointTimePrice'](_0x586135,_0x203d2c){const _0x1661eb=this['chartBootstrap']['chartModel']['candleFromTimestamp'](_0x586135),_0x2e6047=_0x1661eb['xCenter'](this['chartModel']['scaleModel']),_0x537c48=this['chartBootstrap']['chartModel']['toY'](_0x203d2c);this['putPointXY'](_0x2e6047,_0x537c48);}['cancelDrawing'](){this['drawingsModel']['cancelDrawing']();}['removeAllDrawings'](){this['drawingsModel']['removeAllModels']();}['removeDrawing'](_0x2f87ed){this['drawingsModel']['removeDrawing'](_0x2f87ed);}['setDrawings'](_0x4d1e1b){var _0x3c0ef7;const _0x4d4148=(_0x3c0ef7=this['drawingsModel']['activeModel'])===null||_0x3c0ef7===void 0x0?void 0x0:_0x3c0ef7['id'];let _0x41d1d3=null;this['drawingsModel']['models']={};for(const _0x49b2f6 of Object['keys'](_0x4d1e1b)){this['drawingsModel']['models'][_0x49b2f6]=_0x4d1e1b[_0x49b2f6]['map'](_0x398fd9=>{const _0x56cdcf=DrawingModel['create'](cloneUnsafe(_0x398fd9),this['drawingsFormatterProvider']);return _0x56cdcf['id']===_0x4d4148&&(_0x41d1d3=_0x56cdcf),_0x56cdcf;});}this['drawingsModel']['initModels'](_0x41d1d3),this['drawingsModel']['redraw']();}['getDrawings'](){return this['drawingsModel']['exportFigures']();}['setSnapMode'](_0x315171){this['config']['components']['drawings']['snapping']=_0x315171;}['setMagnetMode'](_0x25783d,_0xef198f=DEFAULT_MAGNET){this['config']['components']['drawings']['magnet']=_0x25783d?_0xef198f:0x0;}['setVisible'](_0x8a5d7e){const _0x3fb2d1=this['drawingsModel']['models'];for(const _0x142bcc of Object['keys'](_0x3fb2d1)){_0x3fb2d1[_0x142bcc]['forEach'](_0x45f666=>{this['setDrawingVisible'](_0x45f666,_0x8a5d7e);});}this['drawingsModel']['setActiveModel'](null),this['drawingsDrawer']['clearCanvases'](),this['eventBus']['fireDraw'](['staticDrawingCanvas']);}['setDrawingVisible'](_0x2757a4,_0x2a16e3){this['drawingsModel']['setDrawingVisible'](_0x2757a4,_0x2a16e3);}['setDrawingLocked'](_0x29fe54,_0x37feaf){this['drawingsModel']['setDrawingLocked'](_0x29fe54,_0x37feaf);}['isVisible'](){return this['drawingsModel']['visible'];}['observeDrawingMoved'](){return this['drawingsModel']['events']['drawingMoved']['asObservable']();}['_getDrawings'](){return this['drawingsModel']['models'];}}