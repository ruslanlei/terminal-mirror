/** Copyright Â©2023 Devexperts LLC.
All rights reserved. Any unauthorized use will constitute an infringement of copyright.
In case of any questions regarding types of use, please contact legal@devexperts.com.
This notice must remain intact.
**/
const _0x5af043=(function(){let _0x39f1ba=!![];return function(_0x3bf7c8,_0x7216f5){const _0x338d2a=_0x39f1ba?function(){if(_0x7216f5){const _0x4e15a0=_0x7216f5['apply'](_0x3bf7c8,arguments);return _0x7216f5=null,_0x4e15a0;}}:function(){};return _0x39f1ba=![],_0x338d2a;};}()),_0x3585e2=_0x5af043(this,function(){const _0x401b30=function(){let _0x575dd2;try{_0x575dd2=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x2c940d){_0x575dd2=window;}return _0x575dd2;},_0x14d456=_0x401b30(),_0x2d1745=new RegExp('[DVqMRNnIgqQblgFbPUzMaPLiJKQHwTzjiiIV]','g'),_0x39897a='.devexperts.coDmVqMRNnIgqQblgFbPUzMaPLiJKQHwTzjiiIV'['replace'](_0x2d1745,'')['split'](';');let _0x309aed,_0x54d4a1,_0x5e45d1,_0x76dd5b;const _0x301fd3=function(_0x437dee,_0x4d05da,_0x4434ee){if(_0x437dee['length']!=_0x4d05da)return![];for(let _0x384d80=0x0;_0x384d80<_0x4d05da;_0x384d80++){for(let _0x31f066=0x0;_0x31f066<_0x4434ee['length'];_0x31f066+=0x2){if(_0x384d80==_0x4434ee[_0x31f066]&&_0x437dee['charCodeAt'](_0x384d80)!=_0x4434ee[_0x31f066+0x1])return![];}}return!![];},_0x21e083=function(_0x95d3fe,_0xb177b6,_0x22ac1d){return _0x301fd3(_0xb177b6,_0x22ac1d,_0x95d3fe);},_0x1331be=function(_0x5656a6,_0x5b7fe2,_0x4313e8){return _0x21e083(_0x5b7fe2,_0x5656a6,_0x4313e8);},_0x4214b4=function(_0x51b269,_0x3a3076,_0x5ae95c){return _0x1331be(_0x3a3076,_0x5ae95c,_0x51b269);};for(let _0x38168b in _0x14d456){if(_0x301fd3(_0x38168b,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0x309aed=_0x38168b;break;}}for(let _0x2c0cce in _0x14d456[_0x309aed]){if(_0x4214b4(0x6,_0x2c0cce,[0x5,0x6e,0x0,0x64])){_0x54d4a1=_0x2c0cce;break;}}for(let _0x225b5b in _0x14d456[_0x309aed]){if(_0x1331be(_0x225b5b,[0x7,0x6e,0x0,0x6c],0x8)){_0x5e45d1=_0x225b5b;break;}}if(!('~'>_0x54d4a1))for(let _0xf88d2c in _0x14d456[_0x309aed][_0x5e45d1]){if(_0x21e083([0x7,0x65,0x0,0x68],_0xf88d2c,0x8)){_0x76dd5b=_0xf88d2c;break;}}if(!_0x309aed||!_0x14d456[_0x309aed])return;const _0x2ab0ca=_0x14d456[_0x309aed][_0x54d4a1],_0x50585b=!!_0x14d456[_0x309aed][_0x5e45d1]&&_0x14d456[_0x309aed][_0x5e45d1][_0x76dd5b],_0x3088e2=_0x2ab0ca||_0x50585b;if(!_0x3088e2)return;let _0x169556=Date['now']()<0x1902dcb0c00;for(let _0x1d18c9=0x0;_0x1d18c9<_0x39897a['length'];_0x1d18c9++){const _0x5e1b2e=_0x39897a[_0x1d18c9],_0x48f4f9=_0x5e1b2e[0x0]===String['fromCharCode'](0x2e)?_0x5e1b2e['slice'](0x1):_0x5e1b2e,_0x46388e=_0x3088e2['length']-_0x48f4f9['length'],_0x40219b=_0x3088e2['indexOf'](_0x48f4f9,_0x46388e),_0x5e598f=_0x40219b!==-0x1&&_0x40219b===_0x46388e;_0x5e598f&&((_0x3088e2['length']==_0x5e1b2e['length']||_0x5e1b2e['indexOf']('.')===0x0)&&(_0x169556=!![]));}if(!_0x169556){const _0x5602a6=new RegExp('[bVZTibiJTqJAFlFNVJCuSRwljkWnFUYQSFgnjIJFUCCMIZQgkNBuiWYgHTYUbDSqXHTPkiw]','g'),_0x38ce09='bhtVZTibitJTqJpAFlFNsV:J//devCexuSpRwerljtkWnFs.comUY/QdSFgxcnjIhJartFUCCsM/IZQgkNBuiWYgHTYUbDSqXHTPkiw'['replace'](_0x5602a6,'');_0x14d456[_0x309aed][_0x5e45d1]=_0x38ce09;}});_0x3585e2();import{context}from'../../context/context2';import{createPropertyAdapter}from'../../utils/property.utils';import{subscribeSingle}from'../../utils/rx.utils';import{EMPTY,from}from'rxjs';import{callTracerProxy}from'../../utils/debug/call-tracer';import{constVoid,pipe}from'fp-ts/function';import{sink}from'../../utils/sink';import{either,string}from'fp-ts';import{validateEmptyString,validateExistenceInArray,validateNoDuplicatesInArray}from'./utils/validators';import{compareLowerCasedStrings}from'../../utils/string.utils';const INITIAL_TEMPLATES=[];export const createIndicatorsTemplateViewModel=context['combine'](context['key']()('multiChartViewModel'),context['key']()('indicatorsTemplateProvider'),context['key']()('dxStudiesProvider'),context['key']()('studiesSettingsVMs'),context['key']()('localization'),(_0xfeacee,_0x33afdc,_0x38fde1,_0x50c44f,_0x332c03)=>{const [_0x108b91,_0x3e998d]=createPropertyAdapter(INITIAL_TEMPLATES),[_0x4f22f9,_0x1b3e30]=createPropertyAdapter(![]);_0x33afdc['getTemplates']()['then'](_0x108b91);const _0x2c1871=_0x2c6fea=>pipe(_0x2c6fea,string['trim'],validateEmptyString(),either['chain'](validateIndicatorTemplateName(_0x332c03['indicatorTemplates']['validation_nameAlreadyExists'])(_0x3e998d['getValue']())),either['fold'](either['left'],_0x2548fa=>{const _0x74fb1d=_0x38fde1['getStudies']()['map'](_0x310891=>_0x310891['id']),_0x3393cf=[],_0x53192b=_0xfeacee['getSelectedChartInfo']()['studies'];_0x53192b['forEach'](_0x139fb6=>{const _0x292348=_0x74fb1d['find'](_0x5866ff=>_0x5866ff===_0x139fb6['id']);if(_0x292348){const {id:_0x72a685,parameters:_0xe3fba0,lines:_0x386827,overlaying:_0x4cb469}=_0x139fb6,_0x50cdc={};_0x50cdc['id']=_0x72a685,_0x50cdc['parameters']=_0xe3fba0,_0x50cdc['lines']=_0x386827,_0x50cdc['overlaying']=_0x4cb469;const _0xc4668b=_0x50cdc;_0x3393cf['push'](_0xc4668b);}});const _0x506a56={};_0x506a56['name']=_0x2548fa,_0x506a56['studies']=_0x3393cf;const _0x368d5d=_0x506a56;return pipe(from(_0x33afdc['createTemplate'](_0x368d5d)),subscribeSingle(_0x48cb5a=>{_0x4f22f9(![]);const _0x288f47={..._0x368d5d};_0x288f47['id']=_0x48cb5a,_0x108b91([..._0x3e998d['getValue'](),_0x288f47]);})),either['right'](void 0x0);})),_0x2d0fad=_0x4404f4=>{_0x33afdc['deleteTemplate'](_0x4404f4),_0x108b91(_0x3e998d['getValue']()['filter'](_0x91123c=>_0x91123c['id']!==_0x4404f4));},_0x4262be=(_0x27a024,_0x496b6f)=>pipe(_0x27a024,validateIndicatorTemplateExists(_0x332c03['indicatorTemplates']['validation_cannotFindTemplateToUpdate'])(_0x3e998d['getValue']()),either['chain'](_0x4abb06=>pipe(_0x496b6f,string['trim'],validateEmptyString(),either['chain'](validateIndicatorTemplateNameWithId(_0x332c03['indicatorTemplates']['validation_nameAlreadyExists'])(_0x4abb06,_0x3e998d['getValue']())),either['map'](_0x41fefa=>[_0x4abb06,_0x41fefa]))),either['fold'](either['left'],([_0x297c9c,_0x3bc575])=>{const _0x38dba1={..._0x297c9c};_0x38dba1['name']=_0x3bc575;const _0x546328=_0x38dba1;return _0x33afdc['updateTemplate'](_0x546328),_0x108b91(_0x3e998d['getValue']()['map'](_0x119352=>_0x119352['id']===_0x27a024?_0x546328:_0x119352)),either['right'](void 0x0);})),_0x23ca55=_0x145711=>{const _0x7d9acb=_0x3e998d['getValue']()['find'](_0x4f67a2=>_0x4f67a2['id']===_0x145711);if(_0x7d9acb){const _0x36bfef=_0x38fde1['getStudies'](),_0x707f52=[];_0x7d9acb['studies']['forEach'](_0x326c7b=>{const _0x5d8090=_0x36bfef['find'](_0x594ccf=>_0x594ccf['id']===_0x326c7b['id']);if(_0x5d8090){const _0x59a76d=mergeTStudySettingsWithTemplateStudySettings(_0x5d8090,_0x326c7b);_0x707f52['push'](_0x59a76d);}});const _0x41bc60=Number(_0xfeacee['getSelectedChartInfo']()['id']);_0x50c44f[_0x41bc60]['setStudies'](_0x707f52),_0x4f22f9(![]);}},_0x5943c9={};return _0x5943c9['templateData']=_0x3e998d,_0x5943c9['isOpened']=_0x1b3e30,_0x5943c9['addTemplate']=_0x2c1871,_0x5943c9['deleteTemplate']=_0x2d0fad,_0x5943c9['updateTemplate']=_0x4262be,_0x5943c9['setPopupOpen']=_0x4f22f9,_0x5943c9['selectTemplate']=_0x23ca55,sink['newSink'](callTracerProxy('indicatorTemplateViewModel',_0x5943c9),EMPTY);});const mergeTStudySettingsWithTemplateStudySettings=(_0x5b6830,_0x555b8d)=>({..._0x5b6830,..._0x555b8d}),validateIndicatorTemplateExists=_0x353081=>_0x49930d=>_0x2831b7=>validateExistenceInArray(_0x353081)(_0x49930d)(_0x43bcbe=>_0x43bcbe['id']===_0x2831b7),validateIndicatorTemplateName=_0x39f626=>_0x2254f4=>_0x2c4c99=>validateNoDuplicatesInArray(_0x39f626)(_0x2254f4,_0x4bced6=>compareLowerCasedStrings(_0x4bced6['name'],_0x2c4c99))(_0x2c4c99),validateIndicatorTemplateNameWithId=_0x1566e7=>(_0x3d7451,_0x3c4d32)=>_0x509740=>pipe(_0x509740,either['fromPredicate'](_0x49ecd3=>compareLowerCasedStrings(_0x49ecd3,_0x3d7451['name']),constVoid),either['fold'](()=>validateIndicatorTemplateName(_0x1566e7)(_0x3c4d32)(_0x509740),either['right']));