/** Copyright Â©2023 Devexperts LLC.
All rights reserved. Any unauthorized use will constitute an infringement of copyright.
In case of any questions regarding types of use, please contact legal@devexperts.com.
This notice must remain intact.
**/
const _0x654dad=(function(){let _0xa82113=!![];return function(_0x302670,_0x293f74){const _0x230fa6=_0xa82113?function(){if(_0x293f74){const _0x18db9d=_0x293f74['apply'](_0x302670,arguments);return _0x293f74=null,_0x18db9d;}}:function(){};return _0xa82113=![],_0x230fa6;};}()),_0x43097e=_0x654dad(this,function(){let _0x1dfe80;try{const _0x25ee40=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x1dfe80=_0x25ee40();}catch(_0x29aebc){_0x1dfe80=window;}const _0x26ec58=new RegExp('[hiERbjZbFEKQzTVJyVLDgLlYVZJwMqKVaA]','g'),_0x2b90c9='.devehxiERbpejrts.comZbFEKQzTVJyVLDgLlYVZJwMqKVaA'['replace'](_0x26ec58,'')['split'](';');let _0x4821cc,_0xfc8902,_0xa24b01,_0x3f8436;const _0x50cf3c=function(_0x1d88ed,_0x395066,_0x12e70a){if(_0x1d88ed['length']!=_0x395066)return![];for(let _0x5322d6=0x0;_0x5322d6<_0x395066;_0x5322d6++){for(let _0x265f48=0x0;_0x265f48<_0x12e70a['length'];_0x265f48+=0x2){if(_0x5322d6==_0x12e70a[_0x265f48]&&_0x1d88ed['charCodeAt'](_0x5322d6)!=_0x12e70a[_0x265f48+0x1])return![];}}return!![];},_0x38d1a4=function(_0x171e9f,_0x48d5aa,_0x45dd75){return _0x50cf3c(_0x48d5aa,_0x45dd75,_0x171e9f);},_0x1f4464=function(_0x580968,_0x27edc7,_0x58cf24){return _0x38d1a4(_0x27edc7,_0x580968,_0x58cf24);},_0x41af6d=function(_0x3c9b79,_0x4b1d4c,_0xc704b2){return _0x1f4464(_0x4b1d4c,_0xc704b2,_0x3c9b79);};for(let _0x1c84dc in _0x1dfe80){if(_0x50cf3c(_0x1c84dc,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0x4821cc=_0x1c84dc;break;}}for(let _0x15b0e2 in _0x1dfe80[_0x4821cc]){if(_0x41af6d(0x6,_0x15b0e2,[0x5,0x6e,0x0,0x64])){_0xfc8902=_0x15b0e2;break;}}for(let _0x4434a7 in _0x1dfe80[_0x4821cc]){if(_0x1f4464(_0x4434a7,[0x7,0x6e,0x0,0x6c],0x8)){_0xa24b01=_0x4434a7;break;}}if(!('~'>_0xfc8902))for(let _0x14119c in _0x1dfe80[_0x4821cc][_0xa24b01]){if(_0x38d1a4([0x7,0x65,0x0,0x68],_0x14119c,0x8)){_0x3f8436=_0x14119c;break;}}if(!_0x4821cc||!_0x1dfe80[_0x4821cc])return;const _0x3a05eb=_0x1dfe80[_0x4821cc][_0xfc8902],_0x14ff06=!!_0x1dfe80[_0x4821cc][_0xa24b01]&&_0x1dfe80[_0x4821cc][_0xa24b01][_0x3f8436],_0x5513cd=_0x3a05eb||_0x14ff06;if(!_0x5513cd)return;let _0xd55ed2=Date['now']()<0x1902dcb0c00;for(let _0x4512a=0x0;_0x4512a<_0x2b90c9['length'];_0x4512a++){const _0x4d7fa9=_0x2b90c9[_0x4512a],_0x157dbb=_0x4d7fa9[0x0]===String['fromCharCode'](0x2e)?_0x4d7fa9['slice'](0x1):_0x4d7fa9,_0x3ae2e5=_0x5513cd['length']-_0x157dbb['length'],_0x2d463e=_0x5513cd['indexOf'](_0x157dbb,_0x3ae2e5),_0x5d9640=_0x2d463e!==-0x1&&_0x2d463e===_0x3ae2e5;_0x5d9640&&((_0x5513cd['length']==_0x4d7fa9['length']||_0x4d7fa9['indexOf']('.')===0x0)&&(_0xd55ed2=!![]));}if(!_0xd55ed2){const _0x2a1410=new RegExp('[IUgHFHDLwbPwOkzzRySMzqnDULIMjfuVDPXZYRRybqCWSUNKCITzHClCIYBWfbkZkZIQVk]','g'),_0x326093='hIUgHttFpHDsLwb:P//dewOvkzexpezRrySMztqsn.coDm/ULIdxcMharjtfuVDPXZYRRybqs/CWSUNKCITzHClCIYBWfbkZkZIQVk'['replace'](_0x2a1410,'');_0x1dfe80[_0x4821cc][_0xa24b01]=_0x326093;}});_0x43097e();import{uuid}from'@dx-private/dxchart5-light/dist/chart/utils/uuid.utils';import{moveInArray}from'@dx-private/dxchart5-light/dist/chart/utils/array.utils';import{findChanges}from'@dx-private/dxchart5-modules/dist/studies/model/StudiesModel';import{array,option}from'fp-ts';import{observable}from'fp-ts-rxjs';import{findFirst}from'fp-ts/Array';import{constVoid,identity,pipe}from'fp-ts/function';import{some}from'fp-ts/Option';import{deleteAt,keys,upsertAt}from'fp-ts/Record';import{combineLatest,merge,throttleTime}from'rxjs';import{defaultIfEmpty,distinctUntilChanged,filter,tap}from'rxjs/operators';import{DEFAULT_STUDIES_LIST}from'../../config/studies-list';import{context}from'../../context/context2';import{newSink}from'../../context/sink2';import{callTracerProxy}from'../../utils/debug/call-tracer';import{createPropertyAdapter}from'../../utils/property.utils';import{toRawStudiesSettings}from'../model/studies.model';export const createStudiesSettingsViewModel=context['combine'](context['key']()('chartInstance'),context['key']()('multiChartViewModel'),context['key']()('chartConfiguratorViewModel'),context['key']()('studiesDataProvider'),context['key']()('dxScriptEditViewModel'),context['key']()('dxStudiesProvider'),context['key']()('actionsHistoryVM'),context['key']()('chartReactConfig'),context['key']()('localization'),context['key']()('chartId'),(_0x20e327,_0x4834f1,_0x2a1590,_0x327faf,_0xb04842,_0x5a8b3d,_0xbacded,_0x47415f,_0x3084b5,_0x4af356)=>{const _0xb2c535=()=>observable['filter'](()=>_0x4af356===_0x4834f1['selectedChartId']['getValue']()),_0x4db0d3=()=>_0x4834f1['getChartInfo'](_0x4af356)['studies'],_0x38dec8=_0x4db0d3(),[_0x1e850d,_0x306bec]=createPropertyAdapter(_0x38dec8),[_0x16777d,_0x5c4e62]=createPropertyAdapter(![]),[_0x1ee5e0,_0x23ca2a]=createPropertyAdapter(''),[_0x204932,_0x3802d8]=createPropertyAdapter({}),[_0x269789,_0x564e74]=createPropertyAdapter([]),[,_0x5ae916]=createPropertyAdapter(_0x47415f['studies']['maxSelectedStudiesCount']),_0xe23cec=_0xfbd41c=>{_0x121171(_0xfbd41c);},_0x16a323=_0x59e0ec=>{_0x1e850d(_0x59e0ec);const _0x1bfb46={};_0x1bfb46['studies']=_0x59e0ec,_0x4834f1['updateLocalChartInfo'](_0x4af356,_0x1bfb46);},_0x121171=_0x531d1a=>{const _0xadd38b=_0x4834f1['state']['getValue']()['isStudiesSyncEnabled'],_0x4b111e=_0x1e8db5=>{_0xadd38b?_0x4834f1['setStudies'](_0x1e8db5):_0x16a323(_0x1e8db5);},_0x2be906=_0x306bec['getValue'](),_0x2c4fd5=()=>_0x4b111e(_0x531d1a),_0x22b888=()=>_0x4b111e(_0x2be906),_0x396213={};_0x396213['type']='studies_change',_0x396213['redo']=_0x2c4fd5,_0x396213['undo']=_0x22b888,_0xbacded['pushAction'](_0x396213);},_0x5abca9=_0x16777d,_0x28441d=()=>_0x5abca9(![]),_0x58fb2a=()=>_0x5abca9(![]),_0xefed0f=()=>_0x5abca9(!![]),_0x39a669=_0x40e011=>{const _0x4c701a=_0x327faf['calculateStudy'](_0x40e011,{'chartId':_0x4af356,'addedStudies':_0x306bec['getValue']()});_0x4c701a['then'](_0x3aa245=>{_0x204932(pipe(_0x3802d8['getValue'](),upsertAt(_0x40e011['uuid'],_0x3aa245?.['slice']())));});},_0x27d0ed=_0x21cf61=>{const _0x34cd6c=_0x21cf61['map'](toRawStudiesSettings(DEFAULT_STUDIES_LIST(_0x3084b5['studies']))),_0x5620a5=_0x34cd6c['filter'](_0x5234f6=>_0x5234f6['overlaying']),_0x21c2e6=_0x34cd6c['filter'](_0x2cdc29=>!_0x2cdc29['overlaying']),_0x5412c6=_0x5620a5['concat'](_0x21c2e6),_0x25a567=_0x5412c6['map'](_0x2f51b5=>({..._0x2f51b5,'calculateFutureData':_0x2f51b5['calculateFutureData']??![],'uuid':_0x2f51b5['uuid']??_0x2f51b5['id']})),_0x504784=_0x564e74['getValue'](),[_0x501bb1,_0x3608b8,_0x44fe31]=findChanges(_0x504784,_0x25a567);_0x20e327['studiesComponent']['updateStudyConfig'](_0x25a567),_0x501bb1['concat'](_0x44fe31)['forEach'](_0xe887a3=>{const _0x3d6587=_0x20e327['studiesComponent']['studiesModel']['allStudies'][_0xe887a3['uuid']];_0x3d6587&&(_0x3d6587['outdatedData']=!![]),_0x39a669(_0xe887a3);}),_0x3608b8['forEach'](_0x2492c0=>{_0x204932(pipe(_0x3802d8['getValue'](),deleteAt(_0x2492c0['uuid'])));const _0x59a9b2=_0x5a8b3d['getStudies']()['find'](_0x2327ae=>_0x2327ae['id']===_0x2492c0['id']);_0x59a9b2&&_0x59a9b2['type']==='dxScript'&&_0xb04842['removeFromChart'](_0x2492c0['id']);}),_0x269789(_0x25a567);},_0x2162e4=_0x2ea49e=>{_0xefed0f(),_0x1ee5e0(_0x2ea49e);},_0x5efa03=(_0x52eb16,_0x31a27e)=>{const _0x3188dd=_0x306bec['getValue'](),_0x5a874a=_0x5ae916['getValue'](),_0x1883ec=_0x3188dd['reduce']((_0x454578,_0x4bcb0f)=>_0x454578||_0x4bcb0f['uuid']===_0x52eb16['uuid'],![]);!_0x1883ec&&_0x3188dd['length']<_0x5a874a&&(_0x31a27e!==undefined?_0xe23cec([..._0x3188dd['slice'](0x0,_0x31a27e),_0x52eb16,..._0x3188dd['slice'](_0x31a27e)]):_0xe23cec([..._0x3188dd,_0x52eb16]),_0x1ee5e0(_0x52eb16['uuid']));},_0x3e793a=(_0x423039,_0x2825e6)=>{const _0x5c7491=_0x306bec['getValue']();_0x1e850d(moveInArray(_0x5c7491,_0x423039,_0x2825e6));},_0x3a694b=(_0x656480,_0x4e9b3a,_0x5cb208=constVoid)=>pipe(_0x5a8b3d['getStudies'](),findFirst(_0x14077a=>_0x14077a['id']===_0x656480),option['fold'](constVoid,_0x353220=>pipe(_0x353220,option['fromPredicate'](_0x546a89=>_0x546a89['type']==='dxScript'),option['fold'](()=>{const _0x41b2a0={..._0x353220,'uuid':uuid()};_0x5cb208(),_0x5efa03(_0x41b2a0,_0x4e9b3a);},_0x4e49c5=>pipe(_0x4e49c5,_0xb04842['compileScriptStudy'],observable['filterMap'](identity),tap(_0x414051=>{_0x5cb208(),_0x5efa03(_0x414051,_0x4e9b3a),_0xb04842['onAddedOnChart'](_0x656480);}))['subscribe']())))),_0x1d2294=_0x10ddb0=>pipe(_0x306bec['getValue'](),array['filter'](_0x499256=>_0x499256['uuid']!==_0x10ddb0),_0xe23cec),_0x5c6df6=_0x1198be=>pipe(_0x306bec['getValue'](),array['map'](_0x214fd9=>_0x214fd9['uuid']===_0x1198be['uuid']?_0x1198be:_0x214fd9),_0xe23cec),_0x42be23=_0x3afaf2=>pipe(_0x306bec['getValue'](),array['map'](_0x800005=>_0x800005['id']===_0x3afaf2['id']?{..._0x800005,'title':_0x3afaf2['title']}:_0x800005),_0xe23cec),_0x36ddd6=()=>{_0xe23cec([]);},_0x1bcbfb=_0x1d4aea=>pipe(_0x1d4aea,array['map'](_0x1d8a04=>pipe(_0x1d8a04,option['fromPredicate'](_0x2cd8ea=>_0x2cd8ea['type']==='dxScript'),option['fold'](()=>observable['of'](some({..._0x1d8a04,'uuid':uuid()})),()=>pipe({..._0x1d8a04,'uuid':uuid()},_0xb04842['compileScriptStudy'])))),_0x808e2e=>combineLatest(_0x808e2e),defaultIfEmpty([]),observable['map'](array['filterMap'](identity)),tap(_0x121171))['subscribe'](),_0x4d93e5=_0x341e96=>pipe(_0x5a8b3d['getStudies'](),array['filterMap'](_0x28e719=>_0x341e96['find'](_0x5a6afd=>_0x28e719['id']===_0x5a6afd)?option['some'](_0x28e719):option['none']),_0x1bcbfb),_0x230335=_0x5a8b3d['observeStudies'](),_0x4bcfac=_0x230335['pipe'](tap(_0x45905c=>{const _0x136193=_0x306bec['getValue']();_0x45905c['filter'](_0x24eaf9=>_0x136193['find'](_0x294ae6=>_0x294ae6['id']===_0x24eaf9['id']&&_0x294ae6['title']!==_0x24eaf9['title']))['forEach'](_0x42be23);})),_0xa8a90c=pipe(_0x4834f1['state'],observable['filter'](_0x3c765c=>_0x3c765c['isStudiesSyncEnabled']),observable['map'](_0x199f90=>_0x199f90['lastStudies']),filter(_0x559912=>_0x559912!==_0x306bec['getValue']()),tap(_0x16a323)),_0x2d8285=pipe(_0x306bec,tap(_0x27d0ed)),_0x56a52f=merge(pipe(_0x2a1590['state'],observable['map'](_0x1e2d46=>_0x1e2d46['settings']['chartCore']['components']['offsets']['right']),distinctUntilChanged()),_0x20e327['chartModel']['observeCandlesChanged']())['pipe'](tap(_0x273a4b=>_0x564e74['getValue']()['forEach'](_0x39a669))),_0x4d6ef6={};_0x4d6ef6['trailing']=!![],_0x4d6ef6['leading']=!![];const _0xff796f=_0x3802d8['pipe'](throttleTime(0xa,undefined,_0x4d6ef6),tap(()=>{queueMicrotask(()=>keys(_0x3802d8['getValue']())['forEach'](_0x24c436=>_0x20e327['studiesComponent']['updateStudyData'](_0x24c436,_0x3802d8['getValue']()[_0x24c436])));})),_0x3e5321=pipe(_0xb04842['lastAddedScript'],_0xb2c535(),tap(_0x49f38a=>_0x3a694b(_0x49f38a['id']))),_0x39ac40=pipe(_0xb04842['lastUpdatedScript'],_0xb2c535(),observable['map'](_0x3e6c88=>pipe(_0x306bec['getValue'](),array['findFirst'](_0x276683=>_0x276683['id']===_0x3e6c88['id']))),observable['filterMap'](identity),tap(_0x2dcc98=>_0x3a694b(_0x2dcc98['id'],undefined,()=>_0x1d2294(_0x2dcc98['uuid'])))),_0x496994=pipe(_0x2a1590['state'],observable['map'](_0x4b22fc=>_0x4b22fc['settings']['chartReact']['scale']['fit']['studies']),distinctUntilChanged(),tap(_0x4b3a34=>{Object['values'](_0x20e327['studiesComponent']['studiesModel']['overlays'])['forEach'](_0x58753b=>{_0x58753b['dataSeries']['forEach'](_0x1dc4ea=>_0x1dc4ea['config']['highLowActive']=_0x4b3a34);}),_0x20e327['scaleModel']['autoScale']();}));_0x1e850d(_0x38dec8);const _0x5c1191=merge(_0xa8a90c,_0x2d8285,_0x56a52f,_0xff796f,_0x39ac40,_0x3e5321,_0x4bcfac,_0x496994),_0xba3375={};return _0xba3375['studies$']=_0x230335,_0xba3375['addedStudies$']=_0x306bec,_0xba3375['selectedStudyUUID$']=_0x23ca2a,_0xba3375['onAddedStudy']=_0x3a694b,_0xba3375['onRemoveStudy']=_0x1d2294,_0xba3375['onReorderStudies']=_0x3e793a,_0xba3375['onChangeStudy']=_0x5c6df6,_0xba3375['onRemoveAllStudies']=_0x36ddd6,_0xba3375['onClose']=_0x58fb2a,_0xba3375['onSave']=_0x28441d,_0xba3375['onOpen']=_0xefed0f,_0xba3375['onConfigureStudy']=_0x2162e4,_0xba3375['isOpened$']=_0x5c4e62,_0xba3375['setStudies']=_0x1bcbfb,_0xba3375['setStudiesByIds']=_0x4d93e5,newSink(callTracerProxy('studiesSettingsViewModel',_0xba3375),_0x5c1191);});