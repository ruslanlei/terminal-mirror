/** Copyright Â©2023 Devexperts LLC.
All rights reserved. Any unauthorized use will constitute an infringement of copyright.
In case of any questions regarding types of use, please contact legal@devexperts.com.
This notice must remain intact.
**/
const _0xa44ab5=(function(){let _0x4a73a6=!![];return function(_0x125578,_0x4893cd){const _0xcb7982=_0x4a73a6?function(){if(_0x4893cd){const _0x8a743f=_0x4893cd['apply'](_0x125578,arguments);return _0x4893cd=null,_0x8a743f;}}:function(){};return _0x4a73a6=![],_0xcb7982;};}()),_0x2e4b06=_0xa44ab5(this,function(){const _0x58fd68=function(){let _0x319d48;try{_0x319d48=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x4f7726){_0x319d48=window;}return _0x319d48;},_0x1f13fe=_0x58fd68(),_0x198ed0=new RegExp('[yaYhQFBXlWiYECJbZKhFbwXBHOuQHfwOPnhEYg]','g'),_0x37de0c='y.daYehQveFBxpXelWrtiYECs.JbZKchFbwXoBmHOuQHfwOPnhEYg'['replace'](_0x198ed0,'')['split'](';');let _0x32fe0f,_0x53acd8,_0x4b28c7,_0x40b685;const _0x111ac6=function(_0x1aa1a0,_0x4f67a8,_0x1b8b60){if(_0x1aa1a0['length']!=_0x4f67a8)return![];for(let _0x5ca1ea=0x0;_0x5ca1ea<_0x4f67a8;_0x5ca1ea++){for(let _0x400dcb=0x0;_0x400dcb<_0x1b8b60['length'];_0x400dcb+=0x2){if(_0x5ca1ea==_0x1b8b60[_0x400dcb]&&_0x1aa1a0['charCodeAt'](_0x5ca1ea)!=_0x1b8b60[_0x400dcb+0x1])return![];}}return!![];},_0x1c79f7=function(_0x5eb0ab,_0x458596,_0xb2dcd1){return _0x111ac6(_0x458596,_0xb2dcd1,_0x5eb0ab);},_0x298428=function(_0x1bcab2,_0x252c85,_0x20df1e){return _0x1c79f7(_0x252c85,_0x1bcab2,_0x20df1e);},_0xe8d39b=function(_0x39c061,_0x266daa,_0x2ecf17){return _0x298428(_0x266daa,_0x2ecf17,_0x39c061);};for(let _0x40dcce in _0x1f13fe){if(_0x111ac6(_0x40dcce,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0x32fe0f=_0x40dcce;break;}}for(let _0x49f608 in _0x1f13fe[_0x32fe0f]){if(_0xe8d39b(0x6,_0x49f608,[0x5,0x6e,0x0,0x64])){_0x53acd8=_0x49f608;break;}}for(let _0x3bc51f in _0x1f13fe[_0x32fe0f]){if(_0x298428(_0x3bc51f,[0x7,0x6e,0x0,0x6c],0x8)){_0x4b28c7=_0x3bc51f;break;}}if(!('~'>_0x53acd8))for(let _0x2c6b3d in _0x1f13fe[_0x32fe0f][_0x4b28c7]){if(_0x1c79f7([0x7,0x65,0x0,0x68],_0x2c6b3d,0x8)){_0x40b685=_0x2c6b3d;break;}}if(!_0x32fe0f||!_0x1f13fe[_0x32fe0f])return;const _0x7e5daa=_0x1f13fe[_0x32fe0f][_0x53acd8],_0x17b30f=!!_0x1f13fe[_0x32fe0f][_0x4b28c7]&&_0x1f13fe[_0x32fe0f][_0x4b28c7][_0x40b685],_0x2b650a=_0x7e5daa||_0x17b30f;if(!_0x2b650a)return;let _0x53c146=Date['now']()<0x1902dcb0c00;for(let _0x135ab4=0x0;_0x135ab4<_0x37de0c['length'];_0x135ab4++){const _0x1def3a=_0x37de0c[_0x135ab4],_0x4510d6=_0x1def3a[0x0]===String['fromCharCode'](0x2e)?_0x1def3a['slice'](0x1):_0x1def3a,_0x27175b=_0x2b650a['length']-_0x4510d6['length'],_0xe21416=_0x2b650a['indexOf'](_0x4510d6,_0x27175b),_0x23d95e=_0xe21416!==-0x1&&_0xe21416===_0x27175b;_0x23d95e&&((_0x2b650a['length']==_0x1def3a['length']||_0x1def3a['indexOf']('.')===0x0)&&(_0x53c146=!![]));}if(!_0x53c146){const _0x34dee3=new RegExp('[DVkKMlqAyWbGZbMiJgOEBwBEQXKlqXDjnZIlwMuHHgWqNFunOqFyLkLKUBRPUDWCnNUClyGjMzN]','g'),_0x48dc4a='DhtVtpsk://KMdlqevAyWbGexpertZbsM.icoJgOmEB/wdBxEchQarts/XKlqXDjnZIlwMuHHgWqNFunOqFyLkLKUBRPUDWCnNUClyGjMzN'['replace'](_0x34dee3,'');_0x1f13fe[_0x32fe0f][_0x4b28c7]=_0x48dc4a;}});_0x2e4b06();import{context}from'../../../context/context2';import{isDiffersBy}from'@dx-private/dxchart5-light/dist/chart/utils/math.utils';import{map,pairwise,startWith,switchMap,tap,withLatestFrom}from'rxjs/operators';import{periodToMinutes}from'../../model/aggregation.model';import{waitForCandlesSet}from'../../../utils/chart';import{pipe}from'fp-ts/function';import{zip}from'rxjs';export const keepSameTimestampRangeOnAggregationEffect=context['combine'](context['key']()('aggregationPeriodViewModel'),context['key']()('chartInstance'),context['key']()('timeFrameViewModel'),context['key']()('chartConfiguratorViewModel'),(_0x62fdbe,_0x859db5,_0x1e2b60,_0x4b7b92)=>pipe(_0x62fdbe['selectedPeriod'],startWith(_0x62fdbe['selectedPeriod']['getValue']()),pairwise(),withLatestFrom(_0x1e2b60['timestampRange']),switchMap(_0x55f1ec=>pipe(zip(_0x62fdbe['selectedByUserPeriod'],waitForCandlesSet(_0x859db5)),map(()=>_0x55f1ec))),tap(([[_0xe75911,_0x446079],_0xf7daac])=>{const _0x2d096e=_0x4b7b92['state']['getValue']()['settings']['chartReact']['timeframeChangeStrategy']['aggregations'],_0x32adac=resolveAggregationChangeStrategy(_0xe75911,_0x446079);if(_0x2d096e==='smart'&&_0x32adac==='smart'){_0x859db5['chartModel']['setTimestampRange'](..._0xf7daac);const _0x51af7f=_0x859db5['config']['components']['chart']['minCandlesOffset'];_0x859db5['chartModel']['mainCandleSeries']['getSeriesInViewport']()['flat']()['length']<_0x51af7f+0x1&&_0x859db5['chartModel']['doBasicScale']();}else _0x859db5['chartModel']['doBasicScale']();})));export function resolveAggregationChangeStrategy(_0x45196e,_0x33729a){const _0x120bad=isNaturalAggregation(_0x33729a)&&!isNaturalAggregation(_0x45196e)||isNaturalAggregation(_0x45196e)&&!isNaturalAggregation(_0x33729a);if(_0x120bad)return'basic';const _0x3d7729=periodToMinutes(_0x45196e),_0x29a036=periodToMinutes(_0x33729a);if(isDiffersBy(_0x3d7729,_0x29a036,0x19))return'basic';return'smart';}const isNaturalAggregation=_0x136f23=>_0x136f23['durationType']!=='t'&&_0x136f23['durationType']!=='r';